---
title: PostgreSQL
date: 2024-08-20 16:04:03
categories: 
- [Database]
tags: 
- postgresql
---


## 一、 部署

###  源码部署

- 安装依赖
  ` yum -y groupinstall "Development Tools"`
  ` yum -y install readline-devel zlib-devel libicu-devel bison flex`

- 下载源码
  ` wget https://ftp.postgresql.org/pub/source/v16.4/postgresql-16.4.tar.gz `

- 编译安装
  ` tar -xvf postgresql-16.4.tar.gz `
  ` cd  postgresql-16.4 `
  ` ./configure --prefix=/usr/local/pgsql-16.4 `
  ` make && make install `

- 创建用户/组
  ` groupadd postgres `
  ` useradd -m -g postgres postgres `
  ` chown -R postgres:postgres /usr/local/pgsql-16.4/ `

- 配置环境变量
  切换用户： ` su -l postgres `
  编辑文件： ` vim ~/.bash_profile `
  添加如下内容：
  ``` shell
  PGPORT=5432
  PGHOME=/data/pgsql-16.4
  PGDATA=/data/pgsql-16.4/data
  LD_LIBRARY_PATH=$PGHOME/lib:$LD_LIBRARY_PATH
  PATH=$PGHOME/bin:$PATH
  export PGPORT PGHOME PGDATA LD_LIBRARY_PATH PATH
  ```

- 初始化数据库
  ` su -l postgres `
  ` mkdir -p /usr/local/pgsql-16.4/data `
  ` /usr/local/pgsql-16.4/bin/initdb -D /usr/local/pgsql-16.4/data `

- 启动数据库
  ` /usr/local/pgsql-16.4/bin/pg_ctl -D /usr/local/pgsql-16.4/data -l logfile start `

- 创建用户和DB
  
  进入pgsql终端： ` /usr/local/pgsql-16.4/bin/psql -d postgres `
  创建数据库：
  ``` sql
  CREATE USER $username WITH PASSWORD '$password';
  CREATE DATABASE $dbname OWNER $username;
  ```
  ![images](/images/093.postgresql.md.01.png)

-  配置远程访问
  编辑： ` vim /usr/local/pgsql-16.4/data/pg_hba.conf` 
  ipv4 行添加如下： ` host    all             all             0.0.0.0/0               md5 `
  编辑： ` vim /usr/local/pgsql-16.4/data/postgres.conf ` 
  添加： ` listen_addresses = '*' `