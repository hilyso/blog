---
title: PostgreSQL
date: 2024-08-20 16:04:03
categories: 
- [Database]
tags: 
- postgresql
---


## 一、 部署

###  源码部署

- ### 1.1 安装依赖
  ` yum -y groupinstall "Development Tools"`
  ` yum -y install readline-devel zlib-devel libicu-devel bison flex`

- ### 1.2 下载源码
  ` wget https://ftp.postgresql.org/pub/source/v16.4/postgresql-16.4.tar.gz `

- ### 1.3 编译安装
  ` tar -xvf postgresql-16.4.tar.gz `
  ` cd  postgresql-16.4 `
  ` ./configure --prefix=/usr/local/pgsql-16.4 `
  ` make && make install `

- ### 1.4 创建用户/组
  ` groupadd postgres `
  ` useradd -m -g postgres postgres `
  ` chown -R postgres:postgres /usr/local/pgsql-16.4/ `

- ### 1.5 配置环境变量
  切换用户： ` su -l postgres `
  编辑文件： ` vim ~/.bash_profile `
  添加如下内容：
  ``` shell
  PGPORT=5432
  PGHOME=/data/pgsql-16.4
  PGDATA=/data/pgsql-16.4/data
  LD_LIBRARY_PATH=$PGHOME/lib:$LD_LIBRARY_PATH
  PATH=$PGHOME/bin:$PATH
  export PGPORT PGHOME PGDATA LD_LIBRARY_PATH PATH
  ```

- ### 1.6 初始化数据库
  ` su -l postgres `
  ` mkdir -p /usr/local/pgsql-16.4/data `
  ` /usr/local/pgsql-16.4/bin/initdb -D /usr/local/pgsql-16.4/data `

- ### 1.7 启动数据库
  ` /usr/local/pgsql-16.4/bin/pg_ctl -D /usr/local/pgsql-16.4/data -l logfile start `

- ### 1.8 创建用户和DB
  进入pgsql终端： ` /usr/local/pgsql-16.4/bin/psql -d postgres `
  创建数据库：
  ``` sql
  CREATE USER $username WITH PASSWORD '$password';
  CREATE DATABASE $dbname OWNER $username;
  ```
  ![images](/images/093.postgresql.md.01.png)

- ### 1.9 配置远程访问
  编辑： ` vim /usr/local/pgsql-16.4/data/pg_hba.conf` 
  ipv4 行添加如下： ` host    all             all             0.0.0.0/0               md5 `
  编辑： ` vim /usr/local/pgsql-16.4/data/postgres.conf ` 
  添加： ` listen_addresses = '*' `


- ### 1.10 使用systemd管理
  ``` shell
  # /usr/local/pgsql/postgresql-16.service
  [Unit]
  Description=PostgreSQL-16.4
  After=network.target
  [Service]
  Type=forking
  User=postgres
  Group=postgres
  Environment=PGPORT=2345
  Environment=PGDATA=/usr/local/pgsql/data/
  OOMScoreAdjust=-1000
  ExecStart=/usr/local/pgsql/bin/pg_ctl start -D ${PGDATA} -s -o "-p ${PGPORT}" -w -t 300
  ExecStop=/usr/local/pgsql/bin/pg_ctl stop -D ${PGDATA} -s -m fast
  ExecReload=/data/pgsql-12/bin/pg_ctl reload -D ${PGDATA} -s
  TimeoutSec=300
  [Install]
  WantedBy=multi-user.target
  ```
  ` systemctl daemon-reload `
  ` systemctl enable postgresql-16 --now `


## 二、 插件安装

### mysql_fdw 

- 