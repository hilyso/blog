{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"source/images/002.progress.md.01.png","path":"images/002.progress.md.01.png","modified":1,"renderable":0},{"_id":"source/images/004.lvm.md.01.png","path":"images/004.lvm.md.01.png","modified":1,"renderable":0},{"_id":"source/images/004.lvm.md.02.png","path":"images/004.lvm.md.02.png","modified":1,"renderable":0},{"_id":"source/images/004.lvm.md.03.png","path":"images/004.lvm.md.03.png","modified":1,"renderable":0},{"_id":"source/images/004.lvm.md.04.png","path":"images/004.lvm.md.04.png","modified":1,"renderable":0},{"_id":"source/images/005.elasticsearch.md.01.png","path":"images/005.elasticsearch.md.01.png","modified":1,"renderable":0},{"_id":"source/images/005.elasticsearch.md.02.png","path":"images/005.elasticsearch.md.02.png","modified":1,"renderable":0},{"_id":"source/images/005.elasticsearch.md.03.png","path":"images/005.elasticsearch.md.03.png","modified":1,"renderable":0},{"_id":"source/images/005.elasticsearch.md.04.png","path":"images/005.elasticsearch.md.04.png","modified":1,"renderable":0},{"_id":"source/images/005.elasticsearch.md.05.png","path":"images/005.elasticsearch.md.05.png","modified":1,"renderable":0},{"_id":"source/images/005.elasticsearch.md.06.png","path":"images/005.elasticsearch.md.06.png","modified":1,"renderable":0},{"_id":"source/images/005.elasticsearch.md.07.png","path":"images/005.elasticsearch.md.07.png","modified":1,"renderable":0},{"_id":"source/images/005.elasticsearch.md.08.png","path":"images/005.elasticsearch.md.08.png","modified":1,"renderable":0},{"_id":"source/images/006.iptables.md.01.png","path":"images/006.iptables.md.01.png","modified":1,"renderable":0},{"_id":"source/images/006.iptables.md.02.png","path":"images/006.iptables.md.02.png","modified":1,"renderable":0},{"_id":"source/images/006.iptables.md.03.png","path":"images/006.iptables.md.03.png","modified":1,"renderable":0},{"_id":"source/images/007.system_info.md.01.png","path":"images/007.system_info.md.01.png","modified":1,"renderable":0},{"_id":"source/images/008.reset_password.md.01.png","path":"images/008.reset_password.md.01.png","modified":1,"renderable":0},{"_id":"source/images/008.reset_password.md.02.png","path":"images/008.reset_password.md.02.png","modified":1,"renderable":0},{"_id":"source/images/009.openssh.md.01.png","path":"images/009.openssh.md.01.png","modified":1,"renderable":0},{"_id":"source/images/009.openssh.md.02.png","path":"images/009.openssh.md.02.png","modified":1,"renderable":0},{"_id":"source/images/009.openssh.md.03.png","path":"images/009.openssh.md.03.png","modified":1,"renderable":0},{"_id":"source/images/009.openssh.md.04.png","path":"images/009.openssh.md.04.png","modified":1,"renderable":0},{"_id":"source/images/009.openssh.md.05.png","path":"images/009.openssh.md.05.png","modified":1,"renderable":0},{"_id":"source/images/009.openssh.md.06.png","path":"images/009.openssh.md.06.png","modified":1,"renderable":0},{"_id":"source/images/009.openssh.md.07.png","path":"images/009.openssh.md.07.png","modified":1,"renderable":0},{"_id":"source/images/012.docker_installation.md.01.png","path":"images/012.docker_installation.md.01.png","modified":1,"renderable":0},{"_id":"source/images/017.oracle.md.01.png","path":"images/017.oracle.md.01.png","modified":1,"renderable":0},{"_id":"source/images/017.oracle.md.02.png","path":"images/017.oracle.md.02.png","modified":1,"renderable":0},{"_id":"source/images/017.oracle.md.03.png","path":"images/017.oracle.md.03.png","modified":1,"renderable":0},{"_id":"source/images/017.oracle.md.04.png","path":"images/017.oracle.md.04.png","modified":1,"renderable":0},{"_id":"source/images/017.oracle.md.05.png","path":"images/017.oracle.md.05.png","modified":1,"renderable":0},{"_id":"source/images/017.oracle.md.06.png","path":"images/017.oracle.md.06.png","modified":1,"renderable":0},{"_id":"source/images/017.oracle.md.07.png","path":"images/017.oracle.md.07.png","modified":1,"renderable":0},{"_id":"source/images/017.oracle.md.08.png","path":"images/017.oracle.md.08.png","modified":1,"renderable":0},{"_id":"source/images/017.oracle.md.09.png","path":"images/017.oracle.md.09.png","modified":1,"renderable":0},{"_id":"source/images/017.oracle.md.10.png","path":"images/017.oracle.md.10.png","modified":1,"renderable":0},{"_id":"source/images/017.oracle.md.11.png","path":"images/017.oracle.md.11.png","modified":1,"renderable":0},{"_id":"source/images/017.oracle.md.12.png","path":"images/017.oracle.md.12.png","modified":1,"renderable":0},{"_id":"source/images/017.oracle.md.13.png","path":"images/017.oracle.md.13.png","modified":1,"renderable":0},{"_id":"source/images/027.telnet.md.01.png","path":"images/027.telnet.md.01.png","modified":1,"renderable":0},{"_id":"source/images/027.telnet.md.02.png","path":"images/027.telnet.md.02.png","modified":1,"renderable":0},{"_id":"source/images/028.docker_instances.md.01.png","path":"images/028.docker_instances.md.01.png","modified":1,"renderable":0},{"_id":"source/images/029.install_php7.4.33.md.01.png","path":"images/029.install_php7.4.33.md.01.png","modified":1,"renderable":0},{"_id":"source/images/029.install_php7.4.33.md.02.png","path":"images/029.install_php7.4.33.md.02.png","modified":1,"renderable":0},{"_id":"source/images/029.install_php7.4.33.md.03.png","path":"images/029.install_php7.4.33.md.03.png","modified":1,"renderable":0},{"_id":"source/images/031.ca.md.01.png","path":"images/031.ca.md.01.png","modified":1,"renderable":0},{"_id":"source/images/031.ca.md.02.png","path":"images/031.ca.md.02.png","modified":1,"renderable":0},{"_id":"source/images/031.ca.md.03.png","path":"images/031.ca.md.03.png","modified":1,"renderable":0},{"_id":"source/images/034.redis.md.01.png","path":"images/034.redis.md.01.png","modified":1,"renderable":0},{"_id":"source/images/002.progress.md.02.png","path":"images/002.progress.md.02.png","modified":1,"renderable":0},{"_id":"source/images/035.ssh_key.md.01.png","path":"images/035.ssh_key.md.01.png","modified":1,"renderable":0},{"_id":"source/images/036.openwrt_disk_expansion.md.02.png","path":"images/036.openwrt_disk_expansion.md.02.png","modified":1,"renderable":0},{"_id":"source/images/037.kvm.md.01.png","path":"images/037.kvm.md.01.png","modified":1,"renderable":0},{"_id":"source/images/037.kvm.md.02.png","path":"images/037.kvm.md.02.png","modified":1,"renderable":0},{"_id":"source/images/037.kvm.md.03.png","path":"images/037.kvm.md.03.png","modified":1,"renderable":0},{"_id":"source/images/037.kvm.md.04.png","path":"images/037.kvm.md.04.png","modified":1,"renderable":0},{"_id":"source/images/040.openwrt_install_passwall.md.01.png","path":"images/040.openwrt_install_passwall.md.01.png","modified":1,"renderable":0},{"_id":"source/images/040.openwrt_install_passwall.md.02.png","path":"images/040.openwrt_install_passwall.md.02.png","modified":1,"renderable":0},{"_id":"source/images/040.openwrt_install_passwall.md.03.png","path":"images/040.openwrt_install_passwall.md.03.png","modified":1,"renderable":0},{"_id":"source/images/040.openwrt_install_passwall.md.04.png","path":"images/040.openwrt_install_passwall.md.04.png","modified":1,"renderable":0},{"_id":"source/images/041.openwrt_install_frpc.md.01.png","path":"images/041.openwrt_install_frpc.md.01.png","modified":1,"renderable":0},{"_id":"source/images/041.openwrt_install_frpc.md.02.png","path":"images/041.openwrt_install_frpc.md.02.png","modified":1,"renderable":0},{"_id":"source/images/043.Cryptocurrency_Mining_Malware.md.01.png","path":"images/043.Cryptocurrency_Mining_Malware.md.01.png","modified":1,"renderable":0},{"_id":"source/images/043.Cryptocurrency_Mining_Malware.md.02.png","path":"images/043.Cryptocurrency_Mining_Malware.md.02.png","modified":1,"renderable":0},{"_id":"source/images/043.Cryptocurrency_Mining_Malware.md.03.png","path":"images/043.Cryptocurrency_Mining_Malware.md.03.png","modified":1,"renderable":0},{"_id":"source/images/043.Cryptocurrency_Mining_Malware.md.04.png","path":"images/043.Cryptocurrency_Mining_Malware.md.04.png","modified":1,"renderable":0},{"_id":"source/images/043.Cryptocurrency_Mining_Malware.md.05.png","path":"images/043.Cryptocurrency_Mining_Malware.md.05.png","modified":1,"renderable":0},{"_id":"source/images/043.Cryptocurrency_Mining_Malware.md.06.png","path":"images/043.Cryptocurrency_Mining_Malware.md.06.png","modified":1,"renderable":0},{"_id":"source/images/043.Cryptocurrency_Mining_Malware.md.07.png","path":"images/043.Cryptocurrency_Mining_Malware.md.07.png","modified":1,"renderable":0},{"_id":"source/images/043.Cryptocurrency_Mining_Malware.md.08.png","path":"images/043.Cryptocurrency_Mining_Malware.md.08.png","modified":1,"renderable":0},{"_id":"source/images/045.v2raya.md.00.png","path":"images/045.v2raya.md.00.png","modified":1,"renderable":0},{"_id":"source/images/045.v2raya.md.000.png","path":"images/045.v2raya.md.000.png","modified":1,"renderable":0},{"_id":"source/images/045.v2raya.md.01.png","path":"images/045.v2raya.md.01.png","modified":1,"renderable":0},{"_id":"source/images/045.v2raya.md.02.png","path":"images/045.v2raya.md.02.png","modified":1,"renderable":0},{"_id":"source/images/045.v2raya.md.03.png","path":"images/045.v2raya.md.03.png","modified":1,"renderable":0},{"_id":"source/images/046.docker_install_manual.md.01.png","path":"images/046.docker_install_manual.md.01.png","modified":1,"renderable":0},{"_id":"source/images/046.docker_install_manual.md.02.png","path":"images/046.docker_install_manual.md.02.png","modified":1,"renderable":0},{"_id":"source/images/047.docker_build_instances.md.01.png","path":"images/047.docker_build_instances.md.01.png","modified":1,"renderable":0},{"_id":"source/images/047.docker_build_instances.md.02.png","path":"images/047.docker_build_instances.md.02.png","modified":1,"renderable":0},{"_id":"source/images/047.docker_build_instances.md.03.png","path":"images/047.docker_build_instances.md.03.png","modified":1,"renderable":0},{"_id":"source/images/049.centos_downgrade.md.01.png","path":"images/049.centos_downgrade.md.01.png","modified":1,"renderable":0},{"_id":"source/images/050.registry_setup.md.01.png","path":"images/050.registry_setup.md.01.png","modified":1,"renderable":0},{"_id":"source/images/050.registry_setup.md.02.png","path":"images/050.registry_setup.md.02.png","modified":1,"renderable":0},{"_id":"source/images/003.clamav.md.01.png","path":"images/003.clamav.md.01.png","modified":1,"renderable":0},{"_id":"source/images/051.MySQL_Install_Using_Generic_Binaries.md.01.png","path":"images/051.MySQL_Install_Using_Generic_Binaries.md.01.png","modified":1,"renderable":0},{"_id":"source/images/051.MySQL_Install_Using_Generic_Binaries.md.02.png","path":"images/051.MySQL_Install_Using_Generic_Binaries.md.02.png","modified":1,"renderable":0},{"_id":"source/images/052.MySQL_Installation_Uasing_Source.md.01.png","path":"images/052.MySQL_Installation_Uasing_Source.md.01.png","modified":1,"renderable":0},{"_id":"source/images/053.Prometheus_Installation.md.01.png","path":"images/053.Prometheus_Installation.md.01.png","modified":1,"renderable":0},{"_id":"source/images/055.Gitlab_Installation.md.01.png","path":"images/055.Gitlab_Installation.md.01.png","modified":1,"renderable":0},{"_id":"source/images/055.Gitlab_Installation.md.02.png","path":"images/055.Gitlab_Installation.md.02.png","modified":1,"renderable":0},{"_id":"source/images/055.Gitlab_Installation.md.03.png","path":"images/055.Gitlab_Installation.md.03.png","modified":1,"renderable":0},{"_id":"source/images/056.Harbor_Installation.md.01.png","path":"images/056.Harbor_Installation.md.01.png","modified":1,"renderable":0},{"_id":"source/images/056.Harbor_Installation.md.02.png","path":"images/056.Harbor_Installation.md.02.png","modified":1,"renderable":0},{"_id":"source/images/057.Linux_Security_Policy.md.01.png","path":"images/057.Linux_Security_Policy.md.01.png","modified":1,"renderable":0},{"_id":"source/images/057.Linux_Security_Policy.md.02.png","path":"images/057.Linux_Security_Policy.md.02.png","modified":1,"renderable":0},{"_id":"source/images/059.samba.md.01.png","path":"images/059.samba.md.01.png","modified":1,"renderable":0},{"_id":"source/images/059.samba.md.02.png","path":"images/059.samba.md.02.png","modified":1,"renderable":0},{"_id":"source/images/059.samba.md.03.png","path":"images/059.samba.md.03.png","modified":1,"renderable":0},{"_id":"source/images/059.samba.md.04.png","path":"images/059.samba.md.04.png","modified":1,"renderable":0},{"_id":"source/images/059.samba.md.05.png","path":"images/059.samba.md.05.png","modified":1,"renderable":0},{"_id":"source/images/059.samba.md.06.png","path":"images/059.samba.md.06.png","modified":1,"renderable":0},{"_id":"source/images/060.highlight.md.01.png","path":"images/060.highlight.md.01.png","modified":1,"renderable":0},{"_id":"source/images/003.clamav.md.02.png","path":"images/003.clamav.md.02.png","modified":1,"renderable":0},{"_id":"source/images/036.openwrt_disk_expansion.md.01.png","path":"images/036.openwrt_disk_expansion.md.01.png","modified":1,"renderable":0},{"_id":"source/images/052.MySQL_Installation_Uasing_Source.md.02.png","path":"images/052.MySQL_Installation_Uasing_Source.md.02.png","modified":1,"renderable":0},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"themes/next/source/css/noscript.styl","path":"css/noscript.styl","modified":1,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/logo-algolia-nebula-blue-full.svg","path":"images/logo-algolia-nebula-blue-full.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":1,"renderable":1},{"_id":"themes/next/source/js/bookmark.js","path":"js/bookmark.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/comments-buttons.js","path":"js/comments-buttons.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/comments.js","path":"js/comments.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/config.js","path":"js/config.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/motion.js","path":"js/motion.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/next-boot.js","path":"js/next-boot.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/pjax.js","path":"js/pjax.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/schedule.js","path":"js/schedule.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/utils.js","path":"js/utils.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/schemes/muse.js","path":"js/schemes/muse.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/fancybox.js","path":"js/third-party/fancybox.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/pace.js","path":"js/third-party/pace.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/quicklink.js","path":"js/third-party/quicklink.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/baidu-analytics.js","path":"js/third-party/analytics/baidu-analytics.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/google-analytics.js","path":"js/third-party/analytics/google-analytics.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/matomo.js","path":"js/third-party/analytics/matomo.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/growingio.js","path":"js/third-party/analytics/growingio.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/changyan.js","path":"js/third-party/comments/changyan.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/disqus.js","path":"js/third-party/comments/disqus.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/disqusjs.js","path":"js/third-party/comments/disqusjs.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/gitalk.js","path":"js/third-party/comments/gitalk.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/isso.js","path":"js/third-party/comments/isso.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/livere.js","path":"js/third-party/comments/livere.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/utterances.js","path":"js/third-party/comments/utterances.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/chat/chatra.js","path":"js/third-party/chat/chatra.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/chat/gitter.js","path":"js/third-party/chat/gitter.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/chat/tidio.js","path":"js/third-party/chat/tidio.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/math/katex.js","path":"js/third-party/math/katex.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/math/mathjax.js","path":"js/third-party/math/mathjax.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/search/algolia-search.js","path":"js/third-party/search/algolia-search.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/search/local-search.js","path":"js/third-party/search/local-search.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/tags/mermaid.js","path":"js/third-party/tags/mermaid.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/tags/pdf.js","path":"js/third-party/tags/pdf.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/statistics/firestore.js","path":"js/third-party/statistics/firestore.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/statistics/lean-analytics.js","path":"js/third-party/statistics/lean-analytics.js","modified":1,"renderable":1}],"Cache":[{"_id":"source/404/index.md","hash":"fcbd3c87e1d51c4adc7651626b261c4b4bb10626","modified":1701766350872},{"_id":"source/CI-CD/index.md","hash":"65d8012d62937b3d55fd8d712faf2b7a0d827fe5","modified":1701766350872},{"_id":"source/Database/index.md","hash":"7710738da8de52ed039bde71421224a8d3bae08e","modified":1701766350872},{"_id":"source/DevOps/index.md","hash":"06db1bdb5edbdf7725348cd554b6aec11c194011","modified":1701766350872},{"_id":"source/Docker/index.md","hash":"be4d183c091fa1f341263288a888fd2d49d113b2","modified":1701766350873},{"_id":"source/KVM/index.md","hash":"7c97d771c38d0c422cbff1d2cca01ecd1ec22c53","modified":1701766350873},{"_id":"source/Linux/index.md","hash":"76f668de31a70ac167be393e36c0cd2b13a79cad","modified":1701766350873},{"_id":"source/Monitor/index.md","hash":"9e0ba885d9e139c5832e67850716753d4bdc041c","modified":1701766350873},{"_id":"source/K8S/index.md","hash":"c598ceb6d44a77fe0c2b6cc30c0edb6f15fd0ecf","modified":1701766350873},{"_id":"source/MySQL/index.md","hash":"51486259a427a217d312d6e041fe7e442c884204","modified":1701766350873},{"_id":"source/NetWork/index.md","hash":"74031c67c6667ad937451227a5d2bf5f2dab1afe","modified":1701766350873},{"_id":"source/OpenWrt/index.md","hash":"9a85fe671efedd9f6c429b29aab605da136a526e","modified":1701766350873},{"_id":"source/Oracle/index.md","hash":"e18b918733b1b14adb331a47c737087fab28bb30","modified":1701766350873},{"_id":"source/Security/index.md","hash":"dc6f89bc557392981c6cb29dbcdbf205d6e71eed","modified":1701766350874},{"_id":"source/RaspberryPi/index.md","hash":"343568eed29c20ec3ece5ecb4a367a14bb05bc6e","modified":1701766350873},{"_id":"source/Ubuntu/index.md","hash":"4a04d19816d856f2722362f16c8a35be0d1d346f","modified":1701766350874},{"_id":"source/_posts/002.progress.md","hash":"85c7f6c5e29461cd6f82341c49fa12ea37bbcfc9","modified":1701766350874},{"_id":"source/_posts/001.frp.md","hash":"be8ab3b545617a7c9947bbff83c40b415ff32309","modified":1701766350874},{"_id":"source/_posts/003.clamav.md","hash":"5e53b4f19eb3b68dd4615a35061f7041126f8745","modified":1701766350874},{"_id":"source/_posts/004.lvm.md","hash":"916e15e727c8105c5c95e82b43702c7584e6862e","modified":1701766350874},{"_id":"source/_posts/005.elasticsearch.md","hash":"b8e2268da3a44b19393b47c8122869bf0fe52f0d","modified":1701766350874},{"_id":"source/_posts/007.system_monitor.md","hash":"bb50b3c64f1706bc704789f39829572242c06125","modified":1701766350875},{"_id":"source/_posts/006.iptables.md","hash":"f3a82563cabe164767d6acdd5c0e121914cf89a8","modified":1701766350874},{"_id":"source/_posts/008.reset_password.md","hash":"b8eb294d3a0a45bc4da31e55b2b9e23546a21e5f","modified":1701766350875},{"_id":"source/_posts/010.gcc_update.md","hash":"c1a01943683ad8388900e4bf603fc392f5fd6f54","modified":1701766350875},{"_id":"source/_posts/012.docker_installation.md","hash":"148805bc6d454ba96500ad5e8a39f1e4ca832c30","modified":1701766350875},{"_id":"source/_posts/011.apache-doris.md","hash":"850cd50d0097bd93bff3a5db622f4a7bb6f880d4","modified":1701766350875},{"_id":"source/_posts/013.keepalived.md","hash":"8684aa6ac8d90692063151588d1d41400215fc2a","modified":1701766350875},{"_id":"source/_posts/014.linux_shell_redirect.md","hash":"2df198e7ca7b2f339cb9104758f09dd1e53b958f","modified":1701766350875},{"_id":"source/_posts/009.openssh.md","hash":"d7488ab48302f5a19df525443cda885ecd8c8da8","modified":1701766350875},{"_id":"source/_posts/015.windows_route.md","hash":"d01ac49e4abea3c45cdd48a44823dbfa6bb9f37f","modified":1701766350875},{"_id":"source/_posts/016.take_ownership.md","hash":"4f829c7b4db6c3be8b510d4018be0ca0f390e80b","modified":1701766350876},{"_id":"source/_posts/018.mysql.md","hash":"fb3c6a2b1caccf749e7b6055081032a1b794e662","modified":1701766350876},{"_id":"source/_posts/020.mount.md","hash":"6cf5e7657fef57259e46157e65e385dbd57ab80c","modified":1701766350877},{"_id":"source/_posts/019.sudo.md","hash":"c6b16dce1931983b33dba89e4d01776365c5f2c4","modified":1701766350877},{"_id":"source/_posts/021.CentOS-Base.repo.md","hash":"ea952d4bb44ba4cc61cb59294337a35baf439329","modified":1701766350877},{"_id":"source/_posts/023.access.md","hash":"6ab727ae9692374fc0e4313d0a8b8109a71d282b","modified":1701766350877},{"_id":"source/_posts/022.MySQL_backup.md","hash":"5ee9ecf48eed9de757344f3527fa73e7cb45e2f9","modified":1701766350877},{"_id":"source/_posts/025.ssh.md","hash":"02b8b806fab4be1baa2ff5e5e06c4ad5ecddba06","modified":1701766350877},{"_id":"source/_posts/026.xserver.md","hash":"a3a92425bfcfd81190077749c4a74334065e64b5","modified":1701766350877},{"_id":"source/_posts/024.fstab.md","hash":"8691a17e77c0586e9f31b193061faee93b0e7f74","modified":1701766350877},{"_id":"source/_posts/017.Oracle.md","hash":"25b0115626d80e84060ff00240b7d03ba8b37d65","modified":1701766350876},{"_id":"source/_posts/029.install_php7.4.33.md","hash":"a6027d3467cf31c0ee25b18ff60d841d812a17ce","modified":1701766350877},{"_id":"source/_posts/031.ca.md","hash":"0ebfb7b7f42fc5660e6f0a6b68e921f95b3486ba","modified":1701766350878},{"_id":"source/_posts/027.telnet.md","hash":"91ae33ce0fc9c264f363c85eb0b7cbd633990255","modified":1701766350877},{"_id":"source/_posts/032.acme.sh.md","hash":"02fd7aece38c517c63e9b331f716cbebd1c6dcaf","modified":1701766350878},{"_id":"source/_posts/033.tcpdump_instances.md","hash":"720eacb4b26e6f9c2a980a948ffa273dcf75ffa3","modified":1701766350878},{"_id":"source/_posts/030.nextcloud.md","hash":"e87afac4d341707515267499f01192f43c3938ec","modified":1701766350878},{"_id":"source/_posts/035.ssh_key.md","hash":"b198259219d5224fe0925e5c38587d0a67909f4c","modified":1701766350878},{"_id":"source/_posts/034.redis.md","hash":"fbb307c90c4b5d7a3d0d478191c593f5c99c6430","modified":1701766350878},{"_id":"source/_posts/036.openwrt_disk_expansion.md","hash":"7549273eca76736b057aac266048b9b8190d6895","modified":1701766350878},{"_id":"source/_posts/037.kvm.md","hash":"d0a57da181ab0fcd638a222e36bb4629ef768438","modified":1701766350878},{"_id":"source/_posts/028.docker_instances.md","hash":"2a30f176cf05e2db077b96a2e26195c7cb2bd233","modified":1701766350877},{"_id":"source/_posts/038.ubuntu_network_config.md","hash":"96c3a381b13b8149a0abb9e039c6d1c82c6ea93d","modified":1701766350878},{"_id":"source/_posts/040.openwrt_install_passwall.md","hash":"a94afb6843236b3b14793d7ad674bd1f0f991b9b","modified":1701766350878},{"_id":"source/_posts/041.openwrt_install_frpc.md","hash":"8b4eb70250126e7fffadeaae4a119dff220e4f34","modified":1701766350878},{"_id":"source/_posts/040.openwrt_sftp.md","hash":"bcd6ac266836440d1010c0d6c6c1cb0dbe552bda","modified":1701766350878},{"_id":"source/_posts/045.v2raya.md","hash":"1e74c538081e18e63c21d66c207aea626be7cbda","modified":1701766350879},{"_id":"source/_posts/042.Greenbone_Community_installation.md","hash":"6f79fac3e54f002d9d90a49c9b945ffad5c7a8e1","modified":1701766350878},{"_id":"source/_posts/043.Cryptocurrency_Mining_Malware.md","hash":"0978785d50ae50d29d1759ba3f5a5699e8594fc0","modified":1701766350879},{"_id":"source/_posts/044.about_process.md","hash":"45451dbe6116edb774eea86cbd4bf230658d7e41","modified":1701766350879},{"_id":"source/_posts/046.docker_install_manual.md","hash":"94ebce0d5b7ba8d8e91a2841d2f023aa3da9519e","modified":1701766350879},{"_id":"source/_posts/049.centos_downgrade.md","hash":"42799c73144bc7e9a3027fd1ef2bd929aa660315","modified":1701766350879},{"_id":"source/_posts/048.docker-compose_instance.md","hash":"9f4c4cdfe5375273308147895d74b9fb2a7588bf","modified":1701766350879},{"_id":"source/_posts/050.registry_setup.md","hash":"21e42d2c71247fc2c9f76a0d43ea44509e2fe9de","modified":1701766350879},{"_id":"source/_posts/047.docker_build_instances.md","hash":"558a65a803704f318bd71574ba5134d4d7951453","modified":1701766350879},{"_id":"source/_posts/051.MySQL_Install_Using_Generic_Binaries.md","hash":"8674404e195ae1090e4331c4e3095e72ff6323b7","modified":1701766350879},{"_id":"source/_posts/053.Prometheus_Installation.md","hash":"d9364499476c9904962b260c8139bc4894d93be6","modified":1701766350879},{"_id":"source/_posts/054.Grafana_Installation.md","hash":"692083153f55b69b9dae8f4109c983d5b9a19f39","modified":1701766350880},{"_id":"source/_posts/052.MySQL_Installation_Uasing_Source.md","hash":"9ab3610660cc89f9fbbe9547de6a30c52be3bb73","modified":1701766350879},{"_id":"source/_posts/055.Gitlab_Installation.md","hash":"51c0f2284b23bbb266b6fb8e0f2643f219df5ea7","modified":1701766350880},{"_id":"source/_posts/056.Harbor_Installation.md","hash":"f7c74bfcf5934d77c337561a1fec7ec78d03289b","modified":1701766350880},{"_id":"source/_posts/057.Linux_Security_Policy.md","hash":"7c4ab9e7b248c88d5ff34ae95cfed93474b0f90d","modified":1701766350880},{"_id":"source/_posts/061.hexo.md","hash":"fce508f92bf902fd17944f77ae183936bf0b6cfe","modified":1701766350882},{"_id":"source/_posts/060.highlight.md","hash":"a0ff5b934d1a3b68d4528fa8002db948a29ced18","modified":1701766350882},{"_id":"source/_posts/059.samba.md","hash":"abf41b9a48bf6a8bea6bdbbc49f8a23eb9e5473b","modified":1701766350882},{"_id":"source/_posts/058.MySQL_Security_Policy.md","hash":"4c6cfeabb2cd04d86be93e699c6227580ef8efb5","modified":1701766350881},{"_id":"source/_posts/999.Tips-linux.md","hash":"df621cc60dec3cb4b035cde07d76ba9d8c9f4398","modified":1701766350882},{"_id":"source/tags/index.md","hash":"cf9910aadbd6ee66f7c3fc57d377bf369248d70f","modified":1701766350978},{"_id":"source/categories/index.md","hash":"b929d9e67ea42ff88d1878a89460195e998010da","modified":1701766350882},{"_id":"source/images/004.lvm.md.01.png","hash":"4691bdaaad12fd18057c68ea088d386eb9589aaa","modified":1701766350886},{"_id":"source/images/004.lvm.md.02.png","hash":"aa7c480cbf16659a6c6211269f30ce45935d4bc1","modified":1701766350886},{"_id":"source/images/004.lvm.md.04.png","hash":"aa8a446f698cbe4d7fa1f28ef4d3337fd5f73563","modified":1701766350887},{"_id":"source/images/005.elasticsearch.md.02.png","hash":"329eed1611a056e7cf1f528ba14ef31cf05735fa","modified":1701766350888},{"_id":"source/images/005.elasticsearch.md.03.png","hash":"ffca61e0e1f015bf6be403c04731b0bb7273dc79","modified":1701766350889},{"_id":"source/images/005.elasticsearch.md.04.png","hash":"db3bde9a0df0c8b47c6d6f1166f451f547304788","modified":1701766350889},{"_id":"source/images/005.elasticsearch.md.05.png","hash":"8bbe91b742b6137ee3bae4fd3f70f765355f96e5","modified":1701766350890},{"_id":"source/images/005.elasticsearch.md.07.png","hash":"7b7fd9dd060e50154e3e18852776a8331b9f6021","modified":1701766350892},{"_id":"source/images/006.iptables.md.03.png","hash":"aa545771eb288bc4df8e83473ef388f25b68c927","modified":1701766350895},{"_id":"source/images/006.iptables.md.02.png","hash":"db12992e1b0eaf706179a1230181ef1a242eafcf","modified":1701766350895},{"_id":"source/images/007.system_info.md.01.png","hash":"813e1e65e4b399d93e57361339a654144a110f37","modified":1701766350896},{"_id":"source/images/008.reset_password.md.02.png","hash":"4333f8384df6b215607b9dec80914423543793ea","modified":1701766350897},{"_id":"source/images/008.reset_password.md.01.png","hash":"2b4f99f2c2c13db63c096c22019fa1c126f6d20a","modified":1701766350896},{"_id":"source/images/012.docker_installation.md.01.png","hash":"fa5bbbb2f87bbdcf8ac1a9e80034d94cbd21d3a2","modified":1701766350907},{"_id":"source/images/017.oracle.md.02.png","hash":"6e4d4cb67bcf23f5b88ad10a3241cde173ff42e6","modified":1701766350908},{"_id":"source/images/017.oracle.md.01.png","hash":"211dd097f37c6e70f5b86e536eeee8c4027b5435","modified":1701766350907},{"_id":"source/images/017.oracle.md.04.png","hash":"2648e9f5df7cec3094c70f63605b7154d3a8cb90","modified":1701766350910},{"_id":"source/images/017.oracle.md.06.png","hash":"226eadca708d5ba0fa558605e34fe7e364d6b8cb","modified":1701766350911},{"_id":"source/images/017.oracle.md.03.png","hash":"eb6c377bf624d93664c2981f147a9632926f672a","modified":1701766350909},{"_id":"source/images/017.oracle.md.05.png","hash":"25676c6654f6ae754f2a94bdf02ea0d5ef6a8ab0","modified":1701766350910},{"_id":"source/images/017.oracle.md.09.png","hash":"20bbfe2ace9d23e73e9472932641e12a7ffb4dee","modified":1701766350913},{"_id":"source/images/017.oracle.md.10.png","hash":"89795d32ebc27265a4cc1f264a919c12be26ac47","modified":1701766350914},{"_id":"source/images/017.oracle.md.12.png","hash":"7b6376413020ff55a749dd6c161cb5b752adc566","modified":1701766350915},{"_id":"source/images/017.oracle.md.11.png","hash":"3e10efa851efa0cb347ae4e068dbd6f504fb4c8e","modified":1701766350914},{"_id":"source/images/028.docker_instances.md.01.png","hash":"bf929e46c4ca2dec608b43d80f3de40fcead2496","modified":1701766350918},{"_id":"source/images/031.ca.md.01.png","hash":"67e063dffdec69fc78d24997d2dc32a3263b82f7","modified":1701766350927},{"_id":"source/images/035.ssh_key.md.01.png","hash":"66bc80eb445e96d0f910bff62af74c6e247a484c","modified":1701766350931},{"_id":"source/images/002.progress.md.02.png","hash":"f53fdc057abd32d1b18bf6b03848280892cac4fd","modified":1701766350884},{"_id":"source/images/040.openwrt_install_passwall.md.03.png","hash":"bf45100d1dce0dad051f62af9b849c8c90d3f6a8","modified":1701766350944},{"_id":"source/images/040.openwrt_install_passwall.md.01.png","hash":"f501473a5c2dfefa8e30d9120a8da378fb372b4a","modified":1701766350943},{"_id":"source/images/040.openwrt_install_passwall.md.04.png","hash":"15735380aa3c8172855c6e20f8eaa350b469b583","modified":1701766350944},{"_id":"source/images/041.openwrt_install_frpc.md.01.png","hash":"3fb1959b14a4fed2970a040cdd91d36d108ec12a","modified":1701766350945},{"_id":"source/images/043.Cryptocurrency_Mining_Malware.md.04.png","hash":"3b84e850fed75c7522de14ea371e252c6ace450c","modified":1701766350949},{"_id":"source/images/043.Cryptocurrency_Mining_Malware.md.02.png","hash":"8300a70785224e56dfd7b783e3713560ea2532a8","modified":1701766350948},{"_id":"source/images/043.Cryptocurrency_Mining_Malware.md.05.png","hash":"42acb4603d9a6f98d66bb8acaf092944f6051eea","modified":1701766350950},{"_id":"source/images/043.Cryptocurrency_Mining_Malware.md.03.png","hash":"ae4f5f502652c216a7b97fb260e67fe5c4761326","modified":1701766350949},{"_id":"source/images/045.v2raya.md.00.png","hash":"b5f10501dea28f1209ac5f891fb56f6bb8dae97a","modified":1701766350952},{"_id":"source/images/043.Cryptocurrency_Mining_Malware.md.08.png","hash":"9b5861b3593957ac7a72c1479af541216acd7bf9","modified":1701766350952},{"_id":"source/images/045.v2raya.md.000.png","hash":"8ef56f19e487f40a0dcf79db51318ea2877dc130","modified":1701766350952},{"_id":"source/images/045.v2raya.md.02.png","hash":"b7354b9a142ae5f87c388612e802f0d64882e65e","modified":1701766350954},{"_id":"source/images/046.docker_install_manual.md.01.png","hash":"bf20371003a970e7a6ca97bef41861ce2249763e","modified":1701766350955},{"_id":"source/images/045.v2raya.md.03.png","hash":"1eacad49a31fcaa479bb626f0ae5c43d827c5655","modified":1701766350955},{"_id":"source/images/049.centos_downgrade.md.01.png","hash":"4c667cec33799a712d024d0a316462cfdf0a03b5","modified":1701766350959},{"_id":"source/images/050.registry_setup.md.01.png","hash":"8c3adaf4e9c542c6840ead256d0a3ba41f9828f1","modified":1701766350959},{"_id":"source/images/050.registry_setup.md.02.png","hash":"84d1de83725a4d0f2332c5afa0c5f2b19a2a965f","modified":1701766350960},{"_id":"source/images/051.MySQL_Install_Using_Generic_Binaries.md.02.png","hash":"a086f03331dfc00298aeb5c2eb874ec89dd9465a","modified":1701766350961},{"_id":"source/images/056.Harbor_Installation.md.01.png","hash":"0076997f63eb97e9fa0e6221de437df5e4b06938","modified":1701766350966},{"_id":"source/images/055.Gitlab_Installation.md.02.png","hash":"0808f2c2f386e6de32f99759769d8e6a8490b529","modified":1701766350965},{"_id":"source/images/056.Harbor_Installation.md.02.png","hash":"f6592c20cfb85afc8f47387137426865165160a0","modified":1701766350967},{"_id":"source/images/059.samba.md.02.png","hash":"1ec0bc8cd11a9f7ee2fa6188d81e024916252c69","modified":1701766350973},{"_id":"source/images/059.samba.md.06.png","hash":"fb5f34615e90832f34f38314a8e9ff6fefa72edd","modified":1701766350976},{"_id":"source/images/059.samba.md.05.png","hash":"f3db6fdb12d29803fb66897264c592fd9634e17f","modified":1701766350975},{"_id":"source/images/052.MySQL_Installation_Uasing_Source.md.02.png","hash":"47420657145fe17289147cb0a1e900cb8fbaec79","modified":1701766350962},{"_id":"source/images/005.elasticsearch.md.01.png","hash":"56acbf689d68e6fadda3e36b47a26363c77e1d36","modified":1701766350888},{"_id":"source/images/005.elasticsearch.md.08.png","hash":"665b216f7cfcf30cd9026f9388eed796bd986fe8","modified":1701766350893},{"_id":"source/images/004.lvm.md.03.png","hash":"b66c65c73958ce03a6df217b0a5c4afc72500e74","modified":1701766350887},{"_id":"source/images/002.progress.md.01.png","hash":"981b48572b3b32da3e71e985e75126e04bfeb323","modified":1701766350883},{"_id":"source/images/009.openssh.md.03.png","hash":"ea03603fe823cfb4c1f3d5eecfc1e73e016dae46","modified":1701766350903},{"_id":"source/images/009.openssh.md.01.png","hash":"4706abfc666f54b0ccd540fe865ffc09574cbef3","modified":1701766350898},{"_id":"source/images/009.openssh.md.04.png","hash":"127bdf7b211051766e946a64d8b1275adb0194e3","modified":1701766350903},{"_id":"source/images/009.openssh.md.05.png","hash":"e6e097c15a2492d1ed0d87a993ffe2e7f9748442","modified":1701766350904},{"_id":"source/images/009.openssh.md.06.png","hash":"932bc4528927d42720cf843759b70540d947791f","modified":1701766350905},{"_id":"source/images/017.oracle.md.07.png","hash":"21ae6a916a3b29922d6b3c5c78a0a05c4b9683b9","modified":1701766350912},{"_id":"source/images/017.oracle.md.08.png","hash":"ceae0f699979374763a9c133399437a07a5cf26b","modified":1701766350912},{"_id":"source/images/017.oracle.md.13.png","hash":"3cceebcf247c7bf73925524de22b8d73d0e29894","modified":1701766350915},{"_id":"source/images/027.telnet.md.02.png","hash":"28ce933daaf7a51af701ceb94ad45ef9b5ed0b45","modified":1701766350917},{"_id":"source/images/027.telnet.md.01.png","hash":"d41f66832506649ee1627f6b4a58a14406e84ae1","modified":1701766350916},{"_id":"source/images/031.ca.md.03.png","hash":"2884c0fa48bc11f8ffd1ab82a682df6aa0eb259e","modified":1701766350929},{"_id":"source/images/031.ca.md.02.png","hash":"6bbd67655f11766a9de7543ce549f7b1249d6655","modified":1701766350928},{"_id":"source/images/034.redis.md.01.png","hash":"2daa90c1b3ec00cbe4142e195ca719810fa72458","modified":1701766350929},{"_id":"source/images/040.openwrt_install_passwall.md.02.png","hash":"bdfc2a924ab4d5fd86578d34c2e1d7c5be98ba70","modified":1701766350944},{"_id":"source/images/041.openwrt_install_frpc.md.02.png","hash":"c4851930d037cf68542bbe6b87c6f224e1110127","modified":1701766350946},{"_id":"source/images/043.Cryptocurrency_Mining_Malware.md.01.png","hash":"6f6e0509eb3728c36c23c58d85297e2ad1a39ca8","modified":1701766350948},{"_id":"source/images/043.Cryptocurrency_Mining_Malware.md.06.png","hash":"31c26cb4223a07a0b09e140c5b180559af159c23","modified":1701766350951},{"_id":"source/images/043.Cryptocurrency_Mining_Malware.md.07.png","hash":"ab041d6c140e4b827c2a02df85f7887caed0b7de","modified":1701766350951},{"_id":"source/images/045.v2raya.md.01.png","hash":"fc78d3b761fb8a4c9a092f343b8b2d1bd64b0d96","modified":1701766350954},{"_id":"source/images/047.docker_build_instances.md.02.png","hash":"901ba454f56bdf5100b37544e97de0a78aa8df65","modified":1701766350957},{"_id":"source/images/047.docker_build_instances.md.01.png","hash":"3933a3766623eae3950ecbd2d059dc809ceebfcf","modified":1701766350957},{"_id":"source/images/046.docker_install_manual.md.02.png","hash":"4b1e226ba2fda8a04435bce093285f84814fc5c8","modified":1701766350956},{"_id":"source/images/051.MySQL_Install_Using_Generic_Binaries.md.01.png","hash":"34910f3f80584529757bfd617939917e8f1d087a","modified":1701766350960},{"_id":"source/images/053.Prometheus_Installation.md.01.png","hash":"0af5d2370c9b5b61397334899a964923682ac2cf","modified":1701766350963},{"_id":"source/images/052.MySQL_Installation_Uasing_Source.md.01.png","hash":"82b0cdcaf6428cd123db76d61a3b91dcb50e004d","modified":1701766350962},{"_id":"source/images/003.clamav.md.01.png","hash":"0377710a728d349612a253d64ae3928feb0f1343","modified":1701766350885},{"_id":"source/images/055.Gitlab_Installation.md.01.png","hash":"c370f8c385d2ca48854bf8db2ece290bee383f52","modified":1701766350964},{"_id":"source/images/059.samba.md.03.png","hash":"375cbb396fc3893df237a063e2060b04023451a5","modified":1701766350974},{"_id":"source/images/055.Gitlab_Installation.md.03.png","hash":"249978029c004436ad8429196194c0748e9a903b","modified":1701766350966},{"_id":"source/images/003.clamav.md.02.png","hash":"463efbc79306b67e2e69c2c4712f79dd68adf10b","modified":1701766350886},{"_id":"source/images/059.samba.md.04.png","hash":"1ebb2bebe05e2fe6dc98db341963e3bf0b94c243","modified":1701766350975},{"_id":"source/images/009.openssh.md.07.png","hash":"687e52bc44ce594f75fd4cdd654eb53d1231c0c9","modified":1701766350906},{"_id":"source/images/029.install_php7.4.33.md.03.png","hash":"8eb1f0b64ce71dfc0623f0bb822c48117bbc3191","modified":1701766350927},{"_id":"source/images/036.openwrt_disk_expansion.md.02.png","hash":"5e42aaad32d5d4be4c4321878735e4aee87eb359","modified":1701766350934},{"_id":"source/images/037.kvm.md.02.png","hash":"ce5f29c030a4962b5447eee944675bf6ad29196f","modified":1701766350938},{"_id":"source/images/047.docker_build_instances.md.03.png","hash":"67553b46515cd4469a65edc1905625faf1614221","modified":1701766350959},{"_id":"source/images/057.Linux_Security_Policy.md.01.png","hash":"c011cf9fc9285dbda2b6698061c35b6e39d608fc","modified":1701766350970},{"_id":"source/images/059.samba.md.01.png","hash":"eb306fd6368064ab3abb2446993d415e823a8b7c","modified":1701766350972},{"_id":"source/images/009.openssh.md.02.png","hash":"54689ec50a9d36876e73075336f1612c7e17ae99","modified":1701766350900},{"_id":"source/images/005.elasticsearch.md.06.png","hash":"c337f5444bd4db0b08abf9949f76e14e6b5fbb9e","modified":1701766350892},{"_id":"source/images/060.highlight.md.01.png","hash":"c1185e6b72d878cd364e423d0ec9eb3a038b04ff","modified":1701766350978},{"_id":"source/images/029.install_php7.4.33.md.02.png","hash":"bd90e3b395314b90ce305b6d1bd88d0dbc52b69f","modified":1701766350924},{"_id":"source/images/037.kvm.md.04.png","hash":"9847c5db3b6660af0d4ed8e5c80a4845ab04ec67","modified":1701766350942},{"_id":"source/images/057.Linux_Security_Policy.md.02.png","hash":"91a6c27ecbe4f37b25c77744135aa9f9eb967c23","modified":1701766350971},{"_id":"source/images/006.iptables.md.01.png","hash":"a8ac603a12fba8d347c56a5c320a90ed0c24526f","modified":1701766350895},{"_id":"source/images/029.install_php7.4.33.md.01.png","hash":"5ca2d5fcffd1c7496b0dba0e53ce5db5ff9bfe7f","modified":1701766350922},{"_id":"source/images/036.openwrt_disk_expansion.md.01.png","hash":"378dafdc2f8d6e1b73279434a423e3d6456a209b","modified":1701766350934},{"_id":"source/images/037.kvm.md.01.png","hash":"9b194464ed376d437ed707ac6e28e9037c736c66","modified":1701766350936},{"_id":"source/images/037.kvm.md.03.png","hash":"39e3d27da863010cc4a62ac5a7ab3980d53bc1fb","modified":1701766350941},{"_id":"themes/next/_vendors.yml","hash":"463e3097d6e245105f6612994215ab5c637cae28","modified":1679725481000},{"_id":"themes/next/package.json","hash":"a192fe2e0904b490c885e8545a409536b41ef46e","modified":1679725481000},{"_id":"themes/next/_config.yml","hash":"b28a74fe54af970053b8630124c508442b2e9ec6","modified":1696757522000},{"_id":"themes/next/LICENSE.md","hash":"68fc9a03d50fd4b5ea97092b05967d1819dea2c4","modified":1679725481000},{"_id":"themes/next/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1679725481000},{"_id":"themes/next/README.md","hash":"36c4b25587ca494102323dab5a38de5490451a64","modified":1679725481000},{"_id":"themes/next/docs/AUTHORS.md","hash":"a648823121563c34a177ae91f5a774b5e29f01a0","modified":1679725481000},{"_id":"themes/next/languages/ar.yml","hash":"46026e98fe279a9db5d68bf91afa5d8e41f9ccfb","modified":1679725481000},{"_id":"themes/next/languages/README.md","hash":"b2567e32805dda79601157351a07e5ca9fe01315","modified":1679725481000},{"_id":"themes/next/docs/LICENSE.txt","hash":"f5b14f791b7cfa1d16da981d929152e088a5d1b8","modified":1679725481000},{"_id":"themes/next/languages/es.yml","hash":"8b6d4a8a056df4362d20ae1f6ac7a590dd7246e5","modified":1679725481000},{"_id":"themes/next/languages/en.yml","hash":"4bbdb4284afe495437cf7817b97b45f60e12d1e4","modified":1679725481000},{"_id":"themes/next/languages/de.yml","hash":"c4fc18c338309271d1afe737e6c404a6fa313bbc","modified":1679725481000},{"_id":"themes/next/languages/fa.yml","hash":"1e256c8df039ddeba66526c5eb2d6c79177a7fc6","modified":1679725481000},{"_id":"themes/next/languages/id.yml","hash":"c4bad93b23c7eefa730fd7fec5b05ace3ce9ca4d","modified":1679725481000},{"_id":"themes/next/languages/ko.yml","hash":"25ee0d5b9a0464a91af7d2efb33293c09ad5abdf","modified":1679725481000},{"_id":"themes/next/languages/ja.yml","hash":"a0906702d3c87d0e1661e300ad0bdf7e679a3d91","modified":1679725481000},{"_id":"themes/next/languages/fr.yml","hash":"2436942610e38b73b175cb0f8ed1f8f23d42a7ce","modified":1679725481000},{"_id":"themes/next/languages/it.yml","hash":"4d6efcdaea89dfe751b7707d91858bf33d3538b7","modified":1679725481000},{"_id":"themes/next/languages/nl.yml","hash":"8a4da307b4a19e3c96b90a07a2da8dc5d50e5d9e","modified":1679725481000},{"_id":"themes/next/languages/pt-BR.yml","hash":"10d80915c41328f31a4f2d8ac736bba020f373d8","modified":1679725481000},{"_id":"themes/next/languages/th.yml","hash":"4fac74a39d3906c4a727476be4750530a505933a","modified":1679725481000},{"_id":"themes/next/languages/ru.yml","hash":"16b96783ba363255b4c8156c3e1efebdb37676f8","modified":1679725481000},{"_id":"themes/next/languages/pt.yml","hash":"fa7c43ec872aee2739b25dd7260e0764ea9e26fd","modified":1679725481000},{"_id":"themes/next/languages/si.yml","hash":"034c5a0df49144e8f16ae2300dba9fde58b9329e","modified":1679725481000},{"_id":"themes/next/languages/tk.yml","hash":"37d9af426b040004841273d163059cd49cd67d65","modified":1679725481000},{"_id":"themes/next/languages/vi.yml","hash":"a6ba04c743a5b494ac56612ce6b858d9ae3ae1bd","modified":1679725481000},{"_id":"themes/next/languages/tr.yml","hash":"890f87f6a33ad8452b771607d4c3ff14810b35fa","modified":1679725481000},{"_id":"themes/next/languages/zh-CN.yml","hash":"5cebea74f3198a4a20cacf23069c3b91e4f03d85","modified":1679725481000},{"_id":"themes/next/languages/uk.yml","hash":"fbaed3039ed8605b81422003a4ecb2a6514e339d","modified":1679725481000},{"_id":"themes/next/languages/zh-TW.yml","hash":"9fdce9d316e205fc132b2181254ef3b04007a97d","modified":1679725481000},{"_id":"themes/next/layout/_layout.njk","hash":"fc0a45112f2dcfc2642404e8934ea32a793c3bd7","modified":1679725481000},{"_id":"themes/next/languages/zh-HK.yml","hash":"8ab7219563dab13885840207a86055000d173465","modified":1679725481000},{"_id":"themes/next/languages/bn.yml","hash":"74133a827c104d1d84509177f283947fe9327a80","modified":1679725481000},{"_id":"themes/next/layout/category.njk","hash":"c68b7343d0f8145010f93351908cc36ef6212ec1","modified":1679725481000},{"_id":"themes/next/layout/archive.njk","hash":"d759f4d2cf5ddc6875ea250113a00662c1caf6d1","modified":1679725481000},{"_id":"themes/next/layout/index.njk","hash":"dd63e488ae8cc144335a5958acedf6a16edd7a92","modified":1679725481000},{"_id":"themes/next/scripts/events/index.js","hash":"bd9ea82376cd87df611ea3ae077875c7c595a3df","modified":1679725481000},{"_id":"themes/next/scripts/filters/default-injects.js","hash":"872f01cb10e422a648ea505436532e776e92926b","modified":1679725481000},{"_id":"themes/next/scripts/filters/locals.js","hash":"9eb5310664759931287dd28ea39165dfb67f12ed","modified":1679725481000},{"_id":"themes/next/scripts/filters/minify.js","hash":"ce8477e7fb226525bae5872cd68a1c2c23ad50c8","modified":1679725481000},{"_id":"themes/next/scripts/filters/post.js","hash":"fdc8a0af90035e89c3fcb754a0eb189b8951a2bc","modified":1679725481000},{"_id":"themes/next/scripts/helpers/engine.js","hash":"d292b78485e8e8055712b0ed6de7cf559c5fbdcd","modified":1679725481000},{"_id":"themes/next/scripts/helpers/font.js","hash":"3394185a7f0393c16ce52c8028f90da3e9239c55","modified":1679725481000},{"_id":"themes/next/scripts/helpers/navigation.js","hash":"78107021101553c3d23e89290f7530b60cf4aa86","modified":1679725481000},{"_id":"themes/next/scripts/helpers/next-config.js","hash":"226fccbe9c93265e65a300e3cb4bf6f9065cfdd7","modified":1679725481000},{"_id":"themes/next/scripts/helpers/next-url.js","hash":"fd24abfaba4d91923ddb6aecf0268b216678c8bd","modified":1679725481000},{"_id":"themes/next/layout/post.njk","hash":"0bfce9f133f501a9a4837257e3b862b3bbca15be","modified":1679725481000},{"_id":"themes/next/scripts/helpers/next-paginator.js","hash":"e86c764b546e4fbb87970cabc4135a56f9ef9fe1","modified":1679725481000},{"_id":"themes/next/scripts/tags/button.js","hash":"c6ad2ed544fbb25ecb5d820c36e76302504271b7","modified":1679725481000},{"_id":"themes/next/scripts/helpers/next-vendors.js","hash":"afdd6a188a74c188f0dd154fac70efd4080ca262","modified":1679725481000},{"_id":"themes/next/scripts/tags/caniuse.js","hash":"935a311142a409c1896b3ae3f01fe7a9e2db1134","modified":1679725481000},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"92c19d796bdb3320df9caea59bf52df7a95d9da9","modified":1679725481000},{"_id":"themes/next/scripts/tags/link-grid.js","hash":"18a483c2d5afd701f6080ffdddf2d1321370336c","modified":1679725481000},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"9ed799c329abf830f623689d7e136991256a24ca","modified":1679725481000},{"_id":"themes/next/scripts/tags/label.js","hash":"8a73348186113bae0a51ea2f891c1bb882fab05a","modified":1679725481000},{"_id":"themes/next/scripts/tags/index.js","hash":"17f9451ce1f10f78437f52218757d38d4e1591b0","modified":1679725481000},{"_id":"themes/next/scripts/tags/note.js","hash":"7b94ddb46b7d4b0fe815f2fbe4bd375f07f55363","modified":1679725481000},{"_id":"themes/next/scripts/tags/tabs.js","hash":"0eabe51da40b4b13e16419c8fe02452d9a4fef73","modified":1679725481000},{"_id":"themes/next/scripts/tags/pdf.js","hash":"344636b6fd7e27e8831c1e194039afc0d61931cd","modified":1679725481000},{"_id":"themes/next/scripts/tags/mermaid.js","hash":"4fb01ca650fa8b256b8d48f50dc1b18350bd3d6d","modified":1679725481000},{"_id":"themes/next/scripts/tags/video.js","hash":"2ee926448583be8f95af1f2884ae2c9c4830151d","modified":1679725481000},{"_id":"themes/next/layout/tag.njk","hash":"9e16ba20c28a7f2c6bc75aa427f48122301a30aa","modified":1679725481000},{"_id":"themes/next/layout/page.njk","hash":"b0660b2af0ac7d3fda14ca4d9f2c9e79ef06c6f9","modified":1679725481000},{"_id":"themes/next/docs/ru/README.md","hash":"ac3c4a7616ea80f0d32d68d6e53233952ba756dc","modified":1679725481000},{"_id":"themes/next/docs/zh-CN/CONTRIBUTING.md","hash":"a089f7a8368ab0b7d7b9b7ec0ac3767a453435df","modified":1679725481000},{"_id":"themes/next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"7a06d443f374bd1e84294067a0ac796afd9fbe60","modified":1679725481000},{"_id":"themes/next/docs/zh-CN/README.md","hash":"9bbdbb0656505acceef9b9895a576164175fe888","modified":1679725481000},{"_id":"themes/next/layout/_macro/post-collapse.njk","hash":"1a30d751871dabfa80940042ddb1f77d07d830b9","modified":1679725481000},{"_id":"themes/next/layout/_macro/post.njk","hash":"7e8268fd5cbd552322b276f52459fd187c2453d2","modified":1679725481000},{"_id":"themes/next/source/css/_colors.styl","hash":"3c6798c10cc220d83481cb3f3782e78558cee789","modified":1679725481000},{"_id":"themes/next/layout/_macro/sidebar.njk","hash":"547c62ab14d9e05d2d9116db9048a677fbe1fb6d","modified":1679725481000},{"_id":"themes/next/source/css/main.styl","hash":"921a58577f411cf4eb5cfd66db0a241f8f88578c","modified":1679725481000},{"_id":"themes/next/source/css/noscript.styl","hash":"dadc81256afb127b77eac6763d5ee0ec9c77f0a3","modified":1679725481000},{"_id":"themes/next/layout/_partials/comments.njk","hash":"d0c470b0f6690aa217e9ada848c5e2e73fb27c6f","modified":1679725481000},{"_id":"themes/next/layout/_partials/widgets.njk","hash":"e7f988ecddb2159313699a00827a45eca5622bd4","modified":1679725481000},{"_id":"themes/next/layout/_partials/footer.njk","hash":"c40760b559c516677c8b11a00ba50c011f2079fd","modified":1679725481000},{"_id":"themes/next/layout/_scripts/index.njk","hash":"6668878a0f9a1166c6a879755f54a08d942da870","modified":1679725481000},{"_id":"themes/next/source/css/_mixins.styl","hash":"83647a6207333b9609ba90b0946b3fa9548e6381","modified":1679725481000},{"_id":"themes/next/layout/_scripts/vendors.njk","hash":"be80b9fe415a9a09d74c28e230995fd292dfc123","modified":1679725481000},{"_id":"themes/next/layout/_partials/languages.njk","hash":"e43f22198cccb5f6e306b1ce0d28d12a4fb891f8","modified":1679725481000},{"_id":"themes/next/layout/_partials/pagination.njk","hash":"bc719473ed5948ab6859449d60b8d36cfc1542b4","modified":1679725481000},{"_id":"themes/next/layout/_third-party/fancybox.njk","hash":"844559f46e2ff1c8be234d5763703106e2072a7b","modified":1679725481000},{"_id":"themes/next/layout/_third-party/index.njk","hash":"aa37f8e98208177b63e3328d6e53b022c6edf3b2","modified":1679725481000},{"_id":"themes/next/layout/_third-party/pace.njk","hash":"d7ad5714079f7f65446f880baf14722435ca9061","modified":1679725481000},{"_id":"themes/next/layout/_third-party/quicklink.njk","hash":"0efed71ed530447718c4ea5bbd5fc8695b0b0d5f","modified":1679725481000},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1679725481000},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1679725481000},{"_id":"themes/next/source/images/avatar.gif","hash":"2dbc3e2f2d624b2ca1afe6edc2ca17307f1950c8","modified":1679725481000},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1679725481000},{"_id":"themes/next/source/images/logo-algolia-nebula-blue-full.svg","hash":"b85e274207b1392782476a0430feac98db1e7da0","modified":1679725481000},{"_id":"themes/next/source/js/bookmark.js","hash":"0f563ffbf05fad30e854e413ab17ff7164ab5a53","modified":1679725481000},{"_id":"themes/next/source/images/logo.svg","hash":"099e11ab995a2c8981427a85476d082609848c77","modified":1679725481000},{"_id":"themes/next/source/js/comments-buttons.js","hash":"1a7344440321713426a0b2ab17e276b5bdf85ade","modified":1679725481000},{"_id":"themes/next/source/js/comments.js","hash":"66ae2e26ea36a41b72c638ea8b220296638ae952","modified":1679725481000},{"_id":"themes/next/source/js/motion.js","hash":"770d63c26f22705311028a36b52e999cc8a2da82","modified":1679725481000},{"_id":"themes/next/source/js/config.js","hash":"4c4ebbe3b3f3841a26f9d5af6d0ba8bc6da01c54","modified":1679725481000},{"_id":"themes/next/source/js/pjax.js","hash":"b03ba78c6916ad2f390d55bc1bc18fafb64b0ebf","modified":1679725481000},{"_id":"themes/next/scripts/events/lib/config.js","hash":"9ec51eb61f7fee612ffc5252f489003a0fa301fc","modified":1679725481000},{"_id":"themes/next/scripts/events/lib/highlight.js","hash":"6aec7b2c38c50989a23bfaa0d560e75c7f553e12","modified":1679725481000},{"_id":"themes/next/scripts/events/lib/injects.js","hash":"d987709267a1bc6e5014411e9983d7c49c102c16","modified":1679725481000},{"_id":"themes/next/scripts/events/lib/navigation.js","hash":"dd3562686d95a50375e6fd32e717ccb0d99c1e3d","modified":1679725481000},{"_id":"themes/next/scripts/events/lib/utils.js","hash":"ec996d0673f766167c86df0966e9da1ae036e103","modified":1679725481000},{"_id":"themes/next/scripts/events/lib/vendors.js","hash":"64e4024376b51fe81be7ad80235abdf0a83853bd","modified":1679725481000},{"_id":"themes/next/scripts/filters/comment/changyan.js","hash":"5798cfc8f63665031dd3e01debed051628cec319","modified":1679725481000},{"_id":"themes/next/scripts/filters/comment/common.js","hash":"19a402a225c31edffc50f202a14e0d582d3db23e","modified":1679725481000},{"_id":"themes/next/scripts/filters/comment/default-config.js","hash":"93ee5f9109dad885dc38c49bcee630c10f9dce6e","modified":1679725481000},{"_id":"themes/next/scripts/filters/comment/disqus.js","hash":"7f71d6b271ba65ff333d5682e7575711d368c0d2","modified":1679725481000},{"_id":"themes/next/scripts/filters/comment/disqusjs.js","hash":"a600a98e7436edeb31e291abca359885567df3c9","modified":1679725481000},{"_id":"themes/next/scripts/filters/comment/gitalk.js","hash":"7bb7dafdd7f6bca8464b54e17e552ce7f1714195","modified":1679725481000},{"_id":"themes/next/scripts/filters/comment/isso.js","hash":"ff8b5b5145220a17d0ecd9508ba9bd2d3b2da47d","modified":1679725481000},{"_id":"themes/next/scripts/filters/comment/livere.js","hash":"5a07d8bb52bc1d51a624ca8db54be144566c306b","modified":1679725481000},{"_id":"themes/next/scripts/filters/comment/utterances.js","hash":"d3bded697bc32dace689d2a6dfb6eb7514169d15","modified":1679725481000},{"_id":"themes/next/source/js/next-boot.js","hash":"da0f07f9eaaa83de70128b0feaea3fdadb90457a","modified":1679725481000},{"_id":"themes/next/source/js/schedule.js","hash":"a1333258726caf84f368a8f8454639c7dc1626bb","modified":1679725481000},{"_id":"themes/next/source/js/utils.js","hash":"5e1cf39de050964e97fb3ba0825aeec7f4bc36dd","modified":1679725481000},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"a1418c9dc8c0f1a0ad4ded0f4627c45bf0db1a10","modified":1679725481000},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"e3be898f5ebcf435a26542653a9297ff2c71aeb0","modified":1679725481000},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"48f4f277946a168d0db1ea02804e85c22ca2c7db","modified":1679725481000},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"96e0a7c2a65ce68215e17e369085b2ea2f1334f2","modified":1679725481000},{"_id":"themes/next/layout/_partials/head/head-unique.njk","hash":"8da52a144060db1a0a088ccb2e6cc8376d1fce70","modified":1679725481000},{"_id":"themes/next/layout/_partials/head/head.njk","hash":"5388b157bba4a40b9312f4a45c6678974ccf0837","modified":1679725481000},{"_id":"themes/next/source/css/_variables/base.styl","hash":"c4fc4e862d09221265ab1466085f057be2ad2e4d","modified":1679725481000},{"_id":"themes/next/layout/_partials/header/menu-item.njk","hash":"2b814686c0a82f19fc39d39ea661b2820206159e","modified":1696756672000},{"_id":"themes/next/layout/_partials/header/sub-menu.njk","hash":"06480d8ec5f0b87eafd47f082f07968d7282dd5c","modified":1679725481000},{"_id":"themes/next/layout/_partials/header/menu.njk","hash":"ee6fc2f111572d3eeab0a2fecbb2d6b3e37ab26b","modified":1679725481000},{"_id":"themes/next/layout/_partials/header/index.njk","hash":"650de421a8ce4cf685428ffbe0087ff84cbd1356","modified":1679725481000},{"_id":"themes/next/layout/_partials/header/brand.njk","hash":"dd9c4c03e99dfde0dfb8edefcb2c933f2f560efc","modified":1679725481000},{"_id":"themes/next/layout/_partials/post/post-copyright.njk","hash":"133942922e34abae9e4de7ea5591d77c0caa4b37","modified":1679725481000},{"_id":"themes/next/layout/_partials/post/post-followme.njk","hash":"c1e33b4889f75acc490af3c8bde0ec56c518ff41","modified":1679725481000},{"_id":"themes/next/layout/_partials/post/post-related.njk","hash":"e0986db00a0201dd3c60570f964829c84ba5bc68","modified":1679725481000},{"_id":"themes/next/layout/_partials/post/post-meta.njk","hash":"9fa47e4fb342811da590ee4adc91cf81118c0a39","modified":1679725481000},{"_id":"themes/next/layout/_partials/post/post-reward.njk","hash":"e8b8a7c41e9ec612d0c0c73419529d55d1c16256","modified":1679725481000},{"_id":"themes/next/layout/_partials/search/index.njk","hash":"8f6f256ab3b351ffc80f1f3f1d9834e9a7cfac31","modified":1679725481000},{"_id":"themes/next/layout/_partials/post/post-share.njk","hash":"3f28cc4411c0ffc0e41b7970d5ab329c7e46f497","modified":1679725481000},{"_id":"themes/next/layout/_partials/search/algolia-search.njk","hash":"efb2b6f19df02ba5ae623a1f274fff52aed21e6f","modified":1679725481000},{"_id":"themes/next/layout/_partials/search/localsearch.njk","hash":"661f7acae43f0be694266323320f977d84119abe","modified":1679725481000},{"_id":"themes/next/layout/_partials/page/breadcrumb.njk","hash":"89825e75cc45e9709fa6ba89883669eedaff6f46","modified":1679725481000},{"_id":"themes/next/layout/_partials/sidebar/site-overview.njk","hash":"70342218473a6e6aa9148de06bfffe121afb8548","modified":1681488418000},{"_id":"themes/next/layout/_partials/page/categories.njk","hash":"17156d99941f28a225951ffdcfa9a115e20dc2d2","modified":1681492544000},{"_id":"themes/next/layout/_partials/page/schedule.njk","hash":"0f4bc8e257da60f77c0c1738607b2bde55810684","modified":1679725481000},{"_id":"themes/next/layout/_partials/page/page-header.njk","hash":"7ed4f102a1825195cff8d7995bf9219f323a9034","modified":1679725481000},{"_id":"themes/next/layout/_third-party/analytics/cloudflare.njk","hash":"a5b8297c2c383124dd6a56e256ecc0c0dcf489be","modified":1679725481000},{"_id":"themes/next/layout/_partials/page/tags.njk","hash":"a18d1598e36cc72f2b0b24c3cc3c5990dfaa3254","modified":1679725481000},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.njk","hash":"d89066ff53879693f023e540d59c86137172c529","modified":1679725481000},{"_id":"themes/next/layout/_third-party/analytics/growingio.njk","hash":"8afaa772c390bd9d53a5cff9645ac3168334eb98","modified":1679725481000},{"_id":"themes/next/layout/_third-party/analytics/index.njk","hash":"f900306497b133e8b098bd9f4b96b93d1d96c185","modified":1679725481000},{"_id":"themes/next/layout/_third-party/analytics/matomo.njk","hash":"4e89648a8ec8194c5823064cbca39c938a799006","modified":1679725481000},{"_id":"themes/next/layout/_third-party/analytics/microsoft-clarity.njk","hash":"9dc00fcb0a05899f048eace9f9160b78956655d5","modified":1679725481000},{"_id":"themes/next/layout/_third-party/analytics/plausible.njk","hash":"ef9f2bb7110507f1c4336800af9157d5fa9765bd","modified":1679725481000},{"_id":"themes/next/layout/_third-party/analytics/umami.njk","hash":"181f69b6718c7a8642a88652260cc0a26084a3ee","modified":1679725481000},{"_id":"themes/next/layout/_third-party/chat/chatra.njk","hash":"d7263fca16d0278ccf1f6aa1c6df6902a6344a09","modified":1679725481000},{"_id":"themes/next/layout/_third-party/chat/gitter.njk","hash":"f8cc14b7aa949999a1faaeb7855e2f20b59a386d","modified":1679725481000},{"_id":"themes/next/layout/_third-party/chat/tidio.njk","hash":"02aab857c27fc103216029be991688b12a73a525","modified":1679725481000},{"_id":"themes/next/layout/_third-party/comments/changyan.njk","hash":"d1c950f8fbdf85e7a3eae5463767a89e858e8220","modified":1679725481000},{"_id":"themes/next/layout/_third-party/comments/disqus.njk","hash":"9375b19a89b7fa9474e558d085af5448d4c5c50c","modified":1679725481000},{"_id":"themes/next/layout/_third-party/comments/gitalk.njk","hash":"b63b7e2ede0d3e66e732fa1a06bda9b19e1e85d4","modified":1679725481000},{"_id":"themes/next/layout/_third-party/comments/disqusjs.njk","hash":"0749cb6902baecdfd01f779a2a2513f6d2f6a823","modified":1679725481000},{"_id":"themes/next/layout/_third-party/comments/isso.njk","hash":"64cc3bdaf644fd32c0d0a247f29f5b6904da9af3","modified":1679725481000},{"_id":"themes/next/layout/_third-party/comments/livere.njk","hash":"3b13b09fba84ec6000886890a6710736a2b8fafe","modified":1679725481000},{"_id":"themes/next/layout/_third-party/comments/utterances.njk","hash":"5a94032bc3512a10ad4328fc19ec07b819a1d687","modified":1679725481000},{"_id":"themes/next/layout/_third-party/math/index.njk","hash":"abf37fc55aa86702118e8fdf5bf2d389dd589aa0","modified":1679725481000},{"_id":"themes/next/layout/_third-party/math/katex.njk","hash":"1ebf658690468ea197bdd0416eb7cfa4bd0b083a","modified":1679725481000},{"_id":"themes/next/layout/_third-party/math/mathjax.njk","hash":"3677017fd4572b158311f5f5d870590ab25184e0","modified":1679725481000},{"_id":"themes/next/layout/_third-party/search/algolia-search.njk","hash":"24ed76e0c72a25ac152820c750a05826a706b6f4","modified":1679725481000},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.njk","hash":"6215309aee028dcb734452beec448c5afb6c63fc","modified":1679725481000},{"_id":"themes/next/layout/_third-party/search/localsearch.njk","hash":"e45ea3542cdc9ed7ec8447b5e6f35df4c5e82758","modified":1679725481000},{"_id":"themes/next/layout/_third-party/statistics/busuanzi-counter.njk","hash":"a4bc501da0f22f7e420f0ca47e83988ce90b1368","modified":1679725481000},{"_id":"themes/next/layout/_third-party/statistics/lean-analytics.njk","hash":"2446e748cdc102c78492216319ac02148db7daf6","modified":1679725481000},{"_id":"themes/next/layout/_third-party/tags/mermaid.njk","hash":"099e031f52fb8e47b3af5b2684737efc9e643ee7","modified":1679725481000},{"_id":"themes/next/layout/_third-party/tags/pdf.njk","hash":"2c81984cc4f5123103460442f6e046f5b6c97127","modified":1679725481000},{"_id":"themes/next/source/js/third-party/pace.js","hash":"0ef04218b93561ba4d0ff420d556c3d90a756d32","modified":1679725481000},{"_id":"themes/next/layout/_third-party/statistics/firestore.njk","hash":"d32ebe94560fa95824478ebbff531bffc47b194d","modified":1679725481000},{"_id":"themes/next/layout/_third-party/statistics/index.njk","hash":"568ddf7955d11d93fb5e842b403a7ac8b1b7fdb1","modified":1679725481000},{"_id":"themes/next/source/js/third-party/quicklink.js","hash":"eed02e6fced8e5a653077205d4d4d7834ca71472","modified":1679725481000},{"_id":"themes/next/source/js/third-party/fancybox.js","hash":"c098d14e65dd170537134358d4b8359ad0539c2c","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"7664491542046df9a3887cf40a06e00c0b4086a9","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/index.styl","hash":"2298e521253b3bf376a2412271bc2a7d305051f3","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/reading-progress.styl","hash":"90a86045a33c1bae49fc2f6fa1e1b53170c7f77b","modified":1679725481000},{"_id":"themes/next/source/css/_common/outline/index.styl","hash":"8e34df131830d4fa3725e4590a672ba1cf1903e5","modified":1679725481000},{"_id":"themes/next/source/css/_common/outline/mobile.styl","hash":"64775c729512b30b144ab5ae9dc4a4dfd4e13f35","modified":1679725481000},{"_id":"themes/next/source/js/schemes/muse.js","hash":"0c490e9ba82efbb8bdf8465e6b537fafd51e1ed7","modified":1679725481000},{"_id":"themes/next/source/css/_common/scaffolding/buttons.styl","hash":"a042571d85ff7265f799004239a45f36b716b8a6","modified":1679725481000},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"b56367ea676ea8e8783ea89cd4ab150c7da7a060","modified":1679725481000},{"_id":"themes/next/source/css/_common/scaffolding/comments.styl","hash":"e4fecc889ba3317a64e9abba5842c79dff9b7827","modified":1679725481000},{"_id":"themes/next/source/css/_common/scaffolding/index.styl","hash":"523fb7b653b87ae37fc91fc8813e4ffad87b0d7e","modified":1679725481000},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"d0a7c99095f490b0d2ed6b1be43d435960798cec","modified":1679725481000},{"_id":"themes/next/source/css/_common/scaffolding/pagination.styl","hash":"f4228c759db4a650c8d38745c2edd1dc83c45687","modified":1679725481000},{"_id":"themes/next/source/css/_common/scaffolding/toggles.styl","hash":"782ee1fc5e669d3ddbfeb82b73ad7fe561f1a4fb","modified":1679725481000},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"e840b23d33023e6d45e018f6e84b683dd56efd8d","modified":1679725481000},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"9dfe853c901bdc52fc950bacdf15484dbb9bf140","modified":1679725481000},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"77b85d4de5ab747e04008ab31200311b29748740","modified":1679725481000},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"ab16a3dcdc0393b9b582ef59dcc13db9320e917c","modified":1679725481000},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expand.styl","hash":"485d23ccb42c0d0c8ead7ea8930dd3e06d79a285","modified":1679725481000},{"_id":"themes/next/source/css/_schemes/Muse/_header.styl","hash":"d856127cd7e0a28a88edf0b2eb860ede9c3fdb60","modified":1679725481000},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"7fecfb76420f786d6bf60218a81705bb48fb1d18","modified":1679725481000},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"b7f48be3c43bfa393d62142544a5487a67871713","modified":1679725481000},{"_id":"themes/next/source/css/_schemes/Muse/_sidebar.styl","hash":"cef9c5f9524fd01b59b0a89e51904b42cbdedc8c","modified":1679725481000},{"_id":"themes/next/source/css/_schemes/Mist/_layout.styl","hash":"fa4fd8f76464e214fb7318f325b13c2b62f4b478","modified":1679725481000},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"fb550935d374e0bdf1097fce187337dc05cad3e1","modified":1679725481000},{"_id":"themes/next/source/css/_schemes/Muse/_sub-menu.styl","hash":"c48ccd8d6651fe1a01faff8f01179456d39ba9b1","modified":1679725481000},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1679725481000},{"_id":"themes/next/source/css/_schemes/Pisces/_header.styl","hash":"ac2dc0ce9c775a83ef7132ae957b54539366ac9c","modified":1679725481000},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"4266eed6f75625bb30ef0280dc5d4093e7c3beb1","modified":1679725481000},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"91dbf3ca5c3a613d4e30618c120da535bf2d0336","modified":1679725481000},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"72dc825c50357402c342d62ab60fc0c478ab6bc1","modified":1679725481000},{"_id":"themes/next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"778ed2ad5643b93970c95626b325defeb586733f","modified":1679725481000},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"8000075b227749a7495eaf417cac6ccfbe441580","modified":1679725481000},{"_id":"themes/next/source/js/third-party/analytics/baidu-analytics.js","hash":"f629acc46ff40c071ffd31b77d5c7616f0fdd778","modified":1679725481000},{"_id":"themes/next/source/js/third-party/analytics/google-analytics.js","hash":"59684383385059dc4f8a1ff85dbbeb703bcdbcb5","modified":1679725481000},{"_id":"themes/next/source/js/third-party/analytics/matomo.js","hash":"c6a25b26a1443caa70b47fd3dfa282271574deb5","modified":1679725481000},{"_id":"themes/next/source/js/third-party/analytics/growingio.js","hash":"78dd3cf04082b7dbe6246e404b2aa8e726922402","modified":1679725481000},{"_id":"themes/next/source/js/third-party/comments/changyan.js","hash":"260d1a77d6a3bb33a579d3e4cca1997003e799b5","modified":1679725481000},{"_id":"themes/next/source/js/third-party/comments/disqusjs.js","hash":"1e826dea3f684c0515f362dc1352447a1f0eae71","modified":1679725481000},{"_id":"themes/next/source/js/third-party/comments/disqus.js","hash":"da361917d65e5dca8362f8cdeb6c8cc0e8316cec","modified":1679725481000},{"_id":"themes/next/source/js/third-party/comments/gitalk.js","hash":"0ec038cf83e8ec067534f16a54041e47a3c1e59a","modified":1679725481000},{"_id":"themes/next/source/js/third-party/comments/utterances.js","hash":"f67f90eb03e284c82da2b8cf2f1e31801813c16d","modified":1679725481000},{"_id":"themes/next/source/js/third-party/comments/isso.js","hash":"753a873b6f566aff5ba77ca23f91b78eb880ca64","modified":1679725481000},{"_id":"themes/next/source/js/third-party/chat/gitter.js","hash":"cc38c94125f90dadde11b5ebac7d8bf99a1a08a2","modified":1679725481000},{"_id":"themes/next/source/js/third-party/chat/chatra.js","hash":"c32180522788c10e51df1803aa6842ef0432ddc9","modified":1679725481000},{"_id":"themes/next/source/js/third-party/math/katex.js","hash":"83c54ee536e487a1031783443fe0cb63b1b4767e","modified":1679725481000},{"_id":"themes/next/source/js/third-party/chat/tidio.js","hash":"b0079f6a4601e06ca6fe46e83a2f5af553e9bc3c","modified":1679725481000},{"_id":"themes/next/source/js/third-party/math/mathjax.js","hash":"5c749b9c1c3bb738122d0516211ecff6496d4907","modified":1679725481000},{"_id":"themes/next/source/js/third-party/search/algolia-search.js","hash":"fdb7b7cef1a147d897e7f7cd8903b58368ec2062","modified":1679725481000},{"_id":"themes/next/source/js/third-party/tags/mermaid.js","hash":"f27d817b0c2138dd3215b1f46af0753f60a008f3","modified":1679725481000},{"_id":"themes/next/source/js/third-party/tags/pdf.js","hash":"af78c22f0e61c8c8aa8794e585e0d632c6d4fcb8","modified":1679725481000},{"_id":"themes/next/source/js/third-party/search/local-search.js","hash":"4536cb6d0a9bbaaa86fab3fa0101f6a3a3ec5a76","modified":1679725481000},{"_id":"themes/next/source/js/third-party/statistics/firestore.js","hash":"6e0682bb42170d61b13b786295f45f9c785f8b73","modified":1679725481000},{"_id":"themes/next/source/js/third-party/statistics/lean-analytics.js","hash":"835cbf54c49ef1327f47df70ff2636ad36b6f57d","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"8afdc311c6b8db121758371f95cf1c5e77354f42","modified":1679725481000},{"_id":"themes/next/source/js/third-party/comments/livere.js","hash":"2247d88c934c765c43013337860774aaa99f0b31","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/pages/tag-cloud.styl","hash":"1a81d1a71fcf0699629ce6e72dfd0a15f3a2dd0a","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"6b816c2511242ee503fb5f34cd3e4dcdafc06b85","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"b6e2eb1550a7845cb2adf86081a4ab6c7bde1e68","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/pages/index.styl","hash":"7504dbc5c70262b048143b2c37d2b5aa2809afa2","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/post/post-followme.styl","hash":"1ecfd64507954810b07a9d21fb5305b5378feda0","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"aa366d37389760c8595529b850f461569577a1c5","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/post/index.styl","hash":"098d4bd034e986fcf7e443eac4fc2193935461b7","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/post/post-header.styl","hash":"010c901e4ef49a606f8a350efbf09044e76d2ff3","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"04cf4a69537fc14d3b8904f965d283356853847f","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/post/post-footer.styl","hash":"11497388f124bfbb4001495a67d3629a9f618405","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"9ac6f477177264c26a46e8333b8456720a0444dc","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"40c9839d3288c3b7de0bf38ac2e18f6c8eba6227","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/third-party/disqusjs.styl","hash":"877a537d5b95beb048142e4fdee6f17e6ef9c7bb","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/third-party/gitter.styl","hash":"35104dc6883a61c31e0e368dac8ac2f697be62fe","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/third-party/gitalk.styl","hash":"8f094c4ac17e2ab45569b12d157747f9c7333c12","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/third-party/index.styl","hash":"77550e0d3e029b7458e35d8c5ae1fbd612c9673b","modified":1679725481000},{"_id":"themes/next/source/css/_common/outline/footer/index.styl","hash":"0c79462439b1361034a03590cd69a8abb3a678a6","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/third-party/search.styl","hash":"e72799ce3f9b79753e365b2f8c8ef6c310668d4a","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/third-party/utterances.styl","hash":"56d90ae0559caa55b75f3c300ff2711f9ed65fc4","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/third-party/math.styl","hash":"9d995eb4871a6c273d9d51558676a1fdabf69e72","modified":1679725481000},{"_id":"themes/next/source/css/_common/outline/header/index.styl","hash":"6e0d0796ef7fbbb62ffdfb448753a850de82c74f","modified":1679725481000},{"_id":"themes/next/source/css/_common/outline/header/github-banner.styl","hash":"38c64c2d04e46848382bfa246a0e9c508294767b","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/post/post-body.styl","hash":"d757768a58743601d0d84158ba955eb15d4c3c01","modified":1679725481000},{"_id":"themes/next/source/css/_common/outline/header/bookmark.styl","hash":"e74f4bb47a101b014ee2a1783c87f3b87323f9a0","modified":1679725481000},{"_id":"themes/next/source/css/_common/outline/header/menu.styl","hash":"b750af2fb833c10c4313b5a4258237161a7833d7","modified":1679725481000},{"_id":"themes/next/source/css/_common/outline/sidebar/index.styl","hash":"da5e88f8debd5ac8d7af5c6ba6240df66104955f","modified":1679725481000},{"_id":"themes/next/source/css/_common/outline/header/site-nav.styl","hash":"bf3ad8b4268f763a1e26377681644887694bc009","modified":1679725481000},{"_id":"themes/next/source/css/_common/outline/header/site-meta.styl","hash":"a851e9d5aefcd027c95eeb323860b6da70f202d1","modified":1679725481000},{"_id":"themes/next/source/css/_common/outline/sidebar/related-posts.styl","hash":"b05908f04ef95f2d91e6eba89b12411c378d050f","modified":1679725481000},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-button.styl","hash":"b926e368f702f8686aaa2eb98d3d2e533418958c","modified":1679725481000},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-blogroll.styl","hash":"c6a27beb3f741211a14576026f3b4cfc44cc6407","modified":1679725481000},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author-links.styl","hash":"52fc98b1435129eb3edb9293ced9e507741f1350","modified":1679725481000},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author.styl","hash":"5b38ac4a0f1ade0e681aff0e3366c481d9cf3dcd","modified":1679725481000},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toc.styl","hash":"c2e354a565c8c1b32bd0ceacc972b17982758b67","modified":1679725481000},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toggle.styl","hash":"9a7c71560fbdc936ad4e736fe15063ea3e8a644b","modified":1679725481000},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-nav.styl","hash":"24752d145c6fb8f5344dca9c7b9640839c02e009","modified":1679725481000},{"_id":"themes/next/source/css/_common/outline/sidebar/site-state.styl","hash":"26dd0adfcb1db6df29c6090c8d7e9b5a43583fb0","modified":1679725481000},{"_id":"themes/next/source/css/_common/scaffolding/highlight/copy-code.styl","hash":"670fc109b56a010b166b86b616823a1aae97a738","modified":1679725481000},{"_id":"themes/next/source/css/_common/scaffolding/tags/group-pictures.styl","hash":"393ff96234e4196b569d4b11496774eb78e147de","modified":1679725481000},{"_id":"themes/next/source/css/_common/scaffolding/highlight/index.styl","hash":"ee2c157bc6a687c89f59ff2f852debbe97375224","modified":1681454205000},{"_id":"themes/next/source/css/_common/scaffolding/tags/index.styl","hash":"3f76c73a891bbc10679753e702feba9e8a5ffdd2","modified":1679725481000},{"_id":"themes/next/source/css/_common/scaffolding/tags/blockquote-center.styl","hash":"d6418fd2bbfba7b73ddf11ec62db9637fdf5d8af","modified":1679725481000},{"_id":"themes/next/source/css/_common/scaffolding/tags/label.styl","hash":"debee14539272fbe3835a7d3853af2230baa3501","modified":1679725481000},{"_id":"themes/next/source/css/_common/scaffolding/tags/mermaid.styl","hash":"48d35dba575a7c9e8845b16652e76b7d4a4646de","modified":1679725481000},{"_id":"themes/next/source/css/_common/scaffolding/tags/link-grid.styl","hash":"7f8a7345e6537a62cd9e9a94c8f7065b541d9b04","modified":1679725481000},{"_id":"themes/next/source/css/_common/scaffolding/tags/pdf.styl","hash":"b6654a1d7cf82577d8263faffee8af3ad4a5c0e8","modified":1679725481000},{"_id":"themes/next/source/css/_common/scaffolding/tags/note.styl","hash":"98d4c20aff0f0fcfe1824017fb06ab21ef0d218e","modified":1679725481000},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"ec37a36e94ba791663607a5022f763915778578f","modified":1679725481000},{"_id":"themes/next/source/css/_common/scaffolding/tags/tabs.styl","hash":"7a39bcce7274284e87388743db62afc847fe6897","modified":1679725481000},{"_id":"public/./node_modules/hexo-generator-searchdb/templates/search.xml","hash":"6c3abab49661b8cf47715e873791f71b94554308","modified":1702542475921},{"_id":"public/404/index.html","hash":"18bf2e8218b09b65fe2d0129b90cfb1815e73d9f","modified":1702542475921},{"_id":"public/CI-CD/index.html","hash":"9491bb00e51b9c0134d254ff79a19bd004d0b505","modified":1702542475921},{"_id":"public/Database/index.html","hash":"484dc9c429dadec92100ee3f51ccaa8b8fd340f9","modified":1702542475921},{"_id":"public/DevOps/index.html","hash":"9331cc1b00002d2fa6bd1504bdc97380b9f0447c","modified":1702542475921},{"_id":"public/Docker/index.html","hash":"8f750230f71e7243fce5e796321190a6c046e330","modified":1702542475921},{"_id":"public/K8S/index.html","hash":"f53722aedd4e61088dd0c7456e1a53012979c592","modified":1702542475921},{"_id":"public/KVM/index.html","hash":"954ddfeeb0c93e1a2537693bde5ba4952e6f7b6d","modified":1702542475921},{"_id":"public/Linux/index.html","hash":"0a40be0f30f5a73f3408f42569a736e1fa140049","modified":1702542475921},{"_id":"public/Monitor/index.html","hash":"23d28e378a55ab2cb509c174e0da9994ac399707","modified":1702542475921},{"_id":"public/NetWork/index.html","hash":"9aa96faa0a130bad8ad7f2437387a385e9b9cf37","modified":1702542475921},{"_id":"public/OpenWrt/index.html","hash":"043f1666085a7f13e0fdf42db0aee323dc3468f3","modified":1702542475921},{"_id":"public/MySQL/index.html","hash":"adb0d25baf949b119e76cc4a586f9a06c3385efb","modified":1702542475921},{"_id":"public/Oracle/index.html","hash":"473a077f6e44f270df818eecbfd45c99bda49d48","modified":1702542475921},{"_id":"public/RaspberryPi/index.html","hash":"fd51711ca127875526fa7a51199ab8ae2b46081d","modified":1702542475921},{"_id":"public/Security/index.html","hash":"96e86a0b4ee7a5b3743181eede1e587bd06734c0","modified":1702542475921},{"_id":"public/Ubuntu/index.html","hash":"fb15e423195d9d783958476de957e8dbb59be2fc","modified":1702542475921},{"_id":"public/categories/index.html","hash":"4eb5feae8a1421371f278aa95298945566d790f3","modified":1702542475921},{"_id":"public/2023/04/23/040.openwrt_sftp/index.html","hash":"9e61a80358298b2129d617eff7bfd37d1733c40d","modified":1702542475921},{"_id":"public/2022/09/22/026.xserver/index.html","hash":"d79ec1006bf1d51eebf850d3dd38483c9fe82ef8","modified":1702542475921},{"_id":"public/2022/08/25/025.ssh/index.html","hash":"852efaa9ed6f886a298480f2ae0ea20ef6dcde36","modified":1702542475921},{"_id":"public/2020/05/26/014.linux_shell_redirect/index.html","hash":"c8d5178354519a8280bdb26c9a822f5da5381860","modified":1702542475921},{"_id":"public/archives/page/7/index.html","hash":"91a7d3a31c04aee5a963b8548b92e9f96f256021","modified":1702542475921},{"_id":"public/archives/2020/index.html","hash":"50b4299a503ab04e6a7a414213f193f4e2fdcfbf","modified":1702542475921},{"_id":"public/archives/2020/03/index.html","hash":"cd5ec46d2c58eb3c49df866f16082c0d4d8aa9dd","modified":1702542475921},{"_id":"public/archives/2020/05/index.html","hash":"4a755c5edab9450de31b96f59f5cbeaef00816e1","modified":1702542475921},{"_id":"public/archives/2021/index.html","hash":"36c8b9b2f70cbf3a18ef039330cb5ce6109bdbd0","modified":1702542475921},{"_id":"public/archives/2021/03/index.html","hash":"ac6d49d38ffb679df7c364f95b512017b9cfce54","modified":1702542475921},{"_id":"public/archives/2022/page/4/index.html","hash":"57d1ca01e4e5681d098766da0a8f27b1ab872ff1","modified":1702542475921},{"_id":"public/archives/2022/02/index.html","hash":"576b831c9ed7dc3c65414a2d1f768d93e04c3377","modified":1702542475921},{"_id":"public/archives/2022/03/index.html","hash":"c1b253cf7815f9f3b53a28e33d8c501a4572ed00","modified":1702542475921},{"_id":"public/archives/2022/06/index.html","hash":"ca5a3db6a373c841457b27a62aca15ae81d0a0a6","modified":1702542475921},{"_id":"public/archives/2022/05/index.html","hash":"c60ce66914ddbfe21e4a7fa4821ebb727660c0a7","modified":1702542475921},{"_id":"public/archives/2022/08/index.html","hash":"c4cab1e171db7d3aba330742d11aebad18e8dcb0","modified":1702542475921},{"_id":"public/archives/2022/09/index.html","hash":"7d4e50ebc70d27f2a60f46456b67db023176b619","modified":1702542475921},{"_id":"public/archives/2022/10/index.html","hash":"74703ae4d9f7d1f1cf1678c478ec7c15e18da4b5","modified":1702542475921},{"_id":"public/archives/2022/12/index.html","hash":"62d2d8e7f68c53621c6183be4efbf20039e2c41d","modified":1702542475921},{"_id":"public/archives/2022/11/index.html","hash":"dbd5ab07d8ae2e7da9fffd0f893da2a00f41a466","modified":1702542475921},{"_id":"public/archives/2023/page/3/index.html","hash":"9fc3f016d089de265796dd37268843dcba4a39ff","modified":1702542475921},{"_id":"public/archives/2023/03/index.html","hash":"7f613d2cdf634b517bca3729ead4c312b3a9b8b5","modified":1702542475921},{"_id":"public/archives/2023/04/index.html","hash":"5189b6f4f653487e320ad190eec75c413c765317","modified":1702542475921},{"_id":"public/archives/2023/06/index.html","hash":"b4fe4e7ba6087174acda270a94860c39c0d2c4bc","modified":1702542475921},{"_id":"public/archives/2023/07/index.html","hash":"dfe0d540f51a9877d3b5c9f41ba0961789c2ec6e","modified":1702542475921},{"_id":"public/archives/2023/09/index.html","hash":"80331a5da3984ea602195cfa350737b25d8032d9","modified":1702542475921},{"_id":"public/archives/2023/10/index.html","hash":"881aeeb5f6cab51d5aba883d9e54df66cff615a5","modified":1702542475921},{"_id":"public/archives/2023/11/index.html","hash":"660bf02e180d68eddc6c7878eb6cbdb07d8bf61f","modified":1702542475921},{"_id":"public/categories/Linux/page/4/index.html","hash":"a9cc29c5afc038dc59ac8fd41e0f6eb48fa924e4","modified":1702542475921},{"_id":"public/categories/CentOS/page/2/index.html","hash":"ed98c26ca621917f3552e72097ee16a916960fc6","modified":1702542475921},{"_id":"public/categories/NetWork/index.html","hash":"da040205ef7951fe57e2b304876362baf801b2d0","modified":1702542475921},{"_id":"public/categories/Ubuntu/index.html","hash":"37020e3f3bcd1e734db78ff3b3ec203782519dec","modified":1702542475921},{"_id":"public/categories/Database/index.html","hash":"e49aad9a0d4af55e7e166cd3543436d28c95958b","modified":1702542475921},{"_id":"public/categories/Security/index.html","hash":"9d2cfeba3e02f1357638cb499d29958c8555b660","modified":1702542475921},{"_id":"public/categories/Docker/index.html","hash":"75c6b5c3378aacf7531013ad9b840a9f2cc4cf9b","modified":1702542475921},{"_id":"public/categories/OpenWrt/index.html","hash":"73397a52a81f782ccd4173e1d3b5f0a10ead73ca","modified":1702542475921},{"_id":"public/categories/KVM/index.html","hash":"960f5b85438056b9f8dcfe477a467f201e97d85e","modified":1702542475921},{"_id":"public/categories/Network/index.html","hash":"c281b3a969b16e408a289d350096fefae11c3996","modified":1702542475921},{"_id":"public/categories/Monitor/index.html","hash":"be7fc7c859e895fa0ff1d74eef0c7b105f50e12b","modified":1702542475921},{"_id":"public/categories/CI-CD/index.html","hash":"51bbf132af9e17ebea3b80d27fb1a323ef0c1150","modified":1702542475921},{"_id":"public/tags/frp-内网穿透/index.html","hash":"997d0b5a42099ea7d7421567bc99281ae7bc0eb3","modified":1702542475921},{"_id":"public/tags/Clamav/index.html","hash":"7924c9525247e76ea99f9ba7071d0c55becda704","modified":1702542475921},{"_id":"public/tags/Linux-进程/index.html","hash":"c3ae3b54a6392503050087c61156bb92e891a6ab","modified":1702542475921},{"_id":"public/tags/LVM/index.html","hash":"7d316840b5598968b2a7e27a2f87f2112a194bf8","modified":1702542475921},{"_id":"public/tags/elasticsearch/index.html","hash":"be12ff169a6a897d70f41d4a40e0d38dbea4aef8","modified":1702542475921},{"_id":"public/tags/iptables/index.html","hash":"1ee4ee01028c974d1ecc43f814974d0b1496f82f","modified":1702542475921},{"_id":"public/tags/firewalls/index.html","hash":"9eb2628c85481bd08aae808da523d0e8a9209f7f","modified":1702542475921},{"_id":"public/tags/monitor/index.html","hash":"3bc0812437d472bb45d3531e3535d1b4315e97c6","modified":1702542475921},{"_id":"public/tags/password/index.html","hash":"8e09fb1986737e4bbdf94674a1f8a1192e191ace","modified":1702542475921},{"_id":"public/tags/openssl/index.html","hash":"24fe29dc70db90650ddadc918aa0a4c87ec3324a","modified":1702542475921},{"_id":"public/tags/openssh/index.html","hash":"1340a212ae132ccc0b5fcf073a560c1b9f99a077","modified":1702542475921},{"_id":"public/tags/gcc/index.html","hash":"f81c0f8c6dfbf810ab4a78f38c061b724f327ec1","modified":1702542475921},{"_id":"public/tags/apache-doris/index.html","hash":"d81ce06e506eb971487b9f3b2d2e8fa2af942670","modified":1702542475921},{"_id":"public/tags/docker/index.html","hash":"5ce8ef424ced0547f881b6b773489c6a90fd541f","modified":1702542475921},{"_id":"public/tags/nginx/index.html","hash":"5fdd9d657757879a5d61ff43316368545edff687","modified":1702542475921},{"_id":"public/tags/keepalived/index.html","hash":"075bf8c1629e83b582a30c010a4cb983436304f9","modified":1702542475921},{"_id":"public/tags/HA/index.html","hash":"c7f427609dc0078cd0ccb47c421d10654fcc9a59","modified":1702542475921},{"_id":"public/tags/shell/index.html","hash":"7fd0a91b4f2b5a4f4995f25d181a33b38cedcf9b","modified":1702542475921},{"_id":"public/tags/路由/index.html","hash":"f11475932e478463336a31461bcf48e1bd40ba92","modified":1702542475921},{"_id":"public/tags/重定向/index.html","hash":"1e0e50b9a5fcf1037938db1ac079987a3277fe49","modified":1702542475921},{"_id":"public/tags/windows/index.html","hash":"47bb6805c2eff4d563e8a2278b86ab6267c5e18d","modified":1702542475921},{"_id":"public/tags/ownership/index.html","hash":"951fbea27bbaebb2437ad4aa7993df8ca4ff703d","modified":1702542475921},{"_id":"public/tags/Oracle/index.html","hash":"ebe5df7514484767bdc919f67d5dcbdee669b50d","modified":1702542475921},{"_id":"public/tags/MySQL/index.html","hash":"70e09e3906d16e54ab2051e896871031c3585b73","modified":1702542475921},{"_id":"public/tags/sudo/index.html","hash":"02e8037d311154e69c91ebc17e0ad6428d549bc9","modified":1702542475921},{"_id":"public/tags/mkfs-ext4/index.html","hash":"a14373fee1b887825e387fab08a6e22a52f513fb","modified":1702542475921},{"_id":"public/tags/mount/index.html","hash":"4c26160c7ee88d3f1be19133e8579f0217291710","modified":1702542475921},{"_id":"public/tags/repo/index.html","hash":"08ce85dd30c47946b48a36be5424bc020661489e","modified":1702542475921},{"_id":"public/tags/yum/index.html","hash":"d9eed7649fd0ac021e1ccaf6cab3fd45b1313b10","modified":1702542475921},{"_id":"public/tags/backup/index.html","hash":"1c3e49d02c8a1d62fc2214a927098668f6781769","modified":1702542475921},{"_id":"public/tags/access/index.html","hash":"1e9e201f19cc64d3278192a2901493bcade88cb7","modified":1702542475921},{"_id":"public/tags/fstab/index.html","hash":"4255829d8c1b1501acbb01d921a89f0eb0c05db2","modified":1702542475921},{"_id":"public/tags/umount/index.html","hash":"c87076ae131f91421bfe4ef133924b5dc66aae72","modified":1702542475921},{"_id":"public/tags/ssh/index.html","hash":"72ca4b2779401266bee5696e530e6fca85957647","modified":1702542475921},{"_id":"public/tags/远程登录/index.html","hash":"5c03199cf1b9beca30009c59d73b45884e40ae43","modified":1702542475921},{"_id":"public/tags/ssh协议/index.html","hash":"4f8be3eba738dcd2104ccf07b86c603fc6d2d89e","modified":1702542475921},{"_id":"public/tags/xserver/index.html","hash":"dea0e7e02af457e69330ee0638c167fec9fa54d8","modified":1702542475921},{"_id":"public/tags/桌面/index.html","hash":"513eb885ccaef32d3a9ed7e147766cfeb0234ac6","modified":1702542475921},{"_id":"public/tags/容器/index.html","hash":"9a3021b2cd84eb58eb0dcb3e57f79c316d6576e7","modified":1702542475921},{"_id":"public/tags/telnet/index.html","hash":"12032ed098aa66ff05ccf786bf2ca7012b7d9e99","modified":1702542475921},{"_id":"public/tags/xinetd/index.html","hash":"b63cd3c699f0fefb6d1dfce62bc4dbb0192b5416","modified":1702542475921},{"_id":"public/tags/php/index.html","hash":"a3870f96943121613cb963cc589a3e2f0585a094","modified":1702542475921},{"_id":"public/tags/nextcloud/index.html","hash":"d189d7e456dcf686af2811d745ab70232eddf1f6","modified":1702542475921},{"_id":"public/tags/CA/index.html","hash":"c17621d9f63de0f6046ae43ef3cd58592efc61fd","modified":1702542475921},{"_id":"public/tags/https/index.html","hash":"9f8fa431eb6c6e7b0e8cc14e1f4db650f712ed5b","modified":1702542475921},{"_id":"public/tags/ca/index.html","hash":"6fde9383442c75b8f809a88fb4c99f1fff0e1993","modified":1702542475921},{"_id":"public/tags/acme-sh/index.html","hash":"919dddc923688c92841cf84ef48ae922e7b2e5b2","modified":1702542475921},{"_id":"public/tags/tcpdump/index.html","hash":"7b8d0f1e271ae12b860dbda38ba425e0947019ff","modified":1702542475921},{"_id":"public/tags/wireshark/index.html","hash":"f6de836c184159104ac684e2f9eb7a4562f58817","modified":1702542475921},{"_id":"public/tags/抓包/index.html","hash":"4b2a06116d26eab0398f1486ef1e41fd1d8d7e62","modified":1702542475921},{"_id":"public/tags/redis/index.html","hash":"df308a81b79349089938ac73f67be78a934d63d6","modified":1702542475921},{"_id":"public/tags/SSH/index.html","hash":"3f538d8cf94f0fadd6f12cd7a8317971620ce98e","modified":1702542475921},{"_id":"public/tags/OpenWrt/index.html","hash":"a8a17ed6bc134f48a6f33e2ebd553453e9adbabb","modified":1702542475921},{"_id":"public/tags/kvm/index.html","hash":"d2e67181896138ede13b7074068dd3048f846cb5","modified":1702542475921},{"_id":"public/tags/qemu/index.html","hash":"61b587246228fe39fd8ad6c593608929713f6cff","modified":1702542475921},{"_id":"public/tags/Ubuntu/index.html","hash":"935e236a1a05bb7fd55b11394dbe6b7dab4fc261","modified":1702542475921},{"_id":"public/tags/network/index.html","hash":"a3c4e398bd1e9304a6d5ff7fb68d5c58a5b2111e","modified":1702542475921},{"_id":"public/tags/passwall/index.html","hash":"0bda054ccde78fb371b182b3d970cffe3495dafb","modified":1702542475921},{"_id":"public/tags/frpc/index.html","hash":"f4a356c4a5d5baf4c43aab2a2d400ff3c29d38bd","modified":1702542475921},{"_id":"public/tags/DevOps/index.html","hash":"8cad60474ce10128f6652756cf27226404d7a90a","modified":1702542475921},{"_id":"public/tags/挖矿/index.html","hash":"6c0896912ca349afa45e89ba8d6411afb4a333be","modified":1702542475921},{"_id":"public/tags/xmrig/index.html","hash":"b087c85531ea6bd816eea7b4074c23811af905df","modified":1702542475921},{"_id":"public/tags/Cryptocurrency-Mining-Malware/index.html","hash":"8adfe5b41c1c75f77e78b44b93eff40fc4a72121","modified":1702542475921},{"_id":"public/tags/pid/index.html","hash":"5216a105117d05d7c843cf7b287268c40a2a8044","modified":1702542475921},{"_id":"public/tags/progress/index.html","hash":"dfb8f0e67d6a37be40133ac1aca0b61eb302b9ab","modified":1702542475921},{"_id":"public/tags/v2ray/index.html","hash":"391802b91f030c4810ea7eac6f40badba11df7de","modified":1702542475921},{"_id":"public/tags/xray/index.html","hash":"26bd588a0810d91246627d67e041af6cd98a2d69","modified":1702542475921},{"_id":"public/tags/v2rayA/index.html","hash":"0e33ccc9ba73e3a99c64d5e250c63b04a3fd28fd","modified":1702542475921},{"_id":"public/tags/systemd/index.html","hash":"02da2c47fe5ba7887c4cea4a5d163276b999b034","modified":1702542475921},{"_id":"public/tags/Dockerfile/index.html","hash":"8a142b03441b047e49856e6ffbb861da84fd7ae5","modified":1702542475921},{"_id":"public/tags/centos/index.html","hash":"97cc4a6a962afc4548af66ebde8c475331c66f3d","modified":1702542475921},{"_id":"public/tags/downgrade/index.html","hash":"28f1b4967022f855dafcdd67821f5bec4610bbdb","modified":1702542475921},{"_id":"public/tags/registry/index.html","hash":"ece76af81319102ea2df7d605f5067a0bc8b6a78","modified":1702542475921},{"_id":"public/tags/docker-compose/index.html","hash":"b7ffaead9eda3203721925292f0c8bab2d14953a","modified":1702542475921},{"_id":"public/tags/Prometheus/index.html","hash":"a69d8984d2c5a6079d46449f48c45a2f582529c6","modified":1702542475921},{"_id":"public/tags/Grafana/index.html","hash":"6c76eb90e62fa6e02dce577003c122cb9efa80be","modified":1702542475921},{"_id":"public/tags/gitlab/index.html","hash":"d5aa5508dae85d6d6db21d145ec1ceefcea07e59","modified":1702542475921},{"_id":"public/tags/harbor/index.html","hash":"cf94c38711cf8edc5c8424cfb01c7e7d156c6786","modified":1702542475921},{"_id":"public/tags/security/index.html","hash":"623251f5ce24ad05d3c980b778b640c8b4669494","modified":1702542475921},{"_id":"public/tags/mysql/index.html","hash":"e323de599d0859805b920330d2f1b2c7df257cc1","modified":1702542475921},{"_id":"public/tags/SecureCRT/index.html","hash":"aee144fc301daeca6c910a9397acfa0984fd8cd4","modified":1702542475921},{"_id":"public/tags/xshell/index.html","hash":"f45ac54377ca0d4558c0c468d87bff1bbc4ce1a4","modified":1702542475921},{"_id":"public/tags/samba/index.html","hash":"d321d758df4dee90dbcf5675e581bca702bd3bfb","modified":1702542475921},{"_id":"public/tags/hexo/index.html","hash":"70b61d5cc60d6dc25faf6c905cd636b9725717a1","modified":1702542475921},{"_id":"public/tags/Tips/index.html","hash":"34dbb6de1f4d4f806dde4e1e32798929d522949b","modified":1702542475921},{"_id":"public/tags/index.html","hash":"2eccbcf381e3e71703d2d5baf72633a66d08b87f","modified":1702542475921},{"_id":"public/2023/11/30/061.hexo/index.html","hash":"59a0ca6d7809688e7931772c15b659465e7f8bb4","modified":1702542475921},{"_id":"public/2023/11/23/060.highlight/index.html","hash":"8f51b6d82f301e19020c8ec4edbb70e1a1bb178d","modified":1702542475921},{"_id":"public/2023/11/23/059.samba/index.html","hash":"26e857e213ab055160cb42cacec39bd28fc05728","modified":1702542475921},{"_id":"public/2023/11/06/058.MySQL_Security_Policy/index.html","hash":"f5a9c5ca894993161ec25452412b99e0c2d42111","modified":1702542475921},{"_id":"public/2023/11/02/057.Linux_Security_Policy/index.html","hash":"0eb582fcab4656346073d97b007e6cd48937b9dd","modified":1702542475921},{"_id":"public/2023/10/12/056.Harbor_Installation/index.html","hash":"21693c5e4716e1cdecc8c728e8112cfe814b49bc","modified":1702542475921},{"_id":"public/2023/10/11/055.Gitlab_Installation/index.html","hash":"d1df4b7d1b9c1c80e88f3d1150d98bffbb3f6d95","modified":1702542475921},{"_id":"public/2023/09/28/054.Grafana_Installation/index.html","hash":"f07b9c4d8ab5f705fd76d1cf868ad7a014487ef7","modified":1702542475921},{"_id":"public/2023/09/26/053.Prometheus_Installation/index.html","hash":"7f26ed19fba029a18e7dd767f4b9b04347fa5de4","modified":1702542475921},{"_id":"public/2023/09/25/052.MySQL_Installation_Uasing_Source/index.html","hash":"b7884acfb270f1f1ae302b124ced8a487635bbe4","modified":1702542475921},{"_id":"public/2023/09/25/051.MySQL_Install_Using_Generic_Binaries/index.html","hash":"90532f7e43d4883948afc4c361c3c881addba2ff","modified":1702542475921},{"_id":"public/2023/09/20/050.registry_setup/index.html","hash":"72231beb1d6f35113adb0edd0bccae8b130a8d8e","modified":1702542475921},{"_id":"public/2023/09/15/049.centos_downgrade/index.html","hash":"11c761d988cbb36a2403589eae98ec8afe546770","modified":1702542475921},{"_id":"public/2023/09/14/048.docker-compose_instance/index.html","hash":"dc2e767606901e7ee667488987bb5892f2d9fe82","modified":1702542475921},{"_id":"public/2023/09/12/047.docker_build_instances/index.html","hash":"63ff3dd1af9b9c82161b3fa72bd3fb7b949cb019","modified":1702542475921},{"_id":"public/2023/09/11/046.docker_install_manual/index.html","hash":"cc3ba22fd82f0e5cc484e9173eaf85f7c2cd868e","modified":1702542475921},{"_id":"public/2023/07/07/045.v2raya/index.html","hash":"09e19b050cad991b1700dab8eeaa172e8a303480","modified":1702542475921},{"_id":"public/2023/06/20/044.about_process/index.html","hash":"04cd26580aaf17117845962035839a937cf6f1f2","modified":1702542475921},{"_id":"public/2023/06/12/043.Cryptocurrency_Mining_Malware/index.html","hash":"5617337e43c51f7be75e87e91031db8a5bc22129","modified":1702542475921},{"_id":"public/2023/06/06/042.Greenbone_Community_installation/index.html","hash":"3c0be43ac89934816f52fd196c3560c59f9817ac","modified":1702542475921},{"_id":"public/2023/06/02/041.openwrt_install_frpc/index.html","hash":"c2ef586ae6769b2a81f504ec2002241967bbba8b","modified":1702542475921},{"_id":"public/2023/04/23/040.openwrt_install_passwall/index.html","hash":"7a5fd8645994b810b3f9af81ac70e68f2fe1bb7c","modified":1702542475921},{"_id":"public/2023/03/30/037.kvm/index.html","hash":"485b19c220b1d9f4c6166f3fb6864d6d434b1834","modified":1702542475921},{"_id":"public/2023/03/30/038.ubuntu_network_config/index.html","hash":"8a2d8ba794ae5503c7333c930ddac9200f7de219","modified":1702542475921},{"_id":"public/2023/03/24/036.openwrt_disk_expansion/index.html","hash":"269305674b69fe9dac4291dbeb0d65ed9a454701","modified":1702542475921},{"_id":"public/2023/03/15/035.ssh_key/index.html","hash":"5f857c72d013914141b92ee5903a2ad6f3c50b51","modified":1702542475921},{"_id":"public/2022/12/05/034.redis/index.html","hash":"6258354ef3c6edcff9641ccd893d1f2c93278d25","modified":1702542475921},{"_id":"public/2022/11/29/033.tcpdump_instances/index.html","hash":"cd9b80233be17bebd739c38ab98d735a383c71bc","modified":1702542475921},{"_id":"public/2022/11/28/032.acme.sh/index.html","hash":"c524d124f97a9ddd6f84784461ed1c4e2807a8b0","modified":1702542475921},{"_id":"public/2022/11/24/031.ca/index.html","hash":"a725410fcb974eae739cf3d9af1e90a4884b4ec2","modified":1702542475921},{"_id":"public/2022/11/23/030.nextcloud/index.html","hash":"c97054533dd45c4658e6a2a3a6fbb0241f7fe95e","modified":1702542475921},{"_id":"public/2022/11/22/029.install_php7.4.33/index.html","hash":"c54b9e5c6b8da5894822472db4932e6fb571dd84","modified":1702542475921},{"_id":"public/2022/11/04/028.docker_instances/index.html","hash":"78aa0d860f6c83542fa612a02ef229232a5e2ef4","modified":1702542475921},{"_id":"public/2022/10/09/027.telnet/index.html","hash":"b0927cbda92fb5294bbbb3a5abbc399c7c410e7b","modified":1702542475921},{"_id":"public/2022/08/12/024.fstab/index.html","hash":"5bd343ac558ab0a3a73496aadc1f7826c3b8ab03","modified":1702542475921},{"_id":"public/2022/06/30/023.access/index.html","hash":"1bbedfdb9fb6287a826bc866248902f719f5414d","modified":1702542475921},{"_id":"public/2022/06/23/022.MySQL_backup/index.html","hash":"101653aee352cff51b0a2b5e62e73cca0cc8d6e0","modified":1702542475921},{"_id":"public/2022/06/21/021.CentOS-Base.repo/index.html","hash":"3a9a9f979efc2896472a2ce5ee5015ea7dd63f63","modified":1702542475921},{"_id":"public/2022/06/16/020.mount/index.html","hash":"ea2600179590a20d92cedb180b4ca69d1d5a4bec","modified":1702542475921},{"_id":"public/2022/06/15/019.sudo/index.html","hash":"4c5665d01dcb887c67e9fdee4fcf620e4c70c5ba","modified":1702542475921},{"_id":"public/2022/06/13/018.mysql/index.html","hash":"a639b0a5dced4d45aeed434b51f0d6214daab056","modified":1702542475921},{"_id":"public/2022/06/10/017.Oracle/index.html","hash":"efc9971c2fcf2ae8249675e8a1b3984bb6d6905d","modified":1702542475921},{"_id":"public/2022/06/09/016.take_ownership/index.html","hash":"9617cbcc4f92d8007651532a19389d573fc85ded","modified":1702542475921},{"_id":"public/2022/05/31/015.windows_route/index.html","hash":"51761b10927fd0a4a2cca3f3ef5c9e99b39449fd","modified":1702542475921},{"_id":"public/2022/05/24/011.apache-doris/index.html","hash":"f82d884455eee7632b197b71efd9965eca958176","modified":1702542475921},{"_id":"public/2022/05/23/010.gcc_update/index.html","hash":"8e178932f8191d68166f523fbad6606d80dcc2be","modified":1702542475921},{"_id":"public/2022/05/18/999.Tips-linux/index.html","hash":"8f6add5b4178e0c0864eaad3755acf79052ef0b9","modified":1702542475921},{"_id":"public/2022/05/16/009.openssh/index.html","hash":"940da92946f21ab0ea46158e727f7fd4b956619e","modified":1702542475921},{"_id":"public/2022/05/12/008.reset_password/index.html","hash":"2eacb6724892fd611bc6c7504a92ce52ebf24e5b","modified":1702542475921},{"_id":"public/2022/05/11/007.system_monitor/index.html","hash":"d03313f48b5110450737a5ecf649ebe7fbcb54f3","modified":1702542475921},{"_id":"public/2022/03/23/002.progress/index.html","hash":"2a91fcd0ff2fd85624af2444204b15481b7d056f","modified":1702542475921},{"_id":"public/2022/03/03/004.lvm/index.html","hash":"f07929ab3f6f5828162b8f2be9654837ee454f5c","modified":1702542475921},{"_id":"public/2022/03/03/003.clamav/index.html","hash":"d7684e6f541db6a9737c3f7fa19b971c6e5ad271","modified":1702542475921},{"_id":"public/2022/02/25/001.frp/index.html","hash":"4474ea5c8d6ae0e6439cc261b4feb07831a61cf0","modified":1702542475921},{"_id":"public/2022/02/17/005.elasticsearch/index.html","hash":"4fbe356cb37cb7464de80f75e86d456892f152b6","modified":1702542475921},{"_id":"public/2022/02/16/006.iptables/index.html","hash":"f6eb69d19c0494fc463d2a97637857cf46ba1530","modified":1702542475921},{"_id":"public/2021/03/18/012.docker_installation/index.html","hash":"16c4293e134c8ebab128137154846a7333d26b17","modified":1702542475921},{"_id":"public/2020/03/18/013.keepalived/index.html","hash":"385023579c042c438826562fbc2e76e06817117b","modified":1702542475921},{"_id":"public/archives/index.html","hash":"59529f45497f328264981342690a44ae3238caf1","modified":1702542475921},{"_id":"public/archives/page/2/index.html","hash":"38941590da41f74681b0d06967eaf464ae8b1999","modified":1702542475921},{"_id":"public/archives/page/3/index.html","hash":"c7cd38935fe8ebd6522daa60936c11d61e9204ed","modified":1702542475921},{"_id":"public/archives/page/4/index.html","hash":"72652902f4ab7a2b4d537b05839fe681bd372e9c","modified":1702542475921},{"_id":"public/archives/page/5/index.html","hash":"93b34ecb84b265e45cebcd5ec2095f94c1ef70ec","modified":1702542475921},{"_id":"public/archives/page/6/index.html","hash":"987210151cea50187a22f3380def20f3a5d608ea","modified":1702542475921},{"_id":"public/archives/2022/index.html","hash":"f8749e7bf6370a93f0dd34ced93c7f400e45c02c","modified":1702542475921},{"_id":"public/archives/2022/page/2/index.html","hash":"38f04fdddd7333005f0dd9ef51bb12718a628127","modified":1702542475921},{"_id":"public/archives/2022/page/3/index.html","hash":"1f3a405d6f999fd6e08c1c19139006c2021f2d15","modified":1702542475921},{"_id":"public/archives/2023/index.html","hash":"c771554307c2f52eb0735d70d5ea04cbe58ef7a1","modified":1702542475921},{"_id":"public/archives/2023/page/2/index.html","hash":"bf42377c43878fcbbb69e638b467ad0aec3c72a7","modified":1702542475921},{"_id":"public/categories/Linux/index.html","hash":"68b7a85abb7f02f7403ba1eeb63d649a0dffb4b7","modified":1702542475921},{"_id":"public/categories/Linux/page/2/index.html","hash":"b72e76c96e1ee6017d947b10126002a981237b93","modified":1702542475921},{"_id":"public/categories/Linux/page/3/index.html","hash":"8fd9499af977488b52f7f29c2fef65b21238e109","modified":1702542475921},{"_id":"public/categories/CentOS/index.html","hash":"b95c61b6f8343dc401bf4d5308231f65115be40c","modified":1702542475921},{"_id":"public/categories/DevOps/index.html","hash":"667ab9f461de191b17c1e740508329f935ad18ff","modified":1702542475921},{"_id":"public/index.html","hash":"1c2b1942bc366afd7867244cb81fea0541184cb6","modified":1702542475921},{"_id":"public/page/2/index.html","hash":"6a88537b8650ae516b83ed0212d565fe45ab396a","modified":1702542475921},{"_id":"public/page/3/index.html","hash":"6b13995712f253d457693ea57831f46a656384f1","modified":1702542475921},{"_id":"public/page/4/index.html","hash":"ce59c370595c7d60d9e49f50ae7cf4ba4c080f1b","modified":1702542475921},{"_id":"public/page/5/index.html","hash":"70bd1a456998eb48f139efd8aece2a4ebbc54a7b","modified":1702542475921},{"_id":"public/page/6/index.html","hash":"e7439ffd6f96d6f9b912381b52bf7362f3a6170f","modified":1702542475921},{"_id":"public/page/7/index.html","hash":"b05211559caaa8050b941df2dc7602a61d726a65","modified":1702542475921},{"_id":"public/images/004.lvm.md.01.png","hash":"4691bdaaad12fd18057c68ea088d386eb9589aaa","modified":1702542475921},{"_id":"public/images/004.lvm.md.02.png","hash":"aa7c480cbf16659a6c6211269f30ce45935d4bc1","modified":1702542475921},{"_id":"public/images/004.lvm.md.04.png","hash":"aa8a446f698cbe4d7fa1f28ef4d3337fd5f73563","modified":1702542475921},{"_id":"public/images/005.elasticsearch.md.02.png","hash":"329eed1611a056e7cf1f528ba14ef31cf05735fa","modified":1702542475921},{"_id":"public/images/005.elasticsearch.md.03.png","hash":"ffca61e0e1f015bf6be403c04731b0bb7273dc79","modified":1702542475921},{"_id":"public/images/005.elasticsearch.md.04.png","hash":"db3bde9a0df0c8b47c6d6f1166f451f547304788","modified":1702542475921},{"_id":"public/images/005.elasticsearch.md.05.png","hash":"8bbe91b742b6137ee3bae4fd3f70f765355f96e5","modified":1702542475921},{"_id":"public/images/005.elasticsearch.md.07.png","hash":"7b7fd9dd060e50154e3e18852776a8331b9f6021","modified":1702542475921},{"_id":"public/images/006.iptables.md.02.png","hash":"db12992e1b0eaf706179a1230181ef1a242eafcf","modified":1702542475921},{"_id":"public/images/006.iptables.md.03.png","hash":"aa545771eb288bc4df8e83473ef388f25b68c927","modified":1702542475921},{"_id":"public/images/007.system_info.md.01.png","hash":"813e1e65e4b399d93e57361339a654144a110f37","modified":1702542475921},{"_id":"public/images/008.reset_password.md.01.png","hash":"2b4f99f2c2c13db63c096c22019fa1c126f6d20a","modified":1702542475921},{"_id":"public/images/008.reset_password.md.02.png","hash":"4333f8384df6b215607b9dec80914423543793ea","modified":1702542475921},{"_id":"public/images/012.docker_installation.md.01.png","hash":"fa5bbbb2f87bbdcf8ac1a9e80034d94cbd21d3a2","modified":1702542475921},{"_id":"public/images/017.oracle.md.01.png","hash":"211dd097f37c6e70f5b86e536eeee8c4027b5435","modified":1702542475921},{"_id":"public/images/017.oracle.md.02.png","hash":"6e4d4cb67bcf23f5b88ad10a3241cde173ff42e6","modified":1702542475921},{"_id":"public/images/017.oracle.md.03.png","hash":"eb6c377bf624d93664c2981f147a9632926f672a","modified":1702542475921},{"_id":"public/images/017.oracle.md.04.png","hash":"2648e9f5df7cec3094c70f63605b7154d3a8cb90","modified":1702542475921},{"_id":"public/images/017.oracle.md.05.png","hash":"25676c6654f6ae754f2a94bdf02ea0d5ef6a8ab0","modified":1702542475921},{"_id":"public/images/017.oracle.md.06.png","hash":"226eadca708d5ba0fa558605e34fe7e364d6b8cb","modified":1702542475921},{"_id":"public/images/017.oracle.md.09.png","hash":"20bbfe2ace9d23e73e9472932641e12a7ffb4dee","modified":1702542475921},{"_id":"public/images/017.oracle.md.10.png","hash":"89795d32ebc27265a4cc1f264a919c12be26ac47","modified":1702542475921},{"_id":"public/images/017.oracle.md.12.png","hash":"7b6376413020ff55a749dd6c161cb5b752adc566","modified":1702542475921},{"_id":"public/images/017.oracle.md.11.png","hash":"3e10efa851efa0cb347ae4e068dbd6f504fb4c8e","modified":1702542475921},{"_id":"public/images/028.docker_instances.md.01.png","hash":"bf929e46c4ca2dec608b43d80f3de40fcead2496","modified":1702542475921},{"_id":"public/images/031.ca.md.01.png","hash":"67e063dffdec69fc78d24997d2dc32a3263b82f7","modified":1702542475921},{"_id":"public/images/002.progress.md.02.png","hash":"f53fdc057abd32d1b18bf6b03848280892cac4fd","modified":1702542475921},{"_id":"public/images/035.ssh_key.md.01.png","hash":"66bc80eb445e96d0f910bff62af74c6e247a484c","modified":1702542475921},{"_id":"public/images/040.openwrt_install_passwall.md.01.png","hash":"f501473a5c2dfefa8e30d9120a8da378fb372b4a","modified":1702542475921},{"_id":"public/images/040.openwrt_install_passwall.md.04.png","hash":"15735380aa3c8172855c6e20f8eaa350b469b583","modified":1702542475921},{"_id":"public/images/040.openwrt_install_passwall.md.03.png","hash":"bf45100d1dce0dad051f62af9b849c8c90d3f6a8","modified":1702542475921},{"_id":"public/images/041.openwrt_install_frpc.md.01.png","hash":"3fb1959b14a4fed2970a040cdd91d36d108ec12a","modified":1702542475921},{"_id":"public/images/043.Cryptocurrency_Mining_Malware.md.02.png","hash":"8300a70785224e56dfd7b783e3713560ea2532a8","modified":1702542475921},{"_id":"public/images/043.Cryptocurrency_Mining_Malware.md.04.png","hash":"3b84e850fed75c7522de14ea371e252c6ace450c","modified":1702542475921},{"_id":"public/images/043.Cryptocurrency_Mining_Malware.md.05.png","hash":"42acb4603d9a6f98d66bb8acaf092944f6051eea","modified":1702542475921},{"_id":"public/images/043.Cryptocurrency_Mining_Malware.md.03.png","hash":"ae4f5f502652c216a7b97fb260e67fe5c4761326","modified":1702542475921},{"_id":"public/images/043.Cryptocurrency_Mining_Malware.md.08.png","hash":"9b5861b3593957ac7a72c1479af541216acd7bf9","modified":1702542475921},{"_id":"public/images/045.v2raya.md.00.png","hash":"b5f10501dea28f1209ac5f891fb56f6bb8dae97a","modified":1702542475921},{"_id":"public/images/045.v2raya.md.000.png","hash":"8ef56f19e487f40a0dcf79db51318ea2877dc130","modified":1702542475921},{"_id":"public/images/045.v2raya.md.02.png","hash":"b7354b9a142ae5f87c388612e802f0d64882e65e","modified":1702542475921},{"_id":"public/images/045.v2raya.md.03.png","hash":"1eacad49a31fcaa479bb626f0ae5c43d827c5655","modified":1702542475921},{"_id":"public/images/046.docker_install_manual.md.01.png","hash":"bf20371003a970e7a6ca97bef41861ce2249763e","modified":1702542475921},{"_id":"public/images/049.centos_downgrade.md.01.png","hash":"4c667cec33799a712d024d0a316462cfdf0a03b5","modified":1702542475921},{"_id":"public/images/050.registry_setup.md.01.png","hash":"8c3adaf4e9c542c6840ead256d0a3ba41f9828f1","modified":1702542475921},{"_id":"public/images/050.registry_setup.md.02.png","hash":"84d1de83725a4d0f2332c5afa0c5f2b19a2a965f","modified":1702542475921},{"_id":"public/images/051.MySQL_Install_Using_Generic_Binaries.md.02.png","hash":"a086f03331dfc00298aeb5c2eb874ec89dd9465a","modified":1702542475921},{"_id":"public/images/055.Gitlab_Installation.md.02.png","hash":"0808f2c2f386e6de32f99759769d8e6a8490b529","modified":1702542475921},{"_id":"public/images/056.Harbor_Installation.md.01.png","hash":"0076997f63eb97e9fa0e6221de437df5e4b06938","modified":1702542475921},{"_id":"public/images/056.Harbor_Installation.md.02.png","hash":"f6592c20cfb85afc8f47387137426865165160a0","modified":1702542475921},{"_id":"public/images/059.samba.md.02.png","hash":"1ec0bc8cd11a9f7ee2fa6188d81e024916252c69","modified":1702542475921},{"_id":"public/images/059.samba.md.05.png","hash":"f3db6fdb12d29803fb66897264c592fd9634e17f","modified":1702542475921},{"_id":"public/images/059.samba.md.06.png","hash":"fb5f34615e90832f34f38314a8e9ff6fefa72edd","modified":1702542475921},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1702542475921},{"_id":"public/images/avatar.gif","hash":"2dbc3e2f2d624b2ca1afe6edc2ca17307f1950c8","modified":1702542475921},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1702542475921},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1702542475921},{"_id":"public/images/logo.svg","hash":"099e11ab995a2c8981427a85476d082609848c77","modified":1702542475921},{"_id":"public/images/logo-algolia-nebula-blue-full.svg","hash":"b85e274207b1392782476a0430feac98db1e7da0","modified":1702542475921},{"_id":"public/images/052.MySQL_Installation_Uasing_Source.md.02.png","hash":"47420657145fe17289147cb0a1e900cb8fbaec79","modified":1702542475921},{"_id":"public/images/002.progress.md.01.png","hash":"981b48572b3b32da3e71e985e75126e04bfeb323","modified":1702542475921},{"_id":"public/images/004.lvm.md.03.png","hash":"b66c65c73958ce03a6df217b0a5c4afc72500e74","modified":1702542475921},{"_id":"public/images/005.elasticsearch.md.01.png","hash":"56acbf689d68e6fadda3e36b47a26363c77e1d36","modified":1702542475921},{"_id":"public/images/005.elasticsearch.md.08.png","hash":"665b216f7cfcf30cd9026f9388eed796bd986fe8","modified":1702542475921},{"_id":"public/images/009.openssh.md.01.png","hash":"4706abfc666f54b0ccd540fe865ffc09574cbef3","modified":1702542475921},{"_id":"public/images/009.openssh.md.03.png","hash":"ea03603fe823cfb4c1f3d5eecfc1e73e016dae46","modified":1702542475921},{"_id":"public/images/009.openssh.md.05.png","hash":"e6e097c15a2492d1ed0d87a993ffe2e7f9748442","modified":1702542475921},{"_id":"public/images/009.openssh.md.04.png","hash":"127bdf7b211051766e946a64d8b1275adb0194e3","modified":1702542475921},{"_id":"public/images/009.openssh.md.06.png","hash":"932bc4528927d42720cf843759b70540d947791f","modified":1702542475921},{"_id":"public/images/017.oracle.md.07.png","hash":"21ae6a916a3b29922d6b3c5c78a0a05c4b9683b9","modified":1702542475921},{"_id":"public/images/017.oracle.md.08.png","hash":"ceae0f699979374763a9c133399437a07a5cf26b","modified":1702542475921},{"_id":"public/images/027.telnet.md.01.png","hash":"d41f66832506649ee1627f6b4a58a14406e84ae1","modified":1702542475921},{"_id":"public/images/017.oracle.md.13.png","hash":"3cceebcf247c7bf73925524de22b8d73d0e29894","modified":1702542475921},{"_id":"public/images/027.telnet.md.02.png","hash":"28ce933daaf7a51af701ceb94ad45ef9b5ed0b45","modified":1702542475921},{"_id":"public/images/031.ca.md.02.png","hash":"6bbd67655f11766a9de7543ce549f7b1249d6655","modified":1702542475921},{"_id":"public/images/031.ca.md.03.png","hash":"2884c0fa48bc11f8ffd1ab82a682df6aa0eb259e","modified":1702542475921},{"_id":"public/images/034.redis.md.01.png","hash":"2daa90c1b3ec00cbe4142e195ca719810fa72458","modified":1702542475921},{"_id":"public/images/040.openwrt_install_passwall.md.02.png","hash":"bdfc2a924ab4d5fd86578d34c2e1d7c5be98ba70","modified":1702542475921},{"_id":"public/images/041.openwrt_install_frpc.md.02.png","hash":"c4851930d037cf68542bbe6b87c6f224e1110127","modified":1702542475921},{"_id":"public/images/043.Cryptocurrency_Mining_Malware.md.01.png","hash":"6f6e0509eb3728c36c23c58d85297e2ad1a39ca8","modified":1702542475921},{"_id":"public/images/043.Cryptocurrency_Mining_Malware.md.07.png","hash":"ab041d6c140e4b827c2a02df85f7887caed0b7de","modified":1702542475921},{"_id":"public/images/043.Cryptocurrency_Mining_Malware.md.06.png","hash":"31c26cb4223a07a0b09e140c5b180559af159c23","modified":1702542475921},{"_id":"public/images/045.v2raya.md.01.png","hash":"fc78d3b761fb8a4c9a092f343b8b2d1bd64b0d96","modified":1702542475921},{"_id":"public/images/046.docker_install_manual.md.02.png","hash":"4b1e226ba2fda8a04435bce093285f84814fc5c8","modified":1702542475921},{"_id":"public/images/047.docker_build_instances.md.01.png","hash":"3933a3766623eae3950ecbd2d059dc809ceebfcf","modified":1702542475921},{"_id":"public/images/047.docker_build_instances.md.02.png","hash":"901ba454f56bdf5100b37544e97de0a78aa8df65","modified":1702542475921},{"_id":"public/images/003.clamav.md.01.png","hash":"0377710a728d349612a253d64ae3928feb0f1343","modified":1702542475921},{"_id":"public/images/051.MySQL_Install_Using_Generic_Binaries.md.01.png","hash":"34910f3f80584529757bfd617939917e8f1d087a","modified":1702542475921},{"_id":"public/images/052.MySQL_Installation_Uasing_Source.md.01.png","hash":"82b0cdcaf6428cd123db76d61a3b91dcb50e004d","modified":1702542475921},{"_id":"public/images/053.Prometheus_Installation.md.01.png","hash":"0af5d2370c9b5b61397334899a964923682ac2cf","modified":1702542475921},{"_id":"public/images/055.Gitlab_Installation.md.01.png","hash":"c370f8c385d2ca48854bf8db2ece290bee383f52","modified":1702542475921},{"_id":"public/images/055.Gitlab_Installation.md.03.png","hash":"249978029c004436ad8429196194c0748e9a903b","modified":1702542475921},{"_id":"public/images/059.samba.md.03.png","hash":"375cbb396fc3893df237a063e2060b04023451a5","modified":1702542475921},{"_id":"public/images/059.samba.md.04.png","hash":"1ebb2bebe05e2fe6dc98db341963e3bf0b94c243","modified":1702542475921},{"_id":"public/images/003.clamav.md.02.png","hash":"463efbc79306b67e2e69c2c4712f79dd68adf10b","modified":1702542475921},{"_id":"public/css/noscript.css","hash":"4cd5301e478e0e0d4b176740ec314087ec5cb707","modified":1702542475921},{"_id":"public/js/bookmark.js","hash":"0f563ffbf05fad30e854e413ab17ff7164ab5a53","modified":1702542475921},{"_id":"public/js/comments-buttons.js","hash":"1a7344440321713426a0b2ab17e276b5bdf85ade","modified":1702542475921},{"_id":"public/js/comments.js","hash":"66ae2e26ea36a41b72c638ea8b220296638ae952","modified":1702542475921},{"_id":"public/js/config.js","hash":"4c4ebbe3b3f3841a26f9d5af6d0ba8bc6da01c54","modified":1702542475921},{"_id":"public/js/motion.js","hash":"770d63c26f22705311028a36b52e999cc8a2da82","modified":1702542475921},{"_id":"public/js/next-boot.js","hash":"da0f07f9eaaa83de70128b0feaea3fdadb90457a","modified":1702542475921},{"_id":"public/js/schedule.js","hash":"a1333258726caf84f368a8f8454639c7dc1626bb","modified":1702542475921},{"_id":"public/js/pjax.js","hash":"b03ba78c6916ad2f390d55bc1bc18fafb64b0ebf","modified":1702542475921},{"_id":"public/js/schemes/muse.js","hash":"0c490e9ba82efbb8bdf8465e6b537fafd51e1ed7","modified":1702542475921},{"_id":"public/js/third-party/fancybox.js","hash":"c098d14e65dd170537134358d4b8359ad0539c2c","modified":1702542475921},{"_id":"public/js/third-party/pace.js","hash":"0ef04218b93561ba4d0ff420d556c3d90a756d32","modified":1702542475921},{"_id":"public/js/third-party/quicklink.js","hash":"eed02e6fced8e5a653077205d4d4d7834ca71472","modified":1702542475921},{"_id":"public/js/third-party/analytics/baidu-analytics.js","hash":"f629acc46ff40c071ffd31b77d5c7616f0fdd778","modified":1702542475921},{"_id":"public/js/third-party/analytics/google-analytics.js","hash":"59684383385059dc4f8a1ff85dbbeb703bcdbcb5","modified":1702542475921},{"_id":"public/js/third-party/analytics/growingio.js","hash":"78dd3cf04082b7dbe6246e404b2aa8e726922402","modified":1702542475921},{"_id":"public/js/third-party/analytics/matomo.js","hash":"c6a25b26a1443caa70b47fd3dfa282271574deb5","modified":1702542475921},{"_id":"public/js/third-party/comments/changyan.js","hash":"260d1a77d6a3bb33a579d3e4cca1997003e799b5","modified":1702542475921},{"_id":"public/js/third-party/comments/disqus.js","hash":"da361917d65e5dca8362f8cdeb6c8cc0e8316cec","modified":1702542475921},{"_id":"public/js/third-party/comments/disqusjs.js","hash":"1e826dea3f684c0515f362dc1352447a1f0eae71","modified":1702542475921},{"_id":"public/js/third-party/comments/gitalk.js","hash":"0ec038cf83e8ec067534f16a54041e47a3c1e59a","modified":1702542475921},{"_id":"public/js/third-party/comments/livere.js","hash":"2247d88c934c765c43013337860774aaa99f0b31","modified":1702542475921},{"_id":"public/js/third-party/comments/utterances.js","hash":"f67f90eb03e284c82da2b8cf2f1e31801813c16d","modified":1702542475921},{"_id":"public/js/third-party/comments/isso.js","hash":"753a873b6f566aff5ba77ca23f91b78eb880ca64","modified":1702542475921},{"_id":"public/js/third-party/chat/chatra.js","hash":"c32180522788c10e51df1803aa6842ef0432ddc9","modified":1702542475921},{"_id":"public/js/third-party/chat/gitter.js","hash":"cc38c94125f90dadde11b5ebac7d8bf99a1a08a2","modified":1702542475921},{"_id":"public/js/third-party/chat/tidio.js","hash":"b0079f6a4601e06ca6fe46e83a2f5af553e9bc3c","modified":1702542475921},{"_id":"public/js/third-party/math/katex.js","hash":"83c54ee536e487a1031783443fe0cb63b1b4767e","modified":1702542475921},{"_id":"public/js/third-party/math/mathjax.js","hash":"5c749b9c1c3bb738122d0516211ecff6496d4907","modified":1702542475921},{"_id":"public/js/third-party/search/algolia-search.js","hash":"fdb7b7cef1a147d897e7f7cd8903b58368ec2062","modified":1702542475921},{"_id":"public/js/third-party/tags/mermaid.js","hash":"f27d817b0c2138dd3215b1f46af0753f60a008f3","modified":1702542475921},{"_id":"public/js/third-party/search/local-search.js","hash":"4536cb6d0a9bbaaa86fab3fa0101f6a3a3ec5a76","modified":1702542475921},{"_id":"public/js/third-party/statistics/firestore.js","hash":"6e0682bb42170d61b13b786295f45f9c785f8b73","modified":1702542475921},{"_id":"public/js/third-party/tags/pdf.js","hash":"af78c22f0e61c8c8aa8794e585e0d632c6d4fcb8","modified":1702542475921},{"_id":"public/js/third-party/statistics/lean-analytics.js","hash":"835cbf54c49ef1327f47df70ff2636ad36b6f57d","modified":1702542475921},{"_id":"public/css/main.css","hash":"f16732521a25575164af237b10b6fb2748ffa919","modified":1702542475921},{"_id":"public/js/utils.js","hash":"5e1cf39de050964e97fb3ba0825aeec7f4bc36dd","modified":1702542475921},{"_id":"public/images/009.openssh.md.07.png","hash":"687e52bc44ce594f75fd4cdd654eb53d1231c0c9","modified":1702542475921},{"_id":"public/images/029.install_php7.4.33.md.03.png","hash":"8eb1f0b64ce71dfc0623f0bb822c48117bbc3191","modified":1702542475921},{"_id":"public/images/036.openwrt_disk_expansion.md.02.png","hash":"5e42aaad32d5d4be4c4321878735e4aee87eb359","modified":1702542475921},{"_id":"public/images/037.kvm.md.02.png","hash":"ce5f29c030a4962b5447eee944675bf6ad29196f","modified":1702542475921},{"_id":"public/images/047.docker_build_instances.md.03.png","hash":"67553b46515cd4469a65edc1905625faf1614221","modified":1702542475921},{"_id":"public/images/059.samba.md.01.png","hash":"eb306fd6368064ab3abb2446993d415e823a8b7c","modified":1702542475921},{"_id":"public/images/057.Linux_Security_Policy.md.01.png","hash":"c011cf9fc9285dbda2b6698061c35b6e39d608fc","modified":1702542475921},{"_id":"public/images/009.openssh.md.02.png","hash":"54689ec50a9d36876e73075336f1612c7e17ae99","modified":1702542475921},{"_id":"public/images/060.highlight.md.01.png","hash":"c1185e6b72d878cd364e423d0ec9eb3a038b04ff","modified":1702542475921},{"_id":"public/images/005.elasticsearch.md.06.png","hash":"c337f5444bd4db0b08abf9949f76e14e6b5fbb9e","modified":1702542475921},{"_id":"public/images/029.install_php7.4.33.md.02.png","hash":"bd90e3b395314b90ce305b6d1bd88d0dbc52b69f","modified":1702542475921},{"_id":"public/images/037.kvm.md.04.png","hash":"9847c5db3b6660af0d4ed8e5c80a4845ab04ec67","modified":1702542475921},{"_id":"public/images/057.Linux_Security_Policy.md.02.png","hash":"91a6c27ecbe4f37b25c77744135aa9f9eb967c23","modified":1702542475921},{"_id":"public/images/006.iptables.md.01.png","hash":"a8ac603a12fba8d347c56a5c320a90ed0c24526f","modified":1702542475921},{"_id":"public/images/029.install_php7.4.33.md.01.png","hash":"5ca2d5fcffd1c7496b0dba0e53ce5db5ff9bfe7f","modified":1702542475921},{"_id":"public/images/036.openwrt_disk_expansion.md.01.png","hash":"378dafdc2f8d6e1b73279434a423e3d6456a209b","modified":1702542475921},{"_id":"public/images/037.kvm.md.01.png","hash":"9b194464ed376d437ed707ac6e28e9037c736c66","modified":1702542475921},{"_id":"public/images/037.kvm.md.03.png","hash":"39e3d27da863010cc4a62ac5a7ab3980d53bc1fb","modified":1702542475921}],"Category":[{"name":"Linux","_id":"clq4xtz8k0004ijnrex12eyz8"},{"name":"CentOS","_id":"clq4xtz9k000jijnr8kk3dc6a"},{"name":"NetWork","_id":"clq4xtzac0018ijnrax4t9pqd"},{"name":"Ubuntu","_id":"clq4xtzai001hijnr18yjhsoh"},{"name":"Database","_id":"clq4xtzb0001xijnr358632ai"},{"name":"Docker","_id":"clq4xtzbq002dijnreg00gfm3"},{"name":"Security","_id":"clq4xtzc2002kijnr9bpx77or"},{"name":"DevOps","_id":"clq4xtzco0035ijnrg81c4suo"},{"name":"OpenWrt","_id":"clq4xtzcz003qijnrhmticrvg"},{"name":"KVM","_id":"clq4xtzd4003xijnreom21t2t"},{"name":"Network","_id":"clq4xtzde0044ijnre1kg4fwl"},{"name":"Monitor","_id":"clq4xtzeg0051ijnr7azu2404"},{"name":"CI/CD","_id":"clq4xtzer005fijnr60d1gl7h"}],"Data":[],"Page":[{"title":"404","date":"2014-12-22T04:39:04.000Z","comments":0,"_content":"<script src=\"//qzonestyle.gtimg.cn/qzone/hybrid/app/404/search_children.js\"\n        charset=\"utf-8\" homePageUrl=\"/\" homePageName=\"Back to home\">\n</script>\n","source":"404/index.md","raw":"---\ntitle: '404'\ndate: 2014-12-22 12:39:04\ncomments: false\n---\n<script src=\"//qzonestyle.gtimg.cn/qzone/hybrid/app/404/search_children.js\"\n        charset=\"utf-8\" homePageUrl=\"/\" homePageName=\"Back to home\">\n</script>\n","updated":"2023-12-05T08:52:30.872Z","path":"404/index.html","layout":"page","_id":"clq4xtz7v0000ijnrhfgs7fvm","content":"<script src=\"//qzonestyle.gtimg.cn/qzone/hybrid/app/404/search_children.js\"\n        charset=\"utf-8\" homePageUrl=\"/\" homePageName=\"Back to home\">\n</script>\n","site":{"data":{}},"excerpt":"","more":"<script src=\"//qzonestyle.gtimg.cn/qzone/hybrid/app/404/search_children.js\"\n        charset=\"utf-8\" homePageUrl=\"/\" homePageName=\"Back to home\">\n</script>\n"},{"title":"CI/CD","date":"2023-10-08T01:04:15.000Z","_content":"","source":"CI-CD/index.md","raw":"---\ntitle: CI/CD\ndate: 2023-10-08 09:04:15\n---\n","updated":"2023-12-05T08:52:30.872Z","path":"CI-CD/index.html","comments":1,"layout":"page","_id":"clq4xtz8d0002ijnrc0o647pe","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Database","date":"2023-04-19T06:40:32.000Z","_content":"","source":"Database/index.md","raw":"---\ntitle: Database\ndate: 2023-04-19 14:40:32\n---\n","updated":"2023-12-05T08:52:30.872Z","path":"Database/index.html","comments":1,"layout":"page","_id":"clq4xtz8r0006ijnrb4w88qr1","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"DevOps","date":"2022-05-07T06:24:15.000Z","_content":"","source":"DevOps/index.md","raw":"---\ntitle: DevOps\ndate: 2022-05-07 14:24:15\n---\n","updated":"2023-12-05T08:52:30.872Z","path":"DevOps/index.html","comments":1,"layout":"page","_id":"clq4xtz8v0008ijnrcfbm3p5z","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Docker","date":"2022-05-07T06:25:11.000Z","_content":"","source":"Docker/index.md","raw":"---\ntitle: Docker\ndate: 2022-05-07 14:25:11\n---\n","updated":"2023-12-05T08:52:30.873Z","path":"Docker/index.html","comments":1,"layout":"page","_id":"clq4xtz8z000aijnr4732ap92","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"K8S","date":"2022-05-07T06:25:02.000Z","_content":"","source":"K8S/index.md","raw":"---\ntitle: K8S\ndate: 2022-05-07 14:25:02\n---\n","updated":"2023-12-05T08:52:30.873Z","path":"K8S/index.html","comments":1,"layout":"page","_id":"clq4xtz98000fijnr5iiehe80","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"KVM","date":"2023-04-19T01:59:47.000Z","_content":"","source":"KVM/index.md","raw":"---\ntitle: KVM\ndate: 2023-04-19 09:59:47\n---\n","updated":"2023-12-05T08:52:30.873Z","path":"KVM/index.html","comments":1,"layout":"page","_id":"clq4xtz9h000hijnr0g1v2b5b","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Linux","date":"2022-05-06T09:39:10.000Z","type":"Linux","_content":"","source":"Linux/index.md","raw":"---\ntitle: Linux\ndate: 2022-05-06 17:39:10\ntype: Linux\n---\n","updated":"2023-12-05T08:52:30.873Z","path":"Linux/index.html","comments":1,"layout":"page","_id":"clq4xtz9o000mijnr7s1gg8bn","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Monitor","date":"2023-09-26T23:12:23.000Z","_content":"","source":"Monitor/index.md","raw":"---\ntitle: Monitor\ndate: 2023-09-27 07:12:23\n---\n","updated":"2023-12-05T08:52:30.873Z","path":"Monitor/index.html","comments":1,"layout":"page","_id":"clq4xtz9r000pijnr9pqq1lud","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"NetWork","date":"2022-05-07T06:23:57.000Z","_content":"","source":"NetWork/index.md","raw":"---\ntitle: NetWork\ndate: 2022-05-07 14:23:57\n---\n","updated":"2023-12-05T08:52:30.873Z","path":"NetWork/index.html","comments":1,"layout":"page","_id":"clq4xtz9w000uijnr58lbfe10","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"OpenWrt","date":"2023-03-28T01:43:46.000Z","_content":"","source":"OpenWrt/index.md","raw":"---\ntitle: OpenWrt\ndate: 2023-03-28 09:43:46\n---\n","updated":"2023-12-05T08:52:30.873Z","path":"OpenWrt/index.html","comments":1,"layout":"page","_id":"clq4xtza1000xijnr81cwc1br","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"MySQL","date":"2022-05-07T06:25:52.000Z","_content":"","source":"MySQL/index.md","raw":"---\ntitle: MySQL\ndate: 2022-05-07 14:25:52\n---\n","updated":"2023-12-05T08:52:30.873Z","path":"MySQL/index.html","comments":1,"layout":"page","_id":"clq4xtza50011ijnrdhrm28kf","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Oracle","date":"2023-04-14T08:57:44.000Z","_content":"","source":"Oracle/index.md","raw":"---\ntitle: Oracle\ndate: 2023-04-14 16:57:44\n---\n","updated":"2023-12-05T08:52:30.873Z","path":"Oracle/index.html","comments":1,"layout":"page","_id":"clq4xtza90015ijnr29rdf7cm","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"RaspberryPi","date":"2022-05-07T06:24:25.000Z","_content":"","source":"RaspberryPi/index.md","raw":"---\ntitle: RaspberryPi\ndate: 2022-05-07 14:24:25\n---\n","updated":"2023-12-05T08:52:30.873Z","path":"RaspberryPi/index.html","comments":1,"layout":"page","_id":"clq4xtzad0019ijnrgztjap1g","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Security","date":"2022-05-07T06:24:06.000Z","_content":"","source":"Security/index.md","raw":"---\ntitle: Security\ndate: 2022-05-07 14:24:06\n---\n","updated":"2023-12-05T08:52:30.874Z","path":"Security/index.html","comments":1,"layout":"page","_id":"clq4xtzag001eijnr7nes0twk","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Ubuntu","date":"2022-05-07T06:24:52.000Z","_content":"","source":"Ubuntu/index.md","raw":"---\ntitle: Ubuntu\ndate: 2022-05-07 14:24:52\n---\n","updated":"2023-12-05T08:52:30.874Z","path":"Ubuntu/index.html","comments":1,"layout":"page","_id":"clq4xtzaj001iijnr12g59s9r","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Categories","date":"2022-05-06T09:42:03.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: Categories\ndate: 2022-05-06 17:42:03\ntype: categories\n---\n","updated":"2023-12-05T08:52:30.882Z","path":"categories/index.html","comments":1,"layout":"page","_id":"clq4xtzao001mijnr2j24813v","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"tags","date":"2022-05-07T02:37:11.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2022-05-07 10:37:11\ntype: tags\n---\n","updated":"2023-12-05T08:52:30.978Z","path":"tags/index.html","comments":1,"layout":"page","_id":"clq4xtzas001qijnrhl3k5gx3","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"frp内网穿透","date":"2022-02-25T09:30:08.000Z","_content":"\n\n## 环境介绍\n*server* : debian 9           腾讯云主机       124.xxx.xxx.xxx  (公网可以被访问的主机)\n*client* : centos minimal 7.9 (VMware)     192.168.128.7    (需要被内网穿透的主机)\n\n1) 根据自己的版本下载 frp (server和client都要下载)\n   `https://github.com/fatedier/frp/releases`\n\n2) 解压 \n   ` tar -zxvf frp_0.39.1_linux_amd64.tar.gz`\n\n[官方文档](https://gofrp.org/docs/examples/ssh/)\n<!-- more -->\n## server 端配置\n\n1) 创建 frps 配置文件目录\n  ` mkdir /etc/frp `\n\n2) 复制配置文件\n   ` cp frp/frps* /etc/frp `\n\n3) 复制启动文件\n   ` cp frp/frps /usr/bin/frps `\n\n4) 使用 system 管理服务\n   ` cp frp/systemd/frps* /usr/lib/systemd/system `\n\n5) 配置 SSH\n   ` vim frps.ini `\n\n6) 启动服务\n   ` systemctl start frps `\n\n## client 端配置\n\n1) 创建 frpc 配置文件目录\n   ` mkdir /etc/frp `\n\n2) 复制配置文件\n   ` cp frp/frpc* /etc/frp `\n\n3) 复制启动文件\n   ` cp frp/frpc /usr/bin/frps `\n\n4) 使用 systemd 管理服务\n   ` cp frp/systemd/frpc* /usr/lib/systemd/system `\n\n5) 配置 SSH\n   ``` vim frpc.ini ```\n\n6) 启动服务\n   ` systemctl start frpc `\n\n### 如果启动服务没有报错, 就可以实现内网穿透远程SSH\n\n\n测试一下:\n 测试机: windows   公网环境\n` ssh -oPort=6000 root@124.xxx.xxx.xxx `\n","source":"_posts/001.frp.md","raw":"---\ntitle: frp内网穿透\ndate: 2022-02-25 17:30:08\ncategories: Linux\ntags: frp 内网穿透\n---\n\n\n## 环境介绍\n*server* : debian 9           腾讯云主机       124.xxx.xxx.xxx  (公网可以被访问的主机)\n*client* : centos minimal 7.9 (VMware)     192.168.128.7    (需要被内网穿透的主机)\n\n1) 根据自己的版本下载 frp (server和client都要下载)\n   `https://github.com/fatedier/frp/releases`\n\n2) 解压 \n   ` tar -zxvf frp_0.39.1_linux_amd64.tar.gz`\n\n[官方文档](https://gofrp.org/docs/examples/ssh/)\n<!-- more -->\n## server 端配置\n\n1) 创建 frps 配置文件目录\n  ` mkdir /etc/frp `\n\n2) 复制配置文件\n   ` cp frp/frps* /etc/frp `\n\n3) 复制启动文件\n   ` cp frp/frps /usr/bin/frps `\n\n4) 使用 system 管理服务\n   ` cp frp/systemd/frps* /usr/lib/systemd/system `\n\n5) 配置 SSH\n   ` vim frps.ini `\n\n6) 启动服务\n   ` systemctl start frps `\n\n## client 端配置\n\n1) 创建 frpc 配置文件目录\n   ` mkdir /etc/frp `\n\n2) 复制配置文件\n   ` cp frp/frpc* /etc/frp `\n\n3) 复制启动文件\n   ` cp frp/frpc /usr/bin/frps `\n\n4) 使用 systemd 管理服务\n   ` cp frp/systemd/frpc* /usr/lib/systemd/system `\n\n5) 配置 SSH\n   ``` vim frpc.ini ```\n\n6) 启动服务\n   ` systemctl start frpc `\n\n### 如果启动服务没有报错, 就可以实现内网穿透远程SSH\n\n\n测试一下:\n 测试机: windows   公网环境\n` ssh -oPort=6000 root@124.xxx.xxx.xxx `\n","slug":"001.frp","published":1,"updated":"2023-12-05T08:52:30.874Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtz850001ijnrdkte5o5e","content":"<h2 id=\"环境介绍\"><a href=\"#环境介绍\" class=\"headerlink\" title=\"环境介绍\"></a>环境介绍</h2><p><em>server</em> : debian 9           腾讯云主机       124.xxx.xxx.xxx  (公网可以被访问的主机)<br><em>client</em> : centos minimal 7.9 (VMware)     192.168.128.7    (需要被内网穿透的主机)</p>\n<ol>\n<li><p>根据自己的版本下载 frp (server和client都要下载)<br><code>https://github.com/fatedier/frp/releases</code></p>\n</li>\n<li><p>解压<br><code> tar -zxvf frp_0.39.1_linux_amd64.tar.gz</code></p>\n</li>\n</ol>\n<p><a href=\"https://gofrp.org/docs/examples/ssh/\">官方文档</a></p>\n<span id=\"more\"></span>\n<h2 id=\"server-端配置\"><a href=\"#server-端配置\" class=\"headerlink\" title=\"server 端配置\"></a>server 端配置</h2><ol>\n<li><p>创建 frps 配置文件目录<br>  <code>mkdir /etc/frp</code></p>\n</li>\n<li><p>复制配置文件<br><code>cp frp/frps* /etc/frp</code></p>\n</li>\n<li><p>复制启动文件<br><code>cp frp/frps /usr/bin/frps</code></p>\n</li>\n<li><p>使用 system 管理服务<br><code>cp frp/systemd/frps* /usr/lib/systemd/system</code></p>\n</li>\n<li><p>配置 SSH<br><code>vim frps.ini</code></p>\n</li>\n<li><p>启动服务<br><code>systemctl start frps</code></p>\n</li>\n</ol>\n<h2 id=\"client-端配置\"><a href=\"#client-端配置\" class=\"headerlink\" title=\"client 端配置\"></a>client 端配置</h2><ol>\n<li><p>创建 frpc 配置文件目录<br><code>mkdir /etc/frp</code></p>\n</li>\n<li><p>复制配置文件<br><code>cp frp/frpc* /etc/frp</code></p>\n</li>\n<li><p>复制启动文件<br><code>cp frp/frpc /usr/bin/frps</code></p>\n</li>\n<li><p>使用 systemd 管理服务<br><code>cp frp/systemd/frpc* /usr/lib/systemd/system</code></p>\n</li>\n<li><p>配置 SSH<br><code>vim frpc.ini</code></p>\n</li>\n<li><p>启动服务<br><code>systemctl start frpc</code></p>\n</li>\n</ol>\n<h3 id=\"如果启动服务没有报错-就可以实现内网穿透远程SSH\"><a href=\"#如果启动服务没有报错-就可以实现内网穿透远程SSH\" class=\"headerlink\" title=\"如果启动服务没有报错, 就可以实现内网穿透远程SSH\"></a>如果启动服务没有报错, 就可以实现内网穿透远程SSH</h3><p>测试一下:<br> 测试机: windows   公网环境<br><code>ssh -oPort=6000 root@124.xxx.xxx.xxx</code></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"环境介绍\"><a href=\"#环境介绍\" class=\"headerlink\" title=\"环境介绍\"></a>环境介绍</h2><p><em>server</em> : debian 9           腾讯云主机       124.xxx.xxx.xxx  (公网可以被访问的主机)<br><em>client</em> : centos minimal 7.9 (VMware)     192.168.128.7    (需要被内网穿透的主机)</p>\n<ol>\n<li><p>根据自己的版本下载 frp (server和client都要下载)<br><code>https://github.com/fatedier/frp/releases</code></p>\n</li>\n<li><p>解压<br><code> tar -zxvf frp_0.39.1_linux_amd64.tar.gz</code></p>\n</li>\n</ol>\n<p><a href=\"https://gofrp.org/docs/examples/ssh/\">官方文档</a></p>","more":"<h2 id=\"server-端配置\"><a href=\"#server-端配置\" class=\"headerlink\" title=\"server 端配置\"></a>server 端配置</h2><ol>\n<li><p>创建 frps 配置文件目录<br>  <code>mkdir /etc/frp</code></p>\n</li>\n<li><p>复制配置文件<br><code>cp frp/frps* /etc/frp</code></p>\n</li>\n<li><p>复制启动文件<br><code>cp frp/frps /usr/bin/frps</code></p>\n</li>\n<li><p>使用 system 管理服务<br><code>cp frp/systemd/frps* /usr/lib/systemd/system</code></p>\n</li>\n<li><p>配置 SSH<br><code>vim frps.ini</code></p>\n</li>\n<li><p>启动服务<br><code>systemctl start frps</code></p>\n</li>\n</ol>\n<h2 id=\"client-端配置\"><a href=\"#client-端配置\" class=\"headerlink\" title=\"client 端配置\"></a>client 端配置</h2><ol>\n<li><p>创建 frpc 配置文件目录<br><code>mkdir /etc/frp</code></p>\n</li>\n<li><p>复制配置文件<br><code>cp frp/frpc* /etc/frp</code></p>\n</li>\n<li><p>复制启动文件<br><code>cp frp/frpc /usr/bin/frps</code></p>\n</li>\n<li><p>使用 systemd 管理服务<br><code>cp frp/systemd/frpc* /usr/lib/systemd/system</code></p>\n</li>\n<li><p>配置 SSH<br><code>vim frpc.ini</code></p>\n</li>\n<li><p>启动服务<br><code>systemctl start frpc</code></p>\n</li>\n</ol>\n<h3 id=\"如果启动服务没有报错-就可以实现内网穿透远程SSH\"><a href=\"#如果启动服务没有报错-就可以实现内网穿透远程SSH\" class=\"headerlink\" title=\"如果启动服务没有报错, 就可以实现内网穿透远程SSH\"></a>如果启动服务没有报错, 就可以实现内网穿透远程SSH</h3><p>测试一下:<br> 测试机: windows   公网环境<br><code>ssh -oPort=6000 root@124.xxx.xxx.xxx</code></p>"},{"title":"Linux进程状态","date":"2022-03-23T09:39:10.000Z","_content":"\n>内容转自:[https://cloud.tencent.com/developer/article/1568077](https://links.jianshu.com/go?to=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Farticle%2F1568077)\n\n# 一、进程状态\n\n*   D：uninterruptible sleep (usually IO)\n*   R：running or runnable (on run queue)\n*   S：interruptible sleep (waiting for an event to complete)\n*   T：stopped by job control signal\n*   t：stopped by debugger during the tracing\n*   W：paging (not valid since the 2.6.xx kernel)\n*   X：dead (should never be seen)\n*   Z：defunct (\"zombie\") process, terminated but not - reaped by its parent\n\n<!-- more -->\n\n## 1、R (TASK_RUNNING)，可执行状态\n\n只有在该状态的进程才可能在CPU上运行。而同一时刻可能有多个进程处于可执行状态，这些进程的task_struct结构（进程控制块）被放入对应CPU的可执行队列中（一个进程最多只能出现在一个CPU的可执行队列中）。进而，进程调度器就从各个CPU的可执行队列中分别选择一个进程在该CPU上运行。\n\n> 很多操作系统教科书将正在CPU上执行的进程定义为RUNNING状态、而将可执行但是尚未被调度执行的进程定义为READY状态，这两种状态在linux下统一为 TASK_RUNNING状态。\n\n## 2、S (TASK_INTERRUPTIBLE)，可中断的睡眠状态\n\n处于这个状态的进程因为等待某某事件的发生（比如等待socket连接、等待信号量），而被挂起。这些进程的task_struct结构（进程控制块）被放入对应事件的等待队列中。当这些事件发生时（由外部中断触发、或由其他进程触发），对应的等待队列中的一个或多个进程将被唤醒。\n\n> 通过ps命令会看到，一般情况下，进程列表中的绝大多数进程都处于TASK_INTERRUPTIBLE状态（除非机器的负载很高）。毕竟CPU就这么几个，进程动辄几十上百个，如果不是绝大多数进程都在睡眠，CPU又怎么响应得过来。\n\n## 3、D (TASK_UNINTERRUPTIBLE)，不可中断的睡眠状态\n\n与TASK_INTERRUPTIBLE状态类似，进程处于睡眠状态，但是此刻进程是不可中断的。不可中断，指的并不是CPU不响应外部硬件的中断，而是指进程不响应异步信号。\n\n绝大多数情况下，进程处在睡眠状态时，总是应该能够响应异步信号的。否则你将惊奇的发现，kill -9竟然杀不死一个正在睡眠的进程了！于是我们也很好理解，为什么ps命令看到的进程几乎不会出现TASK_UNINTERRUPTIBLE状态，而总是TASK_INTERRUPTIBLE状态。\n\n> 而TASK_UNINTERRUPTIBLE状态存在的意义就在于，内核的某些处理流程是不能被打断的。如果响应异步信号，程序的执行流程中就会被插入一段用于处理异步信号的流程（这个插入的流程可能只存在于内核态，也可能延伸到用户态），于是原有的流程就被中断了。 例如，在进程对某些硬件进行操作时（比如进程调用read系统调用对某个设备文件进行读操作，而read系统调用最终执行到对应设备驱动的代码，并与对应的物理设备进行交互），可能需要使用TASK_UNINTERRUPTIBLE状态对进程进行保护，以避免进程与设备交互的过程被打断，造成设备陷入不可控的状态。这种情况下的TASK_UNINTERRUPTIBLE状态总是非常短暂的，通过ps命令基本上不可能捕捉到。\n\n## 4、T/t (TASK_STOPPED or TASK_TRACED)，暂停状态或跟踪状态\n\n**T (TASK_STOPPED)状态**：向进程发送一个SIGSTOP信号，它就会因响应该信号而进入TASK_STOPPED状态（除非该进程本身处于TASK_UNINTERRUPTIBLE状态而不响应信号）。 SIGSTOP与SIGKILL信号一样，是非常强制的。不允许用户进程通过signal系列的系统调用重新设置对应的信号处理函数。 向进程发送一个SIGCONT信号（kill -18），可以让其从TASK_STOPPED状态恢复到TASK_RUNNING状态；或者kill -9直接尝试杀死。\n\n**t (TASK_STOPPED)状态**：当进程正在被跟踪时，它处于TASK_TRACED这个特殊的状态。“正在被跟踪”指的是进程暂停下来，等待跟踪它的进程对它进行操作。比如在gdb（UNIX及UNIX-like下的调试工具）调试中对被跟踪的进程下一个断点，进程在断点处停下来的时候就处于TASK_TRACED状态。而在其他时候，被跟踪的进程还是处于前面提到的那些状态。\n\n> 对于进程本身来说，TASK_STOPPED和TASK_TRACED状态很类似，都是表示进程暂停下来。 而TASK_TRACED状态相当于在TASK_STOPPED之上多了一层保护，处于TASK_TRACED状态的进程不能响应SIGCONT信号而被唤醒。只能等到调试进程通过ptrace系统调用执行PTRACE_CONT、PTRACE_DETACH等操作（通过ptrace系统调用的参数指定操作），或调试进程退出，被调试的进程才能恢复TASK_RUNNING状态。\n\n## 5、Z (TASK_DEAD - EXIT_ZOMBIE)，退出状态，进程成为僵尸进程\n\n进程在退出的过程中，处于TASK_DEAD状态。在这个退出过程中，进程占有的所有资源将被回收，除了task_struct结构（以及少数资源）以外。于是进程就只剩下task_struct这么个空壳，故称为僵尸。\n\n之所以保留task_struct，是因为task_struct里面保存了进程的退出码、以及一些统计信息。而其父进程很可能会关心这些信息。父进程可以通过wait系列的系统调用（如wait4、waitid）来等待某个或某些子进程的退出，并获取它的退出信息（保存在task_struct里）。然后wait系列的系统调用会顺便将子进程的尸体（task_struct）也释放掉。\n\n> 当父/子进程在不同时间点退出时，就可能会出现Z的细分状态：\n\n1.  僵尸状态 一个进程使用 fork 创建子进程，如果子进程退出后父进程没有调用 wait 或 waitpid 获取子进程的状态信息，并将子进程释放掉。那么子进程的进程描述符仍然保存在系统中，仍然占用进程表，此时进程就处于僵尸状态。 子进程在退出的过程中，内核会给其父进程发送一个信号，通知父进程来“收尸”。出现僵尸状态可能有两种情况： 第一种情况，父进程收到通知还没来得及完成收尸，此时正常； 第二种情况，父进程收尸出现异常，此时，只要父进程不退出，子进程的僵尸状态就一直存在，可以通过**杀死父进程**或者**重启**来解决。\n2.  孤儿状态 父进程退出，相应的一个或多个子进程还在运行，那么那些子进程将处于孤儿状态，成为孤儿进程。这些进程会被托管给别的进程，托管给谁呢？可能是退出进程所在进程组的下一个进程（如果存在的话），或者是1号进程。所以每个进程、每时每刻都有父进程存在。除非它是1号进程。 1号进程，pid为1的进程，又称init进程。 linux系统启动后，第一个被创建的用户态进程就是init进程。它有两项使命： 1、执行系统初始化脚本，创建一系列的进程（它们都是init进程的子孙）； 2、在一个死循环中等待其子进程的退出事件，并调用waitid系统调用来完成“收尸”工作； init进程不会被暂停、也不会被杀死（这是由内核来保证的）。它在等待子进程退出的过程中处于TASK_INTERRUPTIBLE状态，“收尸”过程中则处于TASK_RUNNING状态。\n\n## 6、X (TASK_DEAD - EXIT_DEAD)，退出状态，进程即将被销毁\n\n进程在退出过程中也可能不会保留它的task_struct。比如这个进程是多线程程序中被detach过的进程。或者父进程通过设置SIGCHLD信号的handler为SIG_IGN，显式的忽略了SIGCHLD信号。（这是posix的规定，尽管子进程的退出信号可以被设置为SIGCHLD以外的其他信号。） 此时，进程将被置于EXIT_DEAD退出状态，这意味着接下来的代码立即就会将该进程彻底释放。所以EXIT_DEAD状态是非常短暂的，几乎不可能通过ps命令捕捉到。\n\n## 7、查看进程状态\n\n**进程小状态**：\n\n*   <：high-priority (not nice to other users)\n*   N：low-priority (nice to other users)\n*   L：has pages locked into memory (for real-time and custom IO)\n*   s：is a session leader\n*   l：is multi-threaded (using CLONE_THREAD, like NPTL pthreads do)\n*   +：is in the foreground process group\n\n**常用的命令**：ps命令，见[Linux系统之常用命令](https://www.cnblogs.com/littlecharacter/p/12154587.html)\n\n*   `ps -eo stat,pid,user,%cpu,%mem,time,cmd`\n*   `ps -eo stat,pid,user,%cpu,%mem,time,cmd | grep -e '^[R]'`\n\n# 二、进程状态转换\n\n![进程转换](/images/002.progress.md.01.png)\n\n\n## 1、进程初始状态\n\n进程是通过fork系列的系统调用（fork、clone、vfork）来创建的，内核（或内核模块）也可以通过kernel_thread函数创建内核进程。这些创建子进程的函数本质上都完成了相同的功能——将调用进程复制一份，得到子进程。（可以通过选项参数来决定各种资源是共享、还是私有。） 那么既然调用进程处于TASK_RUNNING状态（否则，它若不是正在运行，又怎么进行调用？），则子进程默认也处于TASK_RUNNING状态。 另外，在系统调用调用clone和内核函数kernel_thread也接受CLONE_STOPPED选项，从而将子进程的初始状态置为 TASK_STOPPED。\n\n## 2、进程状态变迁\n\n进程自创建以后，状态可能发生一系列的变化，直到进程退出。而尽管进程状态有好几种，但是进程状态的变迁却只有两个方向——从TASK_RUNNING状态变为非TASK_RUNNING状态、或者从非TASK_RUNNING状态变为TASK_RUNNING状态。 也就是说，如果给一个TASK_INTERRUPTIBLE状态的进程发送SIGKILL信号，这个进程将先被唤醒（进入TASK_RUNNING状态），然后再响应SIGKILL信号而退出（变为TASK_DEAD状态）。并不会从TASK_INTERRUPTIBLE状态直接退出。\n\n> 进程从非TASK_RUNNING状态变为TASK_RUNNING状态，是由别的进程（也可能是中断处理程序）执行唤醒操作来实现的。执行唤醒的进程设置被唤醒进程的状态为TASK_RUNNING，然后将其task_struct结构加入到某个CPU的可执行队列中。于是被唤醒的进程将有机会被调度执行。 而进程从TASK_RUNNING状态变为非TASK_RUNNING状态，则有两种途径： 1、响应信号而进入TASK_STOPED状态、或TASK_DEAD状态； 2、执行系统调用主动进入TASK_INTERRUPTIBLE状态（如nanosleep系统调用）、或TASK_DEAD状态（如exit系统调用）；或由于执行系统调用需要的资源得不到满足，而进入TASK_INTERRUPTIBLE状态或TASK_UNINTERRUPTIBLE状态（如select系统调用）。 显然，这两种情况都只能发生在进程正在CPU上执行的情况下。\n\n# 三、进程调度\n![进程调度](/images/002.progress.md.02.png)\n\n\n转自:https://cloud.tencent.com/developer/article/1568077\n\n","source":"_posts/002.progress.md","raw":"---\ntitle: Linux进程状态\ndate: 2022-03-23 17:39:10\ncategories: Linux\ntags: Linux 进程\n---\n\n>内容转自:[https://cloud.tencent.com/developer/article/1568077](https://links.jianshu.com/go?to=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Farticle%2F1568077)\n\n# 一、进程状态\n\n*   D：uninterruptible sleep (usually IO)\n*   R：running or runnable (on run queue)\n*   S：interruptible sleep (waiting for an event to complete)\n*   T：stopped by job control signal\n*   t：stopped by debugger during the tracing\n*   W：paging (not valid since the 2.6.xx kernel)\n*   X：dead (should never be seen)\n*   Z：defunct (\"zombie\") process, terminated but not - reaped by its parent\n\n<!-- more -->\n\n## 1、R (TASK_RUNNING)，可执行状态\n\n只有在该状态的进程才可能在CPU上运行。而同一时刻可能有多个进程处于可执行状态，这些进程的task_struct结构（进程控制块）被放入对应CPU的可执行队列中（一个进程最多只能出现在一个CPU的可执行队列中）。进而，进程调度器就从各个CPU的可执行队列中分别选择一个进程在该CPU上运行。\n\n> 很多操作系统教科书将正在CPU上执行的进程定义为RUNNING状态、而将可执行但是尚未被调度执行的进程定义为READY状态，这两种状态在linux下统一为 TASK_RUNNING状态。\n\n## 2、S (TASK_INTERRUPTIBLE)，可中断的睡眠状态\n\n处于这个状态的进程因为等待某某事件的发生（比如等待socket连接、等待信号量），而被挂起。这些进程的task_struct结构（进程控制块）被放入对应事件的等待队列中。当这些事件发生时（由外部中断触发、或由其他进程触发），对应的等待队列中的一个或多个进程将被唤醒。\n\n> 通过ps命令会看到，一般情况下，进程列表中的绝大多数进程都处于TASK_INTERRUPTIBLE状态（除非机器的负载很高）。毕竟CPU就这么几个，进程动辄几十上百个，如果不是绝大多数进程都在睡眠，CPU又怎么响应得过来。\n\n## 3、D (TASK_UNINTERRUPTIBLE)，不可中断的睡眠状态\n\n与TASK_INTERRUPTIBLE状态类似，进程处于睡眠状态，但是此刻进程是不可中断的。不可中断，指的并不是CPU不响应外部硬件的中断，而是指进程不响应异步信号。\n\n绝大多数情况下，进程处在睡眠状态时，总是应该能够响应异步信号的。否则你将惊奇的发现，kill -9竟然杀不死一个正在睡眠的进程了！于是我们也很好理解，为什么ps命令看到的进程几乎不会出现TASK_UNINTERRUPTIBLE状态，而总是TASK_INTERRUPTIBLE状态。\n\n> 而TASK_UNINTERRUPTIBLE状态存在的意义就在于，内核的某些处理流程是不能被打断的。如果响应异步信号，程序的执行流程中就会被插入一段用于处理异步信号的流程（这个插入的流程可能只存在于内核态，也可能延伸到用户态），于是原有的流程就被中断了。 例如，在进程对某些硬件进行操作时（比如进程调用read系统调用对某个设备文件进行读操作，而read系统调用最终执行到对应设备驱动的代码，并与对应的物理设备进行交互），可能需要使用TASK_UNINTERRUPTIBLE状态对进程进行保护，以避免进程与设备交互的过程被打断，造成设备陷入不可控的状态。这种情况下的TASK_UNINTERRUPTIBLE状态总是非常短暂的，通过ps命令基本上不可能捕捉到。\n\n## 4、T/t (TASK_STOPPED or TASK_TRACED)，暂停状态或跟踪状态\n\n**T (TASK_STOPPED)状态**：向进程发送一个SIGSTOP信号，它就会因响应该信号而进入TASK_STOPPED状态（除非该进程本身处于TASK_UNINTERRUPTIBLE状态而不响应信号）。 SIGSTOP与SIGKILL信号一样，是非常强制的。不允许用户进程通过signal系列的系统调用重新设置对应的信号处理函数。 向进程发送一个SIGCONT信号（kill -18），可以让其从TASK_STOPPED状态恢复到TASK_RUNNING状态；或者kill -9直接尝试杀死。\n\n**t (TASK_STOPPED)状态**：当进程正在被跟踪时，它处于TASK_TRACED这个特殊的状态。“正在被跟踪”指的是进程暂停下来，等待跟踪它的进程对它进行操作。比如在gdb（UNIX及UNIX-like下的调试工具）调试中对被跟踪的进程下一个断点，进程在断点处停下来的时候就处于TASK_TRACED状态。而在其他时候，被跟踪的进程还是处于前面提到的那些状态。\n\n> 对于进程本身来说，TASK_STOPPED和TASK_TRACED状态很类似，都是表示进程暂停下来。 而TASK_TRACED状态相当于在TASK_STOPPED之上多了一层保护，处于TASK_TRACED状态的进程不能响应SIGCONT信号而被唤醒。只能等到调试进程通过ptrace系统调用执行PTRACE_CONT、PTRACE_DETACH等操作（通过ptrace系统调用的参数指定操作），或调试进程退出，被调试的进程才能恢复TASK_RUNNING状态。\n\n## 5、Z (TASK_DEAD - EXIT_ZOMBIE)，退出状态，进程成为僵尸进程\n\n进程在退出的过程中，处于TASK_DEAD状态。在这个退出过程中，进程占有的所有资源将被回收，除了task_struct结构（以及少数资源）以外。于是进程就只剩下task_struct这么个空壳，故称为僵尸。\n\n之所以保留task_struct，是因为task_struct里面保存了进程的退出码、以及一些统计信息。而其父进程很可能会关心这些信息。父进程可以通过wait系列的系统调用（如wait4、waitid）来等待某个或某些子进程的退出，并获取它的退出信息（保存在task_struct里）。然后wait系列的系统调用会顺便将子进程的尸体（task_struct）也释放掉。\n\n> 当父/子进程在不同时间点退出时，就可能会出现Z的细分状态：\n\n1.  僵尸状态 一个进程使用 fork 创建子进程，如果子进程退出后父进程没有调用 wait 或 waitpid 获取子进程的状态信息，并将子进程释放掉。那么子进程的进程描述符仍然保存在系统中，仍然占用进程表，此时进程就处于僵尸状态。 子进程在退出的过程中，内核会给其父进程发送一个信号，通知父进程来“收尸”。出现僵尸状态可能有两种情况： 第一种情况，父进程收到通知还没来得及完成收尸，此时正常； 第二种情况，父进程收尸出现异常，此时，只要父进程不退出，子进程的僵尸状态就一直存在，可以通过**杀死父进程**或者**重启**来解决。\n2.  孤儿状态 父进程退出，相应的一个或多个子进程还在运行，那么那些子进程将处于孤儿状态，成为孤儿进程。这些进程会被托管给别的进程，托管给谁呢？可能是退出进程所在进程组的下一个进程（如果存在的话），或者是1号进程。所以每个进程、每时每刻都有父进程存在。除非它是1号进程。 1号进程，pid为1的进程，又称init进程。 linux系统启动后，第一个被创建的用户态进程就是init进程。它有两项使命： 1、执行系统初始化脚本，创建一系列的进程（它们都是init进程的子孙）； 2、在一个死循环中等待其子进程的退出事件，并调用waitid系统调用来完成“收尸”工作； init进程不会被暂停、也不会被杀死（这是由内核来保证的）。它在等待子进程退出的过程中处于TASK_INTERRUPTIBLE状态，“收尸”过程中则处于TASK_RUNNING状态。\n\n## 6、X (TASK_DEAD - EXIT_DEAD)，退出状态，进程即将被销毁\n\n进程在退出过程中也可能不会保留它的task_struct。比如这个进程是多线程程序中被detach过的进程。或者父进程通过设置SIGCHLD信号的handler为SIG_IGN，显式的忽略了SIGCHLD信号。（这是posix的规定，尽管子进程的退出信号可以被设置为SIGCHLD以外的其他信号。） 此时，进程将被置于EXIT_DEAD退出状态，这意味着接下来的代码立即就会将该进程彻底释放。所以EXIT_DEAD状态是非常短暂的，几乎不可能通过ps命令捕捉到。\n\n## 7、查看进程状态\n\n**进程小状态**：\n\n*   <：high-priority (not nice to other users)\n*   N：low-priority (nice to other users)\n*   L：has pages locked into memory (for real-time and custom IO)\n*   s：is a session leader\n*   l：is multi-threaded (using CLONE_THREAD, like NPTL pthreads do)\n*   +：is in the foreground process group\n\n**常用的命令**：ps命令，见[Linux系统之常用命令](https://www.cnblogs.com/littlecharacter/p/12154587.html)\n\n*   `ps -eo stat,pid,user,%cpu,%mem,time,cmd`\n*   `ps -eo stat,pid,user,%cpu,%mem,time,cmd | grep -e '^[R]'`\n\n# 二、进程状态转换\n\n![进程转换](/images/002.progress.md.01.png)\n\n\n## 1、进程初始状态\n\n进程是通过fork系列的系统调用（fork、clone、vfork）来创建的，内核（或内核模块）也可以通过kernel_thread函数创建内核进程。这些创建子进程的函数本质上都完成了相同的功能——将调用进程复制一份，得到子进程。（可以通过选项参数来决定各种资源是共享、还是私有。） 那么既然调用进程处于TASK_RUNNING状态（否则，它若不是正在运行，又怎么进行调用？），则子进程默认也处于TASK_RUNNING状态。 另外，在系统调用调用clone和内核函数kernel_thread也接受CLONE_STOPPED选项，从而将子进程的初始状态置为 TASK_STOPPED。\n\n## 2、进程状态变迁\n\n进程自创建以后，状态可能发生一系列的变化，直到进程退出。而尽管进程状态有好几种，但是进程状态的变迁却只有两个方向——从TASK_RUNNING状态变为非TASK_RUNNING状态、或者从非TASK_RUNNING状态变为TASK_RUNNING状态。 也就是说，如果给一个TASK_INTERRUPTIBLE状态的进程发送SIGKILL信号，这个进程将先被唤醒（进入TASK_RUNNING状态），然后再响应SIGKILL信号而退出（变为TASK_DEAD状态）。并不会从TASK_INTERRUPTIBLE状态直接退出。\n\n> 进程从非TASK_RUNNING状态变为TASK_RUNNING状态，是由别的进程（也可能是中断处理程序）执行唤醒操作来实现的。执行唤醒的进程设置被唤醒进程的状态为TASK_RUNNING，然后将其task_struct结构加入到某个CPU的可执行队列中。于是被唤醒的进程将有机会被调度执行。 而进程从TASK_RUNNING状态变为非TASK_RUNNING状态，则有两种途径： 1、响应信号而进入TASK_STOPED状态、或TASK_DEAD状态； 2、执行系统调用主动进入TASK_INTERRUPTIBLE状态（如nanosleep系统调用）、或TASK_DEAD状态（如exit系统调用）；或由于执行系统调用需要的资源得不到满足，而进入TASK_INTERRUPTIBLE状态或TASK_UNINTERRUPTIBLE状态（如select系统调用）。 显然，这两种情况都只能发生在进程正在CPU上执行的情况下。\n\n# 三、进程调度\n![进程调度](/images/002.progress.md.02.png)\n\n\n转自:https://cloud.tencent.com/developer/article/1568077\n\n","slug":"002.progress","published":1,"updated":"2023-12-05T08:52:30.874Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtz8g0003ijnrfhwehspi","content":"<blockquote>\n<p>内容转自:<a href=\"https://links.jianshu.com/go?to=https://cloud.tencent.com/developer/article/1568077\">https://cloud.tencent.com/developer/article/1568077</a></p>\n</blockquote>\n<h1 id=\"一、进程状态\"><a href=\"#一、进程状态\" class=\"headerlink\" title=\"一、进程状态\"></a>一、进程状态</h1><ul>\n<li>D：uninterruptible sleep (usually IO)</li>\n<li>R：running or runnable (on run queue)</li>\n<li>S：interruptible sleep (waiting for an event to complete)</li>\n<li>T：stopped by job control signal</li>\n<li>t：stopped by debugger during the tracing</li>\n<li>W：paging (not valid since the 2.6.xx kernel)</li>\n<li>X：dead (should never be seen)</li>\n<li>Z：defunct (“zombie”) process, terminated but not - reaped by its parent</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"1、R-TASK-RUNNING-，可执行状态\"><a href=\"#1、R-TASK-RUNNING-，可执行状态\" class=\"headerlink\" title=\"1、R (TASK_RUNNING)，可执行状态\"></a>1、R (TASK_RUNNING)，可执行状态</h2><p>只有在该状态的进程才可能在CPU上运行。而同一时刻可能有多个进程处于可执行状态，这些进程的task_struct结构（进程控制块）被放入对应CPU的可执行队列中（一个进程最多只能出现在一个CPU的可执行队列中）。进而，进程调度器就从各个CPU的可执行队列中分别选择一个进程在该CPU上运行。</p>\n<blockquote>\n<p>很多操作系统教科书将正在CPU上执行的进程定义为RUNNING状态、而将可执行但是尚未被调度执行的进程定义为READY状态，这两种状态在linux下统一为 TASK_RUNNING状态。</p>\n</blockquote>\n<h2 id=\"2、S-TASK-INTERRUPTIBLE-，可中断的睡眠状态\"><a href=\"#2、S-TASK-INTERRUPTIBLE-，可中断的睡眠状态\" class=\"headerlink\" title=\"2、S (TASK_INTERRUPTIBLE)，可中断的睡眠状态\"></a>2、S (TASK_INTERRUPTIBLE)，可中断的睡眠状态</h2><p>处于这个状态的进程因为等待某某事件的发生（比如等待socket连接、等待信号量），而被挂起。这些进程的task_struct结构（进程控制块）被放入对应事件的等待队列中。当这些事件发生时（由外部中断触发、或由其他进程触发），对应的等待队列中的一个或多个进程将被唤醒。</p>\n<blockquote>\n<p>通过ps命令会看到，一般情况下，进程列表中的绝大多数进程都处于TASK_INTERRUPTIBLE状态（除非机器的负载很高）。毕竟CPU就这么几个，进程动辄几十上百个，如果不是绝大多数进程都在睡眠，CPU又怎么响应得过来。</p>\n</blockquote>\n<h2 id=\"3、D-TASK-UNINTERRUPTIBLE-，不可中断的睡眠状态\"><a href=\"#3、D-TASK-UNINTERRUPTIBLE-，不可中断的睡眠状态\" class=\"headerlink\" title=\"3、D (TASK_UNINTERRUPTIBLE)，不可中断的睡眠状态\"></a>3、D (TASK_UNINTERRUPTIBLE)，不可中断的睡眠状态</h2><p>与TASK_INTERRUPTIBLE状态类似，进程处于睡眠状态，但是此刻进程是不可中断的。不可中断，指的并不是CPU不响应外部硬件的中断，而是指进程不响应异步信号。</p>\n<p>绝大多数情况下，进程处在睡眠状态时，总是应该能够响应异步信号的。否则你将惊奇的发现，kill -9竟然杀不死一个正在睡眠的进程了！于是我们也很好理解，为什么ps命令看到的进程几乎不会出现TASK_UNINTERRUPTIBLE状态，而总是TASK_INTERRUPTIBLE状态。</p>\n<blockquote>\n<p>而TASK_UNINTERRUPTIBLE状态存在的意义就在于，内核的某些处理流程是不能被打断的。如果响应异步信号，程序的执行流程中就会被插入一段用于处理异步信号的流程（这个插入的流程可能只存在于内核态，也可能延伸到用户态），于是原有的流程就被中断了。 例如，在进程对某些硬件进行操作时（比如进程调用read系统调用对某个设备文件进行读操作，而read系统调用最终执行到对应设备驱动的代码，并与对应的物理设备进行交互），可能需要使用TASK_UNINTERRUPTIBLE状态对进程进行保护，以避免进程与设备交互的过程被打断，造成设备陷入不可控的状态。这种情况下的TASK_UNINTERRUPTIBLE状态总是非常短暂的，通过ps命令基本上不可能捕捉到。</p>\n</blockquote>\n<h2 id=\"4、T-t-TASK-STOPPED-or-TASK-TRACED-，暂停状态或跟踪状态\"><a href=\"#4、T-t-TASK-STOPPED-or-TASK-TRACED-，暂停状态或跟踪状态\" class=\"headerlink\" title=\"4、T&#x2F;t (TASK_STOPPED or TASK_TRACED)，暂停状态或跟踪状态\"></a>4、T&#x2F;t (TASK_STOPPED or TASK_TRACED)，暂停状态或跟踪状态</h2><p><strong>T (TASK_STOPPED)状态</strong>：向进程发送一个SIGSTOP信号，它就会因响应该信号而进入TASK_STOPPED状态（除非该进程本身处于TASK_UNINTERRUPTIBLE状态而不响应信号）。 SIGSTOP与SIGKILL信号一样，是非常强制的。不允许用户进程通过signal系列的系统调用重新设置对应的信号处理函数。 向进程发送一个SIGCONT信号（kill -18），可以让其从TASK_STOPPED状态恢复到TASK_RUNNING状态；或者kill -9直接尝试杀死。</p>\n<p><strong>t (TASK_STOPPED)状态</strong>：当进程正在被跟踪时，它处于TASK_TRACED这个特殊的状态。“正在被跟踪”指的是进程暂停下来，等待跟踪它的进程对它进行操作。比如在gdb（UNIX及UNIX-like下的调试工具）调试中对被跟踪的进程下一个断点，进程在断点处停下来的时候就处于TASK_TRACED状态。而在其他时候，被跟踪的进程还是处于前面提到的那些状态。</p>\n<blockquote>\n<p>对于进程本身来说，TASK_STOPPED和TASK_TRACED状态很类似，都是表示进程暂停下来。 而TASK_TRACED状态相当于在TASK_STOPPED之上多了一层保护，处于TASK_TRACED状态的进程不能响应SIGCONT信号而被唤醒。只能等到调试进程通过ptrace系统调用执行PTRACE_CONT、PTRACE_DETACH等操作（通过ptrace系统调用的参数指定操作），或调试进程退出，被调试的进程才能恢复TASK_RUNNING状态。</p>\n</blockquote>\n<h2 id=\"5、Z-TASK-DEAD-EXIT-ZOMBIE-，退出状态，进程成为僵尸进程\"><a href=\"#5、Z-TASK-DEAD-EXIT-ZOMBIE-，退出状态，进程成为僵尸进程\" class=\"headerlink\" title=\"5、Z (TASK_DEAD - EXIT_ZOMBIE)，退出状态，进程成为僵尸进程\"></a>5、Z (TASK_DEAD - EXIT_ZOMBIE)，退出状态，进程成为僵尸进程</h2><p>进程在退出的过程中，处于TASK_DEAD状态。在这个退出过程中，进程占有的所有资源将被回收，除了task_struct结构（以及少数资源）以外。于是进程就只剩下task_struct这么个空壳，故称为僵尸。</p>\n<p>之所以保留task_struct，是因为task_struct里面保存了进程的退出码、以及一些统计信息。而其父进程很可能会关心这些信息。父进程可以通过wait系列的系统调用（如wait4、waitid）来等待某个或某些子进程的退出，并获取它的退出信息（保存在task_struct里）。然后wait系列的系统调用会顺便将子进程的尸体（task_struct）也释放掉。</p>\n<blockquote>\n<p>当父&#x2F;子进程在不同时间点退出时，就可能会出现Z的细分状态：</p>\n</blockquote>\n<ol>\n<li>僵尸状态 一个进程使用 fork 创建子进程，如果子进程退出后父进程没有调用 wait 或 waitpid 获取子进程的状态信息，并将子进程释放掉。那么子进程的进程描述符仍然保存在系统中，仍然占用进程表，此时进程就处于僵尸状态。 子进程在退出的过程中，内核会给其父进程发送一个信号，通知父进程来“收尸”。出现僵尸状态可能有两种情况： 第一种情况，父进程收到通知还没来得及完成收尸，此时正常； 第二种情况，父进程收尸出现异常，此时，只要父进程不退出，子进程的僵尸状态就一直存在，可以通过<strong>杀死父进程</strong>或者<strong>重启</strong>来解决。</li>\n<li>孤儿状态 父进程退出，相应的一个或多个子进程还在运行，那么那些子进程将处于孤儿状态，成为孤儿进程。这些进程会被托管给别的进程，托管给谁呢？可能是退出进程所在进程组的下一个进程（如果存在的话），或者是1号进程。所以每个进程、每时每刻都有父进程存在。除非它是1号进程。 1号进程，pid为1的进程，又称init进程。 linux系统启动后，第一个被创建的用户态进程就是init进程。它有两项使命： 1、执行系统初始化脚本，创建一系列的进程（它们都是init进程的子孙）； 2、在一个死循环中等待其子进程的退出事件，并调用waitid系统调用来完成“收尸”工作； init进程不会被暂停、也不会被杀死（这是由内核来保证的）。它在等待子进程退出的过程中处于TASK_INTERRUPTIBLE状态，“收尸”过程中则处于TASK_RUNNING状态。</li>\n</ol>\n<h2 id=\"6、X-TASK-DEAD-EXIT-DEAD-，退出状态，进程即将被销毁\"><a href=\"#6、X-TASK-DEAD-EXIT-DEAD-，退出状态，进程即将被销毁\" class=\"headerlink\" title=\"6、X (TASK_DEAD - EXIT_DEAD)，退出状态，进程即将被销毁\"></a>6、X (TASK_DEAD - EXIT_DEAD)，退出状态，进程即将被销毁</h2><p>进程在退出过程中也可能不会保留它的task_struct。比如这个进程是多线程程序中被detach过的进程。或者父进程通过设置SIGCHLD信号的handler为SIG_IGN，显式的忽略了SIGCHLD信号。（这是posix的规定，尽管子进程的退出信号可以被设置为SIGCHLD以外的其他信号。） 此时，进程将被置于EXIT_DEAD退出状态，这意味着接下来的代码立即就会将该进程彻底释放。所以EXIT_DEAD状态是非常短暂的，几乎不可能通过ps命令捕捉到。</p>\n<h2 id=\"7、查看进程状态\"><a href=\"#7、查看进程状态\" class=\"headerlink\" title=\"7、查看进程状态\"></a>7、查看进程状态</h2><p><strong>进程小状态</strong>：</p>\n<ul>\n<li>&lt;：high-priority (not nice to other users)</li>\n<li>N：low-priority (nice to other users)</li>\n<li>L：has pages locked into memory (for real-time and custom IO)</li>\n<li>s：is a session leader</li>\n<li>l：is multi-threaded (using CLONE_THREAD, like NPTL pthreads do)</li>\n<li>+：is in the foreground process group</li>\n</ul>\n<p><strong>常用的命令</strong>：ps命令，见<a href=\"https://www.cnblogs.com/littlecharacter/p/12154587.html\">Linux系统之常用命令</a></p>\n<ul>\n<li><code>ps -eo stat,pid,user,%cpu,%mem,time,cmd</code></li>\n<li><code>ps -eo stat,pid,user,%cpu,%mem,time,cmd | grep -e &#39;^[R]&#39;</code></li>\n</ul>\n<h1 id=\"二、进程状态转换\"><a href=\"#二、进程状态转换\" class=\"headerlink\" title=\"二、进程状态转换\"></a>二、进程状态转换</h1><p><img src=\"/images/002.progress.md.01.png\" alt=\"进程转换\"></p>\n<h2 id=\"1、进程初始状态\"><a href=\"#1、进程初始状态\" class=\"headerlink\" title=\"1、进程初始状态\"></a>1、进程初始状态</h2><p>进程是通过fork系列的系统调用（fork、clone、vfork）来创建的，内核（或内核模块）也可以通过kernel_thread函数创建内核进程。这些创建子进程的函数本质上都完成了相同的功能——将调用进程复制一份，得到子进程。（可以通过选项参数来决定各种资源是共享、还是私有。） 那么既然调用进程处于TASK_RUNNING状态（否则，它若不是正在运行，又怎么进行调用？），则子进程默认也处于TASK_RUNNING状态。 另外，在系统调用调用clone和内核函数kernel_thread也接受CLONE_STOPPED选项，从而将子进程的初始状态置为 TASK_STOPPED。</p>\n<h2 id=\"2、进程状态变迁\"><a href=\"#2、进程状态变迁\" class=\"headerlink\" title=\"2、进程状态变迁\"></a>2、进程状态变迁</h2><p>进程自创建以后，状态可能发生一系列的变化，直到进程退出。而尽管进程状态有好几种，但是进程状态的变迁却只有两个方向——从TASK_RUNNING状态变为非TASK_RUNNING状态、或者从非TASK_RUNNING状态变为TASK_RUNNING状态。 也就是说，如果给一个TASK_INTERRUPTIBLE状态的进程发送SIGKILL信号，这个进程将先被唤醒（进入TASK_RUNNING状态），然后再响应SIGKILL信号而退出（变为TASK_DEAD状态）。并不会从TASK_INTERRUPTIBLE状态直接退出。</p>\n<blockquote>\n<p>进程从非TASK_RUNNING状态变为TASK_RUNNING状态，是由别的进程（也可能是中断处理程序）执行唤醒操作来实现的。执行唤醒的进程设置被唤醒进程的状态为TASK_RUNNING，然后将其task_struct结构加入到某个CPU的可执行队列中。于是被唤醒的进程将有机会被调度执行。 而进程从TASK_RUNNING状态变为非TASK_RUNNING状态，则有两种途径： 1、响应信号而进入TASK_STOPED状态、或TASK_DEAD状态； 2、执行系统调用主动进入TASK_INTERRUPTIBLE状态（如nanosleep系统调用）、或TASK_DEAD状态（如exit系统调用）；或由于执行系统调用需要的资源得不到满足，而进入TASK_INTERRUPTIBLE状态或TASK_UNINTERRUPTIBLE状态（如select系统调用）。 显然，这两种情况都只能发生在进程正在CPU上执行的情况下。</p>\n</blockquote>\n<h1 id=\"三、进程调度\"><a href=\"#三、进程调度\" class=\"headerlink\" title=\"三、进程调度\"></a>三、进程调度</h1><p><img src=\"/images/002.progress.md.02.png\" alt=\"进程调度\"></p>\n<p>转自:<a href=\"https://cloud.tencent.com/developer/article/1568077\">https://cloud.tencent.com/developer/article/1568077</a></p>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>内容转自:<a href=\"https://links.jianshu.com/go?to=https://cloud.tencent.com/developer/article/1568077\">https://cloud.tencent.com/developer/article/1568077</a></p>\n</blockquote>\n<h1 id=\"一、进程状态\"><a href=\"#一、进程状态\" class=\"headerlink\" title=\"一、进程状态\"></a>一、进程状态</h1><ul>\n<li>D：uninterruptible sleep (usually IO)</li>\n<li>R：running or runnable (on run queue)</li>\n<li>S：interruptible sleep (waiting for an event to complete)</li>\n<li>T：stopped by job control signal</li>\n<li>t：stopped by debugger during the tracing</li>\n<li>W：paging (not valid since the 2.6.xx kernel)</li>\n<li>X：dead (should never be seen)</li>\n<li>Z：defunct (“zombie”) process, terminated but not - reaped by its parent</li>\n</ul>","more":"<h2 id=\"1、R-TASK-RUNNING-，可执行状态\"><a href=\"#1、R-TASK-RUNNING-，可执行状态\" class=\"headerlink\" title=\"1、R (TASK_RUNNING)，可执行状态\"></a>1、R (TASK_RUNNING)，可执行状态</h2><p>只有在该状态的进程才可能在CPU上运行。而同一时刻可能有多个进程处于可执行状态，这些进程的task_struct结构（进程控制块）被放入对应CPU的可执行队列中（一个进程最多只能出现在一个CPU的可执行队列中）。进而，进程调度器就从各个CPU的可执行队列中分别选择一个进程在该CPU上运行。</p>\n<blockquote>\n<p>很多操作系统教科书将正在CPU上执行的进程定义为RUNNING状态、而将可执行但是尚未被调度执行的进程定义为READY状态，这两种状态在linux下统一为 TASK_RUNNING状态。</p>\n</blockquote>\n<h2 id=\"2、S-TASK-INTERRUPTIBLE-，可中断的睡眠状态\"><a href=\"#2、S-TASK-INTERRUPTIBLE-，可中断的睡眠状态\" class=\"headerlink\" title=\"2、S (TASK_INTERRUPTIBLE)，可中断的睡眠状态\"></a>2、S (TASK_INTERRUPTIBLE)，可中断的睡眠状态</h2><p>处于这个状态的进程因为等待某某事件的发生（比如等待socket连接、等待信号量），而被挂起。这些进程的task_struct结构（进程控制块）被放入对应事件的等待队列中。当这些事件发生时（由外部中断触发、或由其他进程触发），对应的等待队列中的一个或多个进程将被唤醒。</p>\n<blockquote>\n<p>通过ps命令会看到，一般情况下，进程列表中的绝大多数进程都处于TASK_INTERRUPTIBLE状态（除非机器的负载很高）。毕竟CPU就这么几个，进程动辄几十上百个，如果不是绝大多数进程都在睡眠，CPU又怎么响应得过来。</p>\n</blockquote>\n<h2 id=\"3、D-TASK-UNINTERRUPTIBLE-，不可中断的睡眠状态\"><a href=\"#3、D-TASK-UNINTERRUPTIBLE-，不可中断的睡眠状态\" class=\"headerlink\" title=\"3、D (TASK_UNINTERRUPTIBLE)，不可中断的睡眠状态\"></a>3、D (TASK_UNINTERRUPTIBLE)，不可中断的睡眠状态</h2><p>与TASK_INTERRUPTIBLE状态类似，进程处于睡眠状态，但是此刻进程是不可中断的。不可中断，指的并不是CPU不响应外部硬件的中断，而是指进程不响应异步信号。</p>\n<p>绝大多数情况下，进程处在睡眠状态时，总是应该能够响应异步信号的。否则你将惊奇的发现，kill -9竟然杀不死一个正在睡眠的进程了！于是我们也很好理解，为什么ps命令看到的进程几乎不会出现TASK_UNINTERRUPTIBLE状态，而总是TASK_INTERRUPTIBLE状态。</p>\n<blockquote>\n<p>而TASK_UNINTERRUPTIBLE状态存在的意义就在于，内核的某些处理流程是不能被打断的。如果响应异步信号，程序的执行流程中就会被插入一段用于处理异步信号的流程（这个插入的流程可能只存在于内核态，也可能延伸到用户态），于是原有的流程就被中断了。 例如，在进程对某些硬件进行操作时（比如进程调用read系统调用对某个设备文件进行读操作，而read系统调用最终执行到对应设备驱动的代码，并与对应的物理设备进行交互），可能需要使用TASK_UNINTERRUPTIBLE状态对进程进行保护，以避免进程与设备交互的过程被打断，造成设备陷入不可控的状态。这种情况下的TASK_UNINTERRUPTIBLE状态总是非常短暂的，通过ps命令基本上不可能捕捉到。</p>\n</blockquote>\n<h2 id=\"4、T-t-TASK-STOPPED-or-TASK-TRACED-，暂停状态或跟踪状态\"><a href=\"#4、T-t-TASK-STOPPED-or-TASK-TRACED-，暂停状态或跟踪状态\" class=\"headerlink\" title=\"4、T&#x2F;t (TASK_STOPPED or TASK_TRACED)，暂停状态或跟踪状态\"></a>4、T&#x2F;t (TASK_STOPPED or TASK_TRACED)，暂停状态或跟踪状态</h2><p><strong>T (TASK_STOPPED)状态</strong>：向进程发送一个SIGSTOP信号，它就会因响应该信号而进入TASK_STOPPED状态（除非该进程本身处于TASK_UNINTERRUPTIBLE状态而不响应信号）。 SIGSTOP与SIGKILL信号一样，是非常强制的。不允许用户进程通过signal系列的系统调用重新设置对应的信号处理函数。 向进程发送一个SIGCONT信号（kill -18），可以让其从TASK_STOPPED状态恢复到TASK_RUNNING状态；或者kill -9直接尝试杀死。</p>\n<p><strong>t (TASK_STOPPED)状态</strong>：当进程正在被跟踪时，它处于TASK_TRACED这个特殊的状态。“正在被跟踪”指的是进程暂停下来，等待跟踪它的进程对它进行操作。比如在gdb（UNIX及UNIX-like下的调试工具）调试中对被跟踪的进程下一个断点，进程在断点处停下来的时候就处于TASK_TRACED状态。而在其他时候，被跟踪的进程还是处于前面提到的那些状态。</p>\n<blockquote>\n<p>对于进程本身来说，TASK_STOPPED和TASK_TRACED状态很类似，都是表示进程暂停下来。 而TASK_TRACED状态相当于在TASK_STOPPED之上多了一层保护，处于TASK_TRACED状态的进程不能响应SIGCONT信号而被唤醒。只能等到调试进程通过ptrace系统调用执行PTRACE_CONT、PTRACE_DETACH等操作（通过ptrace系统调用的参数指定操作），或调试进程退出，被调试的进程才能恢复TASK_RUNNING状态。</p>\n</blockquote>\n<h2 id=\"5、Z-TASK-DEAD-EXIT-ZOMBIE-，退出状态，进程成为僵尸进程\"><a href=\"#5、Z-TASK-DEAD-EXIT-ZOMBIE-，退出状态，进程成为僵尸进程\" class=\"headerlink\" title=\"5、Z (TASK_DEAD - EXIT_ZOMBIE)，退出状态，进程成为僵尸进程\"></a>5、Z (TASK_DEAD - EXIT_ZOMBIE)，退出状态，进程成为僵尸进程</h2><p>进程在退出的过程中，处于TASK_DEAD状态。在这个退出过程中，进程占有的所有资源将被回收，除了task_struct结构（以及少数资源）以外。于是进程就只剩下task_struct这么个空壳，故称为僵尸。</p>\n<p>之所以保留task_struct，是因为task_struct里面保存了进程的退出码、以及一些统计信息。而其父进程很可能会关心这些信息。父进程可以通过wait系列的系统调用（如wait4、waitid）来等待某个或某些子进程的退出，并获取它的退出信息（保存在task_struct里）。然后wait系列的系统调用会顺便将子进程的尸体（task_struct）也释放掉。</p>\n<blockquote>\n<p>当父&#x2F;子进程在不同时间点退出时，就可能会出现Z的细分状态：</p>\n</blockquote>\n<ol>\n<li>僵尸状态 一个进程使用 fork 创建子进程，如果子进程退出后父进程没有调用 wait 或 waitpid 获取子进程的状态信息，并将子进程释放掉。那么子进程的进程描述符仍然保存在系统中，仍然占用进程表，此时进程就处于僵尸状态。 子进程在退出的过程中，内核会给其父进程发送一个信号，通知父进程来“收尸”。出现僵尸状态可能有两种情况： 第一种情况，父进程收到通知还没来得及完成收尸，此时正常； 第二种情况，父进程收尸出现异常，此时，只要父进程不退出，子进程的僵尸状态就一直存在，可以通过<strong>杀死父进程</strong>或者<strong>重启</strong>来解决。</li>\n<li>孤儿状态 父进程退出，相应的一个或多个子进程还在运行，那么那些子进程将处于孤儿状态，成为孤儿进程。这些进程会被托管给别的进程，托管给谁呢？可能是退出进程所在进程组的下一个进程（如果存在的话），或者是1号进程。所以每个进程、每时每刻都有父进程存在。除非它是1号进程。 1号进程，pid为1的进程，又称init进程。 linux系统启动后，第一个被创建的用户态进程就是init进程。它有两项使命： 1、执行系统初始化脚本，创建一系列的进程（它们都是init进程的子孙）； 2、在一个死循环中等待其子进程的退出事件，并调用waitid系统调用来完成“收尸”工作； init进程不会被暂停、也不会被杀死（这是由内核来保证的）。它在等待子进程退出的过程中处于TASK_INTERRUPTIBLE状态，“收尸”过程中则处于TASK_RUNNING状态。</li>\n</ol>\n<h2 id=\"6、X-TASK-DEAD-EXIT-DEAD-，退出状态，进程即将被销毁\"><a href=\"#6、X-TASK-DEAD-EXIT-DEAD-，退出状态，进程即将被销毁\" class=\"headerlink\" title=\"6、X (TASK_DEAD - EXIT_DEAD)，退出状态，进程即将被销毁\"></a>6、X (TASK_DEAD - EXIT_DEAD)，退出状态，进程即将被销毁</h2><p>进程在退出过程中也可能不会保留它的task_struct。比如这个进程是多线程程序中被detach过的进程。或者父进程通过设置SIGCHLD信号的handler为SIG_IGN，显式的忽略了SIGCHLD信号。（这是posix的规定，尽管子进程的退出信号可以被设置为SIGCHLD以外的其他信号。） 此时，进程将被置于EXIT_DEAD退出状态，这意味着接下来的代码立即就会将该进程彻底释放。所以EXIT_DEAD状态是非常短暂的，几乎不可能通过ps命令捕捉到。</p>\n<h2 id=\"7、查看进程状态\"><a href=\"#7、查看进程状态\" class=\"headerlink\" title=\"7、查看进程状态\"></a>7、查看进程状态</h2><p><strong>进程小状态</strong>：</p>\n<ul>\n<li>&lt;：high-priority (not nice to other users)</li>\n<li>N：low-priority (nice to other users)</li>\n<li>L：has pages locked into memory (for real-time and custom IO)</li>\n<li>s：is a session leader</li>\n<li>l：is multi-threaded (using CLONE_THREAD, like NPTL pthreads do)</li>\n<li>+：is in the foreground process group</li>\n</ul>\n<p><strong>常用的命令</strong>：ps命令，见<a href=\"https://www.cnblogs.com/littlecharacter/p/12154587.html\">Linux系统之常用命令</a></p>\n<ul>\n<li><code>ps -eo stat,pid,user,%cpu,%mem,time,cmd</code></li>\n<li><code>ps -eo stat,pid,user,%cpu,%mem,time,cmd | grep -e &#39;^[R]&#39;</code></li>\n</ul>\n<h1 id=\"二、进程状态转换\"><a href=\"#二、进程状态转换\" class=\"headerlink\" title=\"二、进程状态转换\"></a>二、进程状态转换</h1><p><img src=\"/images/002.progress.md.01.png\" alt=\"进程转换\"></p>\n<h2 id=\"1、进程初始状态\"><a href=\"#1、进程初始状态\" class=\"headerlink\" title=\"1、进程初始状态\"></a>1、进程初始状态</h2><p>进程是通过fork系列的系统调用（fork、clone、vfork）来创建的，内核（或内核模块）也可以通过kernel_thread函数创建内核进程。这些创建子进程的函数本质上都完成了相同的功能——将调用进程复制一份，得到子进程。（可以通过选项参数来决定各种资源是共享、还是私有。） 那么既然调用进程处于TASK_RUNNING状态（否则，它若不是正在运行，又怎么进行调用？），则子进程默认也处于TASK_RUNNING状态。 另外，在系统调用调用clone和内核函数kernel_thread也接受CLONE_STOPPED选项，从而将子进程的初始状态置为 TASK_STOPPED。</p>\n<h2 id=\"2、进程状态变迁\"><a href=\"#2、进程状态变迁\" class=\"headerlink\" title=\"2、进程状态变迁\"></a>2、进程状态变迁</h2><p>进程自创建以后，状态可能发生一系列的变化，直到进程退出。而尽管进程状态有好几种，但是进程状态的变迁却只有两个方向——从TASK_RUNNING状态变为非TASK_RUNNING状态、或者从非TASK_RUNNING状态变为TASK_RUNNING状态。 也就是说，如果给一个TASK_INTERRUPTIBLE状态的进程发送SIGKILL信号，这个进程将先被唤醒（进入TASK_RUNNING状态），然后再响应SIGKILL信号而退出（变为TASK_DEAD状态）。并不会从TASK_INTERRUPTIBLE状态直接退出。</p>\n<blockquote>\n<p>进程从非TASK_RUNNING状态变为TASK_RUNNING状态，是由别的进程（也可能是中断处理程序）执行唤醒操作来实现的。执行唤醒的进程设置被唤醒进程的状态为TASK_RUNNING，然后将其task_struct结构加入到某个CPU的可执行队列中。于是被唤醒的进程将有机会被调度执行。 而进程从TASK_RUNNING状态变为非TASK_RUNNING状态，则有两种途径： 1、响应信号而进入TASK_STOPED状态、或TASK_DEAD状态； 2、执行系统调用主动进入TASK_INTERRUPTIBLE状态（如nanosleep系统调用）、或TASK_DEAD状态（如exit系统调用）；或由于执行系统调用需要的资源得不到满足，而进入TASK_INTERRUPTIBLE状态或TASK_UNINTERRUPTIBLE状态（如select系统调用）。 显然，这两种情况都只能发生在进程正在CPU上执行的情况下。</p>\n</blockquote>\n<h1 id=\"三、进程调度\"><a href=\"#三、进程调度\" class=\"headerlink\" title=\"三、进程调度\"></a>三、进程调度</h1><p><img src=\"/images/002.progress.md.02.png\" alt=\"进程调度\"></p>\n<p>转自:<a href=\"https://cloud.tencent.com/developer/article/1568077\">https://cloud.tencent.com/developer/article/1568077</a></p>"},{"title":"CentOS安装配置Clamav","date":"2022-03-03T09:30:08.000Z","_content":"\n>在当下, Linux 服务器的安全问题越来越频发,服务器被恶意入侵,业务数据被恶意删除和加密以及服务器被劫持作为 DDos 肉鸡等.为了增强 Linux 服务器的安全性,给大家推荐一款开源的防病毒软件 ClamAV,并附上相关安装配置步骤供参考.\n关于 ClamAV 的更多详情, 参考 [ClamAV 文档](https://docs.clamav.net/)\n\n<!-- more -->\n\n1) 下载\n选择适合自己的版本下载\nhttps://www.clamav.net/downloads\n![image.png](/images/003.clamav.md.01.png)\n\n2) 安装\n ``` rpm -ivh clamav-0.104.2.linux.x86_64.rpm ```\n\n3) 配置\n- 生成配置文件 ```clamd.conf```和```freshclam.conf```\n   - ```cp /usr/local/etc/clamd.conf.sample /usr/local/etc/clamd.conf```\n   - ```cp /usr/local/etc/freshclam.conf.sample /usr/local/etc/freshclam.conf```\n- 配置```clamd.conf```\n``` vim /usr/local/etc/clamd.conf``` 约第八行\n找到包含 Example 的行, 添加 # 号, 进行注释。\n\n- 配置```freshclam.conf```\n   - 找到包含 Example 的行, 添加 # 号, 进行注释。\n   - 找到包含 #DatabaseOwner clamav 的行,改为 DatabaseOwner root。\n   - 找到包含 #UpdateLogFile /var/log/freshclam.log 的行,将 # 号去除。\n   - 找到包含 #LogFileMaxSize 2M 的行,将 # 号去除, 并设置相应的大小,比如 20M。\n   - 找到包含 #LogRotate yes 的行，将 # 号去除。\n   - 找到包含 #LogTime yes 的行,将 # 号去除。\n   - 找到包含 #DatabaseDirectory /var/lib/clamav 的行,将 # 号去除。\n\n4) 使用\n   1. 更新病毒库\n    ``` freshclam```\n![image.png](/images/003.clamav.md.02.png)\n   2. 扫描指定路径\n    ``` clamscan -ri </path1/to/scan> </path2/to/scan>```\n\n   3. 定期扫描\n         ```30 2 * * * /bin/freshclam --datadir=/var/lib/clamav/```\n         ```30 3 * * * /bin/clamscan -ri <path/to/scan> | mail -s \"clamscan daily report\" 'youremailaddress'```\n上述范例会在每天凌晨 2 点半进行病毒库更新, 在凌晨 3 点半进行病毒扫描, 并通过邮件方式把扫描结果发送到邮箱。\n\n","source":"_posts/003.clamav.md","raw":"---\ntitle: CentOS安装配置Clamav\ndate: 2022-03-03 17:30:08\ncategories: \n- [Linux]\n- [CentOS]\ntags: Clamav\n---\n\n>在当下, Linux 服务器的安全问题越来越频发,服务器被恶意入侵,业务数据被恶意删除和加密以及服务器被劫持作为 DDos 肉鸡等.为了增强 Linux 服务器的安全性,给大家推荐一款开源的防病毒软件 ClamAV,并附上相关安装配置步骤供参考.\n关于 ClamAV 的更多详情, 参考 [ClamAV 文档](https://docs.clamav.net/)\n\n<!-- more -->\n\n1) 下载\n选择适合自己的版本下载\nhttps://www.clamav.net/downloads\n![image.png](/images/003.clamav.md.01.png)\n\n2) 安装\n ``` rpm -ivh clamav-0.104.2.linux.x86_64.rpm ```\n\n3) 配置\n- 生成配置文件 ```clamd.conf```和```freshclam.conf```\n   - ```cp /usr/local/etc/clamd.conf.sample /usr/local/etc/clamd.conf```\n   - ```cp /usr/local/etc/freshclam.conf.sample /usr/local/etc/freshclam.conf```\n- 配置```clamd.conf```\n``` vim /usr/local/etc/clamd.conf``` 约第八行\n找到包含 Example 的行, 添加 # 号, 进行注释。\n\n- 配置```freshclam.conf```\n   - 找到包含 Example 的行, 添加 # 号, 进行注释。\n   - 找到包含 #DatabaseOwner clamav 的行,改为 DatabaseOwner root。\n   - 找到包含 #UpdateLogFile /var/log/freshclam.log 的行,将 # 号去除。\n   - 找到包含 #LogFileMaxSize 2M 的行,将 # 号去除, 并设置相应的大小,比如 20M。\n   - 找到包含 #LogRotate yes 的行，将 # 号去除。\n   - 找到包含 #LogTime yes 的行,将 # 号去除。\n   - 找到包含 #DatabaseDirectory /var/lib/clamav 的行,将 # 号去除。\n\n4) 使用\n   1. 更新病毒库\n    ``` freshclam```\n![image.png](/images/003.clamav.md.02.png)\n   2. 扫描指定路径\n    ``` clamscan -ri </path1/to/scan> </path2/to/scan>```\n\n   3. 定期扫描\n         ```30 2 * * * /bin/freshclam --datadir=/var/lib/clamav/```\n         ```30 3 * * * /bin/clamscan -ri <path/to/scan> | mail -s \"clamscan daily report\" 'youremailaddress'```\n上述范例会在每天凌晨 2 点半进行病毒库更新, 在凌晨 3 点半进行病毒扫描, 并通过邮件方式把扫描结果发送到邮箱。\n\n","slug":"003.clamav","published":1,"updated":"2023-12-05T08:52:30.874Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtz8r0007ijnralwtblgi","content":"<blockquote>\n<p>在当下, Linux 服务器的安全问题越来越频发,服务器被恶意入侵,业务数据被恶意删除和加密以及服务器被劫持作为 DDos 肉鸡等.为了增强 Linux 服务器的安全性,给大家推荐一款开源的防病毒软件 ClamAV,并附上相关安装配置步骤供参考.<br>关于 ClamAV 的更多详情, 参考 <a href=\"https://docs.clamav.net/\">ClamAV 文档</a></p>\n</blockquote>\n<span id=\"more\"></span>\n\n<ol>\n<li><p>下载<br>选择适合自己的版本下载<br><a href=\"https://www.clamav.net/downloads\">https://www.clamav.net/downloads</a><br><img src=\"/images/003.clamav.md.01.png\" alt=\"image.png\"></p>\n</li>\n<li><p>安装</p>\n</li>\n</ol>\n<p> <code>rpm -ivh clamav-0.104.2.linux.x86_64.rpm</code></p>\n<ol start=\"3\">\n<li>配置</li>\n</ol>\n<ul>\n<li>生成配置文件 <code>clamd.conf</code>和<code>freshclam.conf</code><ul>\n<li><code>cp /usr/local/etc/clamd.conf.sample /usr/local/etc/clamd.conf</code></li>\n<li><code>cp /usr/local/etc/freshclam.conf.sample /usr/local/etc/freshclam.conf</code></li>\n</ul>\n</li>\n<li>配置<code>clamd.conf</code></li>\n</ul>\n<p><code> vim /usr/local/etc/clamd.conf</code> 约第八行<br>找到包含 Example 的行, 添加 # 号, 进行注释。</p>\n<ul>\n<li>配置<code>freshclam.conf</code><ul>\n<li>找到包含 Example 的行, 添加 # 号, 进行注释。</li>\n<li>找到包含 #DatabaseOwner clamav 的行,改为 DatabaseOwner root。</li>\n<li>找到包含 #UpdateLogFile &#x2F;var&#x2F;log&#x2F;freshclam.log 的行,将 # 号去除。</li>\n<li>找到包含 #LogFileMaxSize 2M 的行,将 # 号去除, 并设置相应的大小,比如 20M。</li>\n<li>找到包含 #LogRotate yes 的行，将 # 号去除。</li>\n<li>找到包含 #LogTime yes 的行,将 # 号去除。</li>\n<li>找到包含 #DatabaseDirectory &#x2F;var&#x2F;lib&#x2F;clamav 的行,将 # 号去除。</li>\n</ul>\n</li>\n</ul>\n<ol start=\"4\">\n<li>使用<ol>\n<li>更新病毒库</li>\n</ol>\n<p> <code> freshclam</code></p>\n</li>\n</ol>\n<p><img src=\"/images/003.clamav.md.02.png\" alt=\"image.png\"><br>   2. 扫描指定路径<br>    <code> clamscan -ri &lt;/path1/to/scan&gt; &lt;/path2/to/scan&gt;</code></p>\n<ol start=\"3\">\n<li>定期扫描<br>   <code>30 2 * * * /bin/freshclam --datadir=/var/lib/clamav/</code><br>   <code>30 3 * * * /bin/clamscan -ri &lt;path/to/scan&gt; | mail -s &quot;clamscan daily report&quot; &#39;youremailaddress&#39;</code></li>\n</ol>\n<p>上述范例会在每天凌晨 2 点半进行病毒库更新, 在凌晨 3 点半进行病毒扫描, 并通过邮件方式把扫描结果发送到邮箱。</p>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>在当下, Linux 服务器的安全问题越来越频发,服务器被恶意入侵,业务数据被恶意删除和加密以及服务器被劫持作为 DDos 肉鸡等.为了增强 Linux 服务器的安全性,给大家推荐一款开源的防病毒软件 ClamAV,并附上相关安装配置步骤供参考.<br>关于 ClamAV 的更多详情, 参考 <a href=\"https://docs.clamav.net/\">ClamAV 文档</a></p>\n</blockquote>","more":"<ol>\n<li><p>下载<br>选择适合自己的版本下载<br><a href=\"https://www.clamav.net/downloads\">https://www.clamav.net/downloads</a><br><img src=\"/images/003.clamav.md.01.png\" alt=\"image.png\"></p>\n</li>\n<li><p>安装</p>\n</li>\n</ol>\n<p> <code>rpm -ivh clamav-0.104.2.linux.x86_64.rpm</code></p>\n<ol start=\"3\">\n<li>配置</li>\n</ol>\n<ul>\n<li>生成配置文件 <code>clamd.conf</code>和<code>freshclam.conf</code><ul>\n<li><code>cp /usr/local/etc/clamd.conf.sample /usr/local/etc/clamd.conf</code></li>\n<li><code>cp /usr/local/etc/freshclam.conf.sample /usr/local/etc/freshclam.conf</code></li>\n</ul>\n</li>\n<li>配置<code>clamd.conf</code></li>\n</ul>\n<p><code> vim /usr/local/etc/clamd.conf</code> 约第八行<br>找到包含 Example 的行, 添加 # 号, 进行注释。</p>\n<ul>\n<li>配置<code>freshclam.conf</code><ul>\n<li>找到包含 Example 的行, 添加 # 号, 进行注释。</li>\n<li>找到包含 #DatabaseOwner clamav 的行,改为 DatabaseOwner root。</li>\n<li>找到包含 #UpdateLogFile &#x2F;var&#x2F;log&#x2F;freshclam.log 的行,将 # 号去除。</li>\n<li>找到包含 #LogFileMaxSize 2M 的行,将 # 号去除, 并设置相应的大小,比如 20M。</li>\n<li>找到包含 #LogRotate yes 的行，将 # 号去除。</li>\n<li>找到包含 #LogTime yes 的行,将 # 号去除。</li>\n<li>找到包含 #DatabaseDirectory &#x2F;var&#x2F;lib&#x2F;clamav 的行,将 # 号去除。</li>\n</ul>\n</li>\n</ul>\n<ol start=\"4\">\n<li>使用<ol>\n<li>更新病毒库</li>\n</ol>\n<p> <code> freshclam</code></p>\n</li>\n</ol>\n<p><img src=\"/images/003.clamav.md.02.png\" alt=\"image.png\"><br>   2. 扫描指定路径<br>    <code> clamscan -ri &lt;/path1/to/scan&gt; &lt;/path2/to/scan&gt;</code></p>\n<ol start=\"3\">\n<li>定期扫描<br>   <code>30 2 * * * /bin/freshclam --datadir=/var/lib/clamav/</code><br>   <code>30 3 * * * /bin/clamscan -ri &lt;path/to/scan&gt; | mail -s &quot;clamscan daily report&quot; &#39;youremailaddress&#39;</code></li>\n</ol>\n<p>上述范例会在每天凌晨 2 点半进行病毒库更新, 在凌晨 3 点半进行病毒扫描, 并通过邮件方式把扫描结果发送到邮箱。</p>"},{"title":"常用LVM操作","date":"2022-03-03T09:30:08.000Z","_content":"\n\n> LVM是逻辑卷管理（Logical Volume Manager）的简称，它是Linux环境下对磁盘分区进行管理的一种机制。LVM通过在硬盘和文件系统之间添加一个逻辑层，来为文件系统屏蔽下层硬盘分区布局，提高硬盘分区管理的灵活性，\n\n\n## 名词解释\n- ```物理存储介质（The physical media）```：指系统的物理存储设备，如硬盘，系统中为```/dev/hda```、```/dev/sda```、```/dev/vda```等等，是存储系统最低层的存储单元。\n\n```{% note info %}```\nNOTE:  ``` /dev/sda``` 和 ```/dev/sda1```是有区别的。 ```/dev/sda``` 表示整个```sda```整个硬盘, ```/dev/sda1```表示的是硬盘上的一个分区。\n好比你的电脑是256的固态, 然后划分成C, D两个盘。 sda指固态, sda1指C盘, sda2指D盘。\n```{% endnote %}```\n\n- ```PV: 物理卷（Physical Volume）```：指硬盘分区或从逻辑上与磁盘分区具有同样功能的设备(如RAID), 是LVM的基本存储逻辑块。物理卷包括一个特殊的标签，该标签默认存放在第二个 512 字节扇区，但也可以将标签放在最开始的四个扇区之一。该标签包含物理卷的随机唯一识别符（UUID），记录块设备的大小和LVM元数据在设备中的存储位置。\n\n- ```VG: 卷组（Volume Group）```：由物理卷组成，屏蔽了底层物理卷细节。可在卷组上创建一个或多个逻辑卷且不用考虑具体的物理卷信息。\n\n- ```LV: 逻辑卷（Logical Volume）```：卷组不能直接用，需要划分成逻辑卷才能使用。逻辑卷可以格式化成不同的文件系统，挂载后直接使用。\n\n- ```PE: 物理块（Physical Extent）```：物理卷以大小相等的“块”为单位存储，块的大小与卷组中逻辑卷块的大小相同。\n\n- ```LE: 逻辑块（Logical Extent，）```：逻辑卷以“块”为单位存储，在一卷组中的所有逻辑卷的块大小是相同的\n\n![lvm图解](/images/004.lvm.md.01.png)\n\n使用LVM管理硬盘的基本过程如下：\n\n- 1.将硬盘创建为物理卷\n- 2.将多个物理卷组合成卷组\n- 3.在卷组中创建逻辑卷\n- 4.在逻辑卷之上创建文件系统\n通过LVM管理硬盘之后，文件系统不再受限于硬盘的大小，可以分布在多个硬盘上，也可以动态扩容。\n\n\n## 情形一: 根目录扩容(常见于CentOS)\n\n- 0: 格式化磁盘并修改分区格式 \n``` fdisk /dev/sdb [n, p, 1, size, t, 8e, w]```\n\n- 1: 创建 PV\n ``` pvcreate /dev/sdb```\n\n- 2: 扩展 VG\n ``` vgextend centos /dev/sdb1```\n\n- 3: 扩展LV\n ``` lvextend -l +100%FREE /dev/centos/root```\n\n- 4: 刷新\n ``` xfs_growfs /dev/centos/root```\n\n ## 情形二: 根目录扩容(常见于Ubuntu)\n\n- 0: 格式化磁盘并修改分区格式 \n``` fdisk /dev/sdb [n, p, 1, size, t, 8e, w]```\n\n- 1: 创建 PV\n ``` pvcreate /dev/sdb```\n\n- 2: 扩展 VG\n ``` vgextend ubuntu-vg /dev/sdb1```\n\n- 3: 扩展LV\n ``` lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv```\n\n- 4: 刷新\n ``` resize2fs /dev/ubuntu-vg/ubuntu-lv```\n\n```{% note info %}NOTE:```\nP.S 如果碰到 xfs 提示 xfs_growfs: /dev/centos/root is not a mounted XFS filesystem\n因为不同的文件格式刷新的方式不同。\n对于 xfs : ```xfs_growfs + 挂载点```\n对于 ext2/3/4: ```resize2fs + 挂载点```\n```{% endnote %}```\n\n- 确认文件系统格式和挂载点\n``` df -Thl```\n![df -Thl](/images/004.lvm.md.02.png)\n``` lsblk ```\n![lsblk](/images/004.lvm.md.03.png)\n\n\n\n## 情形三: 一块磁盘做成lvm单独挂载某个目录\n\n将新磁盘分成两个区,一个挂载/data; 一个挂载/var/lib/docker\n\n![图](/images/004.lvm.md.04.png)\n\n``` yaml\n\n# 创建 pv\npvcreate /dev/sdb1   \n\n# 创建 vg0\nvgcreate vg0 /dev/sdb1\n\n\n# 创建 lv0 和 lv1\nlvcreate  -l 50%FREE -n lv0 vg0\n\nlvcreate  -l 100%FREE -n lv1 vg0\n\n# 格式化\nmkfs.xfs /dev/vg0/lv0\nmkfs.xfs /dev/vg0/lv0\n\n# 挂载\necho \"/dev/vg0/lv0 /data/  xfs  defaults   0 0\"  >> /etc/fstab\necho \"/dev/vg0/lv1 /var/lib/docker  xfs  defaults   0 0\"  >> /etc/fstab\n\n```","source":"_posts/004.lvm.md","raw":"---\ntitle: 常用LVM操作\ndate: 2022-03-03 17:30:08\ncategories: \n- [Linux]\n- [CentOS]\n- [Ubuntu]\ntags: LVM\n---\n\n\n> LVM是逻辑卷管理（Logical Volume Manager）的简称，它是Linux环境下对磁盘分区进行管理的一种机制。LVM通过在硬盘和文件系统之间添加一个逻辑层，来为文件系统屏蔽下层硬盘分区布局，提高硬盘分区管理的灵活性，\n\n\n## 名词解释\n- ```物理存储介质（The physical media）```：指系统的物理存储设备，如硬盘，系统中为```/dev/hda```、```/dev/sda```、```/dev/vda```等等，是存储系统最低层的存储单元。\n\n```{% note info %}```\nNOTE:  ``` /dev/sda``` 和 ```/dev/sda1```是有区别的。 ```/dev/sda``` 表示整个```sda```整个硬盘, ```/dev/sda1```表示的是硬盘上的一个分区。\n好比你的电脑是256的固态, 然后划分成C, D两个盘。 sda指固态, sda1指C盘, sda2指D盘。\n```{% endnote %}```\n\n- ```PV: 物理卷（Physical Volume）```：指硬盘分区或从逻辑上与磁盘分区具有同样功能的设备(如RAID), 是LVM的基本存储逻辑块。物理卷包括一个特殊的标签，该标签默认存放在第二个 512 字节扇区，但也可以将标签放在最开始的四个扇区之一。该标签包含物理卷的随机唯一识别符（UUID），记录块设备的大小和LVM元数据在设备中的存储位置。\n\n- ```VG: 卷组（Volume Group）```：由物理卷组成，屏蔽了底层物理卷细节。可在卷组上创建一个或多个逻辑卷且不用考虑具体的物理卷信息。\n\n- ```LV: 逻辑卷（Logical Volume）```：卷组不能直接用，需要划分成逻辑卷才能使用。逻辑卷可以格式化成不同的文件系统，挂载后直接使用。\n\n- ```PE: 物理块（Physical Extent）```：物理卷以大小相等的“块”为单位存储，块的大小与卷组中逻辑卷块的大小相同。\n\n- ```LE: 逻辑块（Logical Extent，）```：逻辑卷以“块”为单位存储，在一卷组中的所有逻辑卷的块大小是相同的\n\n![lvm图解](/images/004.lvm.md.01.png)\n\n使用LVM管理硬盘的基本过程如下：\n\n- 1.将硬盘创建为物理卷\n- 2.将多个物理卷组合成卷组\n- 3.在卷组中创建逻辑卷\n- 4.在逻辑卷之上创建文件系统\n通过LVM管理硬盘之后，文件系统不再受限于硬盘的大小，可以分布在多个硬盘上，也可以动态扩容。\n\n\n## 情形一: 根目录扩容(常见于CentOS)\n\n- 0: 格式化磁盘并修改分区格式 \n``` fdisk /dev/sdb [n, p, 1, size, t, 8e, w]```\n\n- 1: 创建 PV\n ``` pvcreate /dev/sdb```\n\n- 2: 扩展 VG\n ``` vgextend centos /dev/sdb1```\n\n- 3: 扩展LV\n ``` lvextend -l +100%FREE /dev/centos/root```\n\n- 4: 刷新\n ``` xfs_growfs /dev/centos/root```\n\n ## 情形二: 根目录扩容(常见于Ubuntu)\n\n- 0: 格式化磁盘并修改分区格式 \n``` fdisk /dev/sdb [n, p, 1, size, t, 8e, w]```\n\n- 1: 创建 PV\n ``` pvcreate /dev/sdb```\n\n- 2: 扩展 VG\n ``` vgextend ubuntu-vg /dev/sdb1```\n\n- 3: 扩展LV\n ``` lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv```\n\n- 4: 刷新\n ``` resize2fs /dev/ubuntu-vg/ubuntu-lv```\n\n```{% note info %}NOTE:```\nP.S 如果碰到 xfs 提示 xfs_growfs: /dev/centos/root is not a mounted XFS filesystem\n因为不同的文件格式刷新的方式不同。\n对于 xfs : ```xfs_growfs + 挂载点```\n对于 ext2/3/4: ```resize2fs + 挂载点```\n```{% endnote %}```\n\n- 确认文件系统格式和挂载点\n``` df -Thl```\n![df -Thl](/images/004.lvm.md.02.png)\n``` lsblk ```\n![lsblk](/images/004.lvm.md.03.png)\n\n\n\n## 情形三: 一块磁盘做成lvm单独挂载某个目录\n\n将新磁盘分成两个区,一个挂载/data; 一个挂载/var/lib/docker\n\n![图](/images/004.lvm.md.04.png)\n\n``` yaml\n\n# 创建 pv\npvcreate /dev/sdb1   \n\n# 创建 vg0\nvgcreate vg0 /dev/sdb1\n\n\n# 创建 lv0 和 lv1\nlvcreate  -l 50%FREE -n lv0 vg0\n\nlvcreate  -l 100%FREE -n lv1 vg0\n\n# 格式化\nmkfs.xfs /dev/vg0/lv0\nmkfs.xfs /dev/vg0/lv0\n\n# 挂载\necho \"/dev/vg0/lv0 /data/  xfs  defaults   0 0\"  >> /etc/fstab\necho \"/dev/vg0/lv1 /var/lib/docker  xfs  defaults   0 0\"  >> /etc/fstab\n\n```","slug":"004.lvm","published":1,"updated":"2023-12-05T08:52:30.874Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtz8w0009ijnratonc1nh","content":"<blockquote>\n<p>LVM是逻辑卷管理（Logical Volume Manager）的简称，它是Linux环境下对磁盘分区进行管理的一种机制。LVM通过在硬盘和文件系统之间添加一个逻辑层，来为文件系统屏蔽下层硬盘分区布局，提高硬盘分区管理的灵活性，</p>\n</blockquote>\n<h2 id=\"名词解释\"><a href=\"#名词解释\" class=\"headerlink\" title=\"名词解释\"></a>名词解释</h2><ul>\n<li><code>物理存储介质（The physical media）</code>：指系统的物理存储设备，如硬盘，系统中为<code>/dev/hda</code>、<code>/dev/sda</code>、<code>/dev/vda</code>等等，是存储系统最低层的存储单元。</li>\n</ul>\n<p><code>&#123;% note info %&#125;```\nNOTE:  ``` /dev/sda``` 和 ```/dev/sda1```是有区别的。 ```/dev/sda``` 表示整个```sda```整个硬盘, ```/dev/sda1```表示的是硬盘上的一个分区。\n好比你的电脑是256的固态, 然后划分成C, D两个盘。 sda指固态, sda1指C盘, sda2指D盘。\n```&#123;% endnote %&#125;</code></p>\n<ul>\n<li><p><code>PV: 物理卷（Physical Volume）</code>：指硬盘分区或从逻辑上与磁盘分区具有同样功能的设备(如RAID), 是LVM的基本存储逻辑块。物理卷包括一个特殊的标签，该标签默认存放在第二个 512 字节扇区，但也可以将标签放在最开始的四个扇区之一。该标签包含物理卷的随机唯一识别符（UUID），记录块设备的大小和LVM元数据在设备中的存储位置。</p>\n</li>\n<li><p><code>VG: 卷组（Volume Group）</code>：由物理卷组成，屏蔽了底层物理卷细节。可在卷组上创建一个或多个逻辑卷且不用考虑具体的物理卷信息。</p>\n</li>\n<li><p><code>LV: 逻辑卷（Logical Volume）</code>：卷组不能直接用，需要划分成逻辑卷才能使用。逻辑卷可以格式化成不同的文件系统，挂载后直接使用。</p>\n</li>\n<li><p><code>PE: 物理块（Physical Extent）</code>：物理卷以大小相等的“块”为单位存储，块的大小与卷组中逻辑卷块的大小相同。</p>\n</li>\n<li><p><code>LE: 逻辑块（Logical Extent，）</code>：逻辑卷以“块”为单位存储，在一卷组中的所有逻辑卷的块大小是相同的</p>\n</li>\n</ul>\n<p><img src=\"/images/004.lvm.md.01.png\" alt=\"lvm图解\"></p>\n<p>使用LVM管理硬盘的基本过程如下：</p>\n<ul>\n<li>1.将硬盘创建为物理卷</li>\n<li>2.将多个物理卷组合成卷组</li>\n<li>3.在卷组中创建逻辑卷</li>\n<li>4.在逻辑卷之上创建文件系统<br>通过LVM管理硬盘之后，文件系统不再受限于硬盘的大小，可以分布在多个硬盘上，也可以动态扩容。</li>\n</ul>\n<h2 id=\"情形一-根目录扩容-常见于CentOS\"><a href=\"#情形一-根目录扩容-常见于CentOS\" class=\"headerlink\" title=\"情形一: 根目录扩容(常见于CentOS)\"></a>情形一: 根目录扩容(常见于CentOS)</h2><ul>\n<li>0: 格式化磁盘并修改分区格式</li>\n</ul>\n<p><code> fdisk /dev/sdb [n, p, 1, size, t, 8e, w]</code></p>\n<ul>\n<li>1: 创建 PV</li>\n</ul>\n<p> <code> pvcreate /dev/sdb</code></p>\n<ul>\n<li>2: 扩展 VG</li>\n</ul>\n<p> <code> vgextend centos /dev/sdb1</code></p>\n<ul>\n<li>3: 扩展LV</li>\n</ul>\n<p> <code> lvextend -l +100%FREE /dev/centos/root</code></p>\n<ul>\n<li>4: 刷新</li>\n</ul>\n<p> <code> xfs_growfs /dev/centos/root</code></p>\n<h2 id=\"情形二-根目录扩容-常见于Ubuntu\"><a href=\"#情形二-根目录扩容-常见于Ubuntu\" class=\"headerlink\" title=\"情形二: 根目录扩容(常见于Ubuntu)\"></a>情形二: 根目录扩容(常见于Ubuntu)</h2><ul>\n<li>0: 格式化磁盘并修改分区格式</li>\n</ul>\n<p><code> fdisk /dev/sdb [n, p, 1, size, t, 8e, w]</code></p>\n<ul>\n<li>1: 创建 PV</li>\n</ul>\n<p> <code> pvcreate /dev/sdb</code></p>\n<ul>\n<li>2: 扩展 VG</li>\n</ul>\n<p> <code> vgextend ubuntu-vg /dev/sdb1</code></p>\n<ul>\n<li>3: 扩展LV</li>\n</ul>\n<p> <code> lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv</code></p>\n<ul>\n<li>4: 刷新</li>\n</ul>\n<p> <code> resize2fs /dev/ubuntu-vg/ubuntu-lv</code></p>\n<p><code>&#123;% note info %&#125;NOTE:```\nP.S 如果碰到 xfs 提示 xfs_growfs: /dev/centos/root is not a mounted XFS filesystem\n因为不同的文件格式刷新的方式不同。\n对于 xfs : ```xfs_growfs + 挂载点```\n对于 ext2/3/4: ```resize2fs + 挂载点```\n```&#123;% endnote %&#125;</code></p>\n<ul>\n<li>确认文件系统格式和挂载点</li>\n</ul>\n<p><code> df -Thl</code><br><img src=\"/images/004.lvm.md.02.png\" alt=\"df -Thl\"><br><code>lsblk</code><br><img src=\"/images/004.lvm.md.03.png\" alt=\"lsblk\"></p>\n<h2 id=\"情形三-一块磁盘做成lvm单独挂载某个目录\"><a href=\"#情形三-一块磁盘做成lvm单独挂载某个目录\" class=\"headerlink\" title=\"情形三: 一块磁盘做成lvm单独挂载某个目录\"></a>情形三: 一块磁盘做成lvm单独挂载某个目录</h2><p>将新磁盘分成两个区,一个挂载&#x2F;data; 一个挂载&#x2F;var&#x2F;lib&#x2F;docker</p>\n<p><img src=\"/images/004.lvm.md.04.png\" alt=\"图\"></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建 pv</span></span><br><span class=\"line\"><span class=\"string\">pvcreate</span> <span class=\"string\">/dev/sdb1</span>   </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建 vg0</span></span><br><span class=\"line\"><span class=\"string\">vgcreate</span> <span class=\"string\">vg0</span> <span class=\"string\">/dev/sdb1</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建 lv0 和 lv1</span></span><br><span class=\"line\"><span class=\"string\">lvcreate</span>  <span class=\"string\">-l</span> <span class=\"number\">50</span><span class=\"string\">%FREE</span> <span class=\"string\">-n</span> <span class=\"string\">lv0</span> <span class=\"string\">vg0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">lvcreate</span>  <span class=\"string\">-l</span> <span class=\"number\">100</span><span class=\"string\">%FREE</span> <span class=\"string\">-n</span> <span class=\"string\">lv1</span> <span class=\"string\">vg0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 格式化</span></span><br><span class=\"line\"><span class=\"string\">mkfs.xfs</span> <span class=\"string\">/dev/vg0/lv0</span></span><br><span class=\"line\"><span class=\"string\">mkfs.xfs</span> <span class=\"string\">/dev/vg0/lv0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 挂载</span></span><br><span class=\"line\"><span class=\"string\">echo</span> <span class=\"string\">&quot;/dev/vg0/lv0 /data/  xfs  defaults   0 0&quot;</span>  <span class=\"string\">&gt;&gt;</span> <span class=\"string\">/etc/fstab</span></span><br><span class=\"line\"><span class=\"string\">echo</span> <span class=\"string\">&quot;/dev/vg0/lv1 /var/lib/docker  xfs  defaults   0 0&quot;</span>  <span class=\"string\">&gt;&gt;</span> <span class=\"string\">/etc/fstab</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>LVM是逻辑卷管理（Logical Volume Manager）的简称，它是Linux环境下对磁盘分区进行管理的一种机制。LVM通过在硬盘和文件系统之间添加一个逻辑层，来为文件系统屏蔽下层硬盘分区布局，提高硬盘分区管理的灵活性，</p>\n</blockquote>\n<h2 id=\"名词解释\"><a href=\"#名词解释\" class=\"headerlink\" title=\"名词解释\"></a>名词解释</h2><ul>\n<li><code>物理存储介质（The physical media）</code>：指系统的物理存储设备，如硬盘，系统中为<code>/dev/hda</code>、<code>/dev/sda</code>、<code>/dev/vda</code>等等，是存储系统最低层的存储单元。</li>\n</ul>\n<p><code>&#123;% note info %&#125;```\nNOTE:  ``` /dev/sda``` 和 ```/dev/sda1```是有区别的。 ```/dev/sda``` 表示整个```sda```整个硬盘, ```/dev/sda1```表示的是硬盘上的一个分区。\n好比你的电脑是256的固态, 然后划分成C, D两个盘。 sda指固态, sda1指C盘, sda2指D盘。\n```&#123;% endnote %&#125;</code></p>\n<ul>\n<li><p><code>PV: 物理卷（Physical Volume）</code>：指硬盘分区或从逻辑上与磁盘分区具有同样功能的设备(如RAID), 是LVM的基本存储逻辑块。物理卷包括一个特殊的标签，该标签默认存放在第二个 512 字节扇区，但也可以将标签放在最开始的四个扇区之一。该标签包含物理卷的随机唯一识别符（UUID），记录块设备的大小和LVM元数据在设备中的存储位置。</p>\n</li>\n<li><p><code>VG: 卷组（Volume Group）</code>：由物理卷组成，屏蔽了底层物理卷细节。可在卷组上创建一个或多个逻辑卷且不用考虑具体的物理卷信息。</p>\n</li>\n<li><p><code>LV: 逻辑卷（Logical Volume）</code>：卷组不能直接用，需要划分成逻辑卷才能使用。逻辑卷可以格式化成不同的文件系统，挂载后直接使用。</p>\n</li>\n<li><p><code>PE: 物理块（Physical Extent）</code>：物理卷以大小相等的“块”为单位存储，块的大小与卷组中逻辑卷块的大小相同。</p>\n</li>\n<li><p><code>LE: 逻辑块（Logical Extent，）</code>：逻辑卷以“块”为单位存储，在一卷组中的所有逻辑卷的块大小是相同的</p>\n</li>\n</ul>\n<p><img src=\"/images/004.lvm.md.01.png\" alt=\"lvm图解\"></p>\n<p>使用LVM管理硬盘的基本过程如下：</p>\n<ul>\n<li>1.将硬盘创建为物理卷</li>\n<li>2.将多个物理卷组合成卷组</li>\n<li>3.在卷组中创建逻辑卷</li>\n<li>4.在逻辑卷之上创建文件系统<br>通过LVM管理硬盘之后，文件系统不再受限于硬盘的大小，可以分布在多个硬盘上，也可以动态扩容。</li>\n</ul>\n<h2 id=\"情形一-根目录扩容-常见于CentOS\"><a href=\"#情形一-根目录扩容-常见于CentOS\" class=\"headerlink\" title=\"情形一: 根目录扩容(常见于CentOS)\"></a>情形一: 根目录扩容(常见于CentOS)</h2><ul>\n<li>0: 格式化磁盘并修改分区格式</li>\n</ul>\n<p><code> fdisk /dev/sdb [n, p, 1, size, t, 8e, w]</code></p>\n<ul>\n<li>1: 创建 PV</li>\n</ul>\n<p> <code> pvcreate /dev/sdb</code></p>\n<ul>\n<li>2: 扩展 VG</li>\n</ul>\n<p> <code> vgextend centos /dev/sdb1</code></p>\n<ul>\n<li>3: 扩展LV</li>\n</ul>\n<p> <code> lvextend -l +100%FREE /dev/centos/root</code></p>\n<ul>\n<li>4: 刷新</li>\n</ul>\n<p> <code> xfs_growfs /dev/centos/root</code></p>\n<h2 id=\"情形二-根目录扩容-常见于Ubuntu\"><a href=\"#情形二-根目录扩容-常见于Ubuntu\" class=\"headerlink\" title=\"情形二: 根目录扩容(常见于Ubuntu)\"></a>情形二: 根目录扩容(常见于Ubuntu)</h2><ul>\n<li>0: 格式化磁盘并修改分区格式</li>\n</ul>\n<p><code> fdisk /dev/sdb [n, p, 1, size, t, 8e, w]</code></p>\n<ul>\n<li>1: 创建 PV</li>\n</ul>\n<p> <code> pvcreate /dev/sdb</code></p>\n<ul>\n<li>2: 扩展 VG</li>\n</ul>\n<p> <code> vgextend ubuntu-vg /dev/sdb1</code></p>\n<ul>\n<li>3: 扩展LV</li>\n</ul>\n<p> <code> lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv</code></p>\n<ul>\n<li>4: 刷新</li>\n</ul>\n<p> <code> resize2fs /dev/ubuntu-vg/ubuntu-lv</code></p>\n<p><code>&#123;% note info %&#125;NOTE:```\nP.S 如果碰到 xfs 提示 xfs_growfs: /dev/centos/root is not a mounted XFS filesystem\n因为不同的文件格式刷新的方式不同。\n对于 xfs : ```xfs_growfs + 挂载点```\n对于 ext2/3/4: ```resize2fs + 挂载点```\n```&#123;% endnote %&#125;</code></p>\n<ul>\n<li>确认文件系统格式和挂载点</li>\n</ul>\n<p><code> df -Thl</code><br><img src=\"/images/004.lvm.md.02.png\" alt=\"df -Thl\"><br><code>lsblk</code><br><img src=\"/images/004.lvm.md.03.png\" alt=\"lsblk\"></p>\n<h2 id=\"情形三-一块磁盘做成lvm单独挂载某个目录\"><a href=\"#情形三-一块磁盘做成lvm单独挂载某个目录\" class=\"headerlink\" title=\"情形三: 一块磁盘做成lvm单独挂载某个目录\"></a>情形三: 一块磁盘做成lvm单独挂载某个目录</h2><p>将新磁盘分成两个区,一个挂载&#x2F;data; 一个挂载&#x2F;var&#x2F;lib&#x2F;docker</p>\n<p><img src=\"/images/004.lvm.md.04.png\" alt=\"图\"></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建 pv</span></span><br><span class=\"line\"><span class=\"string\">pvcreate</span> <span class=\"string\">/dev/sdb1</span>   </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建 vg0</span></span><br><span class=\"line\"><span class=\"string\">vgcreate</span> <span class=\"string\">vg0</span> <span class=\"string\">/dev/sdb1</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建 lv0 和 lv1</span></span><br><span class=\"line\"><span class=\"string\">lvcreate</span>  <span class=\"string\">-l</span> <span class=\"number\">50</span><span class=\"string\">%FREE</span> <span class=\"string\">-n</span> <span class=\"string\">lv0</span> <span class=\"string\">vg0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">lvcreate</span>  <span class=\"string\">-l</span> <span class=\"number\">100</span><span class=\"string\">%FREE</span> <span class=\"string\">-n</span> <span class=\"string\">lv1</span> <span class=\"string\">vg0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 格式化</span></span><br><span class=\"line\"><span class=\"string\">mkfs.xfs</span> <span class=\"string\">/dev/vg0/lv0</span></span><br><span class=\"line\"><span class=\"string\">mkfs.xfs</span> <span class=\"string\">/dev/vg0/lv0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 挂载</span></span><br><span class=\"line\"><span class=\"string\">echo</span> <span class=\"string\">&quot;/dev/vg0/lv0 /data/  xfs  defaults   0 0&quot;</span>  <span class=\"string\">&gt;&gt;</span> <span class=\"string\">/etc/fstab</span></span><br><span class=\"line\"><span class=\"string\">echo</span> <span class=\"string\">&quot;/dev/vg0/lv1 /var/lib/docker  xfs  defaults   0 0&quot;</span>  <span class=\"string\">&gt;&gt;</span> <span class=\"string\">/etc/fstab</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"ElasticSearch部署","date":"2022-02-17T09:30:08.000Z","_content":"\n>Elasticsearch 是一个分布式的免费开源搜索和分析引擎，适用于包括文本、数字、地理空间、结构化和非结构化数据等在内的所有类型的数据。 Elasticsearch 在Apache Lucene 的基础上开发而成，由Elasticsearch N.V. （即现在的Elastic）于2010 年首次发布。\n官方文档https://www.elastic.co/guide/en/elastic-stack/index.html\n\n**搭建环境:  CentOS7.9(vm) ;  ElasticSearch5.6.7  ; Java1.8.0_321**\n**值得说一下, 不同的方式安装会遇到不同的问题, 这里我们采用两种方式 : rpm 和 tar两种方式安装**\n\n##  一 、rpm 包部署方式\n### Java环境 安装\n1) 下载jdk \n选择合适的版本下载(需要登陆Oracle) : https://www.oracle.com/java/technologies/downloads/\n这里我们选择 rpm 包\n![image.png](/images/005.elasticsearch.md.01.png)\n\n2) win下上传至 centos7\n``` scp jdk-8u321-linux-x64.rpm root@192.168.8.132:/root ```\n![image.png](/images/005.elasticsearch.md.02.png)\n\n3) 安装 \n``` rpm -ivh jdk-8u321-linux-x64.rpm```\n4) 配置Java环境\n刚安装完成后会有个临时java环境, 将其永久生效\n编辑文件 ``` vim /etc/profile ```\n文件末尾添加如下:\n```export JAVA_HOME=/usr/bin/```\n```export PATH=$JAVA_HOME/:$PATH```\n\n其实并不需要```$CLASSPTAH``` , 我们后面在说\n5) 验证Java环境\n```java -version``` OR ``` javac```\n看到有输出就OK了\n![image.png](/images/005.elasticsearch.md.03.png)\n\n### ElasticSearch 安装\n较新版本的ElasticSearch 会自带Java环境. 注意下载合适的版本\n\n1) 下载ElasticSearch \nhttps://www.elastic.co/cn/downloads/past-releases/elasticsearch-5-6-7\n![image.png](/images/005.elasticsearch.md.04.png)\n\n2) 上传到centos7\n```scp elasticsearch-5.6.7.rpm root@192.168.132:/root```\n3) 安装 ElasticSearch \n``` rpm -ivh elasticsearch-5.6.7.rpm```\n4) 使用 systemd 管理 elasticsearch\n``` systemctl  daemon-reload ```\n``` systemctl  enable elasticsearch-service ```\n5) 运行 elasticsearch\n``` systemctl start elasticsearch ```\n6) 测试运行\n``` curl localhost:9200 ```\n看到如下输入表示成功运行\n![image.png](/images/005.elasticsearch.md.05.png)\n\n#### P.S \n* 这里使用 ```systemctl start elasticsearch``` 并不是使用root用户去运行的.\n使用 ``` htop ``` 看一下可以看到实际运行的用户就是 elasticsearch\n![image.png](/images/005.elasticsearch.md.06.png)\n\n* 可能遇到 no java in(/usr/local...)等问题\n如果使用的是tar安装的配置的java环境, 那么 elasticsearch的运行用户是没有java环境的. \n\n#### 建议 Java 和 elasticsearch 保持相同安装方式. 都使用 rpm 包或者 tar包. \n\n## 二、tar 包部署方式\n\n1) Java 和 elasticsearch 下载\n[Java 下载](https://www.oracle.com/java/technologies/downloads/)\n[elasticsearch 下载](https://www.elastic.co/cn/downloads/past-releases/elasticsearch-5-6-7)\n\n2) 解压\n``` tar -zxvf /*tar```\n\n3) 为 elasticsearch  创建用户\n``` groupadd es ```\n``` useradd es -g es ```\n``` passwd es ```\n上述操作在 root 用户下完成\n(如果不创建密码的话, 该用户没有bash权限的, 影响下面调用java环境)\n\n4) 配置java环境\n编辑文件``` vim /etc/profile```\n文件末尾追加:\n```export JAVA_HOME=/jdk解压目录/jdk1.8.0_321/bin```\n```export PATH=$JAVA_HOME/:$PATH```\n\n* 上述操作是为root用户添加了Java环境\n\n为es 用户添加环境\n编辑文件 ``` vim /home/es/.bash_profile```\n文件末尾追加:\n```export JAVA_HOME=/jdk解压目录/jdk1.8.0_321/bin```\n```export PATH=$JAVA_HOME/:$PATH```\n\n5) 使用 es 用户 启动 elasticsearch\n``` su es ```\n``` ./elasticsearch安装目录/bin/elasticsearch```\n\n相关文档:\nelasticsearch5.6.7 https://www.elastic.co/guide/en/elasticsearch/reference/5.6/rpm.html\nsystemd https://yo.zgserver.com/systemd-19.html\n ####### 有问题可留言...\n\n\n ## 常见报错以及相关解决办法\n\n### 1. 安装完readonlyrest重启elasticsearch报错\n\n - elasticsearch.yml里关掉xpack\n ``` xpace.security.enabled: false ```\n ![images](/images/005.elasticsearch.md.07.png)\n\n### 2. elasticsearch-plugin安装插件或者操作提示could not find java in JAVA_HOME at xxxxxx\n\n- 即使是root权限, 安装插件的时候也加上sudo\n ![images](/images/005.elasticsearch.md.08.png)","source":"_posts/005.elasticsearch.md","raw":"---\ntitle: ElasticSearch部署\ndate: 2022-02-17 17:30:08\ncategories: \n- [Linux]\n- [CentOS]\ntags: elasticsearch\n---\n\n>Elasticsearch 是一个分布式的免费开源搜索和分析引擎，适用于包括文本、数字、地理空间、结构化和非结构化数据等在内的所有类型的数据。 Elasticsearch 在Apache Lucene 的基础上开发而成，由Elasticsearch N.V. （即现在的Elastic）于2010 年首次发布。\n官方文档https://www.elastic.co/guide/en/elastic-stack/index.html\n\n**搭建环境:  CentOS7.9(vm) ;  ElasticSearch5.6.7  ; Java1.8.0_321**\n**值得说一下, 不同的方式安装会遇到不同的问题, 这里我们采用两种方式 : rpm 和 tar两种方式安装**\n\n##  一 、rpm 包部署方式\n### Java环境 安装\n1) 下载jdk \n选择合适的版本下载(需要登陆Oracle) : https://www.oracle.com/java/technologies/downloads/\n这里我们选择 rpm 包\n![image.png](/images/005.elasticsearch.md.01.png)\n\n2) win下上传至 centos7\n``` scp jdk-8u321-linux-x64.rpm root@192.168.8.132:/root ```\n![image.png](/images/005.elasticsearch.md.02.png)\n\n3) 安装 \n``` rpm -ivh jdk-8u321-linux-x64.rpm```\n4) 配置Java环境\n刚安装完成后会有个临时java环境, 将其永久生效\n编辑文件 ``` vim /etc/profile ```\n文件末尾添加如下:\n```export JAVA_HOME=/usr/bin/```\n```export PATH=$JAVA_HOME/:$PATH```\n\n其实并不需要```$CLASSPTAH``` , 我们后面在说\n5) 验证Java环境\n```java -version``` OR ``` javac```\n看到有输出就OK了\n![image.png](/images/005.elasticsearch.md.03.png)\n\n### ElasticSearch 安装\n较新版本的ElasticSearch 会自带Java环境. 注意下载合适的版本\n\n1) 下载ElasticSearch \nhttps://www.elastic.co/cn/downloads/past-releases/elasticsearch-5-6-7\n![image.png](/images/005.elasticsearch.md.04.png)\n\n2) 上传到centos7\n```scp elasticsearch-5.6.7.rpm root@192.168.132:/root```\n3) 安装 ElasticSearch \n``` rpm -ivh elasticsearch-5.6.7.rpm```\n4) 使用 systemd 管理 elasticsearch\n``` systemctl  daemon-reload ```\n``` systemctl  enable elasticsearch-service ```\n5) 运行 elasticsearch\n``` systemctl start elasticsearch ```\n6) 测试运行\n``` curl localhost:9200 ```\n看到如下输入表示成功运行\n![image.png](/images/005.elasticsearch.md.05.png)\n\n#### P.S \n* 这里使用 ```systemctl start elasticsearch``` 并不是使用root用户去运行的.\n使用 ``` htop ``` 看一下可以看到实际运行的用户就是 elasticsearch\n![image.png](/images/005.elasticsearch.md.06.png)\n\n* 可能遇到 no java in(/usr/local...)等问题\n如果使用的是tar安装的配置的java环境, 那么 elasticsearch的运行用户是没有java环境的. \n\n#### 建议 Java 和 elasticsearch 保持相同安装方式. 都使用 rpm 包或者 tar包. \n\n## 二、tar 包部署方式\n\n1) Java 和 elasticsearch 下载\n[Java 下载](https://www.oracle.com/java/technologies/downloads/)\n[elasticsearch 下载](https://www.elastic.co/cn/downloads/past-releases/elasticsearch-5-6-7)\n\n2) 解压\n``` tar -zxvf /*tar```\n\n3) 为 elasticsearch  创建用户\n``` groupadd es ```\n``` useradd es -g es ```\n``` passwd es ```\n上述操作在 root 用户下完成\n(如果不创建密码的话, 该用户没有bash权限的, 影响下面调用java环境)\n\n4) 配置java环境\n编辑文件``` vim /etc/profile```\n文件末尾追加:\n```export JAVA_HOME=/jdk解压目录/jdk1.8.0_321/bin```\n```export PATH=$JAVA_HOME/:$PATH```\n\n* 上述操作是为root用户添加了Java环境\n\n为es 用户添加环境\n编辑文件 ``` vim /home/es/.bash_profile```\n文件末尾追加:\n```export JAVA_HOME=/jdk解压目录/jdk1.8.0_321/bin```\n```export PATH=$JAVA_HOME/:$PATH```\n\n5) 使用 es 用户 启动 elasticsearch\n``` su es ```\n``` ./elasticsearch安装目录/bin/elasticsearch```\n\n相关文档:\nelasticsearch5.6.7 https://www.elastic.co/guide/en/elasticsearch/reference/5.6/rpm.html\nsystemd https://yo.zgserver.com/systemd-19.html\n ####### 有问题可留言...\n\n\n ## 常见报错以及相关解决办法\n\n### 1. 安装完readonlyrest重启elasticsearch报错\n\n - elasticsearch.yml里关掉xpack\n ``` xpace.security.enabled: false ```\n ![images](/images/005.elasticsearch.md.07.png)\n\n### 2. elasticsearch-plugin安装插件或者操作提示could not find java in JAVA_HOME at xxxxxx\n\n- 即使是root权限, 安装插件的时候也加上sudo\n ![images](/images/005.elasticsearch.md.08.png)","slug":"005.elasticsearch","published":1,"updated":"2023-12-05T08:52:30.874Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtz90000bijnrd6vz57hk","content":"<blockquote>\n<p>Elasticsearch 是一个分布式的免费开源搜索和分析引擎，适用于包括文本、数字、地理空间、结构化和非结构化数据等在内的所有类型的数据。 Elasticsearch 在Apache Lucene 的基础上开发而成，由Elasticsearch N.V. （即现在的Elastic）于2010 年首次发布。<br>官方文档<a href=\"https://www.elastic.co/guide/en/elastic-stack/index.html\">https://www.elastic.co/guide/en/elastic-stack/index.html</a></p>\n</blockquote>\n<p><strong>搭建环境:  CentOS7.9(vm) ;  ElasticSearch5.6.7  ; Java1.8.0_321</strong><br><strong>值得说一下, 不同的方式安装会遇到不同的问题, 这里我们采用两种方式 : rpm 和 tar两种方式安装</strong></p>\n<h2 id=\"一-、rpm-包部署方式\"><a href=\"#一-、rpm-包部署方式\" class=\"headerlink\" title=\"一 、rpm 包部署方式\"></a>一 、rpm 包部署方式</h2><h3 id=\"Java环境-安装\"><a href=\"#Java环境-安装\" class=\"headerlink\" title=\"Java环境 安装\"></a>Java环境 安装</h3><ol>\n<li><p>下载jdk<br>选择合适的版本下载(需要登陆Oracle) : <a href=\"https://www.oracle.com/java/technologies/downloads/\">https://www.oracle.com/java/technologies/downloads/</a><br>这里我们选择 rpm 包<br><img src=\"/images/005.elasticsearch.md.01.png\" alt=\"image.png\"></p>\n</li>\n<li><p>win下上传至 centos7</p>\n</li>\n</ol>\n<p><code>scp jdk-8u321-linux-x64.rpm root@192.168.8.132:/root</code><br><img src=\"/images/005.elasticsearch.md.02.png\" alt=\"image.png\"></p>\n<ol start=\"3\">\n<li>安装</li>\n</ol>\n<p><code> rpm -ivh jdk-8u321-linux-x64.rpm</code><br>4) 配置Java环境<br>刚安装完成后会有个临时java环境, 将其永久生效<br>编辑文件 <code>vim /etc/profile</code><br>文件末尾添加如下:<br><code>export JAVA_HOME=/usr/bin/</code><br><code>export PATH=$JAVA_HOME/:$PATH</code></p>\n<p>其实并不需要<code>$CLASSPTAH</code> , 我们后面在说<br>5) 验证Java环境<br><code>java -version</code> OR <code> javac</code><br>看到有输出就OK了<br><img src=\"/images/005.elasticsearch.md.03.png\" alt=\"image.png\"></p>\n<h3 id=\"ElasticSearch-安装\"><a href=\"#ElasticSearch-安装\" class=\"headerlink\" title=\"ElasticSearch 安装\"></a>ElasticSearch 安装</h3><p>较新版本的ElasticSearch 会自带Java环境. 注意下载合适的版本</p>\n<ol>\n<li><p>下载ElasticSearch<br><a href=\"https://www.elastic.co/cn/downloads/past-releases/elasticsearch-5-6-7\">https://www.elastic.co/cn/downloads/past-releases/elasticsearch-5-6-7</a><br><img src=\"/images/005.elasticsearch.md.04.png\" alt=\"image.png\"></p>\n</li>\n<li><p>上传到centos7</p>\n</li>\n</ol>\n<p><code>scp elasticsearch-5.6.7.rpm root@192.168.132:/root</code><br>3) 安装 ElasticSearch<br><code> rpm -ivh elasticsearch-5.6.7.rpm</code><br>4) 使用 systemd 管理 elasticsearch<br><code>systemctl  daemon-reload</code><br><code>systemctl  enable elasticsearch-service</code><br>5) 运行 elasticsearch<br><code>systemctl start elasticsearch</code><br>6) 测试运行<br><code>curl localhost:9200</code><br>看到如下输入表示成功运行<br><img src=\"/images/005.elasticsearch.md.05.png\" alt=\"image.png\"></p>\n<h4 id=\"P-S\"><a href=\"#P-S\" class=\"headerlink\" title=\"P.S\"></a>P.S</h4><ul>\n<li>这里使用 <code>systemctl start elasticsearch</code> 并不是使用root用户去运行的.<br>使用 <code>htop</code> 看一下可以看到实际运行的用户就是 elasticsearch</li>\n</ul>\n<p><img src=\"/images/005.elasticsearch.md.06.png\" alt=\"image.png\"></p>\n<ul>\n<li>可能遇到 no java in(&#x2F;usr&#x2F;local…)等问题<br>如果使用的是tar安装的配置的java环境, 那么 elasticsearch的运行用户是没有java环境的.</li>\n</ul>\n<h4 id=\"建议-Java-和-elasticsearch-保持相同安装方式-都使用-rpm-包或者-tar包\"><a href=\"#建议-Java-和-elasticsearch-保持相同安装方式-都使用-rpm-包或者-tar包\" class=\"headerlink\" title=\"建议 Java 和 elasticsearch 保持相同安装方式. 都使用 rpm 包或者 tar包.\"></a>建议 Java 和 elasticsearch 保持相同安装方式. 都使用 rpm 包或者 tar包.</h4><h2 id=\"二、tar-包部署方式\"><a href=\"#二、tar-包部署方式\" class=\"headerlink\" title=\"二、tar 包部署方式\"></a>二、tar 包部署方式</h2><ol>\n<li><p>Java 和 elasticsearch 下载<br><a href=\"https://www.oracle.com/java/technologies/downloads/\">Java 下载</a><br><a href=\"https://www.elastic.co/cn/downloads/past-releases/elasticsearch-5-6-7\">elasticsearch 下载</a></p>\n</li>\n<li><p>解压</p>\n</li>\n</ol>\n<p><code> tar -zxvf /*tar</code></p>\n<ol start=\"3\">\n<li>为 elasticsearch  创建用户</li>\n</ol>\n<p><code>groupadd es</code><br><code>useradd es -g es</code><br><code>passwd es</code><br>上述操作在 root 用户下完成<br>(如果不创建密码的话, 该用户没有bash权限的, 影响下面调用java环境)</p>\n<ol start=\"4\">\n<li>配置java环境<br>编辑文件<code> vim /etc/profile</code><br>文件末尾追加:</li>\n</ol>\n<p><code>export JAVA_HOME=/jdk解压目录/jdk1.8.0_321/bin</code><br><code>export PATH=$JAVA_HOME/:$PATH</code></p>\n<ul>\n<li>上述操作是为root用户添加了Java环境</li>\n</ul>\n<p>为es 用户添加环境<br>编辑文件 <code> vim /home/es/.bash_profile</code><br>文件末尾追加:<br><code>export JAVA_HOME=/jdk解压目录/jdk1.8.0_321/bin</code><br><code>export PATH=$JAVA_HOME/:$PATH</code></p>\n<ol start=\"5\">\n<li>使用 es 用户 启动 elasticsearch</li>\n</ol>\n<p><code>su es</code><br><code> ./elasticsearch安装目录/bin/elasticsearch</code></p>\n<p>相关文档:<br>elasticsearch5.6.7 <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/5.6/rpm.html\">https://www.elastic.co/guide/en/elasticsearch/reference/5.6/rpm.html</a><br>systemd <a href=\"https://yo.zgserver.com/systemd-19.html\">https://yo.zgserver.com/systemd-19.html</a><br> ####### 有问题可留言…</p>\n<h2 id=\"常见报错以及相关解决办法\"><a href=\"#常见报错以及相关解决办法\" class=\"headerlink\" title=\"常见报错以及相关解决办法\"></a>常见报错以及相关解决办法</h2><h3 id=\"1-安装完readonlyrest重启elasticsearch报错\"><a href=\"#1-安装完readonlyrest重启elasticsearch报错\" class=\"headerlink\" title=\"1. 安装完readonlyrest重启elasticsearch报错\"></a>1. 安装完readonlyrest重启elasticsearch报错</h3><ul>\n<li>elasticsearch.yml里关掉xpack</li>\n</ul>\n<p> <code>xpace.security.enabled: false</code><br> <img src=\"/images/005.elasticsearch.md.07.png\" alt=\"images\"></p>\n<h3 id=\"2-elasticsearch-plugin安装插件或者操作提示could-not-find-java-in-JAVA-HOME-at-xxxxxx\"><a href=\"#2-elasticsearch-plugin安装插件或者操作提示could-not-find-java-in-JAVA-HOME-at-xxxxxx\" class=\"headerlink\" title=\"2. elasticsearch-plugin安装插件或者操作提示could not find java in JAVA_HOME at xxxxxx\"></a>2. elasticsearch-plugin安装插件或者操作提示could not find java in JAVA_HOME at xxxxxx</h3><ul>\n<li>即使是root权限, 安装插件的时候也加上sudo<br> <img src=\"/images/005.elasticsearch.md.08.png\" alt=\"images\"></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>Elasticsearch 是一个分布式的免费开源搜索和分析引擎，适用于包括文本、数字、地理空间、结构化和非结构化数据等在内的所有类型的数据。 Elasticsearch 在Apache Lucene 的基础上开发而成，由Elasticsearch N.V. （即现在的Elastic）于2010 年首次发布。<br>官方文档<a href=\"https://www.elastic.co/guide/en/elastic-stack/index.html\">https://www.elastic.co/guide/en/elastic-stack/index.html</a></p>\n</blockquote>\n<p><strong>搭建环境:  CentOS7.9(vm) ;  ElasticSearch5.6.7  ; Java1.8.0_321</strong><br><strong>值得说一下, 不同的方式安装会遇到不同的问题, 这里我们采用两种方式 : rpm 和 tar两种方式安装</strong></p>\n<h2 id=\"一-、rpm-包部署方式\"><a href=\"#一-、rpm-包部署方式\" class=\"headerlink\" title=\"一 、rpm 包部署方式\"></a>一 、rpm 包部署方式</h2><h3 id=\"Java环境-安装\"><a href=\"#Java环境-安装\" class=\"headerlink\" title=\"Java环境 安装\"></a>Java环境 安装</h3><ol>\n<li><p>下载jdk<br>选择合适的版本下载(需要登陆Oracle) : <a href=\"https://www.oracle.com/java/technologies/downloads/\">https://www.oracle.com/java/technologies/downloads/</a><br>这里我们选择 rpm 包<br><img src=\"/images/005.elasticsearch.md.01.png\" alt=\"image.png\"></p>\n</li>\n<li><p>win下上传至 centos7</p>\n</li>\n</ol>\n<p><code>scp jdk-8u321-linux-x64.rpm root@192.168.8.132:/root</code><br><img src=\"/images/005.elasticsearch.md.02.png\" alt=\"image.png\"></p>\n<ol start=\"3\">\n<li>安装</li>\n</ol>\n<p><code> rpm -ivh jdk-8u321-linux-x64.rpm</code><br>4) 配置Java环境<br>刚安装完成后会有个临时java环境, 将其永久生效<br>编辑文件 <code>vim /etc/profile</code><br>文件末尾添加如下:<br><code>export JAVA_HOME=/usr/bin/</code><br><code>export PATH=$JAVA_HOME/:$PATH</code></p>\n<p>其实并不需要<code>$CLASSPTAH</code> , 我们后面在说<br>5) 验证Java环境<br><code>java -version</code> OR <code> javac</code><br>看到有输出就OK了<br><img src=\"/images/005.elasticsearch.md.03.png\" alt=\"image.png\"></p>\n<h3 id=\"ElasticSearch-安装\"><a href=\"#ElasticSearch-安装\" class=\"headerlink\" title=\"ElasticSearch 安装\"></a>ElasticSearch 安装</h3><p>较新版本的ElasticSearch 会自带Java环境. 注意下载合适的版本</p>\n<ol>\n<li><p>下载ElasticSearch<br><a href=\"https://www.elastic.co/cn/downloads/past-releases/elasticsearch-5-6-7\">https://www.elastic.co/cn/downloads/past-releases/elasticsearch-5-6-7</a><br><img src=\"/images/005.elasticsearch.md.04.png\" alt=\"image.png\"></p>\n</li>\n<li><p>上传到centos7</p>\n</li>\n</ol>\n<p><code>scp elasticsearch-5.6.7.rpm root@192.168.132:/root</code><br>3) 安装 ElasticSearch<br><code> rpm -ivh elasticsearch-5.6.7.rpm</code><br>4) 使用 systemd 管理 elasticsearch<br><code>systemctl  daemon-reload</code><br><code>systemctl  enable elasticsearch-service</code><br>5) 运行 elasticsearch<br><code>systemctl start elasticsearch</code><br>6) 测试运行<br><code>curl localhost:9200</code><br>看到如下输入表示成功运行<br><img src=\"/images/005.elasticsearch.md.05.png\" alt=\"image.png\"></p>\n<h4 id=\"P-S\"><a href=\"#P-S\" class=\"headerlink\" title=\"P.S\"></a>P.S</h4><ul>\n<li>这里使用 <code>systemctl start elasticsearch</code> 并不是使用root用户去运行的.<br>使用 <code>htop</code> 看一下可以看到实际运行的用户就是 elasticsearch</li>\n</ul>\n<p><img src=\"/images/005.elasticsearch.md.06.png\" alt=\"image.png\"></p>\n<ul>\n<li>可能遇到 no java in(&#x2F;usr&#x2F;local…)等问题<br>如果使用的是tar安装的配置的java环境, 那么 elasticsearch的运行用户是没有java环境的.</li>\n</ul>\n<h4 id=\"建议-Java-和-elasticsearch-保持相同安装方式-都使用-rpm-包或者-tar包\"><a href=\"#建议-Java-和-elasticsearch-保持相同安装方式-都使用-rpm-包或者-tar包\" class=\"headerlink\" title=\"建议 Java 和 elasticsearch 保持相同安装方式. 都使用 rpm 包或者 tar包.\"></a>建议 Java 和 elasticsearch 保持相同安装方式. 都使用 rpm 包或者 tar包.</h4><h2 id=\"二、tar-包部署方式\"><a href=\"#二、tar-包部署方式\" class=\"headerlink\" title=\"二、tar 包部署方式\"></a>二、tar 包部署方式</h2><ol>\n<li><p>Java 和 elasticsearch 下载<br><a href=\"https://www.oracle.com/java/technologies/downloads/\">Java 下载</a><br><a href=\"https://www.elastic.co/cn/downloads/past-releases/elasticsearch-5-6-7\">elasticsearch 下载</a></p>\n</li>\n<li><p>解压</p>\n</li>\n</ol>\n<p><code> tar -zxvf /*tar</code></p>\n<ol start=\"3\">\n<li>为 elasticsearch  创建用户</li>\n</ol>\n<p><code>groupadd es</code><br><code>useradd es -g es</code><br><code>passwd es</code><br>上述操作在 root 用户下完成<br>(如果不创建密码的话, 该用户没有bash权限的, 影响下面调用java环境)</p>\n<ol start=\"4\">\n<li>配置java环境<br>编辑文件<code> vim /etc/profile</code><br>文件末尾追加:</li>\n</ol>\n<p><code>export JAVA_HOME=/jdk解压目录/jdk1.8.0_321/bin</code><br><code>export PATH=$JAVA_HOME/:$PATH</code></p>\n<ul>\n<li>上述操作是为root用户添加了Java环境</li>\n</ul>\n<p>为es 用户添加环境<br>编辑文件 <code> vim /home/es/.bash_profile</code><br>文件末尾追加:<br><code>export JAVA_HOME=/jdk解压目录/jdk1.8.0_321/bin</code><br><code>export PATH=$JAVA_HOME/:$PATH</code></p>\n<ol start=\"5\">\n<li>使用 es 用户 启动 elasticsearch</li>\n</ol>\n<p><code>su es</code><br><code> ./elasticsearch安装目录/bin/elasticsearch</code></p>\n<p>相关文档:<br>elasticsearch5.6.7 <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/5.6/rpm.html\">https://www.elastic.co/guide/en/elasticsearch/reference/5.6/rpm.html</a><br>systemd <a href=\"https://yo.zgserver.com/systemd-19.html\">https://yo.zgserver.com/systemd-19.html</a><br> ####### 有问题可留言…</p>\n<h2 id=\"常见报错以及相关解决办法\"><a href=\"#常见报错以及相关解决办法\" class=\"headerlink\" title=\"常见报错以及相关解决办法\"></a>常见报错以及相关解决办法</h2><h3 id=\"1-安装完readonlyrest重启elasticsearch报错\"><a href=\"#1-安装完readonlyrest重启elasticsearch报错\" class=\"headerlink\" title=\"1. 安装完readonlyrest重启elasticsearch报错\"></a>1. 安装完readonlyrest重启elasticsearch报错</h3><ul>\n<li>elasticsearch.yml里关掉xpack</li>\n</ul>\n<p> <code>xpace.security.enabled: false</code><br> <img src=\"/images/005.elasticsearch.md.07.png\" alt=\"images\"></p>\n<h3 id=\"2-elasticsearch-plugin安装插件或者操作提示could-not-find-java-in-JAVA-HOME-at-xxxxxx\"><a href=\"#2-elasticsearch-plugin安装插件或者操作提示could-not-find-java-in-JAVA-HOME-at-xxxxxx\" class=\"headerlink\" title=\"2. elasticsearch-plugin安装插件或者操作提示could not find java in JAVA_HOME at xxxxxx\"></a>2. elasticsearch-plugin安装插件或者操作提示could not find java in JAVA_HOME at xxxxxx</h3><ul>\n<li>即使是root权限, 安装插件的时候也加上sudo<br> <img src=\"/images/005.elasticsearch.md.08.png\" alt=\"images\"></li>\n</ul>\n"},{"title":"iptables基本操作","date":"2022-02-16T03:11:08.000Z","_content":"\n\n# [引言](https://www.jianshu.com/p/70f7efe3a227)\n**从Cent7以后，iptables服务的启动脚本已被忽略。请使用firewalld来取代iptables服务。**\n\n>在RHEL7里，默认是使用firewalld来管理netfilter子系统，不过底层调用的命令仍然是iptables。\nfirewalld是iptables的前端控制器，用于实现持久的网络流量规则。它提供命令行和图形界面。\n\n**firewalld 与 iptables的比较：**\n\n> - firewalld可以动态修改单条规则，动态管理规则集，允许更新规则而不破坏现有会话和连接。而iptables，在修改了规则后必须得全部刷新才可以生效；\n> - firewalld使用区域和服务而不是链式规则；\n> - ```firewalld默认是拒绝的```，需要设置以后才能放行。而```iptables默认是允许的```，需要拒绝的才去限制；\n> - firewalld自身并不具备防火墙的功能，而是和iptables一样需要通过内核的netfilter来实现。也就是说，firewalld和iptables一样，它们的作用都用于维护规则，而真正使用规则干活的是内核的netfilter。只不过firewalld和iptables的结果以及使用方法不一样！\n\n**firewalld是iptables的一个封装，可以让你更容易地管理iptables规则。它并不是iptables的替代品，虽然iptables命令仍可用于firewalld，但建议firewalld时仅使用firewalld命令。**\n\n# 一、 安装\n\n## 1.1 关闭 firewalld\n``` systemctr disable firewalld```\n``` systemctl stop firewalld```\n\n## 1.2 安装 iptalbes\n``` yum install iptables iptables-services```\n\n## 1.3 启用 iptables\n``` systemctl enable iptables```\n``` systemctl start iptables ```\n\n## 1.4 备份 iptables\n``` cp /etc/sysconfig/iptables /etc/sysconfig/iptables-backup```\n\n# 二、 相关实例\n\n## 2.1 查看当前规则\n``` iptables -L -n -v --line-number```\n\n## 2.2 和详细内容(包含流量统计)\n``` iptables -nvL --line-number ```\n\n## 2.3 放行某个端口\n``` iptables -I INPUT -p tcp --dport 80 -j ACCEPT```\n``` iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT```\n\n## 2.4 允许某网段访问特定端口\n``` iptables -I INPUT -s 192.168.1.0/24 -p tcp --dport 80 -j ACCEPT```\n\n## 2.5 删除某条规则\n``` iptables -D INPUT 1```\n``` iptables -D FORWARD 1```\n\n## 2.6 指定某段ip地址\n\n``` iptables -I INPUT -p tcp --dport 80 -j DROP```\n``` iptables - I INPUT -m iprange --src-range 192.168.1.200-192.168.1-210 -p tcp --dport 80 -j ACCEPT ```\n\n## 2.7 修改某条规则\n``` iptables -R INPUT 5 -p tcp --dport 36878 -j ACCEPT ```\n\n## 2.8 设置默认策略\n``` iptables -P INPUT DROP ```\n``` iptables -P NAT REJECT ``` \n``` iptables -P OUTPUT ACCEPT ```\n\n## 保存更改\n\n{% tabs tab,1 %} 名字为tab，默认在第1个选项卡，如果是-1则隐藏\n<!-- tab CentOS 6 -->\n``` iptables-save```\n<!-- endtab -->\n<!-- tab CentOS 7-->\n``` iptables-save > /etc/sysconfig/iptables```\n<!-- endtab -->\n<!-- tab Ubuntu -->\n``` iptables-save > /etc/iptables/rule.v4```\n<!-- endtab -->\n{% endtabs %}\n\n\n暂时更新到这....\n2022/2/17\n\n# 三、 nat转发\n\n## 3.1 端口转发\n**192.168.1.7:7410  --->   192.168.1.160:9200**\n```iptables -t nat -A PREROUTING -d 192.168.1.7/32 -p tcp --dport 7410 -j DNAT --to-destination 192.168.1.160:9200```\n```iptables -t nat -A POSTROUTING -d 192.168.1.160/32 -p tcp --dport 9200 -j SNAT --to-source 192.168.1.7```\n\n## 3.2 删除nat中的规则\n``` iptables -t nat -D POSTROUTING 6 ```\n``` iptables -t nat -D PREROUTING 1 ```\n\n\n\n# 四、 iptables自定义链\n\n## 4.1 创建一条自定义链\n```iptables -t filter -N es_white_list```\n\n## 4.2 自定义链的规则\n``` bash\niptables -I es_white_list -j DROP\niptables -I es_white_list -s 172.22.67.31/32 -j ACCEPT\niptables -I es_white_list -s 172.22.67.32/32 -j ACCEPT\n```\n\n## 4.3 将自定义链的规则应用到某个端口\n``` bash\niptables -I INPUT -p tcp --dport 9200 -j es_white_list\niptables -I INPUT -p tcp --dport 9300 -j es_white_list\n``` \n\n4.1 + 4.2 + 4.3 --> 创建白名单```es_white_list``` 只有白名单里的ip地址可以访问该主机的9200和9200端口.\n\n# 五、 iptables删除自定义链\n\n## 5.1 清空链white_list里的规则\n``` iptables -t filter -F white_list ```\n\n\n## 5.2 删除链white_list\n``` iptables -t filter -X white_list ```\n\n\n报错: **iptables: Too many links.**\n原因: **该链仍在被使用, 删除使用该链的规则**\n![image.png](/images/006.iptables.md.02.png)\n\n删除引用**DOCKER-USER**的规则\n``` iptables -t filter -D FORWARD 1 ```\n![image.png](/images/006.iptables.md.03.png)\n\n\n\n# 六、 重置所有规则\n使用这些命令刷新和重置 iptables 到默认状态：\n\n``` bash\niptables -F\niptables -X\niptables -t nat -F\niptables -t nat -X\niptables -t mangle -F\niptables -t mangle -X\niptables -t raw -F\niptables -t raw -X\niptables -t security -F\niptables -t security -X\niptables -P INPUT ACCEPT\niptables -P FORWARD ACCEPT\niptables -P OUTPUT ACCEPT\n没有任何参数的 -F 命令在当前表中刷新所有链。同样的， -X 命令删除表中所有非默认链。\n```\n\n# 七、 初始状态\n{% label success@适用于CentOS 7%}\n``` bash\n# sample configuration for iptables service\n# you can edit this manually or use system-config-firewall\n# please do not ask us to add additional ports/services to this default configuration\n*filter\n:INPUT ACCEPT [0:0]\n:FORWARD ACCEPT [0:0]\n:OUTPUT ACCEPT [0:0]\n-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT\n-A INPUT -p icmp -j ACCEPT\n-A INPUT -i lo -j ACCEPT\n-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT\n-A INPUT -j REJECT --reject-with icmp-host-prohibited\n-A FORWARD -j REJECT --reject-with icmp-host-prohibited\nCOMMIT\n```\n\n\n### Ubuntu/Debian中的iptables\n\n\n在Debian/Ubuntu中使用iptables添加了规则, 即使使用iptables-save保存了规则也会在系统重启后失效. \n或者使用iptables-save保存到文件, 然后系统重启后执行iptables-restore恢复规则.\n\n```iptables-persistent``` 应运而生, 更好的iptables持久化方案.\n\n安装之后其配置文件如下:  ```/etc/iptables/rules.v4```    ```/etc/iptables/rules.v6```\n**区别于**CentOS中的 ```/etc/sysconfig/iptables ```\nDebian/Ubuntu下清空```/etc/iptables/rules.v4```文件内容, 不会影响已有规则, 甚至``` systemctl stop iptables ```也不会影响\nCentOS下清空 ```/etc/sysconfig/iptables ``` 或者``` systemctl stop iptables ```相当于关闭防火墙\n\n![image.png](/images/006.iptables.md.01.png)\n\n\n\n\n","source":"_posts/006.iptables.md","raw":"---\ntitle: iptables基本操作\ndate: 2022-02-16 11:11:08\ncategories: \n- [Linux]\n- [NetWork]\ntags: \n- iptables\n- firewalls\n---\n\n\n# [引言](https://www.jianshu.com/p/70f7efe3a227)\n**从Cent7以后，iptables服务的启动脚本已被忽略。请使用firewalld来取代iptables服务。**\n\n>在RHEL7里，默认是使用firewalld来管理netfilter子系统，不过底层调用的命令仍然是iptables。\nfirewalld是iptables的前端控制器，用于实现持久的网络流量规则。它提供命令行和图形界面。\n\n**firewalld 与 iptables的比较：**\n\n> - firewalld可以动态修改单条规则，动态管理规则集，允许更新规则而不破坏现有会话和连接。而iptables，在修改了规则后必须得全部刷新才可以生效；\n> - firewalld使用区域和服务而不是链式规则；\n> - ```firewalld默认是拒绝的```，需要设置以后才能放行。而```iptables默认是允许的```，需要拒绝的才去限制；\n> - firewalld自身并不具备防火墙的功能，而是和iptables一样需要通过内核的netfilter来实现。也就是说，firewalld和iptables一样，它们的作用都用于维护规则，而真正使用规则干活的是内核的netfilter。只不过firewalld和iptables的结果以及使用方法不一样！\n\n**firewalld是iptables的一个封装，可以让你更容易地管理iptables规则。它并不是iptables的替代品，虽然iptables命令仍可用于firewalld，但建议firewalld时仅使用firewalld命令。**\n\n# 一、 安装\n\n## 1.1 关闭 firewalld\n``` systemctr disable firewalld```\n``` systemctl stop firewalld```\n\n## 1.2 安装 iptalbes\n``` yum install iptables iptables-services```\n\n## 1.3 启用 iptables\n``` systemctl enable iptables```\n``` systemctl start iptables ```\n\n## 1.4 备份 iptables\n``` cp /etc/sysconfig/iptables /etc/sysconfig/iptables-backup```\n\n# 二、 相关实例\n\n## 2.1 查看当前规则\n``` iptables -L -n -v --line-number```\n\n## 2.2 和详细内容(包含流量统计)\n``` iptables -nvL --line-number ```\n\n## 2.3 放行某个端口\n``` iptables -I INPUT -p tcp --dport 80 -j ACCEPT```\n``` iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT```\n\n## 2.4 允许某网段访问特定端口\n``` iptables -I INPUT -s 192.168.1.0/24 -p tcp --dport 80 -j ACCEPT```\n\n## 2.5 删除某条规则\n``` iptables -D INPUT 1```\n``` iptables -D FORWARD 1```\n\n## 2.6 指定某段ip地址\n\n``` iptables -I INPUT -p tcp --dport 80 -j DROP```\n``` iptables - I INPUT -m iprange --src-range 192.168.1.200-192.168.1-210 -p tcp --dport 80 -j ACCEPT ```\n\n## 2.7 修改某条规则\n``` iptables -R INPUT 5 -p tcp --dport 36878 -j ACCEPT ```\n\n## 2.8 设置默认策略\n``` iptables -P INPUT DROP ```\n``` iptables -P NAT REJECT ``` \n``` iptables -P OUTPUT ACCEPT ```\n\n## 保存更改\n\n{% tabs tab,1 %} 名字为tab，默认在第1个选项卡，如果是-1则隐藏\n<!-- tab CentOS 6 -->\n``` iptables-save```\n<!-- endtab -->\n<!-- tab CentOS 7-->\n``` iptables-save > /etc/sysconfig/iptables```\n<!-- endtab -->\n<!-- tab Ubuntu -->\n``` iptables-save > /etc/iptables/rule.v4```\n<!-- endtab -->\n{% endtabs %}\n\n\n暂时更新到这....\n2022/2/17\n\n# 三、 nat转发\n\n## 3.1 端口转发\n**192.168.1.7:7410  --->   192.168.1.160:9200**\n```iptables -t nat -A PREROUTING -d 192.168.1.7/32 -p tcp --dport 7410 -j DNAT --to-destination 192.168.1.160:9200```\n```iptables -t nat -A POSTROUTING -d 192.168.1.160/32 -p tcp --dport 9200 -j SNAT --to-source 192.168.1.7```\n\n## 3.2 删除nat中的规则\n``` iptables -t nat -D POSTROUTING 6 ```\n``` iptables -t nat -D PREROUTING 1 ```\n\n\n\n# 四、 iptables自定义链\n\n## 4.1 创建一条自定义链\n```iptables -t filter -N es_white_list```\n\n## 4.2 自定义链的规则\n``` bash\niptables -I es_white_list -j DROP\niptables -I es_white_list -s 172.22.67.31/32 -j ACCEPT\niptables -I es_white_list -s 172.22.67.32/32 -j ACCEPT\n```\n\n## 4.3 将自定义链的规则应用到某个端口\n``` bash\niptables -I INPUT -p tcp --dport 9200 -j es_white_list\niptables -I INPUT -p tcp --dport 9300 -j es_white_list\n``` \n\n4.1 + 4.2 + 4.3 --> 创建白名单```es_white_list``` 只有白名单里的ip地址可以访问该主机的9200和9200端口.\n\n# 五、 iptables删除自定义链\n\n## 5.1 清空链white_list里的规则\n``` iptables -t filter -F white_list ```\n\n\n## 5.2 删除链white_list\n``` iptables -t filter -X white_list ```\n\n\n报错: **iptables: Too many links.**\n原因: **该链仍在被使用, 删除使用该链的规则**\n![image.png](/images/006.iptables.md.02.png)\n\n删除引用**DOCKER-USER**的规则\n``` iptables -t filter -D FORWARD 1 ```\n![image.png](/images/006.iptables.md.03.png)\n\n\n\n# 六、 重置所有规则\n使用这些命令刷新和重置 iptables 到默认状态：\n\n``` bash\niptables -F\niptables -X\niptables -t nat -F\niptables -t nat -X\niptables -t mangle -F\niptables -t mangle -X\niptables -t raw -F\niptables -t raw -X\niptables -t security -F\niptables -t security -X\niptables -P INPUT ACCEPT\niptables -P FORWARD ACCEPT\niptables -P OUTPUT ACCEPT\n没有任何参数的 -F 命令在当前表中刷新所有链。同样的， -X 命令删除表中所有非默认链。\n```\n\n# 七、 初始状态\n{% label success@适用于CentOS 7%}\n``` bash\n# sample configuration for iptables service\n# you can edit this manually or use system-config-firewall\n# please do not ask us to add additional ports/services to this default configuration\n*filter\n:INPUT ACCEPT [0:0]\n:FORWARD ACCEPT [0:0]\n:OUTPUT ACCEPT [0:0]\n-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT\n-A INPUT -p icmp -j ACCEPT\n-A INPUT -i lo -j ACCEPT\n-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT\n-A INPUT -j REJECT --reject-with icmp-host-prohibited\n-A FORWARD -j REJECT --reject-with icmp-host-prohibited\nCOMMIT\n```\n\n\n### Ubuntu/Debian中的iptables\n\n\n在Debian/Ubuntu中使用iptables添加了规则, 即使使用iptables-save保存了规则也会在系统重启后失效. \n或者使用iptables-save保存到文件, 然后系统重启后执行iptables-restore恢复规则.\n\n```iptables-persistent``` 应运而生, 更好的iptables持久化方案.\n\n安装之后其配置文件如下:  ```/etc/iptables/rules.v4```    ```/etc/iptables/rules.v6```\n**区别于**CentOS中的 ```/etc/sysconfig/iptables ```\nDebian/Ubuntu下清空```/etc/iptables/rules.v4```文件内容, 不会影响已有规则, 甚至``` systemctl stop iptables ```也不会影响\nCentOS下清空 ```/etc/sysconfig/iptables ``` 或者``` systemctl stop iptables ```相当于关闭防火墙\n\n![image.png](/images/006.iptables.md.01.png)\n\n\n\n\n","slug":"006.iptables","published":1,"updated":"2023-12-05T08:52:30.874Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtz9b000gijnr0faaeytq","content":"<h1 id=\"引言\"><a href=\"#引言\" class=\"headerlink\" title=\"引言\"></a><a href=\"https://www.jianshu.com/p/70f7efe3a227\">引言</a></h1><p><strong>从Cent7以后，iptables服务的启动脚本已被忽略。请使用firewalld来取代iptables服务。</strong></p>\n<blockquote>\n<p>在RHEL7里，默认是使用firewalld来管理netfilter子系统，不过底层调用的命令仍然是iptables。<br>firewalld是iptables的前端控制器，用于实现持久的网络流量规则。它提供命令行和图形界面。</p>\n</blockquote>\n<p><strong>firewalld 与 iptables的比较：</strong></p>\n<blockquote>\n<ul>\n<li>firewalld可以动态修改单条规则，动态管理规则集，允许更新规则而不破坏现有会话和连接。而iptables，在修改了规则后必须得全部刷新才可以生效；</li>\n<li>firewalld使用区域和服务而不是链式规则；</li>\n<li><code>firewalld默认是拒绝的</code>，需要设置以后才能放行。而<code>iptables默认是允许的</code>，需要拒绝的才去限制；</li>\n<li>firewalld自身并不具备防火墙的功能，而是和iptables一样需要通过内核的netfilter来实现。也就是说，firewalld和iptables一样，它们的作用都用于维护规则，而真正使用规则干活的是内核的netfilter。只不过firewalld和iptables的结果以及使用方法不一样！</li>\n</ul>\n</blockquote>\n<p><strong>firewalld是iptables的一个封装，可以让你更容易地管理iptables规则。它并不是iptables的替代品，虽然iptables命令仍可用于firewalld，但建议firewalld时仅使用firewalld命令。</strong></p>\n<h1 id=\"一、-安装\"><a href=\"#一、-安装\" class=\"headerlink\" title=\"一、 安装\"></a>一、 安装</h1><h2 id=\"1-1-关闭-firewalld\"><a href=\"#1-1-关闭-firewalld\" class=\"headerlink\" title=\"1.1 关闭 firewalld\"></a>1.1 关闭 firewalld</h2><p><code> systemctr disable firewalld</code><br><code> systemctl stop firewalld</code></p>\n<h2 id=\"1-2-安装-iptalbes\"><a href=\"#1-2-安装-iptalbes\" class=\"headerlink\" title=\"1.2 安装 iptalbes\"></a>1.2 安装 iptalbes</h2><p><code> yum install iptables iptables-services</code></p>\n<h2 id=\"1-3-启用-iptables\"><a href=\"#1-3-启用-iptables\" class=\"headerlink\" title=\"1.3 启用 iptables\"></a>1.3 启用 iptables</h2><p><code> systemctl enable iptables</code><br><code>systemctl start iptables</code></p>\n<h2 id=\"1-4-备份-iptables\"><a href=\"#1-4-备份-iptables\" class=\"headerlink\" title=\"1.4 备份 iptables\"></a>1.4 备份 iptables</h2><p><code> cp /etc/sysconfig/iptables /etc/sysconfig/iptables-backup</code></p>\n<h1 id=\"二、-相关实例\"><a href=\"#二、-相关实例\" class=\"headerlink\" title=\"二、 相关实例\"></a>二、 相关实例</h1><h2 id=\"2-1-查看当前规则\"><a href=\"#2-1-查看当前规则\" class=\"headerlink\" title=\"2.1 查看当前规则\"></a>2.1 查看当前规则</h2><p><code> iptables -L -n -v --line-number</code></p>\n<h2 id=\"2-2-和详细内容-包含流量统计\"><a href=\"#2-2-和详细内容-包含流量统计\" class=\"headerlink\" title=\"2.2 和详细内容(包含流量统计)\"></a>2.2 和详细内容(包含流量统计)</h2><p><code>iptables -nvL --line-number</code></p>\n<h2 id=\"2-3-放行某个端口\"><a href=\"#2-3-放行某个端口\" class=\"headerlink\" title=\"2.3 放行某个端口\"></a>2.3 放行某个端口</h2><p><code> iptables -I INPUT -p tcp --dport 80 -j ACCEPT</code><br><code> iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT</code></p>\n<h2 id=\"2-4-允许某网段访问特定端口\"><a href=\"#2-4-允许某网段访问特定端口\" class=\"headerlink\" title=\"2.4 允许某网段访问特定端口\"></a>2.4 允许某网段访问特定端口</h2><p><code> iptables -I INPUT -s 192.168.1.0/24 -p tcp --dport 80 -j ACCEPT</code></p>\n<h2 id=\"2-5-删除某条规则\"><a href=\"#2-5-删除某条规则\" class=\"headerlink\" title=\"2.5 删除某条规则\"></a>2.5 删除某条规则</h2><p><code> iptables -D INPUT 1</code><br><code> iptables -D FORWARD 1</code></p>\n<h2 id=\"2-6-指定某段ip地址\"><a href=\"#2-6-指定某段ip地址\" class=\"headerlink\" title=\"2.6 指定某段ip地址\"></a>2.6 指定某段ip地址</h2><p><code> iptables -I INPUT -p tcp --dport 80 -j DROP</code><br><code>iptables - I INPUT -m iprange --src-range 192.168.1.200-192.168.1-210 -p tcp --dport 80 -j ACCEPT</code></p>\n<h2 id=\"2-7-修改某条规则\"><a href=\"#2-7-修改某条规则\" class=\"headerlink\" title=\"2.7 修改某条规则\"></a>2.7 修改某条规则</h2><p><code>iptables -R INPUT 5 -p tcp --dport 36878 -j ACCEPT</code></p>\n<h2 id=\"2-8-设置默认策略\"><a href=\"#2-8-设置默认策略\" class=\"headerlink\" title=\"2.8 设置默认策略\"></a>2.8 设置默认策略</h2><p><code>iptables -P INPUT DROP</code><br><code>iptables -P NAT REJECT</code><br><code>iptables -P OUTPUT ACCEPT</code></p>\n<h2 id=\"保存更改\"><a href=\"#保存更改\" class=\"headerlink\" title=\"保存更改\"></a>保存更改</h2><div class=\"tabs\" id=\"tab\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#tab-1\">CentOS 6</a></li><li class=\"tab\"><a href=\"#tab-2\">CentOS 7</a></li><li class=\"tab\"><a href=\"#tab-3\">Ubuntu</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"tab-1\"><p><code> iptables-save</code></p></div><div class=\"tab-pane\" id=\"tab-2\"><p><code> iptables-save &gt; /etc/sysconfig/iptables</code></p></div><div class=\"tab-pane\" id=\"tab-3\"><p><code> iptables-save &gt; /etc/iptables/rule.v4</code></p></div></div></div>\n\n\n<p>暂时更新到这….<br>2022&#x2F;2&#x2F;17</p>\n<h1 id=\"三、-nat转发\"><a href=\"#三、-nat转发\" class=\"headerlink\" title=\"三、 nat转发\"></a>三、 nat转发</h1><h2 id=\"3-1-端口转发\"><a href=\"#3-1-端口转发\" class=\"headerlink\" title=\"3.1 端口转发\"></a>3.1 端口转发</h2><p><strong>192.168.1.7:7410  —&gt;   192.168.1.160:9200</strong><br><code>iptables -t nat -A PREROUTING -d 192.168.1.7/32 -p tcp --dport 7410 -j DNAT --to-destination 192.168.1.160:9200</code><br><code>iptables -t nat -A POSTROUTING -d 192.168.1.160/32 -p tcp --dport 9200 -j SNAT --to-source 192.168.1.7</code></p>\n<h2 id=\"3-2-删除nat中的规则\"><a href=\"#3-2-删除nat中的规则\" class=\"headerlink\" title=\"3.2 删除nat中的规则\"></a>3.2 删除nat中的规则</h2><p><code>iptables -t nat -D POSTROUTING 6</code><br><code>iptables -t nat -D PREROUTING 1</code></p>\n<h1 id=\"四、-iptables自定义链\"><a href=\"#四、-iptables自定义链\" class=\"headerlink\" title=\"四、 iptables自定义链\"></a>四、 iptables自定义链</h1><h2 id=\"4-1-创建一条自定义链\"><a href=\"#4-1-创建一条自定义链\" class=\"headerlink\" title=\"4.1 创建一条自定义链\"></a>4.1 创建一条自定义链</h2><p><code>iptables -t filter -N es_white_list</code></p>\n<h2 id=\"4-2-自定义链的规则\"><a href=\"#4-2-自定义链的规则\" class=\"headerlink\" title=\"4.2 自定义链的规则\"></a>4.2 自定义链的规则</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">iptables -I es_white_list -j DROP</span><br><span class=\"line\">iptables -I es_white_list -s 172.22.67.31/32 -j ACCEPT</span><br><span class=\"line\">iptables -I es_white_list -s 172.22.67.32/32 -j ACCEPT</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-3-将自定义链的规则应用到某个端口\"><a href=\"#4-3-将自定义链的规则应用到某个端口\" class=\"headerlink\" title=\"4.3 将自定义链的规则应用到某个端口\"></a>4.3 将自定义链的规则应用到某个端口</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">iptables -I INPUT -p tcp --dport 9200 -j es_white_list</span><br><span class=\"line\">iptables -I INPUT -p tcp --dport 9300 -j es_white_list</span><br></pre></td></tr></table></figure>\n\n<p>4.1 + 4.2 + 4.3 –&gt; 创建白名单<code>es_white_list</code> 只有白名单里的ip地址可以访问该主机的9200和9200端口.</p>\n<h1 id=\"五、-iptables删除自定义链\"><a href=\"#五、-iptables删除自定义链\" class=\"headerlink\" title=\"五、 iptables删除自定义链\"></a>五、 iptables删除自定义链</h1><h2 id=\"5-1-清空链white-list里的规则\"><a href=\"#5-1-清空链white-list里的规则\" class=\"headerlink\" title=\"5.1 清空链white_list里的规则\"></a>5.1 清空链white_list里的规则</h2><p><code>iptables -t filter -F white_list</code></p>\n<h2 id=\"5-2-删除链white-list\"><a href=\"#5-2-删除链white-list\" class=\"headerlink\" title=\"5.2 删除链white_list\"></a>5.2 删除链white_list</h2><p><code>iptables -t filter -X white_list</code></p>\n<p>报错: <strong>iptables: Too many links.</strong><br>原因: <strong>该链仍在被使用, 删除使用该链的规则</strong><br><img src=\"/images/006.iptables.md.02.png\" alt=\"image.png\"></p>\n<p>删除引用<strong>DOCKER-USER</strong>的规则<br><code>iptables -t filter -D FORWARD 1</code><br><img src=\"/images/006.iptables.md.03.png\" alt=\"image.png\"></p>\n<h1 id=\"六、-重置所有规则\"><a href=\"#六、-重置所有规则\" class=\"headerlink\" title=\"六、 重置所有规则\"></a>六、 重置所有规则</h1><p>使用这些命令刷新和重置 iptables 到默认状态：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">iptables -F</span><br><span class=\"line\">iptables -X</span><br><span class=\"line\">iptables -t nat -F</span><br><span class=\"line\">iptables -t nat -X</span><br><span class=\"line\">iptables -t mangle -F</span><br><span class=\"line\">iptables -t mangle -X</span><br><span class=\"line\">iptables -t raw -F</span><br><span class=\"line\">iptables -t raw -X</span><br><span class=\"line\">iptables -t security -F</span><br><span class=\"line\">iptables -t security -X</span><br><span class=\"line\">iptables -P INPUT ACCEPT</span><br><span class=\"line\">iptables -P FORWARD ACCEPT</span><br><span class=\"line\">iptables -P OUTPUT ACCEPT</span><br><span class=\"line\">没有任何参数的 -F 命令在当前表中刷新所有链。同样的， -X 命令删除表中所有非默认链。</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"七、-初始状态\"><a href=\"#七、-初始状态\" class=\"headerlink\" title=\"七、 初始状态\"></a>七、 初始状态</h1><mark class=\"label success\">适用于CentOS 7</mark>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># sample configuration for iptables service</span></span><br><span class=\"line\"><span class=\"comment\"># you can edit this manually or use system-config-firewall</span></span><br><span class=\"line\"><span class=\"comment\"># please do not ask us to add additional ports/services to this default configuration</span></span><br><span class=\"line\">*filter</span><br><span class=\"line\">:INPUT ACCEPT [0:0]</span><br><span class=\"line\">:FORWARD ACCEPT [0:0]</span><br><span class=\"line\">:OUTPUT ACCEPT [0:0]</span><br><span class=\"line\">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class=\"line\">-A INPUT -p icmp -j ACCEPT</span><br><span class=\"line\">-A INPUT -i lo -j ACCEPT</span><br><span class=\"line\">-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT</span><br><span class=\"line\">-A INPUT -j REJECT --reject-with icmp-host-prohibited</span><br><span class=\"line\">-A FORWARD -j REJECT --reject-with icmp-host-prohibited</span><br><span class=\"line\">COMMIT</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"Ubuntu-Debian中的iptables\"><a href=\"#Ubuntu-Debian中的iptables\" class=\"headerlink\" title=\"Ubuntu&#x2F;Debian中的iptables\"></a>Ubuntu&#x2F;Debian中的iptables</h3><p>在Debian&#x2F;Ubuntu中使用iptables添加了规则, 即使使用iptables-save保存了规则也会在系统重启后失效.<br>或者使用iptables-save保存到文件, 然后系统重启后执行iptables-restore恢复规则.</p>\n<p><code>iptables-persistent</code> 应运而生, 更好的iptables持久化方案.</p>\n<p>安装之后其配置文件如下:  <code>/etc/iptables/rules.v4</code>    <code>/etc/iptables/rules.v6</code><br><strong>区别于</strong>CentOS中的 <code>/etc/sysconfig/iptables </code><br>Debian&#x2F;Ubuntu下清空<code>/etc/iptables/rules.v4</code>文件内容, 不会影响已有规则, 甚至<code>systemctl stop iptables</code>也不会影响<br>CentOS下清空 <code>/etc/sysconfig/iptables </code> 或者<code>systemctl stop iptables</code>相当于关闭防火墙</p>\n<p><img src=\"/images/006.iptables.md.01.png\" alt=\"image.png\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"引言\"><a href=\"#引言\" class=\"headerlink\" title=\"引言\"></a><a href=\"https://www.jianshu.com/p/70f7efe3a227\">引言</a></h1><p><strong>从Cent7以后，iptables服务的启动脚本已被忽略。请使用firewalld来取代iptables服务。</strong></p>\n<blockquote>\n<p>在RHEL7里，默认是使用firewalld来管理netfilter子系统，不过底层调用的命令仍然是iptables。<br>firewalld是iptables的前端控制器，用于实现持久的网络流量规则。它提供命令行和图形界面。</p>\n</blockquote>\n<p><strong>firewalld 与 iptables的比较：</strong></p>\n<blockquote>\n<ul>\n<li>firewalld可以动态修改单条规则，动态管理规则集，允许更新规则而不破坏现有会话和连接。而iptables，在修改了规则后必须得全部刷新才可以生效；</li>\n<li>firewalld使用区域和服务而不是链式规则；</li>\n<li><code>firewalld默认是拒绝的</code>，需要设置以后才能放行。而<code>iptables默认是允许的</code>，需要拒绝的才去限制；</li>\n<li>firewalld自身并不具备防火墙的功能，而是和iptables一样需要通过内核的netfilter来实现。也就是说，firewalld和iptables一样，它们的作用都用于维护规则，而真正使用规则干活的是内核的netfilter。只不过firewalld和iptables的结果以及使用方法不一样！</li>\n</ul>\n</blockquote>\n<p><strong>firewalld是iptables的一个封装，可以让你更容易地管理iptables规则。它并不是iptables的替代品，虽然iptables命令仍可用于firewalld，但建议firewalld时仅使用firewalld命令。</strong></p>\n<h1 id=\"一、-安装\"><a href=\"#一、-安装\" class=\"headerlink\" title=\"一、 安装\"></a>一、 安装</h1><h2 id=\"1-1-关闭-firewalld\"><a href=\"#1-1-关闭-firewalld\" class=\"headerlink\" title=\"1.1 关闭 firewalld\"></a>1.1 关闭 firewalld</h2><p><code> systemctr disable firewalld</code><br><code> systemctl stop firewalld</code></p>\n<h2 id=\"1-2-安装-iptalbes\"><a href=\"#1-2-安装-iptalbes\" class=\"headerlink\" title=\"1.2 安装 iptalbes\"></a>1.2 安装 iptalbes</h2><p><code> yum install iptables iptables-services</code></p>\n<h2 id=\"1-3-启用-iptables\"><a href=\"#1-3-启用-iptables\" class=\"headerlink\" title=\"1.3 启用 iptables\"></a>1.3 启用 iptables</h2><p><code> systemctl enable iptables</code><br><code>systemctl start iptables</code></p>\n<h2 id=\"1-4-备份-iptables\"><a href=\"#1-4-备份-iptables\" class=\"headerlink\" title=\"1.4 备份 iptables\"></a>1.4 备份 iptables</h2><p><code> cp /etc/sysconfig/iptables /etc/sysconfig/iptables-backup</code></p>\n<h1 id=\"二、-相关实例\"><a href=\"#二、-相关实例\" class=\"headerlink\" title=\"二、 相关实例\"></a>二、 相关实例</h1><h2 id=\"2-1-查看当前规则\"><a href=\"#2-1-查看当前规则\" class=\"headerlink\" title=\"2.1 查看当前规则\"></a>2.1 查看当前规则</h2><p><code> iptables -L -n -v --line-number</code></p>\n<h2 id=\"2-2-和详细内容-包含流量统计\"><a href=\"#2-2-和详细内容-包含流量统计\" class=\"headerlink\" title=\"2.2 和详细内容(包含流量统计)\"></a>2.2 和详细内容(包含流量统计)</h2><p><code>iptables -nvL --line-number</code></p>\n<h2 id=\"2-3-放行某个端口\"><a href=\"#2-3-放行某个端口\" class=\"headerlink\" title=\"2.3 放行某个端口\"></a>2.3 放行某个端口</h2><p><code> iptables -I INPUT -p tcp --dport 80 -j ACCEPT</code><br><code> iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT</code></p>\n<h2 id=\"2-4-允许某网段访问特定端口\"><a href=\"#2-4-允许某网段访问特定端口\" class=\"headerlink\" title=\"2.4 允许某网段访问特定端口\"></a>2.4 允许某网段访问特定端口</h2><p><code> iptables -I INPUT -s 192.168.1.0/24 -p tcp --dport 80 -j ACCEPT</code></p>\n<h2 id=\"2-5-删除某条规则\"><a href=\"#2-5-删除某条规则\" class=\"headerlink\" title=\"2.5 删除某条规则\"></a>2.5 删除某条规则</h2><p><code> iptables -D INPUT 1</code><br><code> iptables -D FORWARD 1</code></p>\n<h2 id=\"2-6-指定某段ip地址\"><a href=\"#2-6-指定某段ip地址\" class=\"headerlink\" title=\"2.6 指定某段ip地址\"></a>2.6 指定某段ip地址</h2><p><code> iptables -I INPUT -p tcp --dport 80 -j DROP</code><br><code>iptables - I INPUT -m iprange --src-range 192.168.1.200-192.168.1-210 -p tcp --dport 80 -j ACCEPT</code></p>\n<h2 id=\"2-7-修改某条规则\"><a href=\"#2-7-修改某条规则\" class=\"headerlink\" title=\"2.7 修改某条规则\"></a>2.7 修改某条规则</h2><p><code>iptables -R INPUT 5 -p tcp --dport 36878 -j ACCEPT</code></p>\n<h2 id=\"2-8-设置默认策略\"><a href=\"#2-8-设置默认策略\" class=\"headerlink\" title=\"2.8 设置默认策略\"></a>2.8 设置默认策略</h2><p><code>iptables -P INPUT DROP</code><br><code>iptables -P NAT REJECT</code><br><code>iptables -P OUTPUT ACCEPT</code></p>\n<h2 id=\"保存更改\"><a href=\"#保存更改\" class=\"headerlink\" title=\"保存更改\"></a>保存更改</h2><div class=\"tabs\" id=\"tab\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#tab-1\">CentOS 6</a></li><li class=\"tab\"><a href=\"#tab-2\">CentOS 7</a></li><li class=\"tab\"><a href=\"#tab-3\">Ubuntu</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"tab-1\"><p><code> iptables-save</code></p></div><div class=\"tab-pane\" id=\"tab-2\"><p><code> iptables-save &gt; /etc/sysconfig/iptables</code></p></div><div class=\"tab-pane\" id=\"tab-3\"><p><code> iptables-save &gt; /etc/iptables/rule.v4</code></p></div></div></div>\n\n\n<p>暂时更新到这….<br>2022&#x2F;2&#x2F;17</p>\n<h1 id=\"三、-nat转发\"><a href=\"#三、-nat转发\" class=\"headerlink\" title=\"三、 nat转发\"></a>三、 nat转发</h1><h2 id=\"3-1-端口转发\"><a href=\"#3-1-端口转发\" class=\"headerlink\" title=\"3.1 端口转发\"></a>3.1 端口转发</h2><p><strong>192.168.1.7:7410  —&gt;   192.168.1.160:9200</strong><br><code>iptables -t nat -A PREROUTING -d 192.168.1.7/32 -p tcp --dport 7410 -j DNAT --to-destination 192.168.1.160:9200</code><br><code>iptables -t nat -A POSTROUTING -d 192.168.1.160/32 -p tcp --dport 9200 -j SNAT --to-source 192.168.1.7</code></p>\n<h2 id=\"3-2-删除nat中的规则\"><a href=\"#3-2-删除nat中的规则\" class=\"headerlink\" title=\"3.2 删除nat中的规则\"></a>3.2 删除nat中的规则</h2><p><code>iptables -t nat -D POSTROUTING 6</code><br><code>iptables -t nat -D PREROUTING 1</code></p>\n<h1 id=\"四、-iptables自定义链\"><a href=\"#四、-iptables自定义链\" class=\"headerlink\" title=\"四、 iptables自定义链\"></a>四、 iptables自定义链</h1><h2 id=\"4-1-创建一条自定义链\"><a href=\"#4-1-创建一条自定义链\" class=\"headerlink\" title=\"4.1 创建一条自定义链\"></a>4.1 创建一条自定义链</h2><p><code>iptables -t filter -N es_white_list</code></p>\n<h2 id=\"4-2-自定义链的规则\"><a href=\"#4-2-自定义链的规则\" class=\"headerlink\" title=\"4.2 自定义链的规则\"></a>4.2 自定义链的规则</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">iptables -I es_white_list -j DROP</span><br><span class=\"line\">iptables -I es_white_list -s 172.22.67.31/32 -j ACCEPT</span><br><span class=\"line\">iptables -I es_white_list -s 172.22.67.32/32 -j ACCEPT</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-3-将自定义链的规则应用到某个端口\"><a href=\"#4-3-将自定义链的规则应用到某个端口\" class=\"headerlink\" title=\"4.3 将自定义链的规则应用到某个端口\"></a>4.3 将自定义链的规则应用到某个端口</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">iptables -I INPUT -p tcp --dport 9200 -j es_white_list</span><br><span class=\"line\">iptables -I INPUT -p tcp --dport 9300 -j es_white_list</span><br></pre></td></tr></table></figure>\n\n<p>4.1 + 4.2 + 4.3 –&gt; 创建白名单<code>es_white_list</code> 只有白名单里的ip地址可以访问该主机的9200和9200端口.</p>\n<h1 id=\"五、-iptables删除自定义链\"><a href=\"#五、-iptables删除自定义链\" class=\"headerlink\" title=\"五、 iptables删除自定义链\"></a>五、 iptables删除自定义链</h1><h2 id=\"5-1-清空链white-list里的规则\"><a href=\"#5-1-清空链white-list里的规则\" class=\"headerlink\" title=\"5.1 清空链white_list里的规则\"></a>5.1 清空链white_list里的规则</h2><p><code>iptables -t filter -F white_list</code></p>\n<h2 id=\"5-2-删除链white-list\"><a href=\"#5-2-删除链white-list\" class=\"headerlink\" title=\"5.2 删除链white_list\"></a>5.2 删除链white_list</h2><p><code>iptables -t filter -X white_list</code></p>\n<p>报错: <strong>iptables: Too many links.</strong><br>原因: <strong>该链仍在被使用, 删除使用该链的规则</strong><br><img src=\"/images/006.iptables.md.02.png\" alt=\"image.png\"></p>\n<p>删除引用<strong>DOCKER-USER</strong>的规则<br><code>iptables -t filter -D FORWARD 1</code><br><img src=\"/images/006.iptables.md.03.png\" alt=\"image.png\"></p>\n<h1 id=\"六、-重置所有规则\"><a href=\"#六、-重置所有规则\" class=\"headerlink\" title=\"六、 重置所有规则\"></a>六、 重置所有规则</h1><p>使用这些命令刷新和重置 iptables 到默认状态：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">iptables -F</span><br><span class=\"line\">iptables -X</span><br><span class=\"line\">iptables -t nat -F</span><br><span class=\"line\">iptables -t nat -X</span><br><span class=\"line\">iptables -t mangle -F</span><br><span class=\"line\">iptables -t mangle -X</span><br><span class=\"line\">iptables -t raw -F</span><br><span class=\"line\">iptables -t raw -X</span><br><span class=\"line\">iptables -t security -F</span><br><span class=\"line\">iptables -t security -X</span><br><span class=\"line\">iptables -P INPUT ACCEPT</span><br><span class=\"line\">iptables -P FORWARD ACCEPT</span><br><span class=\"line\">iptables -P OUTPUT ACCEPT</span><br><span class=\"line\">没有任何参数的 -F 命令在当前表中刷新所有链。同样的， -X 命令删除表中所有非默认链。</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"七、-初始状态\"><a href=\"#七、-初始状态\" class=\"headerlink\" title=\"七、 初始状态\"></a>七、 初始状态</h1><mark class=\"label success\">适用于CentOS 7</mark>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># sample configuration for iptables service</span></span><br><span class=\"line\"><span class=\"comment\"># you can edit this manually or use system-config-firewall</span></span><br><span class=\"line\"><span class=\"comment\"># please do not ask us to add additional ports/services to this default configuration</span></span><br><span class=\"line\">*filter</span><br><span class=\"line\">:INPUT ACCEPT [0:0]</span><br><span class=\"line\">:FORWARD ACCEPT [0:0]</span><br><span class=\"line\">:OUTPUT ACCEPT [0:0]</span><br><span class=\"line\">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class=\"line\">-A INPUT -p icmp -j ACCEPT</span><br><span class=\"line\">-A INPUT -i lo -j ACCEPT</span><br><span class=\"line\">-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT</span><br><span class=\"line\">-A INPUT -j REJECT --reject-with icmp-host-prohibited</span><br><span class=\"line\">-A FORWARD -j REJECT --reject-with icmp-host-prohibited</span><br><span class=\"line\">COMMIT</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"Ubuntu-Debian中的iptables\"><a href=\"#Ubuntu-Debian中的iptables\" class=\"headerlink\" title=\"Ubuntu&#x2F;Debian中的iptables\"></a>Ubuntu&#x2F;Debian中的iptables</h3><p>在Debian&#x2F;Ubuntu中使用iptables添加了规则, 即使使用iptables-save保存了规则也会在系统重启后失效.<br>或者使用iptables-save保存到文件, 然后系统重启后执行iptables-restore恢复规则.</p>\n<p><code>iptables-persistent</code> 应运而生, 更好的iptables持久化方案.</p>\n<p>安装之后其配置文件如下:  <code>/etc/iptables/rules.v4</code>    <code>/etc/iptables/rules.v6</code><br><strong>区别于</strong>CentOS中的 <code>/etc/sysconfig/iptables </code><br>Debian&#x2F;Ubuntu下清空<code>/etc/iptables/rules.v4</code>文件内容, 不会影响已有规则, 甚至<code>systemctl stop iptables</code>也不会影响<br>CentOS下清空 <code>/etc/sysconfig/iptables </code> 或者<code>systemctl stop iptables</code>相当于关闭防火墙</p>\n<p><img src=\"/images/006.iptables.md.01.png\" alt=\"image.png\"></p>\n"},{"title":"Linux下系统监视","date":"2022-05-11T03:39:08.000Z","_content":"\n## Linux下系统监视\n### ``` System ``` 系统\n####\t1. ``` iostat ``` 设备负载信息\n\n命令 ``` iostat ``` 包含在软件包 ```sysstat```里\n![image.png](/images/007.system_info.md.01.png)\n\n{% note info %}\nNOTE:\n查询哪个软件包提供哪个command ```yum whatprovides COMMAND``` \n查询哪个软件包提供哪个文件     ```yum whatprovides FILE```\n{% endnote %}\n\n\n第一份 ```iostat``` 报告显示自引导系统以来收集的统计信息。后续报告则涵盖上一份报告之后的时间。\n\n```\n[root@centos7 ~]# iostat\nLinux 3.10.0-1160.62.1.el7.x86_64 (centos7.9) \t05/11/2022 \t_x86_64_\t(2 CPU)\n\navg-cpu:  %user   %nice %system %iowait  %steal   %idle\n           0.13    0.00    0.30    0.02    0.00   99.55\n\nDevice:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn\nsda               1.70        23.68        17.60     336054     249741\nsdb               0.06         1.82         7.55      25823     107131\ndm-0              1.74        22.85        25.00     324293     354804\ndm-1              0.01         0.16         0.00       2204          0\n```\n\n\n### ```Pid ``` 进程\n### ``` Network ``` 网络\n### ``` Member ``` 内存\n### ``` Hardware ``` 硬件\n### ``` File and File system ``` 文件和文件系统\n### ``` Users ``` 用户\n### ``` Others ``` 其他","source":"_posts/007.system_monitor.md","raw":"---\ntitle: Linux下系统监视\ndate: 2022-05-11 11:39:08\ncategories: \n- [Linux]\n- [CentOS]\n- [Ubuntu]\ntags: \n- monitor\n---\n\n## Linux下系统监视\n### ``` System ``` 系统\n####\t1. ``` iostat ``` 设备负载信息\n\n命令 ``` iostat ``` 包含在软件包 ```sysstat```里\n![image.png](/images/007.system_info.md.01.png)\n\n{% note info %}\nNOTE:\n查询哪个软件包提供哪个command ```yum whatprovides COMMAND``` \n查询哪个软件包提供哪个文件     ```yum whatprovides FILE```\n{% endnote %}\n\n\n第一份 ```iostat``` 报告显示自引导系统以来收集的统计信息。后续报告则涵盖上一份报告之后的时间。\n\n```\n[root@centos7 ~]# iostat\nLinux 3.10.0-1160.62.1.el7.x86_64 (centos7.9) \t05/11/2022 \t_x86_64_\t(2 CPU)\n\navg-cpu:  %user   %nice %system %iowait  %steal   %idle\n           0.13    0.00    0.30    0.02    0.00   99.55\n\nDevice:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn\nsda               1.70        23.68        17.60     336054     249741\nsdb               0.06         1.82         7.55      25823     107131\ndm-0              1.74        22.85        25.00     324293     354804\ndm-1              0.01         0.16         0.00       2204          0\n```\n\n\n### ```Pid ``` 进程\n### ``` Network ``` 网络\n### ``` Member ``` 内存\n### ``` Hardware ``` 硬件\n### ``` File and File system ``` 文件和文件系统\n### ``` Users ``` 用户\n### ``` Others ``` 其他","slug":"007.system_monitor","published":1,"updated":"2023-12-05T08:52:30.875Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtz9j000iijnrc5ci8lkk","content":"<h2 id=\"Linux下系统监视\"><a href=\"#Linux下系统监视\" class=\"headerlink\" title=\"Linux下系统监视\"></a>Linux下系统监视</h2><h3 id=\"System-系统\"><a href=\"#System-系统\" class=\"headerlink\" title=\"System 系统\"></a><code>System</code> 系统</h3><h4 id=\"1-iostat-设备负载信息\"><a href=\"#1-iostat-设备负载信息\" class=\"headerlink\" title=\"1. iostat 设备负载信息\"></a>1. <code>iostat</code> 设备负载信息</h4><p>命令 <code>iostat</code> 包含在软件包 <code>sysstat</code>里<br><img src=\"/images/007.system_info.md.01.png\" alt=\"image.png\"></p>\n<div class=\"note info\"><p>NOTE:<br>查询哪个软件包提供哪个command <code>yum whatprovides COMMAND</code><br>查询哪个软件包提供哪个文件     <code>yum whatprovides FILE</code></p>\n</div>\n\n\n<p>第一份 <code>iostat</code> 报告显示自引导系统以来收集的统计信息。后续报告则涵盖上一份报告之后的时间。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@centos7 ~]# iostat</span><br><span class=\"line\">Linux 3.10.0-1160.62.1.el7.x86_64 (centos7.9) \t05/11/2022 \t_x86_64_\t(2 CPU)</span><br><span class=\"line\"></span><br><span class=\"line\">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class=\"line\">           0.13    0.00    0.30    0.02    0.00   99.55</span><br><span class=\"line\"></span><br><span class=\"line\">Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn</span><br><span class=\"line\">sda               1.70        23.68        17.60     336054     249741</span><br><span class=\"line\">sdb               0.06         1.82         7.55      25823     107131</span><br><span class=\"line\">dm-0              1.74        22.85        25.00     324293     354804</span><br><span class=\"line\">dm-1              0.01         0.16         0.00       2204          0</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"Pid-进程\"><a href=\"#Pid-进程\" class=\"headerlink\" title=\"Pid  进程\"></a><code>Pid </code> 进程</h3><h3 id=\"Network-网络\"><a href=\"#Network-网络\" class=\"headerlink\" title=\"Network 网络\"></a><code>Network</code> 网络</h3><h3 id=\"Member-内存\"><a href=\"#Member-内存\" class=\"headerlink\" title=\"Member 内存\"></a><code>Member</code> 内存</h3><h3 id=\"Hardware-硬件\"><a href=\"#Hardware-硬件\" class=\"headerlink\" title=\"Hardware 硬件\"></a><code>Hardware</code> 硬件</h3><h3 id=\"File-and-File-system-文件和文件系统\"><a href=\"#File-and-File-system-文件和文件系统\" class=\"headerlink\" title=\"File and File system 文件和文件系统\"></a><code>File and File system</code> 文件和文件系统</h3><h3 id=\"Users-用户\"><a href=\"#Users-用户\" class=\"headerlink\" title=\"Users 用户\"></a><code>Users</code> 用户</h3><h3 id=\"Others-其他\"><a href=\"#Others-其他\" class=\"headerlink\" title=\"Others 其他\"></a><code>Others</code> 其他</h3>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Linux下系统监视\"><a href=\"#Linux下系统监视\" class=\"headerlink\" title=\"Linux下系统监视\"></a>Linux下系统监视</h2><h3 id=\"System-系统\"><a href=\"#System-系统\" class=\"headerlink\" title=\"System 系统\"></a><code>System</code> 系统</h3><h4 id=\"1-iostat-设备负载信息\"><a href=\"#1-iostat-设备负载信息\" class=\"headerlink\" title=\"1. iostat 设备负载信息\"></a>1. <code>iostat</code> 设备负载信息</h4><p>命令 <code>iostat</code> 包含在软件包 <code>sysstat</code>里<br><img src=\"/images/007.system_info.md.01.png\" alt=\"image.png\"></p>\n<div class=\"note info\"><p>NOTE:<br>查询哪个软件包提供哪个command <code>yum whatprovides COMMAND</code><br>查询哪个软件包提供哪个文件     <code>yum whatprovides FILE</code></p>\n</div>\n\n\n<p>第一份 <code>iostat</code> 报告显示自引导系统以来收集的统计信息。后续报告则涵盖上一份报告之后的时间。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@centos7 ~]# iostat</span><br><span class=\"line\">Linux 3.10.0-1160.62.1.el7.x86_64 (centos7.9) \t05/11/2022 \t_x86_64_\t(2 CPU)</span><br><span class=\"line\"></span><br><span class=\"line\">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class=\"line\">           0.13    0.00    0.30    0.02    0.00   99.55</span><br><span class=\"line\"></span><br><span class=\"line\">Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn</span><br><span class=\"line\">sda               1.70        23.68        17.60     336054     249741</span><br><span class=\"line\">sdb               0.06         1.82         7.55      25823     107131</span><br><span class=\"line\">dm-0              1.74        22.85        25.00     324293     354804</span><br><span class=\"line\">dm-1              0.01         0.16         0.00       2204          0</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"Pid-进程\"><a href=\"#Pid-进程\" class=\"headerlink\" title=\"Pid  进程\"></a><code>Pid </code> 进程</h3><h3 id=\"Network-网络\"><a href=\"#Network-网络\" class=\"headerlink\" title=\"Network 网络\"></a><code>Network</code> 网络</h3><h3 id=\"Member-内存\"><a href=\"#Member-内存\" class=\"headerlink\" title=\"Member 内存\"></a><code>Member</code> 内存</h3><h3 id=\"Hardware-硬件\"><a href=\"#Hardware-硬件\" class=\"headerlink\" title=\"Hardware 硬件\"></a><code>Hardware</code> 硬件</h3><h3 id=\"File-and-File-system-文件和文件系统\"><a href=\"#File-and-File-system-文件和文件系统\" class=\"headerlink\" title=\"File and File system 文件和文件系统\"></a><code>File and File system</code> 文件和文件系统</h3><h3 id=\"Users-用户\"><a href=\"#Users-用户\" class=\"headerlink\" title=\"Users 用户\"></a><code>Users</code> 用户</h3><h3 id=\"Others-其他\"><a href=\"#Others-其他\" class=\"headerlink\" title=\"Others 其他\"></a><code>Others</code> 其他</h3>"},{"title":"Linux重置root密码","date":"2022-05-12T02:33:08.000Z","_content":"\n**简洁点**\n\n1) press ``` e ``` on grub, \n2) add parameters ``` rd.break ``` \n3) ``` Ctrl + x ```\n4) ``` mount -o remount rw /sysroot ```\n5) ``` chroot /sysroot ```\n6) ``` passwd ```\n7) ``` touch /.autorelabel ```\n8) ``` exit ```  \n9) ``` reboot ```\n---\n<!-- more -->\n\n- 0: 确保你有访问机器的权限, 物理访问或者通过远程访问bootloader.\n- 1: 重启机器, 在选择启动内核选项迅速按下上下键来取消倒计时.\n- 2: 选择要启动的内核然后按下```e```, 此时你会进入grub bootloader的编辑页面\n- 3: 找到内核启动加载参数的行\n-    - 3.1 ```RHEL/CentOS 7```, 行首以 ```linux16```开始.\n-    - 3.2 ```RHEL/Centos 8x, and Fedora``` 行首以 ```linux```开始.\n- 4: 在step3中的行尾添加参数```rd.break```.**(此操作只是临时生效)**\n![image.png](/images/008.reset_password.md.01.png)\n- 5: 按下 ```Ctrl+x```执行添加参数后的bootloader\n- 6: 此时会进入救援模式(rescue), 命令提示符变成了```switch_root:/#```\n![image.png](/images/008.reset_password.md.02.png)\n- 7: 以读写模式重新挂在根分区, 不然会没法执行修改密码的命令 \n     ``` mount -o remount rw /sysroot ```\n- 8: 修改根目录路径\n     ``` chroot /sysroot ```\n- 9: 执行修改root密码的命令 ``` passwd ```, 然后重复输入密码以确认.\n- 10: 重新启动之前，您需要确保 SELinux 允许文件更改。输入：```touch /.autorelabel```这将在下次重新启动时向 SELinux 发出文件系统已更改（更改的密码）的信号，并允许加载更改。这将导致整个文件系统被“重新标记”，这可能需要一段时间，具体取决于文件系统的大小和机器的速度，因此请注意这种可能性。\n- 11: 输入: ``` exit ``` 离开 chroot环境, 然后输入: ```rebbot```重启机器.\n","source":"_posts/008.reset_password.md","raw":"---\ntitle: Linux重置root密码\ndate: 2022-05-12 10:33:08\ncategories: \n- [Linux]\n- [CentOS]\n- [Ubuntu]\ntags: \n- password\n---\n\n**简洁点**\n\n1) press ``` e ``` on grub, \n2) add parameters ``` rd.break ``` \n3) ``` Ctrl + x ```\n4) ``` mount -o remount rw /sysroot ```\n5) ``` chroot /sysroot ```\n6) ``` passwd ```\n7) ``` touch /.autorelabel ```\n8) ``` exit ```  \n9) ``` reboot ```\n---\n<!-- more -->\n\n- 0: 确保你有访问机器的权限, 物理访问或者通过远程访问bootloader.\n- 1: 重启机器, 在选择启动内核选项迅速按下上下键来取消倒计时.\n- 2: 选择要启动的内核然后按下```e```, 此时你会进入grub bootloader的编辑页面\n- 3: 找到内核启动加载参数的行\n-    - 3.1 ```RHEL/CentOS 7```, 行首以 ```linux16```开始.\n-    - 3.2 ```RHEL/Centos 8x, and Fedora``` 行首以 ```linux```开始.\n- 4: 在step3中的行尾添加参数```rd.break```.**(此操作只是临时生效)**\n![image.png](/images/008.reset_password.md.01.png)\n- 5: 按下 ```Ctrl+x```执行添加参数后的bootloader\n- 6: 此时会进入救援模式(rescue), 命令提示符变成了```switch_root:/#```\n![image.png](/images/008.reset_password.md.02.png)\n- 7: 以读写模式重新挂在根分区, 不然会没法执行修改密码的命令 \n     ``` mount -o remount rw /sysroot ```\n- 8: 修改根目录路径\n     ``` chroot /sysroot ```\n- 9: 执行修改root密码的命令 ``` passwd ```, 然后重复输入密码以确认.\n- 10: 重新启动之前，您需要确保 SELinux 允许文件更改。输入：```touch /.autorelabel```这将在下次重新启动时向 SELinux 发出文件系统已更改（更改的密码）的信号，并允许加载更改。这将导致整个文件系统被“重新标记”，这可能需要一段时间，具体取决于文件系统的大小和机器的速度，因此请注意这种可能性。\n- 11: 输入: ``` exit ``` 离开 chroot环境, 然后输入: ```rebbot```重启机器.\n","slug":"008.reset_password","published":1,"updated":"2023-12-05T08:52:30.875Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtz9p000nijnrd60g4lbl","content":"<p><strong>简洁点</strong></p>\n<ol>\n<li>press <code>e</code> on grub, </li>\n<li>add parameters <code>rd.break</code> </li>\n<li><code>Ctrl + x</code></li>\n<li><code>mount -o remount rw /sysroot</code></li>\n<li><code>chroot /sysroot</code></li>\n<li><code>passwd</code></li>\n<li><code>touch /.autorelabel</code></li>\n<li><code>exit</code>  </li>\n<li><code>reboot</code></li>\n</ol>\n<hr>\n<span id=\"more\"></span>\n\n<ul>\n<li>0: 确保你有访问机器的权限, 物理访问或者通过远程访问bootloader.</li>\n<li>1: 重启机器, 在选择启动内核选项迅速按下上下键来取消倒计时.</li>\n<li>2: 选择要启动的内核然后按下<code>e</code>, 此时你会进入grub bootloader的编辑页面</li>\n<li>3: 找到内核启动加载参数的行</li>\n<li><ul>\n<li>3.1 <code>RHEL/CentOS 7</code>, 行首以 <code>linux16</code>开始.</li>\n</ul>\n</li>\n<li><ul>\n<li>3.2 <code>RHEL/Centos 8x, and Fedora</code> 行首以 <code>linux</code>开始.</li>\n</ul>\n</li>\n<li>4: 在step3中的行尾添加参数<code>rd.break</code>.<strong>(此操作只是临时生效)</strong><br><img src=\"/images/008.reset_password.md.01.png\" alt=\"image.png\"></li>\n<li>5: 按下 <code>Ctrl+x</code>执行添加参数后的bootloader</li>\n<li>6: 此时会进入救援模式(rescue), 命令提示符变成了<code>switch_root:/#</code><br><img src=\"/images/008.reset_password.md.02.png\" alt=\"image.png\"></li>\n<li>7: 以读写模式重新挂在根分区, 不然会没法执行修改密码的命令<br>   <code>mount -o remount rw /sysroot</code></li>\n<li>8: 修改根目录路径<br>   <code>chroot /sysroot</code></li>\n<li>9: 执行修改root密码的命令 <code>passwd</code>, 然后重复输入密码以确认.</li>\n<li>10: 重新启动之前，您需要确保 SELinux 允许文件更改。输入：<code>touch /.autorelabel</code>这将在下次重新启动时向 SELinux 发出文件系统已更改（更改的密码）的信号，并允许加载更改。这将导致整个文件系统被“重新标记”，这可能需要一段时间，具体取决于文件系统的大小和机器的速度，因此请注意这种可能性。</li>\n<li>11: 输入: <code>exit</code> 离开 chroot环境, 然后输入: <code>rebbot</code>重启机器.</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p><strong>简洁点</strong></p>\n<ol>\n<li>press <code>e</code> on grub, </li>\n<li>add parameters <code>rd.break</code> </li>\n<li><code>Ctrl + x</code></li>\n<li><code>mount -o remount rw /sysroot</code></li>\n<li><code>chroot /sysroot</code></li>\n<li><code>passwd</code></li>\n<li><code>touch /.autorelabel</code></li>\n<li><code>exit</code>  </li>\n<li><code>reboot</code></li>\n</ol>\n<hr>","more":"<ul>\n<li>0: 确保你有访问机器的权限, 物理访问或者通过远程访问bootloader.</li>\n<li>1: 重启机器, 在选择启动内核选项迅速按下上下键来取消倒计时.</li>\n<li>2: 选择要启动的内核然后按下<code>e</code>, 此时你会进入grub bootloader的编辑页面</li>\n<li>3: 找到内核启动加载参数的行</li>\n<li><ul>\n<li>3.1 <code>RHEL/CentOS 7</code>, 行首以 <code>linux16</code>开始.</li>\n</ul>\n</li>\n<li><ul>\n<li>3.2 <code>RHEL/Centos 8x, and Fedora</code> 行首以 <code>linux</code>开始.</li>\n</ul>\n</li>\n<li>4: 在step3中的行尾添加参数<code>rd.break</code>.<strong>(此操作只是临时生效)</strong><br><img src=\"/images/008.reset_password.md.01.png\" alt=\"image.png\"></li>\n<li>5: 按下 <code>Ctrl+x</code>执行添加参数后的bootloader</li>\n<li>6: 此时会进入救援模式(rescue), 命令提示符变成了<code>switch_root:/#</code><br><img src=\"/images/008.reset_password.md.02.png\" alt=\"image.png\"></li>\n<li>7: 以读写模式重新挂在根分区, 不然会没法执行修改密码的命令<br>   <code>mount -o remount rw /sysroot</code></li>\n<li>8: 修改根目录路径<br>   <code>chroot /sysroot</code></li>\n<li>9: 执行修改root密码的命令 <code>passwd</code>, 然后重复输入密码以确认.</li>\n<li>10: 重新启动之前，您需要确保 SELinux 允许文件更改。输入：<code>touch /.autorelabel</code>这将在下次重新启动时向 SELinux 发出文件系统已更改（更改的密码）的信号，并允许加载更改。这将导致整个文件系统被“重新标记”，这可能需要一段时间，具体取决于文件系统的大小和机器的速度，因此请注意这种可能性。</li>\n<li>11: 输入: <code>exit</code> 离开 chroot环境, 然后输入: <code>rebbot</code>重启机器.</li>\n</ul>"},{"title":"openssl 和 openssl 升级","date":"2022-05-16T02:33:08.000Z","_content":"\n\n## 一、 安装前准备\n\n### 1.1 查看当前openssh版本\n```\n[root@centos7 ~]# ssh -V\nOpenSSH_7.4p1, OpenSSL 1.0.2k-fips  26 Jan 2017\n[root@centos7 ~]# \n```\n\n### 1.2 查看当前openssl版本\n```\n[root@centos7 ~]# \n[root@centos7 ~]# openssl version\nOpenSSL 1.0.2k-fips  26 Jan 2017\n[root@centos7 ~]# \n```\n\n### 1.3 安装依赖\n\n``` yum install perl perl-Test-Harness perl-Test-Simple```\n``` yum groupinstall Development Tools ```\n\n### 1.4 安装 zlib\n\n#### 1.4.1 下载\n```wget http://www.zlib.net/zlib-1.3.tar.gz```\n\n#### 1.4.2 解压\n```tar -xzvf zlib-1.3.tar.gz```\n\n#### 1.4.3编译&安装:\n``` bash\ncd zlib-1.3\n./configure --prefix=/usr/local/zlib\nmake\nmake test  # 这一步出错不要继续 # 看到ok字样表示成功\nmake install\n```\n\n\n\n## 二、 安装OpenSSL\n\n### 2.1 源码编译安装\n\n> 官网下载地址: https://www.openssl.org/source/\n\n#### 2.1.1 下载:\n``` wget https://www.openssl.org/source/openssl-1.1.1.tar.gz ```\n\n#### 2.1.2 解压\n```tar -xzvf openssl-1.1.1w.tar.gz```\n\n#### 2.1.3 编译&安装:\n``` bash\ncd openssl-1.1.1w\n./config --shared --prefix=/usr/local/openssl  # --shared 创建共享库\nmake -j4                                       # - j4 使用四个进程\nmake install\n```\n\n\n### 2.2 替换openssl为新版本\n\n#### 2.2.1 替换 openssl 二进制文件\n```mv /usr/bin/openssl{,.back}```\n```ln -s /usr/local/openssl/bin/openssl /usr/bin/openssl```\n\n#### 2.2.2 openssl 相关库\n```mv /usr/include/openssl{,.back}```\n```ln -s /usr/local/openssl/include/openssl/ /usr/include/```\n\n#### 2.2.3 共享库路径加入系统\n```echo \"/usr/local/openssl/lib\" >> /etc/ld.so.conf ```\n\n#### 2.2.4 验证\n```ldconfig -v | grep openssl ```\n\n## 三、 安装OpenSSH\n\n\n### 3.1 备份相关文件\n```mv /etc/ssh{,.back}```\n```mv /etc/pam.d/sshd{,.back}```\n\n### 3.2 下载\n``` wget https://mirrors.aliyun.com/pub/OpenBSD/OpenSSH/portable/openssh-9.5p1.tar.gz ```\n\n### 3.3 解压\n``` tar -xzvf openssh-9.5p1.tar.gz ```\n\n### 3.4 编译&安装\n``` bash\ncd openssh-9.5p1\n./configure \\\n--prefix=/usr/local/openssh \\\n--sysconfdir=/etc/ssh \\\n--with-zlib=/usr/local/zlib \\\n--with-ssl-dir=/usr/local/openssl \\\n--with-pam \nmake -j4\nmake tests\nmake install\n```\n### 3.5 注意事项\n\n**确保使用了openssl-1.1.1**\n<img src=\"/images/009.openssh.md.01.png\" width=100% height=80% />\n**./config的结果**\n<img src=\"/images/009.openssh.md.02.png\" width=100% height=60% />\n**make tests 这里时间特别较长**\n<img src=\"/images/009.openssh.md.04.png\" width=100% height=100% />\n**保证.key文件的权限为 0600**\n<img src=\"/images/009.openssh.md.05.png\" width=100% height=100% />\n<img src=\"/images/009.openssh.md.06.png\" width=100% height=100% />\n\n\n**注意: 安装完不可直接systemctl去重启sshd, 可能会造成服务器无法连接**\n**请在有ssh之外远程到服务器上的权限再去升级ssh, 避免升级过程中导致ssh无法连接**\n\n### 3.6 修改sshd配置文件\n其实直接恢复原来的sshd_conf文件即可. 保险起见使用如下配置\n编辑sshd配置文件: ```vim /etc/ssh/sshd_config```\n添加: ```PermitRootLogin yes```\n\n### 3.7 复制sshd的pam配置文件\n```cp openssh-9.5p1/contrib/redhat/sshd.pam /etc/pam.d/sshd```\n\n\n### 3.8 使用systemctl管理sshd\n**配置启动脚本**\n```cp openssh-9.5p1/contrib/redhat/sshd.init /etc/init.d/sshd```\n\n**添加sshd的service配置文件**\n```vim /usr/lib/systemd/system/sshd.service```\n``` bash\n#vim /usr/lib/systemd/system/sshd.service\n[Unit]\nDescription=OpenSSH server daemon\nDocumentation=man:sshd(8) man:sshd_config(5)\nAfter=network.target sshd-keygen.service\nWants=sshd-keygen.service\n\n[Service]\nType=forking\nExecStart=/etc/rc.d/init.d/sshd start\nExecStop=/etc/rc.d/init.d/sshd stop\nRestart=/etc/rc.d/init.d/sshd stop\n[Install]\nWantedBy=multi-user.target\n```\n\n\n### 3.9 替换为新的 sshd\n\n```mv /usr/bin/ssh{,.back}```\n```mv /usr/sbin/sshd{,.back}```\n```ln -s /usr/local/openssh/sbin/sshd /usr/sbin/sshd```\n```ln -s /usr/local/openssh/bin/ssh /usr/bin/ssh```\n\n\n**重载systemctl**\n```systemctl daemon-reload```\n**重启sshd**\n``` systemctl restart sshd ```\n\n### 3.10 验证\n<img src=\"/images/009.openssh.md.07.png\" width=100% height=100% />\n\n\n## 四、 相关问题\n\n### 4.1 error: *** working libcrypto not found\n\n解决: ``` yum install openssl-devel ```\n\n### 4.2 error: PAM headers not found\n\n解决: ``` yum install pam-devel ```","source":"_posts/009.openssh.md","raw":"---\ntitle: openssl 和 openssl 升级\ndate: 2022-05-16 10:33:08\ncategories: \n- [Linux]\ntags: \n- openssl\n- openssh\n---\n\n\n## 一、 安装前准备\n\n### 1.1 查看当前openssh版本\n```\n[root@centos7 ~]# ssh -V\nOpenSSH_7.4p1, OpenSSL 1.0.2k-fips  26 Jan 2017\n[root@centos7 ~]# \n```\n\n### 1.2 查看当前openssl版本\n```\n[root@centos7 ~]# \n[root@centos7 ~]# openssl version\nOpenSSL 1.0.2k-fips  26 Jan 2017\n[root@centos7 ~]# \n```\n\n### 1.3 安装依赖\n\n``` yum install perl perl-Test-Harness perl-Test-Simple```\n``` yum groupinstall Development Tools ```\n\n### 1.4 安装 zlib\n\n#### 1.4.1 下载\n```wget http://www.zlib.net/zlib-1.3.tar.gz```\n\n#### 1.4.2 解压\n```tar -xzvf zlib-1.3.tar.gz```\n\n#### 1.4.3编译&安装:\n``` bash\ncd zlib-1.3\n./configure --prefix=/usr/local/zlib\nmake\nmake test  # 这一步出错不要继续 # 看到ok字样表示成功\nmake install\n```\n\n\n\n## 二、 安装OpenSSL\n\n### 2.1 源码编译安装\n\n> 官网下载地址: https://www.openssl.org/source/\n\n#### 2.1.1 下载:\n``` wget https://www.openssl.org/source/openssl-1.1.1.tar.gz ```\n\n#### 2.1.2 解压\n```tar -xzvf openssl-1.1.1w.tar.gz```\n\n#### 2.1.3 编译&安装:\n``` bash\ncd openssl-1.1.1w\n./config --shared --prefix=/usr/local/openssl  # --shared 创建共享库\nmake -j4                                       # - j4 使用四个进程\nmake install\n```\n\n\n### 2.2 替换openssl为新版本\n\n#### 2.2.1 替换 openssl 二进制文件\n```mv /usr/bin/openssl{,.back}```\n```ln -s /usr/local/openssl/bin/openssl /usr/bin/openssl```\n\n#### 2.2.2 openssl 相关库\n```mv /usr/include/openssl{,.back}```\n```ln -s /usr/local/openssl/include/openssl/ /usr/include/```\n\n#### 2.2.3 共享库路径加入系统\n```echo \"/usr/local/openssl/lib\" >> /etc/ld.so.conf ```\n\n#### 2.2.4 验证\n```ldconfig -v | grep openssl ```\n\n## 三、 安装OpenSSH\n\n\n### 3.1 备份相关文件\n```mv /etc/ssh{,.back}```\n```mv /etc/pam.d/sshd{,.back}```\n\n### 3.2 下载\n``` wget https://mirrors.aliyun.com/pub/OpenBSD/OpenSSH/portable/openssh-9.5p1.tar.gz ```\n\n### 3.3 解压\n``` tar -xzvf openssh-9.5p1.tar.gz ```\n\n### 3.4 编译&安装\n``` bash\ncd openssh-9.5p1\n./configure \\\n--prefix=/usr/local/openssh \\\n--sysconfdir=/etc/ssh \\\n--with-zlib=/usr/local/zlib \\\n--with-ssl-dir=/usr/local/openssl \\\n--with-pam \nmake -j4\nmake tests\nmake install\n```\n### 3.5 注意事项\n\n**确保使用了openssl-1.1.1**\n<img src=\"/images/009.openssh.md.01.png\" width=100% height=80% />\n**./config的结果**\n<img src=\"/images/009.openssh.md.02.png\" width=100% height=60% />\n**make tests 这里时间特别较长**\n<img src=\"/images/009.openssh.md.04.png\" width=100% height=100% />\n**保证.key文件的权限为 0600**\n<img src=\"/images/009.openssh.md.05.png\" width=100% height=100% />\n<img src=\"/images/009.openssh.md.06.png\" width=100% height=100% />\n\n\n**注意: 安装完不可直接systemctl去重启sshd, 可能会造成服务器无法连接**\n**请在有ssh之外远程到服务器上的权限再去升级ssh, 避免升级过程中导致ssh无法连接**\n\n### 3.6 修改sshd配置文件\n其实直接恢复原来的sshd_conf文件即可. 保险起见使用如下配置\n编辑sshd配置文件: ```vim /etc/ssh/sshd_config```\n添加: ```PermitRootLogin yes```\n\n### 3.7 复制sshd的pam配置文件\n```cp openssh-9.5p1/contrib/redhat/sshd.pam /etc/pam.d/sshd```\n\n\n### 3.8 使用systemctl管理sshd\n**配置启动脚本**\n```cp openssh-9.5p1/contrib/redhat/sshd.init /etc/init.d/sshd```\n\n**添加sshd的service配置文件**\n```vim /usr/lib/systemd/system/sshd.service```\n``` bash\n#vim /usr/lib/systemd/system/sshd.service\n[Unit]\nDescription=OpenSSH server daemon\nDocumentation=man:sshd(8) man:sshd_config(5)\nAfter=network.target sshd-keygen.service\nWants=sshd-keygen.service\n\n[Service]\nType=forking\nExecStart=/etc/rc.d/init.d/sshd start\nExecStop=/etc/rc.d/init.d/sshd stop\nRestart=/etc/rc.d/init.d/sshd stop\n[Install]\nWantedBy=multi-user.target\n```\n\n\n### 3.9 替换为新的 sshd\n\n```mv /usr/bin/ssh{,.back}```\n```mv /usr/sbin/sshd{,.back}```\n```ln -s /usr/local/openssh/sbin/sshd /usr/sbin/sshd```\n```ln -s /usr/local/openssh/bin/ssh /usr/bin/ssh```\n\n\n**重载systemctl**\n```systemctl daemon-reload```\n**重启sshd**\n``` systemctl restart sshd ```\n\n### 3.10 验证\n<img src=\"/images/009.openssh.md.07.png\" width=100% height=100% />\n\n\n## 四、 相关问题\n\n### 4.1 error: *** working libcrypto not found\n\n解决: ``` yum install openssl-devel ```\n\n### 4.2 error: PAM headers not found\n\n解决: ``` yum install pam-devel ```","slug":"009.openssh","published":1,"updated":"2023-12-05T08:52:30.875Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtz9s000qijnr1vwy13tj","content":"<h2 id=\"一、-安装前准备\"><a href=\"#一、-安装前准备\" class=\"headerlink\" title=\"一、 安装前准备\"></a>一、 安装前准备</h2><h3 id=\"1-1-查看当前openssh版本\"><a href=\"#1-1-查看当前openssh版本\" class=\"headerlink\" title=\"1.1 查看当前openssh版本\"></a>1.1 查看当前openssh版本</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@centos7 ~]# ssh -V</span><br><span class=\"line\">OpenSSH_7.4p1, OpenSSL 1.0.2k-fips  26 Jan 2017</span><br><span class=\"line\">[root@centos7 ~]# </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-2-查看当前openssl版本\"><a href=\"#1-2-查看当前openssl版本\" class=\"headerlink\" title=\"1.2 查看当前openssl版本\"></a>1.2 查看当前openssl版本</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@centos7 ~]# </span><br><span class=\"line\">[root@centos7 ~]# openssl version</span><br><span class=\"line\">OpenSSL 1.0.2k-fips  26 Jan 2017</span><br><span class=\"line\">[root@centos7 ~]# </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-3-安装依赖\"><a href=\"#1-3-安装依赖\" class=\"headerlink\" title=\"1.3 安装依赖\"></a>1.3 安装依赖</h3><p><code> yum install perl perl-Test-Harness perl-Test-Simple</code><br><code>yum groupinstall Development Tools</code></p>\n<h3 id=\"1-4-安装-zlib\"><a href=\"#1-4-安装-zlib\" class=\"headerlink\" title=\"1.4 安装 zlib\"></a>1.4 安装 zlib</h3><h4 id=\"1-4-1-下载\"><a href=\"#1-4-1-下载\" class=\"headerlink\" title=\"1.4.1 下载\"></a>1.4.1 下载</h4><p><code>wget http://www.zlib.net/zlib-1.3.tar.gz</code></p>\n<h4 id=\"1-4-2-解压\"><a href=\"#1-4-2-解压\" class=\"headerlink\" title=\"1.4.2 解压\"></a>1.4.2 解压</h4><p><code>tar -xzvf zlib-1.3.tar.gz</code></p>\n<h4 id=\"1-4-3编译-安装\"><a href=\"#1-4-3编译-安装\" class=\"headerlink\" title=\"1.4.3编译&amp;安装:\"></a>1.4.3编译&amp;安装:</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> zlib-1.3</span><br><span class=\"line\">./configure --prefix=/usr/local/zlib</span><br><span class=\"line\">make</span><br><span class=\"line\">make <span class=\"built_in\">test</span>  <span class=\"comment\"># 这一步出错不要继续 # 看到ok字样表示成功</span></span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"二、-安装OpenSSL\"><a href=\"#二、-安装OpenSSL\" class=\"headerlink\" title=\"二、 安装OpenSSL\"></a>二、 安装OpenSSL</h2><h3 id=\"2-1-源码编译安装\"><a href=\"#2-1-源码编译安装\" class=\"headerlink\" title=\"2.1 源码编译安装\"></a>2.1 源码编译安装</h3><blockquote>\n<p>官网下载地址: <a href=\"https://www.openssl.org/source/\">https://www.openssl.org/source/</a></p>\n</blockquote>\n<h4 id=\"2-1-1-下载\"><a href=\"#2-1-1-下载\" class=\"headerlink\" title=\"2.1.1 下载:\"></a>2.1.1 下载:</h4><p><code>wget https://www.openssl.org/source/openssl-1.1.1.tar.gz</code></p>\n<h4 id=\"2-1-2-解压\"><a href=\"#2-1-2-解压\" class=\"headerlink\" title=\"2.1.2 解压\"></a>2.1.2 解压</h4><p><code>tar -xzvf openssl-1.1.1w.tar.gz</code></p>\n<h4 id=\"2-1-3-编译-安装\"><a href=\"#2-1-3-编译-安装\" class=\"headerlink\" title=\"2.1.3 编译&amp;安装:\"></a>2.1.3 编译&amp;安装:</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> openssl-1.1.1w</span><br><span class=\"line\">./config --shared --prefix=/usr/local/openssl  <span class=\"comment\"># --shared 创建共享库</span></span><br><span class=\"line\">make -j4                                       <span class=\"comment\"># - j4 使用四个进程</span></span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"2-2-替换openssl为新版本\"><a href=\"#2-2-替换openssl为新版本\" class=\"headerlink\" title=\"2.2 替换openssl为新版本\"></a>2.2 替换openssl为新版本</h3><h4 id=\"2-2-1-替换-openssl-二进制文件\"><a href=\"#2-2-1-替换-openssl-二进制文件\" class=\"headerlink\" title=\"2.2.1 替换 openssl 二进制文件\"></a>2.2.1 替换 openssl 二进制文件</h4><p><code>mv /usr/bin/openssl&#123;,.back&#125;</code><br><code>ln -s /usr/local/openssl/bin/openssl /usr/bin/openssl</code></p>\n<h4 id=\"2-2-2-openssl-相关库\"><a href=\"#2-2-2-openssl-相关库\" class=\"headerlink\" title=\"2.2.2 openssl 相关库\"></a>2.2.2 openssl 相关库</h4><p><code>mv /usr/include/openssl&#123;,.back&#125;</code><br><code>ln -s /usr/local/openssl/include/openssl/ /usr/include/</code></p>\n<h4 id=\"2-2-3-共享库路径加入系统\"><a href=\"#2-2-3-共享库路径加入系统\" class=\"headerlink\" title=\"2.2.3 共享库路径加入系统\"></a>2.2.3 共享库路径加入系统</h4><p><code>echo &quot;/usr/local/openssl/lib&quot; &gt;&gt; /etc/ld.so.conf </code></p>\n<h4 id=\"2-2-4-验证\"><a href=\"#2-2-4-验证\" class=\"headerlink\" title=\"2.2.4 验证\"></a>2.2.4 验证</h4><p><code>ldconfig -v | grep openssl </code></p>\n<h2 id=\"三、-安装OpenSSH\"><a href=\"#三、-安装OpenSSH\" class=\"headerlink\" title=\"三、 安装OpenSSH\"></a>三、 安装OpenSSH</h2><h3 id=\"3-1-备份相关文件\"><a href=\"#3-1-备份相关文件\" class=\"headerlink\" title=\"3.1 备份相关文件\"></a>3.1 备份相关文件</h3><p><code>mv /etc/ssh&#123;,.back&#125;</code><br><code>mv /etc/pam.d/sshd&#123;,.back&#125;</code></p>\n<h3 id=\"3-2-下载\"><a href=\"#3-2-下载\" class=\"headerlink\" title=\"3.2 下载\"></a>3.2 下载</h3><p><code>wget https://mirrors.aliyun.com/pub/OpenBSD/OpenSSH/portable/openssh-9.5p1.tar.gz</code></p>\n<h3 id=\"3-3-解压\"><a href=\"#3-3-解压\" class=\"headerlink\" title=\"3.3 解压\"></a>3.3 解压</h3><p><code>tar -xzvf openssh-9.5p1.tar.gz</code></p>\n<h3 id=\"3-4-编译-安装\"><a href=\"#3-4-编译-安装\" class=\"headerlink\" title=\"3.4 编译&amp;安装\"></a>3.4 编译&amp;安装</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> openssh-9.5p1</span><br><span class=\"line\">./configure \\</span><br><span class=\"line\">--prefix=/usr/local/openssh \\</span><br><span class=\"line\">--sysconfdir=/etc/ssh \\</span><br><span class=\"line\">--with-zlib=/usr/local/zlib \\</span><br><span class=\"line\">--with-ssl-dir=/usr/local/openssl \\</span><br><span class=\"line\">--with-pam </span><br><span class=\"line\">make -j4</span><br><span class=\"line\">make tests</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-5-注意事项\"><a href=\"#3-5-注意事项\" class=\"headerlink\" title=\"3.5 注意事项\"></a>3.5 注意事项</h3><p><strong>确保使用了openssl-1.1.1</strong><br><img src=\"/images/009.openssh.md.01.png\" width=100% height=80% /><br><strong>.&#x2F;config的结果</strong><br><img src=\"/images/009.openssh.md.02.png\" width=100% height=60% /><br><strong>make tests 这里时间特别较长</strong><br><img src=\"/images/009.openssh.md.04.png\" width=100% height=100% /><br><strong>保证.key文件的权限为 0600</strong><br><img src=\"/images/009.openssh.md.05.png\" width=100% height=100% /><br><img src=\"/images/009.openssh.md.06.png\" width=100% height=100% /></p>\n<p><strong>注意: 安装完不可直接systemctl去重启sshd, 可能会造成服务器无法连接</strong><br><strong>请在有ssh之外远程到服务器上的权限再去升级ssh, 避免升级过程中导致ssh无法连接</strong></p>\n<h3 id=\"3-6-修改sshd配置文件\"><a href=\"#3-6-修改sshd配置文件\" class=\"headerlink\" title=\"3.6 修改sshd配置文件\"></a>3.6 修改sshd配置文件</h3><p>其实直接恢复原来的sshd_conf文件即可. 保险起见使用如下配置<br>编辑sshd配置文件: <code>vim /etc/ssh/sshd_config</code><br>添加: <code>PermitRootLogin yes</code></p>\n<h3 id=\"3-7-复制sshd的pam配置文件\"><a href=\"#3-7-复制sshd的pam配置文件\" class=\"headerlink\" title=\"3.7 复制sshd的pam配置文件\"></a>3.7 复制sshd的pam配置文件</h3><p><code>cp openssh-9.5p1/contrib/redhat/sshd.pam /etc/pam.d/sshd</code></p>\n<h3 id=\"3-8-使用systemctl管理sshd\"><a href=\"#3-8-使用systemctl管理sshd\" class=\"headerlink\" title=\"3.8 使用systemctl管理sshd\"></a>3.8 使用systemctl管理sshd</h3><p><strong>配置启动脚本</strong><br><code>cp openssh-9.5p1/contrib/redhat/sshd.init /etc/init.d/sshd</code></p>\n<p><strong>添加sshd的service配置文件</strong><br><code>vim /usr/lib/systemd/system/sshd.service</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#vim /usr/lib/systemd/system/sshd.service</span></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=OpenSSH server daemon</span><br><span class=\"line\">Documentation=man:sshd(8) man:sshd_config(5)</span><br><span class=\"line\">After=network.target sshd-keygen.service</span><br><span class=\"line\">Wants=sshd-keygen.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=forking</span><br><span class=\"line\">ExecStart=/etc/rc.d/init.d/sshd start</span><br><span class=\"line\">ExecStop=/etc/rc.d/init.d/sshd stop</span><br><span class=\"line\">Restart=/etc/rc.d/init.d/sshd stop</span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"3-9-替换为新的-sshd\"><a href=\"#3-9-替换为新的-sshd\" class=\"headerlink\" title=\"3.9 替换为新的 sshd\"></a>3.9 替换为新的 sshd</h3><p><code>mv /usr/bin/ssh&#123;,.back&#125;</code><br><code>mv /usr/sbin/sshd&#123;,.back&#125;</code><br><code>ln -s /usr/local/openssh/sbin/sshd /usr/sbin/sshd</code><br><code>ln -s /usr/local/openssh/bin/ssh /usr/bin/ssh</code></p>\n<p><strong>重载systemctl</strong><br><code>systemctl daemon-reload</code><br><strong>重启sshd</strong><br><code>systemctl restart sshd</code></p>\n<h3 id=\"3-10-验证\"><a href=\"#3-10-验证\" class=\"headerlink\" title=\"3.10 验证\"></a>3.10 验证</h3><img src=\"/images/009.openssh.md.07.png\" width=100% height=100% />\n\n\n<h2 id=\"四、-相关问题\"><a href=\"#四、-相关问题\" class=\"headerlink\" title=\"四、 相关问题\"></a>四、 相关问题</h2><h3 id=\"4-1-error-working-libcrypto-not-found\"><a href=\"#4-1-error-working-libcrypto-not-found\" class=\"headerlink\" title=\"4.1 error: *** working libcrypto not found\"></a>4.1 error: *** working libcrypto not found</h3><p>解决: <code>yum install openssl-devel</code></p>\n<h3 id=\"4-2-error-PAM-headers-not-found\"><a href=\"#4-2-error-PAM-headers-not-found\" class=\"headerlink\" title=\"4.2 error: PAM headers not found\"></a>4.2 error: PAM headers not found</h3><p>解决: <code>yum install pam-devel</code></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、-安装前准备\"><a href=\"#一、-安装前准备\" class=\"headerlink\" title=\"一、 安装前准备\"></a>一、 安装前准备</h2><h3 id=\"1-1-查看当前openssh版本\"><a href=\"#1-1-查看当前openssh版本\" class=\"headerlink\" title=\"1.1 查看当前openssh版本\"></a>1.1 查看当前openssh版本</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@centos7 ~]# ssh -V</span><br><span class=\"line\">OpenSSH_7.4p1, OpenSSL 1.0.2k-fips  26 Jan 2017</span><br><span class=\"line\">[root@centos7 ~]# </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-2-查看当前openssl版本\"><a href=\"#1-2-查看当前openssl版本\" class=\"headerlink\" title=\"1.2 查看当前openssl版本\"></a>1.2 查看当前openssl版本</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@centos7 ~]# </span><br><span class=\"line\">[root@centos7 ~]# openssl version</span><br><span class=\"line\">OpenSSL 1.0.2k-fips  26 Jan 2017</span><br><span class=\"line\">[root@centos7 ~]# </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-3-安装依赖\"><a href=\"#1-3-安装依赖\" class=\"headerlink\" title=\"1.3 安装依赖\"></a>1.3 安装依赖</h3><p><code> yum install perl perl-Test-Harness perl-Test-Simple</code><br><code>yum groupinstall Development Tools</code></p>\n<h3 id=\"1-4-安装-zlib\"><a href=\"#1-4-安装-zlib\" class=\"headerlink\" title=\"1.4 安装 zlib\"></a>1.4 安装 zlib</h3><h4 id=\"1-4-1-下载\"><a href=\"#1-4-1-下载\" class=\"headerlink\" title=\"1.4.1 下载\"></a>1.4.1 下载</h4><p><code>wget http://www.zlib.net/zlib-1.3.tar.gz</code></p>\n<h4 id=\"1-4-2-解压\"><a href=\"#1-4-2-解压\" class=\"headerlink\" title=\"1.4.2 解压\"></a>1.4.2 解压</h4><p><code>tar -xzvf zlib-1.3.tar.gz</code></p>\n<h4 id=\"1-4-3编译-安装\"><a href=\"#1-4-3编译-安装\" class=\"headerlink\" title=\"1.4.3编译&amp;安装:\"></a>1.4.3编译&amp;安装:</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> zlib-1.3</span><br><span class=\"line\">./configure --prefix=/usr/local/zlib</span><br><span class=\"line\">make</span><br><span class=\"line\">make <span class=\"built_in\">test</span>  <span class=\"comment\"># 这一步出错不要继续 # 看到ok字样表示成功</span></span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"二、-安装OpenSSL\"><a href=\"#二、-安装OpenSSL\" class=\"headerlink\" title=\"二、 安装OpenSSL\"></a>二、 安装OpenSSL</h2><h3 id=\"2-1-源码编译安装\"><a href=\"#2-1-源码编译安装\" class=\"headerlink\" title=\"2.1 源码编译安装\"></a>2.1 源码编译安装</h3><blockquote>\n<p>官网下载地址: <a href=\"https://www.openssl.org/source/\">https://www.openssl.org/source/</a></p>\n</blockquote>\n<h4 id=\"2-1-1-下载\"><a href=\"#2-1-1-下载\" class=\"headerlink\" title=\"2.1.1 下载:\"></a>2.1.1 下载:</h4><p><code>wget https://www.openssl.org/source/openssl-1.1.1.tar.gz</code></p>\n<h4 id=\"2-1-2-解压\"><a href=\"#2-1-2-解压\" class=\"headerlink\" title=\"2.1.2 解压\"></a>2.1.2 解压</h4><p><code>tar -xzvf openssl-1.1.1w.tar.gz</code></p>\n<h4 id=\"2-1-3-编译-安装\"><a href=\"#2-1-3-编译-安装\" class=\"headerlink\" title=\"2.1.3 编译&amp;安装:\"></a>2.1.3 编译&amp;安装:</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> openssl-1.1.1w</span><br><span class=\"line\">./config --shared --prefix=/usr/local/openssl  <span class=\"comment\"># --shared 创建共享库</span></span><br><span class=\"line\">make -j4                                       <span class=\"comment\"># - j4 使用四个进程</span></span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"2-2-替换openssl为新版本\"><a href=\"#2-2-替换openssl为新版本\" class=\"headerlink\" title=\"2.2 替换openssl为新版本\"></a>2.2 替换openssl为新版本</h3><h4 id=\"2-2-1-替换-openssl-二进制文件\"><a href=\"#2-2-1-替换-openssl-二进制文件\" class=\"headerlink\" title=\"2.2.1 替换 openssl 二进制文件\"></a>2.2.1 替换 openssl 二进制文件</h4><p><code>mv /usr/bin/openssl&#123;,.back&#125;</code><br><code>ln -s /usr/local/openssl/bin/openssl /usr/bin/openssl</code></p>\n<h4 id=\"2-2-2-openssl-相关库\"><a href=\"#2-2-2-openssl-相关库\" class=\"headerlink\" title=\"2.2.2 openssl 相关库\"></a>2.2.2 openssl 相关库</h4><p><code>mv /usr/include/openssl&#123;,.back&#125;</code><br><code>ln -s /usr/local/openssl/include/openssl/ /usr/include/</code></p>\n<h4 id=\"2-2-3-共享库路径加入系统\"><a href=\"#2-2-3-共享库路径加入系统\" class=\"headerlink\" title=\"2.2.3 共享库路径加入系统\"></a>2.2.3 共享库路径加入系统</h4><p><code>echo &quot;/usr/local/openssl/lib&quot; &gt;&gt; /etc/ld.so.conf </code></p>\n<h4 id=\"2-2-4-验证\"><a href=\"#2-2-4-验证\" class=\"headerlink\" title=\"2.2.4 验证\"></a>2.2.4 验证</h4><p><code>ldconfig -v | grep openssl </code></p>\n<h2 id=\"三、-安装OpenSSH\"><a href=\"#三、-安装OpenSSH\" class=\"headerlink\" title=\"三、 安装OpenSSH\"></a>三、 安装OpenSSH</h2><h3 id=\"3-1-备份相关文件\"><a href=\"#3-1-备份相关文件\" class=\"headerlink\" title=\"3.1 备份相关文件\"></a>3.1 备份相关文件</h3><p><code>mv /etc/ssh&#123;,.back&#125;</code><br><code>mv /etc/pam.d/sshd&#123;,.back&#125;</code></p>\n<h3 id=\"3-2-下载\"><a href=\"#3-2-下载\" class=\"headerlink\" title=\"3.2 下载\"></a>3.2 下载</h3><p><code>wget https://mirrors.aliyun.com/pub/OpenBSD/OpenSSH/portable/openssh-9.5p1.tar.gz</code></p>\n<h3 id=\"3-3-解压\"><a href=\"#3-3-解压\" class=\"headerlink\" title=\"3.3 解压\"></a>3.3 解压</h3><p><code>tar -xzvf openssh-9.5p1.tar.gz</code></p>\n<h3 id=\"3-4-编译-安装\"><a href=\"#3-4-编译-安装\" class=\"headerlink\" title=\"3.4 编译&amp;安装\"></a>3.4 编译&amp;安装</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> openssh-9.5p1</span><br><span class=\"line\">./configure \\</span><br><span class=\"line\">--prefix=/usr/local/openssh \\</span><br><span class=\"line\">--sysconfdir=/etc/ssh \\</span><br><span class=\"line\">--with-zlib=/usr/local/zlib \\</span><br><span class=\"line\">--with-ssl-dir=/usr/local/openssl \\</span><br><span class=\"line\">--with-pam </span><br><span class=\"line\">make -j4</span><br><span class=\"line\">make tests</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-5-注意事项\"><a href=\"#3-5-注意事项\" class=\"headerlink\" title=\"3.5 注意事项\"></a>3.5 注意事项</h3><p><strong>确保使用了openssl-1.1.1</strong><br><img src=\"/images/009.openssh.md.01.png\" width=100% height=80% /><br><strong>.&#x2F;config的结果</strong><br><img src=\"/images/009.openssh.md.02.png\" width=100% height=60% /><br><strong>make tests 这里时间特别较长</strong><br><img src=\"/images/009.openssh.md.04.png\" width=100% height=100% /><br><strong>保证.key文件的权限为 0600</strong><br><img src=\"/images/009.openssh.md.05.png\" width=100% height=100% /><br><img src=\"/images/009.openssh.md.06.png\" width=100% height=100% /></p>\n<p><strong>注意: 安装完不可直接systemctl去重启sshd, 可能会造成服务器无法连接</strong><br><strong>请在有ssh之外远程到服务器上的权限再去升级ssh, 避免升级过程中导致ssh无法连接</strong></p>\n<h3 id=\"3-6-修改sshd配置文件\"><a href=\"#3-6-修改sshd配置文件\" class=\"headerlink\" title=\"3.6 修改sshd配置文件\"></a>3.6 修改sshd配置文件</h3><p>其实直接恢复原来的sshd_conf文件即可. 保险起见使用如下配置<br>编辑sshd配置文件: <code>vim /etc/ssh/sshd_config</code><br>添加: <code>PermitRootLogin yes</code></p>\n<h3 id=\"3-7-复制sshd的pam配置文件\"><a href=\"#3-7-复制sshd的pam配置文件\" class=\"headerlink\" title=\"3.7 复制sshd的pam配置文件\"></a>3.7 复制sshd的pam配置文件</h3><p><code>cp openssh-9.5p1/contrib/redhat/sshd.pam /etc/pam.d/sshd</code></p>\n<h3 id=\"3-8-使用systemctl管理sshd\"><a href=\"#3-8-使用systemctl管理sshd\" class=\"headerlink\" title=\"3.8 使用systemctl管理sshd\"></a>3.8 使用systemctl管理sshd</h3><p><strong>配置启动脚本</strong><br><code>cp openssh-9.5p1/contrib/redhat/sshd.init /etc/init.d/sshd</code></p>\n<p><strong>添加sshd的service配置文件</strong><br><code>vim /usr/lib/systemd/system/sshd.service</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#vim /usr/lib/systemd/system/sshd.service</span></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=OpenSSH server daemon</span><br><span class=\"line\">Documentation=man:sshd(8) man:sshd_config(5)</span><br><span class=\"line\">After=network.target sshd-keygen.service</span><br><span class=\"line\">Wants=sshd-keygen.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=forking</span><br><span class=\"line\">ExecStart=/etc/rc.d/init.d/sshd start</span><br><span class=\"line\">ExecStop=/etc/rc.d/init.d/sshd stop</span><br><span class=\"line\">Restart=/etc/rc.d/init.d/sshd stop</span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"3-9-替换为新的-sshd\"><a href=\"#3-9-替换为新的-sshd\" class=\"headerlink\" title=\"3.9 替换为新的 sshd\"></a>3.9 替换为新的 sshd</h3><p><code>mv /usr/bin/ssh&#123;,.back&#125;</code><br><code>mv /usr/sbin/sshd&#123;,.back&#125;</code><br><code>ln -s /usr/local/openssh/sbin/sshd /usr/sbin/sshd</code><br><code>ln -s /usr/local/openssh/bin/ssh /usr/bin/ssh</code></p>\n<p><strong>重载systemctl</strong><br><code>systemctl daemon-reload</code><br><strong>重启sshd</strong><br><code>systemctl restart sshd</code></p>\n<h3 id=\"3-10-验证\"><a href=\"#3-10-验证\" class=\"headerlink\" title=\"3.10 验证\"></a>3.10 验证</h3><img src=\"/images/009.openssh.md.07.png\" width=100% height=100% />\n\n\n<h2 id=\"四、-相关问题\"><a href=\"#四、-相关问题\" class=\"headerlink\" title=\"四、 相关问题\"></a>四、 相关问题</h2><h3 id=\"4-1-error-working-libcrypto-not-found\"><a href=\"#4-1-error-working-libcrypto-not-found\" class=\"headerlink\" title=\"4.1 error: *** working libcrypto not found\"></a>4.1 error: *** working libcrypto not found</h3><p>解决: <code>yum install openssl-devel</code></p>\n<h3 id=\"4-2-error-PAM-headers-not-found\"><a href=\"#4-2-error-PAM-headers-not-found\" class=\"headerlink\" title=\"4.2 error: PAM headers not found\"></a>4.2 error: PAM headers not found</h3><p>解决: <code>yum install pam-devel</code></p>\n"},{"title":"gcc-4.8.5升级gcc-11.2.0","date":"2022-05-23T02:33:08.000Z","_content":"\n> 环境说明: 在一台刚安装好的centos7.9上安装gcc-11.2.0\n\n\n0) 下载 gcc-11.2.0\n``` wget --no-check-certificate https://ftp.gnu.org/gnu/gcc/gcc-11.2.0/gcc-11.2.0.tar.gz ```\n\n1) 解压\n``` tar -zxvf gcc-11.2.0.tar.gz ```\n\n2) 执行下载依赖环境的脚本\n``` yum install bzip2 gcc gcc-c++```\n```  ./contrib/download_prerequisites ```\n\n3) 编译安装\n``` cd gcc-11.2.0 ```\n```mkdir build```\n```cd build/```\n```../configure -enable-checking=release -enable-languages=c,c++ -disable-multilib```\n``` make -j4 ```\n``` make install```\n**–enable-languages表示你要让你的gcc支持那些语言**\n**–disable-multilib不生成编译为其他平台可执行代码的交叉编译器**\n**–disable-checking生成的编译器在编译过程中不做额外检查**\n**也可以使用 *–enable-checking=xxx* 来增加一些检查**\n\n4) 删除旧版gcc以及配置全局gcc\n``` yum remove gcc g++ ```\n``` ln -s /usr/local/bin/gcc /usr/bin/gcc ```\n\n5) 验证安装\n``` gcc -v ```\n\n\n\n","source":"_posts/010.gcc_update.md","raw":"---\ntitle: gcc-4.8.5升级gcc-11.2.0\ndate: 2022-05-23 10:33:08\ncategories: \n- [Linux]\n- [CentOS]\ntags: \n- gcc\n---\n\n> 环境说明: 在一台刚安装好的centos7.9上安装gcc-11.2.0\n\n\n0) 下载 gcc-11.2.0\n``` wget --no-check-certificate https://ftp.gnu.org/gnu/gcc/gcc-11.2.0/gcc-11.2.0.tar.gz ```\n\n1) 解压\n``` tar -zxvf gcc-11.2.0.tar.gz ```\n\n2) 执行下载依赖环境的脚本\n``` yum install bzip2 gcc gcc-c++```\n```  ./contrib/download_prerequisites ```\n\n3) 编译安装\n``` cd gcc-11.2.0 ```\n```mkdir build```\n```cd build/```\n```../configure -enable-checking=release -enable-languages=c,c++ -disable-multilib```\n``` make -j4 ```\n``` make install```\n**–enable-languages表示你要让你的gcc支持那些语言**\n**–disable-multilib不生成编译为其他平台可执行代码的交叉编译器**\n**–disable-checking生成的编译器在编译过程中不做额外检查**\n**也可以使用 *–enable-checking=xxx* 来增加一些检查**\n\n4) 删除旧版gcc以及配置全局gcc\n``` yum remove gcc g++ ```\n``` ln -s /usr/local/bin/gcc /usr/bin/gcc ```\n\n5) 验证安装\n``` gcc -v ```\n\n\n\n","slug":"010.gcc_update","published":1,"updated":"2023-12-05T08:52:30.875Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtz9x000vijnr0o6h2qqc","content":"<blockquote>\n<p>环境说明: 在一台刚安装好的centos7.9上安装gcc-11.2.0</p>\n</blockquote>\n<ol start=\"0\">\n<li>下载 gcc-11.2.0</li>\n</ol>\n<p><code>wget --no-check-certificate https://ftp.gnu.org/gnu/gcc/gcc-11.2.0/gcc-11.2.0.tar.gz</code></p>\n<ol>\n<li>解压</li>\n</ol>\n<p><code>tar -zxvf gcc-11.2.0.tar.gz</code></p>\n<ol start=\"2\">\n<li>执行下载依赖环境的脚本</li>\n</ol>\n<p><code> yum install bzip2 gcc gcc-c++</code><br><code> ./contrib/download_prerequisites</code></p>\n<ol start=\"3\">\n<li>编译安装</li>\n</ol>\n<p><code>cd gcc-11.2.0</code><br><code>mkdir build</code><br><code>cd build/</code><br><code>../configure -enable-checking=release -enable-languages=c,c++ -disable-multilib</code><br><code>make -j4</code><br><code> make install</code><br><strong>–enable-languages表示你要让你的gcc支持那些语言</strong><br><strong>–disable-multilib不生成编译为其他平台可执行代码的交叉编译器</strong><br><strong>–disable-checking生成的编译器在编译过程中不做额外检查</strong><br><strong>也可以使用 <em>–enable-checking&#x3D;xxx</em> 来增加一些检查</strong></p>\n<ol start=\"4\">\n<li>删除旧版gcc以及配置全局gcc</li>\n</ol>\n<p><code>yum remove gcc g++</code><br><code>ln -s /usr/local/bin/gcc /usr/bin/gcc</code></p>\n<ol start=\"5\">\n<li>验证安装</li>\n</ol>\n<p><code>gcc -v</code></p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>环境说明: 在一台刚安装好的centos7.9上安装gcc-11.2.0</p>\n</blockquote>\n<ol start=\"0\">\n<li>下载 gcc-11.2.0</li>\n</ol>\n<p><code>wget --no-check-certificate https://ftp.gnu.org/gnu/gcc/gcc-11.2.0/gcc-11.2.0.tar.gz</code></p>\n<ol>\n<li>解压</li>\n</ol>\n<p><code>tar -zxvf gcc-11.2.0.tar.gz</code></p>\n<ol start=\"2\">\n<li>执行下载依赖环境的脚本</li>\n</ol>\n<p><code> yum install bzip2 gcc gcc-c++</code><br><code> ./contrib/download_prerequisites</code></p>\n<ol start=\"3\">\n<li>编译安装</li>\n</ol>\n<p><code>cd gcc-11.2.0</code><br><code>mkdir build</code><br><code>cd build/</code><br><code>../configure -enable-checking=release -enable-languages=c,c++ -disable-multilib</code><br><code>make -j4</code><br><code> make install</code><br><strong>–enable-languages表示你要让你的gcc支持那些语言</strong><br><strong>–disable-multilib不生成编译为其他平台可执行代码的交叉编译器</strong><br><strong>–disable-checking生成的编译器在编译过程中不做额外检查</strong><br><strong>也可以使用 <em>–enable-checking&#x3D;xxx</em> 来增加一些检查</strong></p>\n<ol start=\"4\">\n<li>删除旧版gcc以及配置全局gcc</li>\n</ol>\n<p><code>yum remove gcc g++</code><br><code>ln -s /usr/local/bin/gcc /usr/bin/gcc</code></p>\n<ol start=\"5\">\n<li>验证安装</li>\n</ol>\n<p><code>gcc -v</code></p>\n"},{"title":"apache-doris 编译安装","date":"2022-05-24T02:33:08.000Z","_content":"\n> Apache Doris是一个现代化的MPP分析型数据库产品。仅需亚秒级响应时间即可获得查询结果，有效地支持实时数据分析。Apache Doris的分布式架构非常简洁，易于运维，并且可以支持10PB以上的超大数据集。\n\n> [详情参见官方文档](https://doris.apache.org/zh-CN/get-starting/get-starting.html)\n\n**推荐在docker环境下编译, CentOS和Ubuntu都尝试过, 直接编译对环境的依赖很复杂, 非常容易编译失败.**\n\n**docker的安装在这里不赘述, 默认你已经有了docker环境**\n\n0) 下载镜像\n``` docker pull apache/incubator-doris:build-env-ldb-toolchain-latest ```\n\n1) 运行镜像\n``` docker run -it -v /root/.m2/:/root/.m2 -v /root/apache-doris-1.0.0-incubating-src:/root/apache-doris-1.0.0-incubating-src --privileged=true apache/incubator-doris:build-env-ldb-toolchain-latest```\n\n- 将docker镜像中的.m2挂载到宿主机, 防止每次启动镜像编译时，重复下载 maven 的依赖库.\n```  -v /root/.m2/:/root/.m2 ``` \n- 将本地的源码挂载到镜像中, 这样编译的产出二进制文件会存储在宿主机中, 不会因为镜像退出而消失.\n``` -v /root/apache-doris-1.0.0-incubating-src:/root/apache-doris-1.0.0-incubating-src``` \n\n2) 查看cpu是否支持 AVX2 指令\n``` cat /proc/cpuinfo | grep avx2 ```\n\n3) 编译\n- 支持 AVX2 指令\n``` sh build.sh ```\n- 不支持 AVX2 指令\n``` USE_AVX2=0  sh build.sh ```\n\n4) 打包编译的产出\n``` tar -zcvf doris.tar.gz /doris-path/output/* ```","source":"_posts/011.apache-doris.md","raw":"---\ntitle: apache-doris 编译安装\ndate: 2022-05-24 10:33:08\ncategories: \n- [Database]\ntags: \n- apache-doris\n- docker\n---\n\n> Apache Doris是一个现代化的MPP分析型数据库产品。仅需亚秒级响应时间即可获得查询结果，有效地支持实时数据分析。Apache Doris的分布式架构非常简洁，易于运维，并且可以支持10PB以上的超大数据集。\n\n> [详情参见官方文档](https://doris.apache.org/zh-CN/get-starting/get-starting.html)\n\n**推荐在docker环境下编译, CentOS和Ubuntu都尝试过, 直接编译对环境的依赖很复杂, 非常容易编译失败.**\n\n**docker的安装在这里不赘述, 默认你已经有了docker环境**\n\n0) 下载镜像\n``` docker pull apache/incubator-doris:build-env-ldb-toolchain-latest ```\n\n1) 运行镜像\n``` docker run -it -v /root/.m2/:/root/.m2 -v /root/apache-doris-1.0.0-incubating-src:/root/apache-doris-1.0.0-incubating-src --privileged=true apache/incubator-doris:build-env-ldb-toolchain-latest```\n\n- 将docker镜像中的.m2挂载到宿主机, 防止每次启动镜像编译时，重复下载 maven 的依赖库.\n```  -v /root/.m2/:/root/.m2 ``` \n- 将本地的源码挂载到镜像中, 这样编译的产出二进制文件会存储在宿主机中, 不会因为镜像退出而消失.\n``` -v /root/apache-doris-1.0.0-incubating-src:/root/apache-doris-1.0.0-incubating-src``` \n\n2) 查看cpu是否支持 AVX2 指令\n``` cat /proc/cpuinfo | grep avx2 ```\n\n3) 编译\n- 支持 AVX2 指令\n``` sh build.sh ```\n- 不支持 AVX2 指令\n``` USE_AVX2=0  sh build.sh ```\n\n4) 打包编译的产出\n``` tar -zcvf doris.tar.gz /doris-path/output/* ```","slug":"011.apache-doris","published":1,"updated":"2023-12-05T08:52:30.875Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtza1000yijnr6b5j2ayi","content":"<blockquote>\n<p>Apache Doris是一个现代化的MPP分析型数据库产品。仅需亚秒级响应时间即可获得查询结果，有效地支持实时数据分析。Apache Doris的分布式架构非常简洁，易于运维，并且可以支持10PB以上的超大数据集。</p>\n</blockquote>\n<blockquote>\n<p><a href=\"https://doris.apache.org/zh-CN/get-starting/get-starting.html\">详情参见官方文档</a></p>\n</blockquote>\n<p><strong>推荐在docker环境下编译, CentOS和Ubuntu都尝试过, 直接编译对环境的依赖很复杂, 非常容易编译失败.</strong></p>\n<p><strong>docker的安装在这里不赘述, 默认你已经有了docker环境</strong></p>\n<ol start=\"0\">\n<li>下载镜像</li>\n</ol>\n<p><code>docker pull apache/incubator-doris:build-env-ldb-toolchain-latest</code></p>\n<ol>\n<li>运行镜像</li>\n</ol>\n<p><code> docker run -it -v /root/.m2/:/root/.m2 -v /root/apache-doris-1.0.0-incubating-src:/root/apache-doris-1.0.0-incubating-src --privileged=true apache/incubator-doris:build-env-ldb-toolchain-latest</code></p>\n<ul>\n<li>将docker镜像中的.m2挂载到宿主机, 防止每次启动镜像编译时，重复下载 maven 的依赖库.</li>\n</ul>\n<p><code> -v /root/.m2/:/root/.m2</code> </p>\n<ul>\n<li>将本地的源码挂载到镜像中, 这样编译的产出二进制文件会存储在宿主机中, 不会因为镜像退出而消失.</li>\n</ul>\n<p><code> -v /root/apache-doris-1.0.0-incubating-src:/root/apache-doris-1.0.0-incubating-src</code> </p>\n<ol start=\"2\">\n<li>查看cpu是否支持 AVX2 指令</li>\n</ol>\n<p><code>cat /proc/cpuinfo | grep avx2</code></p>\n<ol start=\"3\">\n<li>编译</li>\n</ol>\n<ul>\n<li>支持 AVX2 指令</li>\n</ul>\n<p><code>sh build.sh</code></p>\n<ul>\n<li>不支持 AVX2 指令</li>\n</ul>\n<p><code>USE_AVX2=0  sh build.sh</code></p>\n<ol start=\"4\">\n<li>打包编译的产出</li>\n</ol>\n<p><code>tar -zcvf doris.tar.gz /doris-path/output/*</code></p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>Apache Doris是一个现代化的MPP分析型数据库产品。仅需亚秒级响应时间即可获得查询结果，有效地支持实时数据分析。Apache Doris的分布式架构非常简洁，易于运维，并且可以支持10PB以上的超大数据集。</p>\n</blockquote>\n<blockquote>\n<p><a href=\"https://doris.apache.org/zh-CN/get-starting/get-starting.html\">详情参见官方文档</a></p>\n</blockquote>\n<p><strong>推荐在docker环境下编译, CentOS和Ubuntu都尝试过, 直接编译对环境的依赖很复杂, 非常容易编译失败.</strong></p>\n<p><strong>docker的安装在这里不赘述, 默认你已经有了docker环境</strong></p>\n<ol start=\"0\">\n<li>下载镜像</li>\n</ol>\n<p><code>docker pull apache/incubator-doris:build-env-ldb-toolchain-latest</code></p>\n<ol>\n<li>运行镜像</li>\n</ol>\n<p><code> docker run -it -v /root/.m2/:/root/.m2 -v /root/apache-doris-1.0.0-incubating-src:/root/apache-doris-1.0.0-incubating-src --privileged=true apache/incubator-doris:build-env-ldb-toolchain-latest</code></p>\n<ul>\n<li>将docker镜像中的.m2挂载到宿主机, 防止每次启动镜像编译时，重复下载 maven 的依赖库.</li>\n</ul>\n<p><code> -v /root/.m2/:/root/.m2</code> </p>\n<ul>\n<li>将本地的源码挂载到镜像中, 这样编译的产出二进制文件会存储在宿主机中, 不会因为镜像退出而消失.</li>\n</ul>\n<p><code> -v /root/apache-doris-1.0.0-incubating-src:/root/apache-doris-1.0.0-incubating-src</code> </p>\n<ol start=\"2\">\n<li>查看cpu是否支持 AVX2 指令</li>\n</ol>\n<p><code>cat /proc/cpuinfo | grep avx2</code></p>\n<ol start=\"3\">\n<li>编译</li>\n</ol>\n<ul>\n<li>支持 AVX2 指令</li>\n</ul>\n<p><code>sh build.sh</code></p>\n<ul>\n<li>不支持 AVX2 指令</li>\n</ul>\n<p><code>USE_AVX2=0  sh build.sh</code></p>\n<ol start=\"4\">\n<li>打包编译的产出</li>\n</ol>\n<p><code>tar -zcvf doris.tar.gz /doris-path/output/*</code></p>\n"},{"title":"Installation of Docker","date":"2021-03-18T07:48:13.000Z","_content":"\n# 0、Env\n\n**Environment :** \n- CentOS Linux release 7.9.2009 (Core)\n- Client: Docker Engine - Community  Version:  20.10.5\n- Server: Docker Engine - Community Version:   20.10.5\n\n\n**Installation (text-based installer)**\n\n## 1、Download *docker-ce.repo*\n   ```wget -O /etc/yum.repos.d/docker-ce.repo https://download.docker.com/linux/centos/docker-ce.repo```\n\n## 2、Change sources to TUNA\n```sed -i 's+https://download.docker.com+https://mirror.nju.edu.cn/docker-ce+' /etc/yum.repos.d/docker-ce.repo```\n\n## 3、Installating\n```yum makecache fast```\n```yum  install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin```\n\n## 4、Start service\n```systemctl start docker```\n\n## 5、Verify \n``` docker --version```  \n\n## 6、e.g\n```docker run hello-world```\n\n**If you've seen such this whitch means the docker have succeed run on you system.**\n![image.png](/images/012.docker_installation.md.01.png)\n\n## 7、Some improvements\n\nchange source \n``` vim /etc/docker/daemon.json``` \ntouch it if there was not such file\n```\n{\n  \"registry-mirrors\": [\n    \"https://hub-mirror.c.163.com\",\n    \"https://mirror.baidubce.com\"\n  ]\n}\n```","source":"_posts/012.docker_installation.md","raw":"---\ntitle: Installation of Docker \ndate: 2021-03-18 15:48:13\ncategories: \n  - [Docker]\ntags: \n- docker\n---\n\n# 0、Env\n\n**Environment :** \n- CentOS Linux release 7.9.2009 (Core)\n- Client: Docker Engine - Community  Version:  20.10.5\n- Server: Docker Engine - Community Version:   20.10.5\n\n\n**Installation (text-based installer)**\n\n## 1、Download *docker-ce.repo*\n   ```wget -O /etc/yum.repos.d/docker-ce.repo https://download.docker.com/linux/centos/docker-ce.repo```\n\n## 2、Change sources to TUNA\n```sed -i 's+https://download.docker.com+https://mirror.nju.edu.cn/docker-ce+' /etc/yum.repos.d/docker-ce.repo```\n\n## 3、Installating\n```yum makecache fast```\n```yum  install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin```\n\n## 4、Start service\n```systemctl start docker```\n\n## 5、Verify \n``` docker --version```  \n\n## 6、e.g\n```docker run hello-world```\n\n**If you've seen such this whitch means the docker have succeed run on you system.**\n![image.png](/images/012.docker_installation.md.01.png)\n\n## 7、Some improvements\n\nchange source \n``` vim /etc/docker/daemon.json``` \ntouch it if there was not such file\n```\n{\n  \"registry-mirrors\": [\n    \"https://hub-mirror.c.163.com\",\n    \"https://mirror.baidubce.com\"\n  ]\n}\n```","slug":"012.docker_installation","published":1,"updated":"2023-12-05T08:52:30.875Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtza60012ijnr6nna8dct","content":"<h1 id=\"0、Env\"><a href=\"#0、Env\" class=\"headerlink\" title=\"0、Env\"></a>0、Env</h1><p><strong>Environment :</strong> </p>\n<ul>\n<li>CentOS Linux release 7.9.2009 (Core)</li>\n<li>Client: Docker Engine - Community  Version:  20.10.5</li>\n<li>Server: Docker Engine - Community Version:   20.10.5</li>\n</ul>\n<p><strong>Installation (text-based installer)</strong></p>\n<h2 id=\"1、Download-docker-ce-repo\"><a href=\"#1、Download-docker-ce-repo\" class=\"headerlink\" title=\"1、Download docker-ce.repo\"></a>1、Download <em>docker-ce.repo</em></h2><p>   <code>wget -O /etc/yum.repos.d/docker-ce.repo https://download.docker.com/linux/centos/docker-ce.repo</code></p>\n<h2 id=\"2、Change-sources-to-TUNA\"><a href=\"#2、Change-sources-to-TUNA\" class=\"headerlink\" title=\"2、Change sources to TUNA\"></a>2、Change sources to TUNA</h2><p><code>sed -i &#39;s+https://download.docker.com+https://mirror.nju.edu.cn/docker-ce+&#39; /etc/yum.repos.d/docker-ce.repo</code></p>\n<h2 id=\"3、Installating\"><a href=\"#3、Installating\" class=\"headerlink\" title=\"3、Installating\"></a>3、Installating</h2><p><code>yum makecache fast</code><br><code>yum  install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</code></p>\n<h2 id=\"4、Start-service\"><a href=\"#4、Start-service\" class=\"headerlink\" title=\"4、Start service\"></a>4、Start service</h2><p><code>systemctl start docker</code></p>\n<h2 id=\"5、Verify\"><a href=\"#5、Verify\" class=\"headerlink\" title=\"5、Verify\"></a>5、Verify</h2><p><code> docker --version</code>  </p>\n<h2 id=\"6、e-g\"><a href=\"#6、e-g\" class=\"headerlink\" title=\"6、e.g\"></a>6、e.g</h2><p><code>docker run hello-world</code></p>\n<p><strong>If you’ve seen such this whitch means the docker have succeed run on you system.</strong><br><img src=\"/images/012.docker_installation.md.01.png\" alt=\"image.png\"></p>\n<h2 id=\"7、Some-improvements\"><a href=\"#7、Some-improvements\" class=\"headerlink\" title=\"7、Some improvements\"></a>7、Some improvements</h2><p>change source<br><code> vim /etc/docker/daemon.json</code><br>touch it if there was not such file</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;registry-mirrors&quot;: [</span><br><span class=\"line\">    &quot;https://hub-mirror.c.163.com&quot;,</span><br><span class=\"line\">    &quot;https://mirror.baidubce.com&quot;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"0、Env\"><a href=\"#0、Env\" class=\"headerlink\" title=\"0、Env\"></a>0、Env</h1><p><strong>Environment :</strong> </p>\n<ul>\n<li>CentOS Linux release 7.9.2009 (Core)</li>\n<li>Client: Docker Engine - Community  Version:  20.10.5</li>\n<li>Server: Docker Engine - Community Version:   20.10.5</li>\n</ul>\n<p><strong>Installation (text-based installer)</strong></p>\n<h2 id=\"1、Download-docker-ce-repo\"><a href=\"#1、Download-docker-ce-repo\" class=\"headerlink\" title=\"1、Download docker-ce.repo\"></a>1、Download <em>docker-ce.repo</em></h2><p>   <code>wget -O /etc/yum.repos.d/docker-ce.repo https://download.docker.com/linux/centos/docker-ce.repo</code></p>\n<h2 id=\"2、Change-sources-to-TUNA\"><a href=\"#2、Change-sources-to-TUNA\" class=\"headerlink\" title=\"2、Change sources to TUNA\"></a>2、Change sources to TUNA</h2><p><code>sed -i &#39;s+https://download.docker.com+https://mirror.nju.edu.cn/docker-ce+&#39; /etc/yum.repos.d/docker-ce.repo</code></p>\n<h2 id=\"3、Installating\"><a href=\"#3、Installating\" class=\"headerlink\" title=\"3、Installating\"></a>3、Installating</h2><p><code>yum makecache fast</code><br><code>yum  install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</code></p>\n<h2 id=\"4、Start-service\"><a href=\"#4、Start-service\" class=\"headerlink\" title=\"4、Start service\"></a>4、Start service</h2><p><code>systemctl start docker</code></p>\n<h2 id=\"5、Verify\"><a href=\"#5、Verify\" class=\"headerlink\" title=\"5、Verify\"></a>5、Verify</h2><p><code> docker --version</code>  </p>\n<h2 id=\"6、e-g\"><a href=\"#6、e-g\" class=\"headerlink\" title=\"6、e.g\"></a>6、e.g</h2><p><code>docker run hello-world</code></p>\n<p><strong>If you’ve seen such this whitch means the docker have succeed run on you system.</strong><br><img src=\"/images/012.docker_installation.md.01.png\" alt=\"image.png\"></p>\n<h2 id=\"7、Some-improvements\"><a href=\"#7、Some-improvements\" class=\"headerlink\" title=\"7、Some improvements\"></a>7、Some improvements</h2><p>change source<br><code> vim /etc/docker/daemon.json</code><br>touch it if there was not such file</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;registry-mirrors&quot;: [</span><br><span class=\"line\">    &quot;https://hub-mirror.c.163.com&quot;,</span><br><span class=\"line\">    &quot;https://mirror.baidubce.com&quot;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"keepalived配置nginx高可用","date":"2020-03-18T07:48:13.000Z","_content":"\n## 名词解释:\n高可用: High Availability (HA)\n负载均衡: Load Balance (LB) \n服务器负载均衡: Server Load Balancing (SLB)\n\n区别: 高可用性：顾名思义，尽可能采取措施减少系统服务中断时间，进而提高业务程序持续对外提供服务的能力。 负载均衡：将高并发的请求数据分发到不同的集群结点，尽量平衡系统所有资源的压力，从而提升整个集群对于请求的处理能力\n\n## 环境说明:\n**主机A 192.168.128.8 nginx + keepalived**\n**主机B 192.168.128.9 nginx + keepalived**\n\n**通过keepalived配置nginx高可用, keepalived配置nginx对外虚拟地址为 192.168.128.10**\n\n## 软件安装\n主机A:  ```yum install keepalived nginx ```\n主机B:  ```yum install keepalived nginx ```\n\n## 主机A配置\n\n1) keepalived 配置\n``` /etc/keepalived/keepalived.conf ```\n\n```\n vrrp_script chk_nginx {\n     script \"/etc/keepalived/nginx_check.sh\"    # 检测nginx状态的脚本路径\n     interval 2                                 # 检测时间间隔2s\n     weight -20                                 # 如果脚本的条件成立，权重-20\n  }\n\n  vrrp_instance VI_1 {\n      state MASTER                              # 服务状态；MASTER（工作状态）BACKUP（备用状态）\n      interface ens33                           # VIP绑定网卡\n      virtual_router_id 51                      # 虚拟路由ID，主、备节点必须一致\n      mcast_src_ip 192.168.128.8                # 本机IP\n      nopreempt                                 # 优先级高的设置，解决异常回复后再次抢占的问题\n      priority 90                              # 优先级；取值范围：0~254；MASTER > BACKUP\n      advert_int 1                              # 组播信息发送间隔，主、备节点必须一致，默认1s\n      authentication {                          # 验证信息；主、备节点必须一致\n          auth_type PASS                        # VRRP验证类型，PASS、AH两种\n          auth_pass 1111                        # VRRP验证密码，在同一个vrrp_instance下，主、从必须使用相同的密码才能正常通信\n      }\n    track_script {                              # 将track_script块加入instance配置块\n          chk_nginx                             # 执行Nginx监控的服务\n      }\n      virtual_ipaddress {                       #虚拟IP池，主、备节点必须一致，可以定义多个VIP\n          192.168.128.10                        # 虚拟IP\n      }\n  }\n```\n2) nginx 脚本配置\n``` vim /etc/keepalived/nginx_check.sh```\n``` chmod +x /etc/keepalived/nginx_check.sh```\n\n``` bash\n#!/bin/bash\nif [ \"$(ps -ef | grep \"nginx: master process\"| grep -v grep )\" == \"\" ];then\n    #echo 1\n    systemctl start nginx\n    sleep 5\n\n    if [ \"$(ps -ef | grep \"nginx: master process\"| grep -v grep )\" == \"\" ];then\n        systemctl stop keepalived\n        #echo 2\n    fi\nfi\n```\n\n## 主机B配置\n\n1) keepalived 配置\n**和主机A的配置除了```本机ip```, ```优先级```不同, 其他均相同配置**\n``` /etc/keepalived/keepalived.conf ```\n\n```\n vrrp_script chk_nginx {\n     script \"/etc/keepalived/nginx_check.sh\"    # 检测nginx状态的脚本路径\n     interval 2                                 # 检测时间间隔2s\n     weight -20                                 # 如果脚本的条件成立，权重-20\n  }\n\n  vrrp_instance VI_1 {\n      state MASTER                              # 服务状态；MASTER（工作状态）BACKUP（备用状态）\n      interface ens33                           # VIP绑定网卡\n      virtual_router_id 51                      # 虚拟路由ID，主、备节点必须一致\n      mcast_src_ip 192.168.128.9                # 本机IP\n      nopreempt                                 # 优先级高的设置，解决异常回复后再次抢占的问题\n      priority 100                              # 优先级；取值范围：0~254；MASTER > BACKUP\n      advert_int 1                              # 组播信息发送间隔，主、备节点必须一致，默认1s\n      authentication {                          # 验证信息；主、备节点必须一致\n          auth_type PASS                        # VRRP验证类型，PASS、AH两种\n          auth_pass 1111                        # VRRP验证密码，在同一个vrrp_instance下，主、从必须使用相同的密码才能正常通信\n      }\n    track_script {                              # 将track_script块加入instance配置块\n          chk_nginx                             # 执行Nginx监控的服务\n      }\n      virtual_ipaddress {                       #虚拟IP池，主、备节点必须一致，可以定义多个VIP\n          192.168.128.10                        # 虚拟IP\n      }\n  }\n```\n\n2) nginx 脚本配置\n**和主机A的配置一样哦**\n``` vim /etc/keepalived/nginx_check.sh```\n``` chmod +x /etc/keepalived/nginx_check.sh```\n\n``` bash\n#!/bin/bash\nif [ \"$(ps -ef | grep \"nginx: master process\"| grep -v grep )\" == \"\" ];then\n    #echo 1\n    systemctl start nginx\n    sleep 5\n\n    if [ \"$(ps -ef | grep \"nginx: master process\"| grep -v grep )\" == \"\" ];then\n        systemctl stop keepalived\n        #echo 2\n    fi\nfi\n```\n\n## 配置启动\n主机A和主机B配置 keppalived 和 nginx 自启\n``` systemctl enable nginx```\n``` systemctl enable keepalived```\n``` systemctl start nginx```\n``` systemctl start nginx ```\n\n**这个时候A和B的nginx就是一个主从关系. 只要其中一个nginx正常就可以通过keepalived虚拟的192.168.128.10 正常访问到nginx**","source":"_posts/013.keepalived.md","raw":"---\ntitle: keepalived配置nginx高可用\ndate: 2020-3-18 15:48:13\ncategories: \n- [Linux]\n- [CentOS]\ntags: \n- nginx\n- keepalived\n- HA\n---\n\n## 名词解释:\n高可用: High Availability (HA)\n负载均衡: Load Balance (LB) \n服务器负载均衡: Server Load Balancing (SLB)\n\n区别: 高可用性：顾名思义，尽可能采取措施减少系统服务中断时间，进而提高业务程序持续对外提供服务的能力。 负载均衡：将高并发的请求数据分发到不同的集群结点，尽量平衡系统所有资源的压力，从而提升整个集群对于请求的处理能力\n\n## 环境说明:\n**主机A 192.168.128.8 nginx + keepalived**\n**主机B 192.168.128.9 nginx + keepalived**\n\n**通过keepalived配置nginx高可用, keepalived配置nginx对外虚拟地址为 192.168.128.10**\n\n## 软件安装\n主机A:  ```yum install keepalived nginx ```\n主机B:  ```yum install keepalived nginx ```\n\n## 主机A配置\n\n1) keepalived 配置\n``` /etc/keepalived/keepalived.conf ```\n\n```\n vrrp_script chk_nginx {\n     script \"/etc/keepalived/nginx_check.sh\"    # 检测nginx状态的脚本路径\n     interval 2                                 # 检测时间间隔2s\n     weight -20                                 # 如果脚本的条件成立，权重-20\n  }\n\n  vrrp_instance VI_1 {\n      state MASTER                              # 服务状态；MASTER（工作状态）BACKUP（备用状态）\n      interface ens33                           # VIP绑定网卡\n      virtual_router_id 51                      # 虚拟路由ID，主、备节点必须一致\n      mcast_src_ip 192.168.128.8                # 本机IP\n      nopreempt                                 # 优先级高的设置，解决异常回复后再次抢占的问题\n      priority 90                              # 优先级；取值范围：0~254；MASTER > BACKUP\n      advert_int 1                              # 组播信息发送间隔，主、备节点必须一致，默认1s\n      authentication {                          # 验证信息；主、备节点必须一致\n          auth_type PASS                        # VRRP验证类型，PASS、AH两种\n          auth_pass 1111                        # VRRP验证密码，在同一个vrrp_instance下，主、从必须使用相同的密码才能正常通信\n      }\n    track_script {                              # 将track_script块加入instance配置块\n          chk_nginx                             # 执行Nginx监控的服务\n      }\n      virtual_ipaddress {                       #虚拟IP池，主、备节点必须一致，可以定义多个VIP\n          192.168.128.10                        # 虚拟IP\n      }\n  }\n```\n2) nginx 脚本配置\n``` vim /etc/keepalived/nginx_check.sh```\n``` chmod +x /etc/keepalived/nginx_check.sh```\n\n``` bash\n#!/bin/bash\nif [ \"$(ps -ef | grep \"nginx: master process\"| grep -v grep )\" == \"\" ];then\n    #echo 1\n    systemctl start nginx\n    sleep 5\n\n    if [ \"$(ps -ef | grep \"nginx: master process\"| grep -v grep )\" == \"\" ];then\n        systemctl stop keepalived\n        #echo 2\n    fi\nfi\n```\n\n## 主机B配置\n\n1) keepalived 配置\n**和主机A的配置除了```本机ip```, ```优先级```不同, 其他均相同配置**\n``` /etc/keepalived/keepalived.conf ```\n\n```\n vrrp_script chk_nginx {\n     script \"/etc/keepalived/nginx_check.sh\"    # 检测nginx状态的脚本路径\n     interval 2                                 # 检测时间间隔2s\n     weight -20                                 # 如果脚本的条件成立，权重-20\n  }\n\n  vrrp_instance VI_1 {\n      state MASTER                              # 服务状态；MASTER（工作状态）BACKUP（备用状态）\n      interface ens33                           # VIP绑定网卡\n      virtual_router_id 51                      # 虚拟路由ID，主、备节点必须一致\n      mcast_src_ip 192.168.128.9                # 本机IP\n      nopreempt                                 # 优先级高的设置，解决异常回复后再次抢占的问题\n      priority 100                              # 优先级；取值范围：0~254；MASTER > BACKUP\n      advert_int 1                              # 组播信息发送间隔，主、备节点必须一致，默认1s\n      authentication {                          # 验证信息；主、备节点必须一致\n          auth_type PASS                        # VRRP验证类型，PASS、AH两种\n          auth_pass 1111                        # VRRP验证密码，在同一个vrrp_instance下，主、从必须使用相同的密码才能正常通信\n      }\n    track_script {                              # 将track_script块加入instance配置块\n          chk_nginx                             # 执行Nginx监控的服务\n      }\n      virtual_ipaddress {                       #虚拟IP池，主、备节点必须一致，可以定义多个VIP\n          192.168.128.10                        # 虚拟IP\n      }\n  }\n```\n\n2) nginx 脚本配置\n**和主机A的配置一样哦**\n``` vim /etc/keepalived/nginx_check.sh```\n``` chmod +x /etc/keepalived/nginx_check.sh```\n\n``` bash\n#!/bin/bash\nif [ \"$(ps -ef | grep \"nginx: master process\"| grep -v grep )\" == \"\" ];then\n    #echo 1\n    systemctl start nginx\n    sleep 5\n\n    if [ \"$(ps -ef | grep \"nginx: master process\"| grep -v grep )\" == \"\" ];then\n        systemctl stop keepalived\n        #echo 2\n    fi\nfi\n```\n\n## 配置启动\n主机A和主机B配置 keppalived 和 nginx 自启\n``` systemctl enable nginx```\n``` systemctl enable keepalived```\n``` systemctl start nginx```\n``` systemctl start nginx ```\n\n**这个时候A和B的nginx就是一个主从关系. 只要其中一个nginx正常就可以通过keepalived虚拟的192.168.128.10 正常访问到nginx**","slug":"013.keepalived","published":1,"updated":"2023-12-05T08:52:30.875Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzaa0016ijnraj6z6lkm","content":"<h2 id=\"名词解释\"><a href=\"#名词解释\" class=\"headerlink\" title=\"名词解释:\"></a>名词解释:</h2><p>高可用: High Availability (HA)<br>负载均衡: Load Balance (LB)<br>服务器负载均衡: Server Load Balancing (SLB)</p>\n<p>区别: 高可用性：顾名思义，尽可能采取措施减少系统服务中断时间，进而提高业务程序持续对外提供服务的能力。 负载均衡：将高并发的请求数据分发到不同的集群结点，尽量平衡系统所有资源的压力，从而提升整个集群对于请求的处理能力</p>\n<h2 id=\"环境说明\"><a href=\"#环境说明\" class=\"headerlink\" title=\"环境说明:\"></a>环境说明:</h2><p><strong>主机A 192.168.128.8 nginx + keepalived</strong><br><strong>主机B 192.168.128.9 nginx + keepalived</strong></p>\n<p><strong>通过keepalived配置nginx高可用, keepalived配置nginx对外虚拟地址为 192.168.128.10</strong></p>\n<h2 id=\"软件安装\"><a href=\"#软件安装\" class=\"headerlink\" title=\"软件安装\"></a>软件安装</h2><p>主机A:  <code>yum install keepalived nginx </code><br>主机B:  <code>yum install keepalived nginx </code></p>\n<h2 id=\"主机A配置\"><a href=\"#主机A配置\" class=\"headerlink\" title=\"主机A配置\"></a>主机A配置</h2><ol>\n<li>keepalived 配置</li>\n</ol>\n<p><code>/etc/keepalived/keepalived.conf</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">vrrp_script chk_nginx &#123;</span><br><span class=\"line\">    script &quot;/etc/keepalived/nginx_check.sh&quot;    # 检测nginx状态的脚本路径</span><br><span class=\"line\">    interval 2                                 # 检测时间间隔2s</span><br><span class=\"line\">    weight -20                                 # 如果脚本的条件成立，权重-20</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> vrrp_instance VI_1 &#123;</span><br><span class=\"line\">     state MASTER                              # 服务状态；MASTER（工作状态）BACKUP（备用状态）</span><br><span class=\"line\">     interface ens33                           # VIP绑定网卡</span><br><span class=\"line\">     virtual_router_id 51                      # 虚拟路由ID，主、备节点必须一致</span><br><span class=\"line\">     mcast_src_ip 192.168.128.8                # 本机IP</span><br><span class=\"line\">     nopreempt                                 # 优先级高的设置，解决异常回复后再次抢占的问题</span><br><span class=\"line\">     priority 90                              # 优先级；取值范围：0~254；MASTER &gt; BACKUP</span><br><span class=\"line\">     advert_int 1                              # 组播信息发送间隔，主、备节点必须一致，默认1s</span><br><span class=\"line\">     authentication &#123;                          # 验证信息；主、备节点必须一致</span><br><span class=\"line\">         auth_type PASS                        # VRRP验证类型，PASS、AH两种</span><br><span class=\"line\">         auth_pass 1111                        # VRRP验证密码，在同一个vrrp_instance下，主、从必须使用相同的密码才能正常通信</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   track_script &#123;                              # 将track_script块加入instance配置块</span><br><span class=\"line\">         chk_nginx                             # 执行Nginx监控的服务</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     virtual_ipaddress &#123;                       #虚拟IP池，主、备节点必须一致，可以定义多个VIP</span><br><span class=\"line\">         192.168.128.10                        # 虚拟IP</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>nginx 脚本配置</li>\n</ol>\n<p><code> vim /etc/keepalived/nginx_check.sh</code><br><code> chmod +x /etc/keepalived/nginx_check.sh</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"subst\">$(ps -ef | grep <span class=\"string\">&quot;nginx: master process&quot;</span>| grep -v grep )</span>&quot;</span> == <span class=\"string\">&quot;&quot;</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"comment\">#echo 1</span></span><br><span class=\"line\">    systemctl start nginx</span><br><span class=\"line\">    <span class=\"built_in\">sleep</span> 5</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"subst\">$(ps -ef | grep <span class=\"string\">&quot;nginx: master process&quot;</span>| grep -v grep )</span>&quot;</span> == <span class=\"string\">&quot;&quot;</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        systemctl stop keepalived</span><br><span class=\"line\">        <span class=\"comment\">#echo 2</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"主机B配置\"><a href=\"#主机B配置\" class=\"headerlink\" title=\"主机B配置\"></a>主机B配置</h2><ol>\n<li>keepalived 配置<br><strong>和主机A的配置除了<code>本机ip</code>, <code>优先级</code>不同, 其他均相同配置</strong></li>\n</ol>\n<p><code>/etc/keepalived/keepalived.conf</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">vrrp_script chk_nginx &#123;</span><br><span class=\"line\">    script &quot;/etc/keepalived/nginx_check.sh&quot;    # 检测nginx状态的脚本路径</span><br><span class=\"line\">    interval 2                                 # 检测时间间隔2s</span><br><span class=\"line\">    weight -20                                 # 如果脚本的条件成立，权重-20</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> vrrp_instance VI_1 &#123;</span><br><span class=\"line\">     state MASTER                              # 服务状态；MASTER（工作状态）BACKUP（备用状态）</span><br><span class=\"line\">     interface ens33                           # VIP绑定网卡</span><br><span class=\"line\">     virtual_router_id 51                      # 虚拟路由ID，主、备节点必须一致</span><br><span class=\"line\">     mcast_src_ip 192.168.128.9                # 本机IP</span><br><span class=\"line\">     nopreempt                                 # 优先级高的设置，解决异常回复后再次抢占的问题</span><br><span class=\"line\">     priority 100                              # 优先级；取值范围：0~254；MASTER &gt; BACKUP</span><br><span class=\"line\">     advert_int 1                              # 组播信息发送间隔，主、备节点必须一致，默认1s</span><br><span class=\"line\">     authentication &#123;                          # 验证信息；主、备节点必须一致</span><br><span class=\"line\">         auth_type PASS                        # VRRP验证类型，PASS、AH两种</span><br><span class=\"line\">         auth_pass 1111                        # VRRP验证密码，在同一个vrrp_instance下，主、从必须使用相同的密码才能正常通信</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   track_script &#123;                              # 将track_script块加入instance配置块</span><br><span class=\"line\">         chk_nginx                             # 执行Nginx监控的服务</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     virtual_ipaddress &#123;                       #虚拟IP池，主、备节点必须一致，可以定义多个VIP</span><br><span class=\"line\">         192.168.128.10                        # 虚拟IP</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>nginx 脚本配置<br><strong>和主机A的配置一样哦</strong></li>\n</ol>\n<p><code> vim /etc/keepalived/nginx_check.sh</code><br><code> chmod +x /etc/keepalived/nginx_check.sh</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"subst\">$(ps -ef | grep <span class=\"string\">&quot;nginx: master process&quot;</span>| grep -v grep )</span>&quot;</span> == <span class=\"string\">&quot;&quot;</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"comment\">#echo 1</span></span><br><span class=\"line\">    systemctl start nginx</span><br><span class=\"line\">    <span class=\"built_in\">sleep</span> 5</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"subst\">$(ps -ef | grep <span class=\"string\">&quot;nginx: master process&quot;</span>| grep -v grep )</span>&quot;</span> == <span class=\"string\">&quot;&quot;</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        systemctl stop keepalived</span><br><span class=\"line\">        <span class=\"comment\">#echo 2</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置启动\"><a href=\"#配置启动\" class=\"headerlink\" title=\"配置启动\"></a>配置启动</h2><p>主机A和主机B配置 keppalived 和 nginx 自启<br><code> systemctl enable nginx</code><br><code> systemctl enable keepalived</code><br><code> systemctl start nginx</code><br><code>systemctl start nginx</code></p>\n<p><strong>这个时候A和B的nginx就是一个主从关系. 只要其中一个nginx正常就可以通过keepalived虚拟的192.168.128.10 正常访问到nginx</strong></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"名词解释\"><a href=\"#名词解释\" class=\"headerlink\" title=\"名词解释:\"></a>名词解释:</h2><p>高可用: High Availability (HA)<br>负载均衡: Load Balance (LB)<br>服务器负载均衡: Server Load Balancing (SLB)</p>\n<p>区别: 高可用性：顾名思义，尽可能采取措施减少系统服务中断时间，进而提高业务程序持续对外提供服务的能力。 负载均衡：将高并发的请求数据分发到不同的集群结点，尽量平衡系统所有资源的压力，从而提升整个集群对于请求的处理能力</p>\n<h2 id=\"环境说明\"><a href=\"#环境说明\" class=\"headerlink\" title=\"环境说明:\"></a>环境说明:</h2><p><strong>主机A 192.168.128.8 nginx + keepalived</strong><br><strong>主机B 192.168.128.9 nginx + keepalived</strong></p>\n<p><strong>通过keepalived配置nginx高可用, keepalived配置nginx对外虚拟地址为 192.168.128.10</strong></p>\n<h2 id=\"软件安装\"><a href=\"#软件安装\" class=\"headerlink\" title=\"软件安装\"></a>软件安装</h2><p>主机A:  <code>yum install keepalived nginx </code><br>主机B:  <code>yum install keepalived nginx </code></p>\n<h2 id=\"主机A配置\"><a href=\"#主机A配置\" class=\"headerlink\" title=\"主机A配置\"></a>主机A配置</h2><ol>\n<li>keepalived 配置</li>\n</ol>\n<p><code>/etc/keepalived/keepalived.conf</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">vrrp_script chk_nginx &#123;</span><br><span class=\"line\">    script &quot;/etc/keepalived/nginx_check.sh&quot;    # 检测nginx状态的脚本路径</span><br><span class=\"line\">    interval 2                                 # 检测时间间隔2s</span><br><span class=\"line\">    weight -20                                 # 如果脚本的条件成立，权重-20</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> vrrp_instance VI_1 &#123;</span><br><span class=\"line\">     state MASTER                              # 服务状态；MASTER（工作状态）BACKUP（备用状态）</span><br><span class=\"line\">     interface ens33                           # VIP绑定网卡</span><br><span class=\"line\">     virtual_router_id 51                      # 虚拟路由ID，主、备节点必须一致</span><br><span class=\"line\">     mcast_src_ip 192.168.128.8                # 本机IP</span><br><span class=\"line\">     nopreempt                                 # 优先级高的设置，解决异常回复后再次抢占的问题</span><br><span class=\"line\">     priority 90                              # 优先级；取值范围：0~254；MASTER &gt; BACKUP</span><br><span class=\"line\">     advert_int 1                              # 组播信息发送间隔，主、备节点必须一致，默认1s</span><br><span class=\"line\">     authentication &#123;                          # 验证信息；主、备节点必须一致</span><br><span class=\"line\">         auth_type PASS                        # VRRP验证类型，PASS、AH两种</span><br><span class=\"line\">         auth_pass 1111                        # VRRP验证密码，在同一个vrrp_instance下，主、从必须使用相同的密码才能正常通信</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   track_script &#123;                              # 将track_script块加入instance配置块</span><br><span class=\"line\">         chk_nginx                             # 执行Nginx监控的服务</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     virtual_ipaddress &#123;                       #虚拟IP池，主、备节点必须一致，可以定义多个VIP</span><br><span class=\"line\">         192.168.128.10                        # 虚拟IP</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>nginx 脚本配置</li>\n</ol>\n<p><code> vim /etc/keepalived/nginx_check.sh</code><br><code> chmod +x /etc/keepalived/nginx_check.sh</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"subst\">$(ps -ef | grep <span class=\"string\">&quot;nginx: master process&quot;</span>| grep -v grep )</span>&quot;</span> == <span class=\"string\">&quot;&quot;</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"comment\">#echo 1</span></span><br><span class=\"line\">    systemctl start nginx</span><br><span class=\"line\">    <span class=\"built_in\">sleep</span> 5</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"subst\">$(ps -ef | grep <span class=\"string\">&quot;nginx: master process&quot;</span>| grep -v grep )</span>&quot;</span> == <span class=\"string\">&quot;&quot;</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        systemctl stop keepalived</span><br><span class=\"line\">        <span class=\"comment\">#echo 2</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"主机B配置\"><a href=\"#主机B配置\" class=\"headerlink\" title=\"主机B配置\"></a>主机B配置</h2><ol>\n<li>keepalived 配置<br><strong>和主机A的配置除了<code>本机ip</code>, <code>优先级</code>不同, 其他均相同配置</strong></li>\n</ol>\n<p><code>/etc/keepalived/keepalived.conf</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">vrrp_script chk_nginx &#123;</span><br><span class=\"line\">    script &quot;/etc/keepalived/nginx_check.sh&quot;    # 检测nginx状态的脚本路径</span><br><span class=\"line\">    interval 2                                 # 检测时间间隔2s</span><br><span class=\"line\">    weight -20                                 # 如果脚本的条件成立，权重-20</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> vrrp_instance VI_1 &#123;</span><br><span class=\"line\">     state MASTER                              # 服务状态；MASTER（工作状态）BACKUP（备用状态）</span><br><span class=\"line\">     interface ens33                           # VIP绑定网卡</span><br><span class=\"line\">     virtual_router_id 51                      # 虚拟路由ID，主、备节点必须一致</span><br><span class=\"line\">     mcast_src_ip 192.168.128.9                # 本机IP</span><br><span class=\"line\">     nopreempt                                 # 优先级高的设置，解决异常回复后再次抢占的问题</span><br><span class=\"line\">     priority 100                              # 优先级；取值范围：0~254；MASTER &gt; BACKUP</span><br><span class=\"line\">     advert_int 1                              # 组播信息发送间隔，主、备节点必须一致，默认1s</span><br><span class=\"line\">     authentication &#123;                          # 验证信息；主、备节点必须一致</span><br><span class=\"line\">         auth_type PASS                        # VRRP验证类型，PASS、AH两种</span><br><span class=\"line\">         auth_pass 1111                        # VRRP验证密码，在同一个vrrp_instance下，主、从必须使用相同的密码才能正常通信</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   track_script &#123;                              # 将track_script块加入instance配置块</span><br><span class=\"line\">         chk_nginx                             # 执行Nginx监控的服务</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     virtual_ipaddress &#123;                       #虚拟IP池，主、备节点必须一致，可以定义多个VIP</span><br><span class=\"line\">         192.168.128.10                        # 虚拟IP</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>nginx 脚本配置<br><strong>和主机A的配置一样哦</strong></li>\n</ol>\n<p><code> vim /etc/keepalived/nginx_check.sh</code><br><code> chmod +x /etc/keepalived/nginx_check.sh</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"subst\">$(ps -ef | grep <span class=\"string\">&quot;nginx: master process&quot;</span>| grep -v grep )</span>&quot;</span> == <span class=\"string\">&quot;&quot;</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"comment\">#echo 1</span></span><br><span class=\"line\">    systemctl start nginx</span><br><span class=\"line\">    <span class=\"built_in\">sleep</span> 5</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"subst\">$(ps -ef | grep <span class=\"string\">&quot;nginx: master process&quot;</span>| grep -v grep )</span>&quot;</span> == <span class=\"string\">&quot;&quot;</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        systemctl stop keepalived</span><br><span class=\"line\">        <span class=\"comment\">#echo 2</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置启动\"><a href=\"#配置启动\" class=\"headerlink\" title=\"配置启动\"></a>配置启动</h2><p>主机A和主机B配置 keppalived 和 nginx 自启<br><code> systemctl enable nginx</code><br><code> systemctl enable keepalived</code><br><code> systemctl start nginx</code><br><code>systemctl start nginx</code></p>\n<p><strong>这个时候A和B的nginx就是一个主从关系. 只要其中一个nginx正常就可以通过keepalived虚拟的192.168.128.10 正常访问到nginx</strong></p>\n"},{"title":"Linux shell 重定向","date":"2020-05-26T06:29:13.000Z","_content":"","source":"_posts/014.linux_shell_redirect.md","raw":"---\ntitle: Linux shell 重定向\ndate: 2020-5-26 14:29:13\ncategories: \n- [Linux]\ntags: \n- shell\n- 重定向\n---\n","slug":"014.linux_shell_redirect","published":1,"updated":"2023-12-05T08:52:30.875Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzad001aijnr55gggunz","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"windows添加删除路由","date":"2022-05-31T06:29:13.000Z","_content":"\n> 经常遇到这种场景, 网线上内网, 无线上外网. \nwindows下, 一般来说网线的优先级会大于无线, 有时候也有相反的情况.\n> 总之, 在这种场景下我们的商洛体验会很糟糕\n> 解决方法还是有的, 修改windows的默认路由即可.\n\n\n```\n[D:\\~]$ {% label success@route print -4%}\n===========================================================================\n接口列表\n 11...ce b0 da b4 4f 9d ......Microsoft Wi-Fi Direct Virtual Adapter\n 13...de b0 da b4 4f 9d ......Microsoft Wi-Fi Direct Virtual Adapter #2\n  5...00 50 56 c0 00 01 ......VMware Virtual Ethernet Adapter for VMnet1\n  6...00 50 56 c0 00 08 ......VMware Virtual Ethernet Adapter for VMnet8\n 16...ce b0 b3 b4 c3 f5 ......Qualcomm Atheros QCA9377 Wireless Network Adapter\n 17...cc b0 da b4 4f 9e ......Bluetooth Device (Personal Area Network)\n  1...........................Software Loopback Interface 1\n===========================================================================\n\nIPv4 路由表\n===========================================================================\n活动路由:\n网络目标        网络掩码          网关       接口   跃点数\n          0.0.0.0          0.0.0.0    192.168.110.1  192.168.110.241     45\n        127.0.0.0        255.0.0.0            在链路上         127.0.0.1    331\n        127.0.0.1  255.255.255.255            在链路上         127.0.0.1    331\n  127.255.255.255  255.255.255.255            在链路上         127.0.0.1    331\n     192.168.64.0    255.255.255.0            在链路上      192.168.64.1    291\n     192.168.64.1  255.255.255.255            在链路上      192.168.64.1    291\n   192.168.64.255  255.255.255.255            在链路上      192.168.64.1    291\n    192.168.110.0    255.255.255.0            在链路上   192.168.110.241    301\n  192.168.110.241  255.255.255.255            在链路上   192.168.110.241    301\n  192.168.110.255  255.255.255.255            在链路上   192.168.110.241    301\n    192.168.128.0    255.255.255.0            在链路上     192.168.128.1    291\n    192.168.128.1  255.255.255.255            在链路上     192.168.128.1    291\n  192.168.128.255  255.255.255.255            在链路上     192.168.128.1    291\n        224.0.0.0        240.0.0.0            在链路上         127.0.0.1    331\n        224.0.0.0        240.0.0.0            在链路上      192.168.64.1    291\n        224.0.0.0        240.0.0.0            在链路上     192.168.128.1    291\n        224.0.0.0        240.0.0.0            在链路上   192.168.110.241    301\n  255.255.255.255  255.255.255.255            在链路上         127.0.0.1    331\n  255.255.255.255  255.255.255.255            在链路上      192.168.64.1    291\n  255.255.255.255  255.255.255.255            在链路上     192.168.128.1    291\n  255.255.255.255  255.255.255.255            在链路上   192.168.110.241    301\n===========================================================================\n永久路由:\n  无\n\n```\n\n``` \nROUTE [-f] [-p] [-4|-6] command [destination]\n                  [MASK netmask]  [gateway] [METRIC metric]  [IF interface]\n\n  -f            清除所有网关项的路由表。\n\n  -p           永久路由。\n\n  -4           强制使用 IPv4。\n\n  -6           强制使用 IPv6。\n\n  command      其中之一:\n                 PRINT     打印路由\n                 ADD       添加路由\n                 DELETE    删除路由\n                 CHANGE    修改现有路由\n  destination  指定主机。\n  MASK         指定下一个参数为“netmask”值。\n  netmask      指定此路由项的子网掩码值。\n               如果未指定，其默认设置为 255.255.255.255。\n  gateway      指定网关。\n  interface    指定路由的接口号码。\n  METRIC       指定跃点数，例如目标的成本。\n```\n\n\n示例 :\n\n1)  添加网络 10.0.0.0/8  下一跳为 10.0.0.1 (临时路由, 重启失效)\n``` route add 10.0.0.0 mask 255.0.0.0 10.0.0.1 ```\n\n2)  添加网络 10.0.0.0/8  下一跳为 10.0.0.1 (永久路由, 重启不失效)\n``` route -p add 10.0.0.0 mask 255.0.0.0 10.0.0.1 ```\n\n3) 删除网络 10.0.0.0/8 \n``` route delete 10.0.0.0 mask 255.0.0.0```\n\n4)  添加网络 192.168.1.0/24 下一跳 192.168.1.1 跳跃数为3\n``` route add 192.168.1.0 mask 255.255.255.0 192.168.1.1 metric 3 ```\n\n5)  添加网络 192.168.1.0/24 下一跳 接口索引为 ox3\n``` route add 192.168.1.0 mask 255.255.255.0 192.168.1.1 if 0x3```\n\n6)  修改网络 192.168.1.0/24 的下一跳为 192.168.1.1254\n``` route change 192.168.1.0 mask 255.255.255.0 192.168.1.1254 ```","source":"_posts/015.windows_route.md","raw":"---\ntitle: windows添加删除路由\ndate: 2022-5-31 14:29:13\ncategories: \n- [NetWork]\ntags: \n- 路由\n- windows\n---\n\n> 经常遇到这种场景, 网线上内网, 无线上外网. \nwindows下, 一般来说网线的优先级会大于无线, 有时候也有相反的情况.\n> 总之, 在这种场景下我们的商洛体验会很糟糕\n> 解决方法还是有的, 修改windows的默认路由即可.\n\n\n```\n[D:\\~]$ {% label success@route print -4%}\n===========================================================================\n接口列表\n 11...ce b0 da b4 4f 9d ......Microsoft Wi-Fi Direct Virtual Adapter\n 13...de b0 da b4 4f 9d ......Microsoft Wi-Fi Direct Virtual Adapter #2\n  5...00 50 56 c0 00 01 ......VMware Virtual Ethernet Adapter for VMnet1\n  6...00 50 56 c0 00 08 ......VMware Virtual Ethernet Adapter for VMnet8\n 16...ce b0 b3 b4 c3 f5 ......Qualcomm Atheros QCA9377 Wireless Network Adapter\n 17...cc b0 da b4 4f 9e ......Bluetooth Device (Personal Area Network)\n  1...........................Software Loopback Interface 1\n===========================================================================\n\nIPv4 路由表\n===========================================================================\n活动路由:\n网络目标        网络掩码          网关       接口   跃点数\n          0.0.0.0          0.0.0.0    192.168.110.1  192.168.110.241     45\n        127.0.0.0        255.0.0.0            在链路上         127.0.0.1    331\n        127.0.0.1  255.255.255.255            在链路上         127.0.0.1    331\n  127.255.255.255  255.255.255.255            在链路上         127.0.0.1    331\n     192.168.64.0    255.255.255.0            在链路上      192.168.64.1    291\n     192.168.64.1  255.255.255.255            在链路上      192.168.64.1    291\n   192.168.64.255  255.255.255.255            在链路上      192.168.64.1    291\n    192.168.110.0    255.255.255.0            在链路上   192.168.110.241    301\n  192.168.110.241  255.255.255.255            在链路上   192.168.110.241    301\n  192.168.110.255  255.255.255.255            在链路上   192.168.110.241    301\n    192.168.128.0    255.255.255.0            在链路上     192.168.128.1    291\n    192.168.128.1  255.255.255.255            在链路上     192.168.128.1    291\n  192.168.128.255  255.255.255.255            在链路上     192.168.128.1    291\n        224.0.0.0        240.0.0.0            在链路上         127.0.0.1    331\n        224.0.0.0        240.0.0.0            在链路上      192.168.64.1    291\n        224.0.0.0        240.0.0.0            在链路上     192.168.128.1    291\n        224.0.0.0        240.0.0.0            在链路上   192.168.110.241    301\n  255.255.255.255  255.255.255.255            在链路上         127.0.0.1    331\n  255.255.255.255  255.255.255.255            在链路上      192.168.64.1    291\n  255.255.255.255  255.255.255.255            在链路上     192.168.128.1    291\n  255.255.255.255  255.255.255.255            在链路上   192.168.110.241    301\n===========================================================================\n永久路由:\n  无\n\n```\n\n``` \nROUTE [-f] [-p] [-4|-6] command [destination]\n                  [MASK netmask]  [gateway] [METRIC metric]  [IF interface]\n\n  -f            清除所有网关项的路由表。\n\n  -p           永久路由。\n\n  -4           强制使用 IPv4。\n\n  -6           强制使用 IPv6。\n\n  command      其中之一:\n                 PRINT     打印路由\n                 ADD       添加路由\n                 DELETE    删除路由\n                 CHANGE    修改现有路由\n  destination  指定主机。\n  MASK         指定下一个参数为“netmask”值。\n  netmask      指定此路由项的子网掩码值。\n               如果未指定，其默认设置为 255.255.255.255。\n  gateway      指定网关。\n  interface    指定路由的接口号码。\n  METRIC       指定跃点数，例如目标的成本。\n```\n\n\n示例 :\n\n1)  添加网络 10.0.0.0/8  下一跳为 10.0.0.1 (临时路由, 重启失效)\n``` route add 10.0.0.0 mask 255.0.0.0 10.0.0.1 ```\n\n2)  添加网络 10.0.0.0/8  下一跳为 10.0.0.1 (永久路由, 重启不失效)\n``` route -p add 10.0.0.0 mask 255.0.0.0 10.0.0.1 ```\n\n3) 删除网络 10.0.0.0/8 \n``` route delete 10.0.0.0 mask 255.0.0.0```\n\n4)  添加网络 192.168.1.0/24 下一跳 192.168.1.1 跳跃数为3\n``` route add 192.168.1.0 mask 255.255.255.0 192.168.1.1 metric 3 ```\n\n5)  添加网络 192.168.1.0/24 下一跳 接口索引为 ox3\n``` route add 192.168.1.0 mask 255.255.255.0 192.168.1.1 if 0x3```\n\n6)  修改网络 192.168.1.0/24 的下一跳为 192.168.1.1254\n``` route change 192.168.1.0 mask 255.255.255.0 192.168.1.1254 ```","slug":"015.windows_route","published":1,"updated":"2023-12-05T08:52:30.875Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzag001fijnr5nsodrnb","content":"<blockquote>\n<p>经常遇到这种场景, 网线上内网, 无线上外网.<br>windows下, 一般来说网线的优先级会大于无线, 有时候也有相反的情况.<br>总之, 在这种场景下我们的商洛体验会很糟糕<br>解决方法还是有的, 修改windows的默认路由即可.</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[D:\\~]$ &#123;% label success@route print -4%&#125;</span><br><span class=\"line\">===========================================================================</span><br><span class=\"line\">接口列表</span><br><span class=\"line\"> 11...ce b0 da b4 4f 9d ......Microsoft Wi-Fi Direct Virtual Adapter</span><br><span class=\"line\"> 13...de b0 da b4 4f 9d ......Microsoft Wi-Fi Direct Virtual Adapter #2</span><br><span class=\"line\">  5...00 50 56 c0 00 01 ......VMware Virtual Ethernet Adapter for VMnet1</span><br><span class=\"line\">  6...00 50 56 c0 00 08 ......VMware Virtual Ethernet Adapter for VMnet8</span><br><span class=\"line\"> 16...ce b0 b3 b4 c3 f5 ......Qualcomm Atheros QCA9377 Wireless Network Adapter</span><br><span class=\"line\"> 17...cc b0 da b4 4f 9e ......Bluetooth Device (Personal Area Network)</span><br><span class=\"line\">  1...........................Software Loopback Interface 1</span><br><span class=\"line\">===========================================================================</span><br><span class=\"line\"></span><br><span class=\"line\">IPv4 路由表</span><br><span class=\"line\">===========================================================================</span><br><span class=\"line\">活动路由:</span><br><span class=\"line\">网络目标        网络掩码          网关       接口   跃点数</span><br><span class=\"line\">          0.0.0.0          0.0.0.0    192.168.110.1  192.168.110.241     45</span><br><span class=\"line\">        127.0.0.0        255.0.0.0            在链路上         127.0.0.1    331</span><br><span class=\"line\">        127.0.0.1  255.255.255.255            在链路上         127.0.0.1    331</span><br><span class=\"line\">  127.255.255.255  255.255.255.255            在链路上         127.0.0.1    331</span><br><span class=\"line\">     192.168.64.0    255.255.255.0            在链路上      192.168.64.1    291</span><br><span class=\"line\">     192.168.64.1  255.255.255.255            在链路上      192.168.64.1    291</span><br><span class=\"line\">   192.168.64.255  255.255.255.255            在链路上      192.168.64.1    291</span><br><span class=\"line\">    192.168.110.0    255.255.255.0            在链路上   192.168.110.241    301</span><br><span class=\"line\">  192.168.110.241  255.255.255.255            在链路上   192.168.110.241    301</span><br><span class=\"line\">  192.168.110.255  255.255.255.255            在链路上   192.168.110.241    301</span><br><span class=\"line\">    192.168.128.0    255.255.255.0            在链路上     192.168.128.1    291</span><br><span class=\"line\">    192.168.128.1  255.255.255.255            在链路上     192.168.128.1    291</span><br><span class=\"line\">  192.168.128.255  255.255.255.255            在链路上     192.168.128.1    291</span><br><span class=\"line\">        224.0.0.0        240.0.0.0            在链路上         127.0.0.1    331</span><br><span class=\"line\">        224.0.0.0        240.0.0.0            在链路上      192.168.64.1    291</span><br><span class=\"line\">        224.0.0.0        240.0.0.0            在链路上     192.168.128.1    291</span><br><span class=\"line\">        224.0.0.0        240.0.0.0            在链路上   192.168.110.241    301</span><br><span class=\"line\">  255.255.255.255  255.255.255.255            在链路上         127.0.0.1    331</span><br><span class=\"line\">  255.255.255.255  255.255.255.255            在链路上      192.168.64.1    291</span><br><span class=\"line\">  255.255.255.255  255.255.255.255            在链路上     192.168.128.1    291</span><br><span class=\"line\">  255.255.255.255  255.255.255.255            在链路上   192.168.110.241    301</span><br><span class=\"line\">===========================================================================</span><br><span class=\"line\">永久路由:</span><br><span class=\"line\">  无</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">ROUTE [-f] [-p] [-4|-6] command [destination]</span><br><span class=\"line\">                  [MASK netmask]  [gateway] [METRIC metric]  [IF interface]</span><br><span class=\"line\"></span><br><span class=\"line\">  -f            清除所有网关项的路由表。</span><br><span class=\"line\"></span><br><span class=\"line\">  -p           永久路由。</span><br><span class=\"line\"></span><br><span class=\"line\">  -4           强制使用 IPv4。</span><br><span class=\"line\"></span><br><span class=\"line\">  -6           强制使用 IPv6。</span><br><span class=\"line\"></span><br><span class=\"line\">  command      其中之一:</span><br><span class=\"line\">                 PRINT     打印路由</span><br><span class=\"line\">                 ADD       添加路由</span><br><span class=\"line\">                 DELETE    删除路由</span><br><span class=\"line\">                 CHANGE    修改现有路由</span><br><span class=\"line\">  destination  指定主机。</span><br><span class=\"line\">  MASK         指定下一个参数为“netmask”值。</span><br><span class=\"line\">  netmask      指定此路由项的子网掩码值。</span><br><span class=\"line\">               如果未指定，其默认设置为 255.255.255.255。</span><br><span class=\"line\">  gateway      指定网关。</span><br><span class=\"line\">  interface    指定路由的接口号码。</span><br><span class=\"line\">  METRIC       指定跃点数，例如目标的成本。</span><br></pre></td></tr></table></figure>\n\n\n<p>示例 :</p>\n<ol>\n<li>添加网络 10.0.0.0&#x2F;8  下一跳为 10.0.0.1 (临时路由, 重启失效)</li>\n</ol>\n<p><code>route add 10.0.0.0 mask 255.0.0.0 10.0.0.1</code></p>\n<ol start=\"2\">\n<li>添加网络 10.0.0.0&#x2F;8  下一跳为 10.0.0.1 (永久路由, 重启不失效)</li>\n</ol>\n<p><code>route -p add 10.0.0.0 mask 255.0.0.0 10.0.0.1</code></p>\n<ol start=\"3\">\n<li>删除网络 10.0.0.0&#x2F;8</li>\n</ol>\n<p><code> route delete 10.0.0.0 mask 255.0.0.0</code></p>\n<ol start=\"4\">\n<li>添加网络 192.168.1.0&#x2F;24 下一跳 192.168.1.1 跳跃数为3</li>\n</ol>\n<p><code>route add 192.168.1.0 mask 255.255.255.0 192.168.1.1 metric 3</code></p>\n<ol start=\"5\">\n<li>添加网络 192.168.1.0&#x2F;24 下一跳 接口索引为 ox3</li>\n</ol>\n<p><code> route add 192.168.1.0 mask 255.255.255.0 192.168.1.1 if 0x3</code></p>\n<ol start=\"6\">\n<li>修改网络 192.168.1.0&#x2F;24 的下一跳为 192.168.1.1254</li>\n</ol>\n<p><code>route change 192.168.1.0 mask 255.255.255.0 192.168.1.1254</code></p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>经常遇到这种场景, 网线上内网, 无线上外网.<br>windows下, 一般来说网线的优先级会大于无线, 有时候也有相反的情况.<br>总之, 在这种场景下我们的商洛体验会很糟糕<br>解决方法还是有的, 修改windows的默认路由即可.</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[D:\\~]$ &#123;% label success@route print -4%&#125;</span><br><span class=\"line\">===========================================================================</span><br><span class=\"line\">接口列表</span><br><span class=\"line\"> 11...ce b0 da b4 4f 9d ......Microsoft Wi-Fi Direct Virtual Adapter</span><br><span class=\"line\"> 13...de b0 da b4 4f 9d ......Microsoft Wi-Fi Direct Virtual Adapter #2</span><br><span class=\"line\">  5...00 50 56 c0 00 01 ......VMware Virtual Ethernet Adapter for VMnet1</span><br><span class=\"line\">  6...00 50 56 c0 00 08 ......VMware Virtual Ethernet Adapter for VMnet8</span><br><span class=\"line\"> 16...ce b0 b3 b4 c3 f5 ......Qualcomm Atheros QCA9377 Wireless Network Adapter</span><br><span class=\"line\"> 17...cc b0 da b4 4f 9e ......Bluetooth Device (Personal Area Network)</span><br><span class=\"line\">  1...........................Software Loopback Interface 1</span><br><span class=\"line\">===========================================================================</span><br><span class=\"line\"></span><br><span class=\"line\">IPv4 路由表</span><br><span class=\"line\">===========================================================================</span><br><span class=\"line\">活动路由:</span><br><span class=\"line\">网络目标        网络掩码          网关       接口   跃点数</span><br><span class=\"line\">          0.0.0.0          0.0.0.0    192.168.110.1  192.168.110.241     45</span><br><span class=\"line\">        127.0.0.0        255.0.0.0            在链路上         127.0.0.1    331</span><br><span class=\"line\">        127.0.0.1  255.255.255.255            在链路上         127.0.0.1    331</span><br><span class=\"line\">  127.255.255.255  255.255.255.255            在链路上         127.0.0.1    331</span><br><span class=\"line\">     192.168.64.0    255.255.255.0            在链路上      192.168.64.1    291</span><br><span class=\"line\">     192.168.64.1  255.255.255.255            在链路上      192.168.64.1    291</span><br><span class=\"line\">   192.168.64.255  255.255.255.255            在链路上      192.168.64.1    291</span><br><span class=\"line\">    192.168.110.0    255.255.255.0            在链路上   192.168.110.241    301</span><br><span class=\"line\">  192.168.110.241  255.255.255.255            在链路上   192.168.110.241    301</span><br><span class=\"line\">  192.168.110.255  255.255.255.255            在链路上   192.168.110.241    301</span><br><span class=\"line\">    192.168.128.0    255.255.255.0            在链路上     192.168.128.1    291</span><br><span class=\"line\">    192.168.128.1  255.255.255.255            在链路上     192.168.128.1    291</span><br><span class=\"line\">  192.168.128.255  255.255.255.255            在链路上     192.168.128.1    291</span><br><span class=\"line\">        224.0.0.0        240.0.0.0            在链路上         127.0.0.1    331</span><br><span class=\"line\">        224.0.0.0        240.0.0.0            在链路上      192.168.64.1    291</span><br><span class=\"line\">        224.0.0.0        240.0.0.0            在链路上     192.168.128.1    291</span><br><span class=\"line\">        224.0.0.0        240.0.0.0            在链路上   192.168.110.241    301</span><br><span class=\"line\">  255.255.255.255  255.255.255.255            在链路上         127.0.0.1    331</span><br><span class=\"line\">  255.255.255.255  255.255.255.255            在链路上      192.168.64.1    291</span><br><span class=\"line\">  255.255.255.255  255.255.255.255            在链路上     192.168.128.1    291</span><br><span class=\"line\">  255.255.255.255  255.255.255.255            在链路上   192.168.110.241    301</span><br><span class=\"line\">===========================================================================</span><br><span class=\"line\">永久路由:</span><br><span class=\"line\">  无</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">ROUTE [-f] [-p] [-4|-6] command [destination]</span><br><span class=\"line\">                  [MASK netmask]  [gateway] [METRIC metric]  [IF interface]</span><br><span class=\"line\"></span><br><span class=\"line\">  -f            清除所有网关项的路由表。</span><br><span class=\"line\"></span><br><span class=\"line\">  -p           永久路由。</span><br><span class=\"line\"></span><br><span class=\"line\">  -4           强制使用 IPv4。</span><br><span class=\"line\"></span><br><span class=\"line\">  -6           强制使用 IPv6。</span><br><span class=\"line\"></span><br><span class=\"line\">  command      其中之一:</span><br><span class=\"line\">                 PRINT     打印路由</span><br><span class=\"line\">                 ADD       添加路由</span><br><span class=\"line\">                 DELETE    删除路由</span><br><span class=\"line\">                 CHANGE    修改现有路由</span><br><span class=\"line\">  destination  指定主机。</span><br><span class=\"line\">  MASK         指定下一个参数为“netmask”值。</span><br><span class=\"line\">  netmask      指定此路由项的子网掩码值。</span><br><span class=\"line\">               如果未指定，其默认设置为 255.255.255.255。</span><br><span class=\"line\">  gateway      指定网关。</span><br><span class=\"line\">  interface    指定路由的接口号码。</span><br><span class=\"line\">  METRIC       指定跃点数，例如目标的成本。</span><br></pre></td></tr></table></figure>\n\n\n<p>示例 :</p>\n<ol>\n<li>添加网络 10.0.0.0&#x2F;8  下一跳为 10.0.0.1 (临时路由, 重启失效)</li>\n</ol>\n<p><code>route add 10.0.0.0 mask 255.0.0.0 10.0.0.1</code></p>\n<ol start=\"2\">\n<li>添加网络 10.0.0.0&#x2F;8  下一跳为 10.0.0.1 (永久路由, 重启不失效)</li>\n</ol>\n<p><code>route -p add 10.0.0.0 mask 255.0.0.0 10.0.0.1</code></p>\n<ol start=\"3\">\n<li>删除网络 10.0.0.0&#x2F;8</li>\n</ol>\n<p><code> route delete 10.0.0.0 mask 255.0.0.0</code></p>\n<ol start=\"4\">\n<li>添加网络 192.168.1.0&#x2F;24 下一跳 192.168.1.1 跳跃数为3</li>\n</ol>\n<p><code>route add 192.168.1.0 mask 255.255.255.0 192.168.1.1 metric 3</code></p>\n<ol start=\"5\">\n<li>添加网络 192.168.1.0&#x2F;24 下一跳 接口索引为 ox3</li>\n</ol>\n<p><code> route add 192.168.1.0 mask 255.255.255.0 192.168.1.1 if 0x3</code></p>\n<ol start=\"6\">\n<li>修改网络 192.168.1.0&#x2F;24 的下一跳为 192.168.1.1254</li>\n</ol>\n<p><code>route change 192.168.1.0 mask 255.255.255.0 192.168.1.1254</code></p>\n"},{"title":"获取文件所有权","date":"2022-06-09T06:40:40.000Z","_content":"\n\n取得所有权限\n``` vb\nWindows Registry Editor Version 5.00\n[HKEY_CLASSES_ROOT\\*\\shell\\runas]\n@=\"Take Ownership\"\n\"NoWorkingDirectory\"=\"\"\n[HKEY_CLASSES_ROOT\\*\\shell\\runas\\command]\n@=\"cmd.exe /c takeown /f \\\"%1\\\" && icacls \\\"%1\\\" /grant administrators:F\"\n\"IsolatedCommand\"=\"cmd.exe /c takeown /f \\\"%1\\\" && icacls \\\"%1\\\" /grant administrators:F\"\n[HKEY_CLASSES_ROOT\\exefile\\shell\\runas2]\n@=\"Take Ownership\"\n\"NoWorkingDirectory\"=\"\"\n[HKEY_CLASSES_ROOT\\exefile\\shell\\runas2\\command]\n@=\"cmd.exe /c takeown /f \\\"%1\\\" && icacls \\\"%1\\\" /grant administrators:F\"\n\"IsolatedCommand\"=\"cmd.exe /c takeown /f \\\"%1\\\" && icacls \\\"%1\\\" /grant administrators:F\"\n\n[HKEY_CLASSES_ROOT\\Directory\\shell\\runas]\n@=\"Take Ownership\"\n\"NoWorkingDirectory\"=\"\"\n[HKEY_CLASSES_ROOT\\Directory\\shell\\runas\\command]\n@=\"cmd.exe /c takeown /f \\\"%1\\\" /r /d y && icacls \\\"%1\\\" /grant administrators:F /t\"\n\"IsolatedCommand\"=\"cmd.exe /c takeown /f \\\"%1\\\" /r /d y && icacls \\\"%1\\\" /grant administrators:F /t\"\n```\n\n\n撤回取得所有权限\n``` vb\nWindows Registry Editor Version 5.00\n[-HKEY_CLASSES_ROOT\\*\\shell\\runas]\n[-HKEY_CLASSES_ROOT\\Directory\\shell\\runas]\n[-HKEY_CLASSES_ROOT\\dllfile\\shell]\n[-HKEY_CLASSES_ROOT\\Drive\\shell\\runas]\n[-HKEY_CLASSES_ROOT\\exefile\\shell\\runas]\n[HKEY_CLASSES_ROOT\\exefile\\shell\\runas]\n\"HasLUAShield\"=\"\"\n[HKEY_CLASSES_ROOT\\exefile\\shell\\runas\\command]\n@=\"\\\"%1\\\" %*\"\n\"IsolatedCommand\"=\"\\\"%1\\\" %*\"\n```","source":"_posts/016.take_ownership.md","raw":"---\ntitle: 获取文件所有权\ndate: 2022-6-9 14:40:40\ncategories: \n- [Security]\ntags: \n- ownership\n---\n\n\n取得所有权限\n``` vb\nWindows Registry Editor Version 5.00\n[HKEY_CLASSES_ROOT\\*\\shell\\runas]\n@=\"Take Ownership\"\n\"NoWorkingDirectory\"=\"\"\n[HKEY_CLASSES_ROOT\\*\\shell\\runas\\command]\n@=\"cmd.exe /c takeown /f \\\"%1\\\" && icacls \\\"%1\\\" /grant administrators:F\"\n\"IsolatedCommand\"=\"cmd.exe /c takeown /f \\\"%1\\\" && icacls \\\"%1\\\" /grant administrators:F\"\n[HKEY_CLASSES_ROOT\\exefile\\shell\\runas2]\n@=\"Take Ownership\"\n\"NoWorkingDirectory\"=\"\"\n[HKEY_CLASSES_ROOT\\exefile\\shell\\runas2\\command]\n@=\"cmd.exe /c takeown /f \\\"%1\\\" && icacls \\\"%1\\\" /grant administrators:F\"\n\"IsolatedCommand\"=\"cmd.exe /c takeown /f \\\"%1\\\" && icacls \\\"%1\\\" /grant administrators:F\"\n\n[HKEY_CLASSES_ROOT\\Directory\\shell\\runas]\n@=\"Take Ownership\"\n\"NoWorkingDirectory\"=\"\"\n[HKEY_CLASSES_ROOT\\Directory\\shell\\runas\\command]\n@=\"cmd.exe /c takeown /f \\\"%1\\\" /r /d y && icacls \\\"%1\\\" /grant administrators:F /t\"\n\"IsolatedCommand\"=\"cmd.exe /c takeown /f \\\"%1\\\" /r /d y && icacls \\\"%1\\\" /grant administrators:F /t\"\n```\n\n\n撤回取得所有权限\n``` vb\nWindows Registry Editor Version 5.00\n[-HKEY_CLASSES_ROOT\\*\\shell\\runas]\n[-HKEY_CLASSES_ROOT\\Directory\\shell\\runas]\n[-HKEY_CLASSES_ROOT\\dllfile\\shell]\n[-HKEY_CLASSES_ROOT\\Drive\\shell\\runas]\n[-HKEY_CLASSES_ROOT\\exefile\\shell\\runas]\n[HKEY_CLASSES_ROOT\\exefile\\shell\\runas]\n\"HasLUAShield\"=\"\"\n[HKEY_CLASSES_ROOT\\exefile\\shell\\runas\\command]\n@=\"\\\"%1\\\" %*\"\n\"IsolatedCommand\"=\"\\\"%1\\\" %*\"\n```","slug":"016.take_ownership","published":1,"updated":"2023-12-05T08:52:30.876Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzal001jijnr98tjdgpm","content":"<p>取得所有权限</p>\n<figure class=\"highlight vb\"><table><tr><td class=\"code\"><pre><span class=\"line\">Windows Registry Editor Version <span class=\"number\">5.00</span></span><br><span class=\"line\">[HKEY_CLASSES_ROOT\\*\\shell\\runas]</span><br><span class=\"line\">@=<span class=\"string\">&quot;Take Ownership&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;NoWorkingDirectory&quot;</span>=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">[HKEY_CLASSES_ROOT\\*\\shell\\runas\\command]</span><br><span class=\"line\">@=<span class=\"string\">&quot;cmd.exe /c takeown /f \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; &amp;&amp; icacls \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; /grant administrators:F&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;IsolatedCommand&quot;</span>=<span class=\"string\">&quot;cmd.exe /c takeown /f \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; &amp;&amp; icacls \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; /grant administrators:F&quot;</span></span><br><span class=\"line\">[HKEY_CLASSES_ROOT\\exefile\\shell\\runas2]</span><br><span class=\"line\">@=<span class=\"string\">&quot;Take Ownership&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;NoWorkingDirectory&quot;</span>=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">[HKEY_CLASSES_ROOT\\exefile\\shell\\runas2\\command]</span><br><span class=\"line\">@=<span class=\"string\">&quot;cmd.exe /c takeown /f \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; &amp;&amp; icacls \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; /grant administrators:F&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;IsolatedCommand&quot;</span>=<span class=\"string\">&quot;cmd.exe /c takeown /f \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; &amp;&amp; icacls \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; /grant administrators:F&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[HKEY_CLASSES_ROOT\\Directory\\shell\\runas]</span><br><span class=\"line\">@=<span class=\"string\">&quot;Take Ownership&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;NoWorkingDirectory&quot;</span>=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">[HKEY_CLASSES_ROOT\\Directory\\shell\\runas\\command]</span><br><span class=\"line\">@=<span class=\"string\">&quot;cmd.exe /c takeown /f \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; /r /d y &amp;&amp; icacls \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; /grant administrators:F /t&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;IsolatedCommand&quot;</span>=<span class=\"string\">&quot;cmd.exe /c takeown /f \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; /r /d y &amp;&amp; icacls \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; /grant administrators:F /t&quot;</span></span><br></pre></td></tr></table></figure>\n\n\n<p>撤回取得所有权限</p>\n<figure class=\"highlight vb\"><table><tr><td class=\"code\"><pre><span class=\"line\">Windows Registry Editor Version <span class=\"number\">5.00</span></span><br><span class=\"line\">[-HKEY_CLASSES_ROOT\\*\\shell\\runas]</span><br><span class=\"line\">[-HKEY_CLASSES_ROOT\\Directory\\shell\\runas]</span><br><span class=\"line\">[-HKEY_CLASSES_ROOT\\dllfile\\shell]</span><br><span class=\"line\">[-HKEY_CLASSES_ROOT\\Drive\\shell\\runas]</span><br><span class=\"line\">[-HKEY_CLASSES_ROOT\\exefile\\shell\\runas]</span><br><span class=\"line\">[HKEY_CLASSES_ROOT\\exefile\\shell\\runas]</span><br><span class=\"line\"><span class=\"string\">&quot;HasLUAShield&quot;</span>=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">[HKEY_CLASSES_ROOT\\exefile\\shell\\runas\\command]</span><br><span class=\"line\">@=<span class=\"string\">&quot;\\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; %*&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;IsolatedCommand&quot;</span>=<span class=\"string\">&quot;\\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; %*&quot;</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<p>取得所有权限</p>\n<figure class=\"highlight vb\"><table><tr><td class=\"code\"><pre><span class=\"line\">Windows Registry Editor Version <span class=\"number\">5.00</span></span><br><span class=\"line\">[HKEY_CLASSES_ROOT\\*\\shell\\runas]</span><br><span class=\"line\">@=<span class=\"string\">&quot;Take Ownership&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;NoWorkingDirectory&quot;</span>=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">[HKEY_CLASSES_ROOT\\*\\shell\\runas\\command]</span><br><span class=\"line\">@=<span class=\"string\">&quot;cmd.exe /c takeown /f \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; &amp;&amp; icacls \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; /grant administrators:F&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;IsolatedCommand&quot;</span>=<span class=\"string\">&quot;cmd.exe /c takeown /f \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; &amp;&amp; icacls \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; /grant administrators:F&quot;</span></span><br><span class=\"line\">[HKEY_CLASSES_ROOT\\exefile\\shell\\runas2]</span><br><span class=\"line\">@=<span class=\"string\">&quot;Take Ownership&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;NoWorkingDirectory&quot;</span>=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">[HKEY_CLASSES_ROOT\\exefile\\shell\\runas2\\command]</span><br><span class=\"line\">@=<span class=\"string\">&quot;cmd.exe /c takeown /f \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; &amp;&amp; icacls \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; /grant administrators:F&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;IsolatedCommand&quot;</span>=<span class=\"string\">&quot;cmd.exe /c takeown /f \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; &amp;&amp; icacls \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; /grant administrators:F&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[HKEY_CLASSES_ROOT\\Directory\\shell\\runas]</span><br><span class=\"line\">@=<span class=\"string\">&quot;Take Ownership&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;NoWorkingDirectory&quot;</span>=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">[HKEY_CLASSES_ROOT\\Directory\\shell\\runas\\command]</span><br><span class=\"line\">@=<span class=\"string\">&quot;cmd.exe /c takeown /f \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; /r /d y &amp;&amp; icacls \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; /grant administrators:F /t&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;IsolatedCommand&quot;</span>=<span class=\"string\">&quot;cmd.exe /c takeown /f \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; /r /d y &amp;&amp; icacls \\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; /grant administrators:F /t&quot;</span></span><br></pre></td></tr></table></figure>\n\n\n<p>撤回取得所有权限</p>\n<figure class=\"highlight vb\"><table><tr><td class=\"code\"><pre><span class=\"line\">Windows Registry Editor Version <span class=\"number\">5.00</span></span><br><span class=\"line\">[-HKEY_CLASSES_ROOT\\*\\shell\\runas]</span><br><span class=\"line\">[-HKEY_CLASSES_ROOT\\Directory\\shell\\runas]</span><br><span class=\"line\">[-HKEY_CLASSES_ROOT\\dllfile\\shell]</span><br><span class=\"line\">[-HKEY_CLASSES_ROOT\\Drive\\shell\\runas]</span><br><span class=\"line\">[-HKEY_CLASSES_ROOT\\exefile\\shell\\runas]</span><br><span class=\"line\">[HKEY_CLASSES_ROOT\\exefile\\shell\\runas]</span><br><span class=\"line\"><span class=\"string\">&quot;HasLUAShield&quot;</span>=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">[HKEY_CLASSES_ROOT\\exefile\\shell\\runas\\command]</span><br><span class=\"line\">@=<span class=\"string\">&quot;\\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; %*&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;IsolatedCommand&quot;</span>=<span class=\"string\">&quot;\\&quot;</span>%<span class=\"number\">1</span>\\<span class=\"string\">&quot; %*&quot;</span></span><br></pre></td></tr></table></figure>"},{"title":"Oracle部署以及数据迁移","date":"2022-06-10T03:08:13.000Z","_content":"\n> 本文章曾多次修改, 截图或者代码提及到的相关**主机名**和**ip**以及**目录**可能存在变化, 请勿信以为真.\n\n## 一、安装前准备\n\n### 1.1、上传文件\n``` scp linux.x64_11gR2_database_1of2 root@172.21.33.23:/data/oracle ```\n``` scp linux.x64_11gR2_database_2of2 root@172.21.33.23:/data/oracle ```\n### 1.2、解压文件\n``` unzip \\*.zip ```\n\n### 1.3、安装依赖\n``` yum install gcc make binutils gcc-c++ compat-libstdc++-33elfutils-libelf-devel elfutils-libelf-devel-static ksh libaio libaio-develnumactl-devel sysstat unixODBC unixODBC-devel pcre-devel –y ```\n\n### 1.4、 添加主机名到hosts文件\n\n```sed -i \"1s/$/ $(hostname)/\" ```\n\n### 1.5、添加安装用户和用户组\n``` bash\ngroupadd oinstall\ngroupadd dba\nuseradd -g oinstall -G dba oracle\npasswd oracle\n```\n\n### 1.6、修改内核参数\n编辑文件: ``` vim /etc/sysctl.conf ```\n在文件末尾添加如下:\n``` bash\nfs.aio-max-nr = 1048576\nfs.file-max = 6815744\nkernel.shmall = 2097152\nkernel.shmmax = 1073741824\nkernel.shmmni = 4096\nkernel.sem = 250 32000 100 128\nnet.ipv4.ip_local_port_range = 9000 65500\nnet.core.rmem_default = 262144\nnet.core.rmem_max = 4194304\nnet.core.wmem_default = 262144\nnet.core.wmem_max = 1048576 \n```\n立即生效: ```sysctl -p```\n\n### 1.7、修改用户的限制文件\n\n编辑文件: ``` vim /etc/security/limits.conf ```\n在文件末尾添加:\n``` bash\noracle           soft    nproc           2047\noracle           hard    nproc           16384\noracle           soft    nofile          1024\noracle           hard    nofile         65536\noracle           soft    stack           10240 \n```\n\n编辑文件: ``` vim /etc/pam.d/login ```\n在文件末尾添加:\n```bash\nsession required  /lib64/security/pam_limits.so\nsession required   pam_limits.so \n```\n\n编辑文件: ``` vim /etc/profile ```\n在文件末尾添加:\n``` bash\nif [ $USER = \"oracle\" ]; then\n  if [ $SHELL = \"/bin/ksh\" ]; then\n      ulimit -p 16384\n      ulimit -n 65536\n  else\n      ulimit -u 16384 -n 65536\n  fi\nfi \n```\n\n### 1.8、安装目录以及权限设置\n\n```bash\nmkdir -p /data/oracle/product/11.2.0\nmkdir /data/oracle/oradata\nmkdir /data/oracle/inventory\nmkdir /data/oracle/fast_recovery_area\nchown -R oracle:oinstall /data/oracle\nchmod -R 775 /data/oracle\n```\n\n### 1.9、Oracle用户环境变量\n\n切换到Oracle下: ``` su -l oracle ```\n\n编辑文件: ```vim .bash_profile```\n在文件末尾添加:\n``` bash\nORACLE_BASE=/data/oracle\nORACLE_HOME=$ORACLE_BASE/product/11.2.0\nORACLE_SID=orcl\nPATH=$PATH:$ORACLE_HOME/bin\nexport ORACLE_BASE ORACLE_HOME ORACLE_SID PATH\n```\n注意: 数据库实例要一致\n``` ORACLE_SID=orcl ```\n\n## 二、安装与配置\n\n### 2.1、以静默方式安装\n\n**编辑配置文件:** ``` vim /data/database/response/db_install.rsp ```\n**注意主机名请按照实际来写:** ```ORACLE_HOSTNAME=CentOS```\n``` shell\noracle.install.option=INSTALL_DB_SWONLY\nORACLE_HOSTNAME=CentOS\nUNIX_GROUP_NAME=oinstall\nINVENTORY_LOCATION=/data/oracle/inventory\nSELECTED_LANGUAGES=en,zh_CN\nORACLE_HOME=/data/oracle/product/11.2.0\nORACLE_BASE=/data/oracle\noracle.install.db.InstallEdition=EE\noracle.install.db.DBA_GROUP=dba\noracle.install.db.OPER_GROUP=dba\nDECLINE_SECURITY_UPDATES=true\n```\n**执行静默安装:** ``` ./runInstaller -silent -responseFile /data/database/response/db_install.rsp -ignorePrereq ```\n![image.png](/images/017.oracle.md.09.png)\n\n**看到如下信息表示安装成功**\n**新打开一个终端, 以root用户执行下面命令来完成安装:** \n``` bash\nsh /data/oracle/inventory/orainstRoot.sh\nsh /data/oracle/product/11.2.0/root.sh\n```\n![image.png](/images/017.oracle.md.10.png)\n\n\n### 2.2、以静默方式配置监听\n**切换成oracle用户,执行下面命令:**\n\n**配置文件:** ```vim /data/database/response/netca.rsp``` {% label warning @一般没什么要修改的地方 %}\n**注意:** ```/silent``` 不是 ```-silent```    ```/responseFile``` 不是```-responseFilet```\n\n**执行静默监听:** ``` netca /silent /responseFile /data/database/response/netca.rsp ```\n![image.png](/images/017.oracle.md.12.png)\n\n\n\n### 2.3、以静默方式创建一个实例\n**切换成oracle用户,执行下面命令:**\n\n**编辑配置文件:** ```vim /data/database/response/dbca.rsp```\n\n``` bash\nRESPONSEFILE_VERSION = \"11.2.0\"\nOPERATION_TYPE = \"createDatabase\"\nGDBNAME = \"orcl.test\"\nSID = \"orcl\"\nTEMPLATENAME = \"General_Purpose.dbc\"\nSYSPASSWORD = \"123456\"\nSYSTEMPASSWORD = \"123456\"\nSYSMANPASSWORD = \"123456\"\nDBSNMPPASSWORD = \"123456\"\nDATAFILEDESTINATION =/data/oracle/oradata\nRECOVERYAREADESTINATION = /data/oracle/fast_recovery_area\nCHARACTERSET = \"ZHS16GBK\"\n# oracle内存1638MB,物理内存2G*80%\nTOTALMEMORY = \"1638\" \n```\n``` dbca -silent -responseFile /data/database/response/dbca.rsp ```\n![image.png](/images/017.oracle.md.05.png)\n\n\n### 2.4、启动oracle\n\n``` lsnrctl start ```\n``` lsnrctl status ```\n<img src=\"/images/017.oracle.md.13.png\" width=70% height=80% />\n<!-- <img src=\"/images/017.oracle.md.03.png\" width=70% height=80% />\n<img src=\"/images/017.oracle.md.04.png\" width=70% height=80% /> -->\n\n\n\n## 三、修改端口\n**切换成oracle用户, 执行下面命令:** \n\n**停止监听**: ``` lsnrctl stop ```\n**修改监听配置文件**: ``` vim /<path to your oracle home>/network/admin/listener.ora```\n{% label danger@1521 %} --> {% label info@11521 %} \n``` bash\nLISTENER =\n  (DESCRIPTION_LIST =\n    (DESCRIPTION =\n      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC11521))\n      (ADDRESS = (PROTOCOL = TCP)(HOST = <your server host name>)(PORT = 11521))\n    )\n  )\n\nADR_BASE_LISTENER = /data/oracle\n```\n**修改local_listener参数**\n``` bash\n$ sqlplus / as sysdba\nSQL> show parameter local_listener\nSQL> alter system set local_listener=\"(address = (protocol = tcp)(host = localhost)(port = 11521))\";\nSQL> show parameter local_listener\n```\n![image.png](/images/017.oracle.md.11.png)\n**重启监听:** ``` lsnrctl reload ```\n\n## 四、数据导入导出\n\n\n### 4.1 创建逻辑目录\n该命令不会在操作系统创建真正的目录（请先创建真正的目录），最好以system等管理员创建逻辑目录。\n``` shell\nshell> sqlplus / as sysdba\nSQL> create directory data_dir as '/data/backup';\nDirectory created.\n```\n\n在操作系统创建真实目录并修改权限\n```mkdir -p /data/backup```\n```chown -R oracle:oinstall /data/backup```\n\n### 4.2 管理员目录\n\n```SQL>select * from dba_directories;```\n\n<img src=\"/images/017.oracle.md.06.png\" width=70% height=80% />\n\n### 4.3 给system用户赋予'data_dir'的读写权限\n\n``` SQL>grant read,write on directory data_dir to system; ```\n\n## 五、 使用expdp导出数据\n\n### 5.1 按用户导出\n\n``` expdp system/password@orcl schemas=system dumpfile=expdp.dmp directory=data_dir ```\n### 5.2 按表导出\n\n``` expdp system/password@orcl tables=emp,dept dumpfile=expdp.dmp directory=data_dir ```\n\n### 5.3 按查询条件导出\n\n``` expdp system/password@orcl directory=data_dir dumpfile=expdp.dmp tables=empquery='where deptno=20' ```\n\n### 5.4 按表空间导出\n\n``` expdp system/password@orcl directory=data_dir dumpfile=tablespace.dmptablespaces=temp,example ```\n\n### 5.5 整库导出\n\n``` expdp system/password@orcl directory=data_dir dumpfile=full.dmp full=y```\n\n### 5.6 例子\n\n**全库导出**实例: \n``` expdp system/password@172.21.33.23/orcl dumpfile=all.dmp directory=data_dir full=y logfile=all.log ```\n\n``` bash\n[oracle@centos7 backup]$ expdp system/password@172.21.33.23/orcl dumpfile=all.dmp directory=data_dir full=y logfile=all.log\nExport: Release 11.2.0.4.0 - Production on Wed Apr 12 14:46:19 2023\nCopyright (c) 1982, 2011, Oracle and/or its affiliates.  All rights reserved.\n;;; \nConnected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production\nWith the Partitioning, OLAP, Data Mining and Real Application Testing options\nStarting \"SYSTEM\".\"SYS_EXPORT_FULL_01\":  system/********@172.21.33.23/orcl dumpfile=all.dmp directory=data_dir full=y logfile=all.log \nEstimate in progress using BLOCKS method...\nProcessing object type DATABASE_EXPORT/SCHEMA/TABLE/TABLE_DATA\nTotal estimation using BLOCKS method: 1.104 GB\nProcessing object type DATABASE_EXPORT/TABLESPACE\nProcessing object type DATABASE_EXPORT/PROFILE\nProcessing object type DATABASE_EXPORT/SYS_USER/USER\nProcessing object type DATABASE_EXPORT/SCHEMA/POST_SCHEMA/PROCOBJ\nProcessing object type DATABASE_EXPORT/SCHEMA/POST_SCHEMA/PROCACT_SCHEMA\nProcessing object type DATABASE_EXPORT/AUDIT\n. . exported \"RSY\".\"DATAEX_PROVIDE_APPLY_copy1\"          114.3 MB  643767 rows\n. . exported \"DBSHUMENG\".\"PER_ASSI_FAMILY_BUSY_HOSPITAL\"  70.17 MB  309988 rows\n\n.\n.   数据已脱敏, 中间省略 n 行\n.\n\n. . exported \"SYSTEM\".\"REPCAT$_USER_AUTHORIZATIONS\"          0 KB       0 rows\n. . exported \"SYSTEM\".\"REPCAT$_USER_PARM_VALUES\"             0 KB       0 rows\n. . exported \"SYSTEM\".\"SQLPLUS_PRODUCT_PROFILE\"              0 KB       0 rows\n. . exported \"TDUSER\".\"TEST\"                                 0 KB       0 rows\nMaster table \"SYSTEM\".\"SYS_EXPORT_FULL_01\" successfully loaded/unloaded\n******************************************************************************\nDump file set for SYSTEM.SYS_EXPORT_FULL_01 is:\n  /data/backup/all.dmp\nJob \"SYSTEM\".\"SYS_EXPORT_FULL_01\" successfully completed at Wed Apr 12 14:49:08 2023 elapsed 0 00:02:47\n```\n\n\n## 六、 使用impdp导出数据\n\n\n### 6.1 导入用户\n\n从用户scott导入到用户scott\n``` impdp scott/tiger@orcl directory=data_dir  dumpfile=expdp.dmp schemas=scott```\n\n### 6.2 导入表\n\n从scott用户中把表dept和emp导入到system用户中\n``` impdp system/manager@orcl directory=data_dir dumpfile=expdp.dmp tables=scott.dept,scott.emp remap_schema=scott:system```\n\n### 6.3 导入表空间\n\n``` impdp system/manager@orcl directory=data_dir dumpfile=tablespace.dmp tablespaces=example```\n\n### 6.4 导入数据库(全)\n\n``` impdb system/manager@orcl directory=data_dir dumpfile=full.dmp full=y ``` \n\n### 6.5 追加数据\n\n``` impdp system/manager@orcl directory=data_dir dumpfile=expdp.dmp schemas=systemtable_exists_action``` \n\n### 6.6 例子\n\n**数据库(全)导入**实例:\n``` impdp system/password@172.19.3.12:11521/orcl.test directory=data_dir dumpfile=all.dmp logfile=import.log full=y ignore=y ```\n\n``` bash\n\n[oracle@host backup]$impdp system/password@172.19.3.12:11521/orcl.test directory=data_dir dumpfile=all.dmp logfile=import.log full=y ignore=y\n\nImport: Release 11.2.0.1.0 - Production on Wed Apr 12 22:01:24 2023\nCopyright (c) 1982, 2009, Oracle and/or its affiliates.  All rights reserved.\nConnected to: Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production\nWith the Partitioning, OLAP, Data Mining and Real Application Testing options\n;;; Legacy Mode Active due to the following parameters:\n;;; Legacy Mode Parameter: \"ignore=TRUE\" Location: Command Line, Replaced with: \"table_exists_action=append\"\nMaster table \"SYSTEM\".\"SYS_IMPORT_FULL_01\" successfully loaded/unloaded\nStarting \"SYSTEM\".\"SYS_IMPORT_FULL_01\":  system/********@172.19.3.12:11521/orcl.test directory=data_dir dumpfile=all.dmp logfile=import.log full=y table\n_exists_action=append \nProcessing object type DATABASE_EXPORT/TABLESPACE\nORA-31684: Object type TABLESPACE:\"UNDOTBS1\" already exists\nORA-31684: Object type TABLESPACE:\"TEMP\" already exists\nORA-31684: Object type TABLESPACE:\"USERS\" already exists\nORA-31684: Object type TABLESPACE:\"TRANSFERDB\" already exists\nProcessing object type DATABASE_EXPORT/PROFILE\nORA-31684: Object type PROFILE:\"MONITORING_PROFILE\" already exists\nProcessing object type DATABASE_EXPORT/SYS_USER/USER\nProcessing object type DATABASE_EXPORT/SCHEMA/USER\nORA-31684: Object type USER:\"OUTLN\" already exists\n.\n. 数据已脱敏, 中间省略 n 行\n.\n\nProcessing object type DATABASE_EXPORT/SCHEMA/TABLE/POST_INSTANCE/PROCACT_INSTANCE\nProcessing object type DATABASE_EXPORT/SCHEMA/TABLE/POST_INSTANCE/PROCDEPOBJ\nProcessing object type DATABASE_EXPORT/SCHEMA/POST_SCHEMA/PROCOBJ\nProcessing object type DATABASE_EXPORT/SCHEMA/POST_SCHEMA/PROCACT_SCHEMA\nProcessing object type DATABASE_EXPORT/AUDIT\nJob \"SYSTEM\".\"SYS_IMPORT_FULL_01\" completed with 7644 error(s) at 22:17:04\n```\n\n\n## 七、 数据导入导出常见错误\n **记录一下一次迁移Oracle中遇到的问题**\n\n ### 7.1 全库数据导入不完整\n\n ```Oracle A```:\n 所属: 生产环境 172.21.33.23\n 版本: ```  Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production```\n\n ``` Oracle B```:\n 所属: 测试环境 172.19.3.12\n 版本: ``` Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production```\n\n版本有细微差别, 但是影响不大\n\n从Oracle A 导出全库顺利, 导入Oracle B 只能导入**部分数据**\n\n相关报错: ``` ORA-01119: error in creating database file '/data/app/oracle/oradata/transferdb/transferdb.dbf' ```\n<img src=\"/images/017.oracle.md.08.png\" width=60% height=70% />\n\nOracle A 的 transferdb 表空间文件-->```'/data/app/oracle/oradata/transferdb/transferdb.dbf' ```\n然而在 Oracle B中连 ``` '/data/app/'``` 这个目录都没有, 所以会创建表空间失败.\n\n解决: 由于两个Oracle不是同一个人安装的, 导致实际Oracle的目录存在差别。\n虽然impdp在导入数据的时候**会创建原本不存在的表空间**, 由于两个Oracle表空间所属**目录不同导致创建表空间失败**, 手动创建表空间后再导入数据成功.\n\n\n\n> 参考:\n[Linux安装Oracle11g](https://www.cnblogs.com/mmzs/p/9033112.html)\n[Oracle使用EXPDP和IMPDP\b详细说明](https://designcoding.com/oracle-expdp-impdp-using#toc_h3_0)\n\n","source":"_posts/017.Oracle.md","raw":"---\ntitle: Oracle部署以及数据迁移\ndate: 2022-6-10 11:08:13\ncategories: \n- [Database]\ntags: \n- Oracle\n---\n\n> 本文章曾多次修改, 截图或者代码提及到的相关**主机名**和**ip**以及**目录**可能存在变化, 请勿信以为真.\n\n## 一、安装前准备\n\n### 1.1、上传文件\n``` scp linux.x64_11gR2_database_1of2 root@172.21.33.23:/data/oracle ```\n``` scp linux.x64_11gR2_database_2of2 root@172.21.33.23:/data/oracle ```\n### 1.2、解压文件\n``` unzip \\*.zip ```\n\n### 1.3、安装依赖\n``` yum install gcc make binutils gcc-c++ compat-libstdc++-33elfutils-libelf-devel elfutils-libelf-devel-static ksh libaio libaio-develnumactl-devel sysstat unixODBC unixODBC-devel pcre-devel –y ```\n\n### 1.4、 添加主机名到hosts文件\n\n```sed -i \"1s/$/ $(hostname)/\" ```\n\n### 1.5、添加安装用户和用户组\n``` bash\ngroupadd oinstall\ngroupadd dba\nuseradd -g oinstall -G dba oracle\npasswd oracle\n```\n\n### 1.6、修改内核参数\n编辑文件: ``` vim /etc/sysctl.conf ```\n在文件末尾添加如下:\n``` bash\nfs.aio-max-nr = 1048576\nfs.file-max = 6815744\nkernel.shmall = 2097152\nkernel.shmmax = 1073741824\nkernel.shmmni = 4096\nkernel.sem = 250 32000 100 128\nnet.ipv4.ip_local_port_range = 9000 65500\nnet.core.rmem_default = 262144\nnet.core.rmem_max = 4194304\nnet.core.wmem_default = 262144\nnet.core.wmem_max = 1048576 \n```\n立即生效: ```sysctl -p```\n\n### 1.7、修改用户的限制文件\n\n编辑文件: ``` vim /etc/security/limits.conf ```\n在文件末尾添加:\n``` bash\noracle           soft    nproc           2047\noracle           hard    nproc           16384\noracle           soft    nofile          1024\noracle           hard    nofile         65536\noracle           soft    stack           10240 \n```\n\n编辑文件: ``` vim /etc/pam.d/login ```\n在文件末尾添加:\n```bash\nsession required  /lib64/security/pam_limits.so\nsession required   pam_limits.so \n```\n\n编辑文件: ``` vim /etc/profile ```\n在文件末尾添加:\n``` bash\nif [ $USER = \"oracle\" ]; then\n  if [ $SHELL = \"/bin/ksh\" ]; then\n      ulimit -p 16384\n      ulimit -n 65536\n  else\n      ulimit -u 16384 -n 65536\n  fi\nfi \n```\n\n### 1.8、安装目录以及权限设置\n\n```bash\nmkdir -p /data/oracle/product/11.2.0\nmkdir /data/oracle/oradata\nmkdir /data/oracle/inventory\nmkdir /data/oracle/fast_recovery_area\nchown -R oracle:oinstall /data/oracle\nchmod -R 775 /data/oracle\n```\n\n### 1.9、Oracle用户环境变量\n\n切换到Oracle下: ``` su -l oracle ```\n\n编辑文件: ```vim .bash_profile```\n在文件末尾添加:\n``` bash\nORACLE_BASE=/data/oracle\nORACLE_HOME=$ORACLE_BASE/product/11.2.0\nORACLE_SID=orcl\nPATH=$PATH:$ORACLE_HOME/bin\nexport ORACLE_BASE ORACLE_HOME ORACLE_SID PATH\n```\n注意: 数据库实例要一致\n``` ORACLE_SID=orcl ```\n\n## 二、安装与配置\n\n### 2.1、以静默方式安装\n\n**编辑配置文件:** ``` vim /data/database/response/db_install.rsp ```\n**注意主机名请按照实际来写:** ```ORACLE_HOSTNAME=CentOS```\n``` shell\noracle.install.option=INSTALL_DB_SWONLY\nORACLE_HOSTNAME=CentOS\nUNIX_GROUP_NAME=oinstall\nINVENTORY_LOCATION=/data/oracle/inventory\nSELECTED_LANGUAGES=en,zh_CN\nORACLE_HOME=/data/oracle/product/11.2.0\nORACLE_BASE=/data/oracle\noracle.install.db.InstallEdition=EE\noracle.install.db.DBA_GROUP=dba\noracle.install.db.OPER_GROUP=dba\nDECLINE_SECURITY_UPDATES=true\n```\n**执行静默安装:** ``` ./runInstaller -silent -responseFile /data/database/response/db_install.rsp -ignorePrereq ```\n![image.png](/images/017.oracle.md.09.png)\n\n**看到如下信息表示安装成功**\n**新打开一个终端, 以root用户执行下面命令来完成安装:** \n``` bash\nsh /data/oracle/inventory/orainstRoot.sh\nsh /data/oracle/product/11.2.0/root.sh\n```\n![image.png](/images/017.oracle.md.10.png)\n\n\n### 2.2、以静默方式配置监听\n**切换成oracle用户,执行下面命令:**\n\n**配置文件:** ```vim /data/database/response/netca.rsp``` {% label warning @一般没什么要修改的地方 %}\n**注意:** ```/silent``` 不是 ```-silent```    ```/responseFile``` 不是```-responseFilet```\n\n**执行静默监听:** ``` netca /silent /responseFile /data/database/response/netca.rsp ```\n![image.png](/images/017.oracle.md.12.png)\n\n\n\n### 2.3、以静默方式创建一个实例\n**切换成oracle用户,执行下面命令:**\n\n**编辑配置文件:** ```vim /data/database/response/dbca.rsp```\n\n``` bash\nRESPONSEFILE_VERSION = \"11.2.0\"\nOPERATION_TYPE = \"createDatabase\"\nGDBNAME = \"orcl.test\"\nSID = \"orcl\"\nTEMPLATENAME = \"General_Purpose.dbc\"\nSYSPASSWORD = \"123456\"\nSYSTEMPASSWORD = \"123456\"\nSYSMANPASSWORD = \"123456\"\nDBSNMPPASSWORD = \"123456\"\nDATAFILEDESTINATION =/data/oracle/oradata\nRECOVERYAREADESTINATION = /data/oracle/fast_recovery_area\nCHARACTERSET = \"ZHS16GBK\"\n# oracle内存1638MB,物理内存2G*80%\nTOTALMEMORY = \"1638\" \n```\n``` dbca -silent -responseFile /data/database/response/dbca.rsp ```\n![image.png](/images/017.oracle.md.05.png)\n\n\n### 2.4、启动oracle\n\n``` lsnrctl start ```\n``` lsnrctl status ```\n<img src=\"/images/017.oracle.md.13.png\" width=70% height=80% />\n<!-- <img src=\"/images/017.oracle.md.03.png\" width=70% height=80% />\n<img src=\"/images/017.oracle.md.04.png\" width=70% height=80% /> -->\n\n\n\n## 三、修改端口\n**切换成oracle用户, 执行下面命令:** \n\n**停止监听**: ``` lsnrctl stop ```\n**修改监听配置文件**: ``` vim /<path to your oracle home>/network/admin/listener.ora```\n{% label danger@1521 %} --> {% label info@11521 %} \n``` bash\nLISTENER =\n  (DESCRIPTION_LIST =\n    (DESCRIPTION =\n      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC11521))\n      (ADDRESS = (PROTOCOL = TCP)(HOST = <your server host name>)(PORT = 11521))\n    )\n  )\n\nADR_BASE_LISTENER = /data/oracle\n```\n**修改local_listener参数**\n``` bash\n$ sqlplus / as sysdba\nSQL> show parameter local_listener\nSQL> alter system set local_listener=\"(address = (protocol = tcp)(host = localhost)(port = 11521))\";\nSQL> show parameter local_listener\n```\n![image.png](/images/017.oracle.md.11.png)\n**重启监听:** ``` lsnrctl reload ```\n\n## 四、数据导入导出\n\n\n### 4.1 创建逻辑目录\n该命令不会在操作系统创建真正的目录（请先创建真正的目录），最好以system等管理员创建逻辑目录。\n``` shell\nshell> sqlplus / as sysdba\nSQL> create directory data_dir as '/data/backup';\nDirectory created.\n```\n\n在操作系统创建真实目录并修改权限\n```mkdir -p /data/backup```\n```chown -R oracle:oinstall /data/backup```\n\n### 4.2 管理员目录\n\n```SQL>select * from dba_directories;```\n\n<img src=\"/images/017.oracle.md.06.png\" width=70% height=80% />\n\n### 4.3 给system用户赋予'data_dir'的读写权限\n\n``` SQL>grant read,write on directory data_dir to system; ```\n\n## 五、 使用expdp导出数据\n\n### 5.1 按用户导出\n\n``` expdp system/password@orcl schemas=system dumpfile=expdp.dmp directory=data_dir ```\n### 5.2 按表导出\n\n``` expdp system/password@orcl tables=emp,dept dumpfile=expdp.dmp directory=data_dir ```\n\n### 5.3 按查询条件导出\n\n``` expdp system/password@orcl directory=data_dir dumpfile=expdp.dmp tables=empquery='where deptno=20' ```\n\n### 5.4 按表空间导出\n\n``` expdp system/password@orcl directory=data_dir dumpfile=tablespace.dmptablespaces=temp,example ```\n\n### 5.5 整库导出\n\n``` expdp system/password@orcl directory=data_dir dumpfile=full.dmp full=y```\n\n### 5.6 例子\n\n**全库导出**实例: \n``` expdp system/password@172.21.33.23/orcl dumpfile=all.dmp directory=data_dir full=y logfile=all.log ```\n\n``` bash\n[oracle@centos7 backup]$ expdp system/password@172.21.33.23/orcl dumpfile=all.dmp directory=data_dir full=y logfile=all.log\nExport: Release 11.2.0.4.0 - Production on Wed Apr 12 14:46:19 2023\nCopyright (c) 1982, 2011, Oracle and/or its affiliates.  All rights reserved.\n;;; \nConnected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production\nWith the Partitioning, OLAP, Data Mining and Real Application Testing options\nStarting \"SYSTEM\".\"SYS_EXPORT_FULL_01\":  system/********@172.21.33.23/orcl dumpfile=all.dmp directory=data_dir full=y logfile=all.log \nEstimate in progress using BLOCKS method...\nProcessing object type DATABASE_EXPORT/SCHEMA/TABLE/TABLE_DATA\nTotal estimation using BLOCKS method: 1.104 GB\nProcessing object type DATABASE_EXPORT/TABLESPACE\nProcessing object type DATABASE_EXPORT/PROFILE\nProcessing object type DATABASE_EXPORT/SYS_USER/USER\nProcessing object type DATABASE_EXPORT/SCHEMA/POST_SCHEMA/PROCOBJ\nProcessing object type DATABASE_EXPORT/SCHEMA/POST_SCHEMA/PROCACT_SCHEMA\nProcessing object type DATABASE_EXPORT/AUDIT\n. . exported \"RSY\".\"DATAEX_PROVIDE_APPLY_copy1\"          114.3 MB  643767 rows\n. . exported \"DBSHUMENG\".\"PER_ASSI_FAMILY_BUSY_HOSPITAL\"  70.17 MB  309988 rows\n\n.\n.   数据已脱敏, 中间省略 n 行\n.\n\n. . exported \"SYSTEM\".\"REPCAT$_USER_AUTHORIZATIONS\"          0 KB       0 rows\n. . exported \"SYSTEM\".\"REPCAT$_USER_PARM_VALUES\"             0 KB       0 rows\n. . exported \"SYSTEM\".\"SQLPLUS_PRODUCT_PROFILE\"              0 KB       0 rows\n. . exported \"TDUSER\".\"TEST\"                                 0 KB       0 rows\nMaster table \"SYSTEM\".\"SYS_EXPORT_FULL_01\" successfully loaded/unloaded\n******************************************************************************\nDump file set for SYSTEM.SYS_EXPORT_FULL_01 is:\n  /data/backup/all.dmp\nJob \"SYSTEM\".\"SYS_EXPORT_FULL_01\" successfully completed at Wed Apr 12 14:49:08 2023 elapsed 0 00:02:47\n```\n\n\n## 六、 使用impdp导出数据\n\n\n### 6.1 导入用户\n\n从用户scott导入到用户scott\n``` impdp scott/tiger@orcl directory=data_dir  dumpfile=expdp.dmp schemas=scott```\n\n### 6.2 导入表\n\n从scott用户中把表dept和emp导入到system用户中\n``` impdp system/manager@orcl directory=data_dir dumpfile=expdp.dmp tables=scott.dept,scott.emp remap_schema=scott:system```\n\n### 6.3 导入表空间\n\n``` impdp system/manager@orcl directory=data_dir dumpfile=tablespace.dmp tablespaces=example```\n\n### 6.4 导入数据库(全)\n\n``` impdb system/manager@orcl directory=data_dir dumpfile=full.dmp full=y ``` \n\n### 6.5 追加数据\n\n``` impdp system/manager@orcl directory=data_dir dumpfile=expdp.dmp schemas=systemtable_exists_action``` \n\n### 6.6 例子\n\n**数据库(全)导入**实例:\n``` impdp system/password@172.19.3.12:11521/orcl.test directory=data_dir dumpfile=all.dmp logfile=import.log full=y ignore=y ```\n\n``` bash\n\n[oracle@host backup]$impdp system/password@172.19.3.12:11521/orcl.test directory=data_dir dumpfile=all.dmp logfile=import.log full=y ignore=y\n\nImport: Release 11.2.0.1.0 - Production on Wed Apr 12 22:01:24 2023\nCopyright (c) 1982, 2009, Oracle and/or its affiliates.  All rights reserved.\nConnected to: Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production\nWith the Partitioning, OLAP, Data Mining and Real Application Testing options\n;;; Legacy Mode Active due to the following parameters:\n;;; Legacy Mode Parameter: \"ignore=TRUE\" Location: Command Line, Replaced with: \"table_exists_action=append\"\nMaster table \"SYSTEM\".\"SYS_IMPORT_FULL_01\" successfully loaded/unloaded\nStarting \"SYSTEM\".\"SYS_IMPORT_FULL_01\":  system/********@172.19.3.12:11521/orcl.test directory=data_dir dumpfile=all.dmp logfile=import.log full=y table\n_exists_action=append \nProcessing object type DATABASE_EXPORT/TABLESPACE\nORA-31684: Object type TABLESPACE:\"UNDOTBS1\" already exists\nORA-31684: Object type TABLESPACE:\"TEMP\" already exists\nORA-31684: Object type TABLESPACE:\"USERS\" already exists\nORA-31684: Object type TABLESPACE:\"TRANSFERDB\" already exists\nProcessing object type DATABASE_EXPORT/PROFILE\nORA-31684: Object type PROFILE:\"MONITORING_PROFILE\" already exists\nProcessing object type DATABASE_EXPORT/SYS_USER/USER\nProcessing object type DATABASE_EXPORT/SCHEMA/USER\nORA-31684: Object type USER:\"OUTLN\" already exists\n.\n. 数据已脱敏, 中间省略 n 行\n.\n\nProcessing object type DATABASE_EXPORT/SCHEMA/TABLE/POST_INSTANCE/PROCACT_INSTANCE\nProcessing object type DATABASE_EXPORT/SCHEMA/TABLE/POST_INSTANCE/PROCDEPOBJ\nProcessing object type DATABASE_EXPORT/SCHEMA/POST_SCHEMA/PROCOBJ\nProcessing object type DATABASE_EXPORT/SCHEMA/POST_SCHEMA/PROCACT_SCHEMA\nProcessing object type DATABASE_EXPORT/AUDIT\nJob \"SYSTEM\".\"SYS_IMPORT_FULL_01\" completed with 7644 error(s) at 22:17:04\n```\n\n\n## 七、 数据导入导出常见错误\n **记录一下一次迁移Oracle中遇到的问题**\n\n ### 7.1 全库数据导入不完整\n\n ```Oracle A```:\n 所属: 生产环境 172.21.33.23\n 版本: ```  Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production```\n\n ``` Oracle B```:\n 所属: 测试环境 172.19.3.12\n 版本: ``` Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production```\n\n版本有细微差别, 但是影响不大\n\n从Oracle A 导出全库顺利, 导入Oracle B 只能导入**部分数据**\n\n相关报错: ``` ORA-01119: error in creating database file '/data/app/oracle/oradata/transferdb/transferdb.dbf' ```\n<img src=\"/images/017.oracle.md.08.png\" width=60% height=70% />\n\nOracle A 的 transferdb 表空间文件-->```'/data/app/oracle/oradata/transferdb/transferdb.dbf' ```\n然而在 Oracle B中连 ``` '/data/app/'``` 这个目录都没有, 所以会创建表空间失败.\n\n解决: 由于两个Oracle不是同一个人安装的, 导致实际Oracle的目录存在差别。\n虽然impdp在导入数据的时候**会创建原本不存在的表空间**, 由于两个Oracle表空间所属**目录不同导致创建表空间失败**, 手动创建表空间后再导入数据成功.\n\n\n\n> 参考:\n[Linux安装Oracle11g](https://www.cnblogs.com/mmzs/p/9033112.html)\n[Oracle使用EXPDP和IMPDP\b详细说明](https://designcoding.com/oracle-expdp-impdp-using#toc_h3_0)\n\n","slug":"017.Oracle","published":1,"updated":"2023-12-05T08:52:30.876Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzao001nijnr9m9q0rjn","content":"<blockquote>\n<p>本文章曾多次修改, 截图或者代码提及到的相关<strong>主机名</strong>和<strong>ip</strong>以及<strong>目录</strong>可能存在变化, 请勿信以为真.</p>\n</blockquote>\n<h2 id=\"一、安装前准备\"><a href=\"#一、安装前准备\" class=\"headerlink\" title=\"一、安装前准备\"></a>一、安装前准备</h2><h3 id=\"1-1、上传文件\"><a href=\"#1-1、上传文件\" class=\"headerlink\" title=\"1.1、上传文件\"></a>1.1、上传文件</h3><p><code>scp linux.x64_11gR2_database_1of2 root@172.21.33.23:/data/oracle</code><br><code>scp linux.x64_11gR2_database_2of2 root@172.21.33.23:/data/oracle</code></p>\n<h3 id=\"1-2、解压文件\"><a href=\"#1-2、解压文件\" class=\"headerlink\" title=\"1.2、解压文件\"></a>1.2、解压文件</h3><p><code>unzip \\*.zip</code></p>\n<h3 id=\"1-3、安装依赖\"><a href=\"#1-3、安装依赖\" class=\"headerlink\" title=\"1.3、安装依赖\"></a>1.3、安装依赖</h3><p><code>yum install gcc make binutils gcc-c++ compat-libstdc++-33elfutils-libelf-devel elfutils-libelf-devel-static ksh libaio libaio-develnumactl-devel sysstat unixODBC unixODBC-devel pcre-devel –y</code></p>\n<h3 id=\"1-4、-添加主机名到hosts文件\"><a href=\"#1-4、-添加主机名到hosts文件\" class=\"headerlink\" title=\"1.4、 添加主机名到hosts文件\"></a>1.4、 添加主机名到hosts文件</h3><p><code>sed -i &quot;1s/$/ $(hostname)/&quot; </code></p>\n<h3 id=\"1-5、添加安装用户和用户组\"><a href=\"#1-5、添加安装用户和用户组\" class=\"headerlink\" title=\"1.5、添加安装用户和用户组\"></a>1.5、添加安装用户和用户组</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">groupadd oinstall</span><br><span class=\"line\">groupadd dba</span><br><span class=\"line\">useradd -g oinstall -G dba oracle</span><br><span class=\"line\">passwd oracle</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-6、修改内核参数\"><a href=\"#1-6、修改内核参数\" class=\"headerlink\" title=\"1.6、修改内核参数\"></a>1.6、修改内核参数</h3><p>编辑文件: <code>vim /etc/sysctl.conf</code><br>在文件末尾添加如下:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">fs.aio-max-nr = 1048576</span><br><span class=\"line\">fs.file-max = 6815744</span><br><span class=\"line\">kernel.shmall = 2097152</span><br><span class=\"line\">kernel.shmmax = 1073741824</span><br><span class=\"line\">kernel.shmmni = 4096</span><br><span class=\"line\">kernel.sem = 250 32000 100 128</span><br><span class=\"line\">net.ipv4.ip_local_port_range = 9000 65500</span><br><span class=\"line\">net.core.rmem_default = 262144</span><br><span class=\"line\">net.core.rmem_max = 4194304</span><br><span class=\"line\">net.core.wmem_default = 262144</span><br><span class=\"line\">net.core.wmem_max = 1048576 </span><br></pre></td></tr></table></figure>\n<p>立即生效: <code>sysctl -p</code></p>\n<h3 id=\"1-7、修改用户的限制文件\"><a href=\"#1-7、修改用户的限制文件\" class=\"headerlink\" title=\"1.7、修改用户的限制文件\"></a>1.7、修改用户的限制文件</h3><p>编辑文件: <code>vim /etc/security/limits.conf</code><br>在文件末尾添加:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">oracle           soft    <span class=\"built_in\">nproc</span>           2047</span><br><span class=\"line\">oracle           hard    <span class=\"built_in\">nproc</span>           16384</span><br><span class=\"line\">oracle           soft    nofile          1024</span><br><span class=\"line\">oracle           hard    nofile         65536</span><br><span class=\"line\">oracle           soft    stack           10240 </span><br></pre></td></tr></table></figure>\n\n<p>编辑文件: <code>vim /etc/pam.d/login</code><br>在文件末尾添加:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">session required  /lib64/security/pam_limits.so</span><br><span class=\"line\">session required   pam_limits.so </span><br></pre></td></tr></table></figure>\n\n<p>编辑文件: <code>vim /etc/profile</code><br>在文件末尾添加:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$USER</span> = <span class=\"string\">&quot;oracle&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ <span class=\"variable\">$SHELL</span> = <span class=\"string\">&quot;/bin/ksh&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">      <span class=\"built_in\">ulimit</span> -p 16384</span><br><span class=\"line\">      <span class=\"built_in\">ulimit</span> -n 65536</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">      <span class=\"built_in\">ulimit</span> -u 16384 -n 65536</span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span> </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-8、安装目录以及权限设置\"><a href=\"#1-8、安装目录以及权限设置\" class=\"headerlink\" title=\"1.8、安装目录以及权限设置\"></a>1.8、安装目录以及权限设置</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /data/oracle/product/11.2.0</span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> /data/oracle/oradata</span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> /data/oracle/inventory</span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> /data/oracle/fast_recovery_area</span><br><span class=\"line\"><span class=\"built_in\">chown</span> -R oracle:oinstall /data/oracle</span><br><span class=\"line\"><span class=\"built_in\">chmod</span> -R 775 /data/oracle</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-9、Oracle用户环境变量\"><a href=\"#1-9、Oracle用户环境变量\" class=\"headerlink\" title=\"1.9、Oracle用户环境变量\"></a>1.9、Oracle用户环境变量</h3><p>切换到Oracle下: <code>su -l oracle</code></p>\n<p>编辑文件: <code>vim .bash_profile</code><br>在文件末尾添加:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">ORACLE_BASE=/data/oracle</span><br><span class=\"line\">ORACLE_HOME=<span class=\"variable\">$ORACLE_BASE</span>/product/11.2.0</span><br><span class=\"line\">ORACLE_SID=orcl</span><br><span class=\"line\">PATH=<span class=\"variable\">$PATH</span>:<span class=\"variable\">$ORACLE_HOME</span>/bin</span><br><span class=\"line\"><span class=\"built_in\">export</span> ORACLE_BASE ORACLE_HOME ORACLE_SID PATH</span><br></pre></td></tr></table></figure>\n<p>注意: 数据库实例要一致<br><code>ORACLE_SID=orcl</code></p>\n<h2 id=\"二、安装与配置\"><a href=\"#二、安装与配置\" class=\"headerlink\" title=\"二、安装与配置\"></a>二、安装与配置</h2><h3 id=\"2-1、以静默方式安装\"><a href=\"#2-1、以静默方式安装\" class=\"headerlink\" title=\"2.1、以静默方式安装\"></a>2.1、以静默方式安装</h3><p><strong>编辑配置文件:</strong> <code>vim /data/database/response/db_install.rsp</code><br><strong>注意主机名请按照实际来写:</strong> <code>ORACLE_HOSTNAME=CentOS</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">oracle.install.option=INSTALL_DB_SWONLY</span><br><span class=\"line\">ORACLE_HOSTNAME=CentOS</span><br><span class=\"line\">UNIX_GROUP_NAME=oinstall</span><br><span class=\"line\">INVENTORY_LOCATION=/data/oracle/inventory</span><br><span class=\"line\">SELECTED_LANGUAGES=en,zh_CN</span><br><span class=\"line\">ORACLE_HOME=/data/oracle/product/11.2.0</span><br><span class=\"line\">ORACLE_BASE=/data/oracle</span><br><span class=\"line\">oracle.install.db.InstallEdition=EE</span><br><span class=\"line\">oracle.install.db.DBA_GROUP=dba</span><br><span class=\"line\">oracle.install.db.OPER_GROUP=dba</span><br><span class=\"line\">DECLINE_SECURITY_UPDATES=true</span><br></pre></td></tr></table></figure>\n<p><strong>执行静默安装:</strong> <code>./runInstaller -silent -responseFile /data/database/response/db_install.rsp -ignorePrereq</code><br><img src=\"/images/017.oracle.md.09.png\" alt=\"image.png\"></p>\n<p><strong>看到如下信息表示安装成功</strong><br><strong>新打开一个终端, 以root用户执行下面命令来完成安装:</strong> </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sh /data/oracle/inventory/orainstRoot.sh</span><br><span class=\"line\">sh /data/oracle/product/11.2.0/root.sh</span><br></pre></td></tr></table></figure>\n<p><img src=\"/images/017.oracle.md.10.png\" alt=\"image.png\"></p>\n<h3 id=\"2-2、以静默方式配置监听\"><a href=\"#2-2、以静默方式配置监听\" class=\"headerlink\" title=\"2.2、以静默方式配置监听\"></a>2.2、以静默方式配置监听</h3><p><strong>切换成oracle用户,执行下面命令:</strong></p>\n<p><strong>配置文件:</strong> <code>vim /data/database/response/netca.rsp</code> <mark class=\"label warning\">一般没什么要修改的地方</mark><br><strong>注意:</strong> <code>/silent</code> 不是 <code>-silent</code>    <code>/responseFile</code> 不是<code>-responseFilet</code></p>\n<p><strong>执行静默监听:</strong> <code>netca /silent /responseFile /data/database/response/netca.rsp</code><br><img src=\"/images/017.oracle.md.12.png\" alt=\"image.png\"></p>\n<h3 id=\"2-3、以静默方式创建一个实例\"><a href=\"#2-3、以静默方式创建一个实例\" class=\"headerlink\" title=\"2.3、以静默方式创建一个实例\"></a>2.3、以静默方式创建一个实例</h3><p><strong>切换成oracle用户,执行下面命令:</strong></p>\n<p><strong>编辑配置文件:</strong> <code>vim /data/database/response/dbca.rsp</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">RESPONSEFILE_VERSION = <span class=\"string\">&quot;11.2.0&quot;</span></span><br><span class=\"line\">OPERATION_TYPE = <span class=\"string\">&quot;createDatabase&quot;</span></span><br><span class=\"line\">GDBNAME = <span class=\"string\">&quot;orcl.test&quot;</span></span><br><span class=\"line\">SID = <span class=\"string\">&quot;orcl&quot;</span></span><br><span class=\"line\">TEMPLATENAME = <span class=\"string\">&quot;General_Purpose.dbc&quot;</span></span><br><span class=\"line\">SYSPASSWORD = <span class=\"string\">&quot;123456&quot;</span></span><br><span class=\"line\">SYSTEMPASSWORD = <span class=\"string\">&quot;123456&quot;</span></span><br><span class=\"line\">SYSMANPASSWORD = <span class=\"string\">&quot;123456&quot;</span></span><br><span class=\"line\">DBSNMPPASSWORD = <span class=\"string\">&quot;123456&quot;</span></span><br><span class=\"line\">DATAFILEDESTINATION =/data/oracle/oradata</span><br><span class=\"line\">RECOVERYAREADESTINATION = /data/oracle/fast_recovery_area</span><br><span class=\"line\">CHARACTERSET = <span class=\"string\">&quot;ZHS16GBK&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># oracle内存1638MB,物理内存2G*80%</span></span><br><span class=\"line\">TOTALMEMORY = <span class=\"string\">&quot;1638&quot;</span> </span><br></pre></td></tr></table></figure>\n<p><code>dbca -silent -responseFile /data/database/response/dbca.rsp</code><br><img src=\"/images/017.oracle.md.05.png\" alt=\"image.png\"></p>\n<h3 id=\"2-4、启动oracle\"><a href=\"#2-4、启动oracle\" class=\"headerlink\" title=\"2.4、启动oracle\"></a>2.4、启动oracle</h3><p><code>lsnrctl start</code><br><code>lsnrctl status</code><br><img src=\"/images/017.oracle.md.13.png\" width=70% height=80% /></p>\n<!-- <img src=\"/images/017.oracle.md.03.png\" width=70% height=80% />\n<img src=\"/images/017.oracle.md.04.png\" width=70% height=80% /> -->\n\n\n\n<h2 id=\"三、修改端口\"><a href=\"#三、修改端口\" class=\"headerlink\" title=\"三、修改端口\"></a>三、修改端口</h2><p><strong>切换成oracle用户, 执行下面命令:</strong> </p>\n<p><strong>停止监听</strong>: <code>lsnrctl stop</code><br><strong>修改监听配置文件</strong>: <code> vim /&lt;path to your oracle home&gt;/network/admin/listener.ora</code></p>\n<mark class=\"label danger\">1521</mark> --> <mark class=\"label info\">11521</mark> \n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">LISTENER =</span><br><span class=\"line\">  (DESCRIPTION_LIST =</span><br><span class=\"line\">    (DESCRIPTION =</span><br><span class=\"line\">      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC11521))</span><br><span class=\"line\">      (ADDRESS = (PROTOCOL = TCP)(HOST = &lt;your server host name&gt;)(PORT = 11521))</span><br><span class=\"line\">    )</span><br><span class=\"line\">  )</span><br><span class=\"line\"></span><br><span class=\"line\">ADR_BASE_LISTENER = /data/oracle</span><br></pre></td></tr></table></figure>\n<p><strong>修改local_listener参数</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ sqlplus / as sysdba</span><br><span class=\"line\">SQL&gt; show parameter local_listener</span><br><span class=\"line\">SQL&gt; alter system <span class=\"built_in\">set</span> local_listener=<span class=\"string\">&quot;(address = (protocol = tcp)(host = localhost)(port = 11521))&quot;</span>;</span><br><span class=\"line\">SQL&gt; show parameter local_listener</span><br></pre></td></tr></table></figure>\n<p><img src=\"/images/017.oracle.md.11.png\" alt=\"image.png\"><br><strong>重启监听:</strong> <code>lsnrctl reload</code></p>\n<h2 id=\"四、数据导入导出\"><a href=\"#四、数据导入导出\" class=\"headerlink\" title=\"四、数据导入导出\"></a>四、数据导入导出</h2><h3 id=\"4-1-创建逻辑目录\"><a href=\"#4-1-创建逻辑目录\" class=\"headerlink\" title=\"4.1 创建逻辑目录\"></a>4.1 创建逻辑目录</h3><p>该命令不会在操作系统创建真正的目录（请先创建真正的目录），最好以system等管理员创建逻辑目录。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">shell&gt; </span><span class=\"language-bash\">sqlplus / as sysdba</span></span><br><span class=\"line\"><span class=\"meta prompt_\">SQL&gt; </span><span class=\"language-bash\">create directory data_dir as <span class=\"string\">&#x27;/data/backup&#x27;</span>;</span></span><br><span class=\"line\">Directory created.</span><br></pre></td></tr></table></figure>\n\n<p>在操作系统创建真实目录并修改权限<br><code>mkdir -p /data/backup</code><br><code>chown -R oracle:oinstall /data/backup</code></p>\n<h3 id=\"4-2-管理员目录\"><a href=\"#4-2-管理员目录\" class=\"headerlink\" title=\"4.2 管理员目录\"></a>4.2 管理员目录</h3><p><code>SQL&gt;select * from dba_directories;</code></p>\n<img src=\"/images/017.oracle.md.06.png\" width=70% height=80% />\n\n<h3 id=\"4-3-给system用户赋予’data-dir’的读写权限\"><a href=\"#4-3-给system用户赋予’data-dir’的读写权限\" class=\"headerlink\" title=\"4.3 给system用户赋予’data_dir’的读写权限\"></a>4.3 给system用户赋予’data_dir’的读写权限</h3><p><code>SQL&gt;grant read,write on directory data_dir to system;</code></p>\n<h2 id=\"五、-使用expdp导出数据\"><a href=\"#五、-使用expdp导出数据\" class=\"headerlink\" title=\"五、 使用expdp导出数据\"></a>五、 使用expdp导出数据</h2><h3 id=\"5-1-按用户导出\"><a href=\"#5-1-按用户导出\" class=\"headerlink\" title=\"5.1 按用户导出\"></a>5.1 按用户导出</h3><p><code>expdp system/password@orcl schemas=system dumpfile=expdp.dmp directory=data_dir</code></p>\n<h3 id=\"5-2-按表导出\"><a href=\"#5-2-按表导出\" class=\"headerlink\" title=\"5.2 按表导出\"></a>5.2 按表导出</h3><p><code>expdp system/password@orcl tables=emp,dept dumpfile=expdp.dmp directory=data_dir</code></p>\n<h3 id=\"5-3-按查询条件导出\"><a href=\"#5-3-按查询条件导出\" class=\"headerlink\" title=\"5.3 按查询条件导出\"></a>5.3 按查询条件导出</h3><p><code>expdp system/password@orcl directory=data_dir dumpfile=expdp.dmp tables=empquery=&#39;where deptno=20&#39;</code></p>\n<h3 id=\"5-4-按表空间导出\"><a href=\"#5-4-按表空间导出\" class=\"headerlink\" title=\"5.4 按表空间导出\"></a>5.4 按表空间导出</h3><p><code>expdp system/password@orcl directory=data_dir dumpfile=tablespace.dmptablespaces=temp,example</code></p>\n<h3 id=\"5-5-整库导出\"><a href=\"#5-5-整库导出\" class=\"headerlink\" title=\"5.5 整库导出\"></a>5.5 整库导出</h3><p><code> expdp system/password@orcl directory=data_dir dumpfile=full.dmp full=y</code></p>\n<h3 id=\"5-6-例子\"><a href=\"#5-6-例子\" class=\"headerlink\" title=\"5.6 例子\"></a>5.6 例子</h3><p><strong>全库导出</strong>实例:<br><code>expdp system/password@172.21.33.23/orcl dumpfile=all.dmp directory=data_dir full=y logfile=all.log</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[oracle@centos7 backup]$ expdp system/password@172.21.33.23/orcl dumpfile=all.dmp directory=data_dir full=y logfile=all.log</span><br><span class=\"line\">Export: Release 11.2.0.4.0 - Production on Wed Apr 12 14:46:19 2023</span><br><span class=\"line\">Copyright (c) 1982, 2011, Oracle and/or its affiliates.  All rights reserved.</span><br><span class=\"line\">;;; </span><br><span class=\"line\">Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production</span><br><span class=\"line\">With the Partitioning, OLAP, Data Mining and Real Application Testing options</span><br><span class=\"line\">Starting <span class=\"string\">&quot;SYSTEM&quot;</span>.<span class=\"string\">&quot;SYS_EXPORT_FULL_01&quot;</span>:  system/********@172.21.33.23/orcl dumpfile=all.dmp directory=data_dir full=y logfile=all.log </span><br><span class=\"line\">Estimate <span class=\"keyword\">in</span> progress using BLOCKS method...</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SCHEMA/TABLE/TABLE_DATA</span><br><span class=\"line\">Total estimation using BLOCKS method: 1.104 GB</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/TABLESPACE</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/PROFILE</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SYS_USER/USER</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SCHEMA/POST_SCHEMA/PROCOBJ</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SCHEMA/POST_SCHEMA/PROCACT_SCHEMA</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/AUDIT</span><br><span class=\"line\">. . exported <span class=\"string\">&quot;RSY&quot;</span>.<span class=\"string\">&quot;DATAEX_PROVIDE_APPLY_copy1&quot;</span>          114.3 MB  643767 rows</span><br><span class=\"line\">. . exported <span class=\"string\">&quot;DBSHUMENG&quot;</span>.<span class=\"string\">&quot;PER_ASSI_FAMILY_BUSY_HOSPITAL&quot;</span>  70.17 MB  309988 rows</span><br><span class=\"line\"></span><br><span class=\"line\">.</span><br><span class=\"line\">.   数据已脱敏, 中间省略 n 行</span><br><span class=\"line\">.</span><br><span class=\"line\"></span><br><span class=\"line\">. . exported <span class=\"string\">&quot;SYSTEM&quot;</span>.<span class=\"string\">&quot;REPCAT<span class=\"variable\">$_USER_AUTHORIZATIONS</span>&quot;</span>          0 KB       0 rows</span><br><span class=\"line\">. . exported <span class=\"string\">&quot;SYSTEM&quot;</span>.<span class=\"string\">&quot;REPCAT<span class=\"variable\">$_USER_PARM_VALUES</span>&quot;</span>             0 KB       0 rows</span><br><span class=\"line\">. . exported <span class=\"string\">&quot;SYSTEM&quot;</span>.<span class=\"string\">&quot;SQLPLUS_PRODUCT_PROFILE&quot;</span>              0 KB       0 rows</span><br><span class=\"line\">. . exported <span class=\"string\">&quot;TDUSER&quot;</span>.<span class=\"string\">&quot;TEST&quot;</span>                                 0 KB       0 rows</span><br><span class=\"line\">Master table <span class=\"string\">&quot;SYSTEM&quot;</span>.<span class=\"string\">&quot;SYS_EXPORT_FULL_01&quot;</span> successfully loaded/unloaded</span><br><span class=\"line\">******************************************************************************</span><br><span class=\"line\">Dump file <span class=\"built_in\">set</span> <span class=\"keyword\">for</span> SYSTEM.SYS_EXPORT_FULL_01 is:</span><br><span class=\"line\">  /data/backup/all.dmp</span><br><span class=\"line\">Job <span class=\"string\">&quot;SYSTEM&quot;</span>.<span class=\"string\">&quot;SYS_EXPORT_FULL_01&quot;</span> successfully completed at Wed Apr 12 14:49:08 2023 elapsed 0 00:02:47</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"六、-使用impdp导出数据\"><a href=\"#六、-使用impdp导出数据\" class=\"headerlink\" title=\"六、 使用impdp导出数据\"></a>六、 使用impdp导出数据</h2><h3 id=\"6-1-导入用户\"><a href=\"#6-1-导入用户\" class=\"headerlink\" title=\"6.1 导入用户\"></a>6.1 导入用户</h3><p>从用户scott导入到用户scott<br><code> impdp scott/tiger@orcl directory=data_dir  dumpfile=expdp.dmp schemas=scott</code></p>\n<h3 id=\"6-2-导入表\"><a href=\"#6-2-导入表\" class=\"headerlink\" title=\"6.2 导入表\"></a>6.2 导入表</h3><p>从scott用户中把表dept和emp导入到system用户中<br><code> impdp system/manager@orcl directory=data_dir dumpfile=expdp.dmp tables=scott.dept,scott.emp remap_schema=scott:system</code></p>\n<h3 id=\"6-3-导入表空间\"><a href=\"#6-3-导入表空间\" class=\"headerlink\" title=\"6.3 导入表空间\"></a>6.3 导入表空间</h3><p><code> impdp system/manager@orcl directory=data_dir dumpfile=tablespace.dmp tablespaces=example</code></p>\n<h3 id=\"6-4-导入数据库-全\"><a href=\"#6-4-导入数据库-全\" class=\"headerlink\" title=\"6.4 导入数据库(全)\"></a>6.4 导入数据库(全)</h3><p><code>impdb system/manager@orcl directory=data_dir dumpfile=full.dmp full=y</code> </p>\n<h3 id=\"6-5-追加数据\"><a href=\"#6-5-追加数据\" class=\"headerlink\" title=\"6.5 追加数据\"></a>6.5 追加数据</h3><p><code> impdp system/manager@orcl directory=data_dir dumpfile=expdp.dmp schemas=systemtable_exists_action</code> </p>\n<h3 id=\"6-6-例子\"><a href=\"#6-6-例子\" class=\"headerlink\" title=\"6.6 例子\"></a>6.6 例子</h3><p><strong>数据库(全)导入</strong>实例:<br><code>impdp system/password@172.19.3.12:11521/orcl.test directory=data_dir dumpfile=all.dmp logfile=import.log full=y ignore=y</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">[oracle@host backup]<span class=\"variable\">$impdp</span> system/password@172.19.3.12:11521/orcl.test directory=data_dir dumpfile=all.dmp logfile=import.log full=y ignore=y</span><br><span class=\"line\"></span><br><span class=\"line\">Import: Release 11.2.0.1.0 - Production on Wed Apr 12 22:01:24 2023</span><br><span class=\"line\">Copyright (c) 1982, 2009, Oracle and/or its affiliates.  All rights reserved.</span><br><span class=\"line\">Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production</span><br><span class=\"line\">With the Partitioning, OLAP, Data Mining and Real Application Testing options</span><br><span class=\"line\">;;; Legacy Mode Active due to the following parameters:</span><br><span class=\"line\">;;; Legacy Mode Parameter: <span class=\"string\">&quot;ignore=TRUE&quot;</span> Location: Command Line, Replaced with: <span class=\"string\">&quot;table_exists_action=append&quot;</span></span><br><span class=\"line\">Master table <span class=\"string\">&quot;SYSTEM&quot;</span>.<span class=\"string\">&quot;SYS_IMPORT_FULL_01&quot;</span> successfully loaded/unloaded</span><br><span class=\"line\">Starting <span class=\"string\">&quot;SYSTEM&quot;</span>.<span class=\"string\">&quot;SYS_IMPORT_FULL_01&quot;</span>:  system/********@172.19.3.12:11521/orcl.test directory=data_dir dumpfile=all.dmp logfile=import.log full=y table</span><br><span class=\"line\">_exists_action=append </span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/TABLESPACE</span><br><span class=\"line\">ORA-31684: Object <span class=\"built_in\">type</span> TABLESPACE:<span class=\"string\">&quot;UNDOTBS1&quot;</span> already exists</span><br><span class=\"line\">ORA-31684: Object <span class=\"built_in\">type</span> TABLESPACE:<span class=\"string\">&quot;TEMP&quot;</span> already exists</span><br><span class=\"line\">ORA-31684: Object <span class=\"built_in\">type</span> TABLESPACE:<span class=\"string\">&quot;USERS&quot;</span> already exists</span><br><span class=\"line\">ORA-31684: Object <span class=\"built_in\">type</span> TABLESPACE:<span class=\"string\">&quot;TRANSFERDB&quot;</span> already exists</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/PROFILE</span><br><span class=\"line\">ORA-31684: Object <span class=\"built_in\">type</span> PROFILE:<span class=\"string\">&quot;MONITORING_PROFILE&quot;</span> already exists</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SYS_USER/USER</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SCHEMA/USER</span><br><span class=\"line\">ORA-31684: Object <span class=\"built_in\">type</span> USER:<span class=\"string\">&quot;OUTLN&quot;</span> already exists</span><br><span class=\"line\">.</span><br><span class=\"line\">. 数据已脱敏, 中间省略 n 行</span><br><span class=\"line\">.</span><br><span class=\"line\"></span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SCHEMA/TABLE/POST_INSTANCE/PROCACT_INSTANCE</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SCHEMA/TABLE/POST_INSTANCE/PROCDEPOBJ</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SCHEMA/POST_SCHEMA/PROCOBJ</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SCHEMA/POST_SCHEMA/PROCACT_SCHEMA</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/AUDIT</span><br><span class=\"line\">Job <span class=\"string\">&quot;SYSTEM&quot;</span>.<span class=\"string\">&quot;SYS_IMPORT_FULL_01&quot;</span> completed with 7644 error(s) at 22:17:04</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"七、-数据导入导出常见错误\"><a href=\"#七、-数据导入导出常见错误\" class=\"headerlink\" title=\"七、 数据导入导出常见错误\"></a>七、 数据导入导出常见错误</h2><p> <strong>记录一下一次迁移Oracle中遇到的问题</strong></p>\n<h3 id=\"7-1-全库数据导入不完整\"><a href=\"#7-1-全库数据导入不完整\" class=\"headerlink\" title=\"7.1 全库数据导入不完整\"></a>7.1 全库数据导入不完整</h3><p> <code>Oracle A</code>:<br> 所属: 生产环境 172.21.33.23<br> 版本: <code>  Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production</code></p>\n<p> <code> Oracle B</code>:<br> 所属: 测试环境 172.19.3.12<br> 版本: <code> Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production</code></p>\n<p>版本有细微差别, 但是影响不大</p>\n<p>从Oracle A 导出全库顺利, 导入Oracle B 只能导入<strong>部分数据</strong></p>\n<p>相关报错: <code>ORA-01119: error in creating database file &#39;/data/app/oracle/oradata/transferdb/transferdb.dbf&#39;</code><br><img src=\"/images/017.oracle.md.08.png\" width=60% height=70% /></p>\n<p>Oracle A 的 transferdb 表空间文件–&gt;<code>&#39;/data/app/oracle/oradata/transferdb/transferdb.dbf&#39; </code><br>然而在 Oracle B中连 <code> &#39;/data/app/&#39;</code> 这个目录都没有, 所以会创建表空间失败.</p>\n<p>解决: 由于两个Oracle不是同一个人安装的, 导致实际Oracle的目录存在差别。<br>虽然impdp在导入数据的时候<strong>会创建原本不存在的表空间</strong>, 由于两个Oracle表空间所属<strong>目录不同导致创建表空间失败</strong>, 手动创建表空间后再导入数据成功.</p>\n<blockquote>\n<p>参考:<br><a href=\"https://www.cnblogs.com/mmzs/p/9033112.html\">Linux安装Oracle11g</a><br><a href=\"https://designcoding.com/oracle-expdp-impdp-using#toc_h3_0\">Oracle使用EXPDP和IMPDP\b详细说明</a></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>本文章曾多次修改, 截图或者代码提及到的相关<strong>主机名</strong>和<strong>ip</strong>以及<strong>目录</strong>可能存在变化, 请勿信以为真.</p>\n</blockquote>\n<h2 id=\"一、安装前准备\"><a href=\"#一、安装前准备\" class=\"headerlink\" title=\"一、安装前准备\"></a>一、安装前准备</h2><h3 id=\"1-1、上传文件\"><a href=\"#1-1、上传文件\" class=\"headerlink\" title=\"1.1、上传文件\"></a>1.1、上传文件</h3><p><code>scp linux.x64_11gR2_database_1of2 root@172.21.33.23:/data/oracle</code><br><code>scp linux.x64_11gR2_database_2of2 root@172.21.33.23:/data/oracle</code></p>\n<h3 id=\"1-2、解压文件\"><a href=\"#1-2、解压文件\" class=\"headerlink\" title=\"1.2、解压文件\"></a>1.2、解压文件</h3><p><code>unzip \\*.zip</code></p>\n<h3 id=\"1-3、安装依赖\"><a href=\"#1-3、安装依赖\" class=\"headerlink\" title=\"1.3、安装依赖\"></a>1.3、安装依赖</h3><p><code>yum install gcc make binutils gcc-c++ compat-libstdc++-33elfutils-libelf-devel elfutils-libelf-devel-static ksh libaio libaio-develnumactl-devel sysstat unixODBC unixODBC-devel pcre-devel –y</code></p>\n<h3 id=\"1-4、-添加主机名到hosts文件\"><a href=\"#1-4、-添加主机名到hosts文件\" class=\"headerlink\" title=\"1.4、 添加主机名到hosts文件\"></a>1.4、 添加主机名到hosts文件</h3><p><code>sed -i &quot;1s/$/ $(hostname)/&quot; </code></p>\n<h3 id=\"1-5、添加安装用户和用户组\"><a href=\"#1-5、添加安装用户和用户组\" class=\"headerlink\" title=\"1.5、添加安装用户和用户组\"></a>1.5、添加安装用户和用户组</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">groupadd oinstall</span><br><span class=\"line\">groupadd dba</span><br><span class=\"line\">useradd -g oinstall -G dba oracle</span><br><span class=\"line\">passwd oracle</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-6、修改内核参数\"><a href=\"#1-6、修改内核参数\" class=\"headerlink\" title=\"1.6、修改内核参数\"></a>1.6、修改内核参数</h3><p>编辑文件: <code>vim /etc/sysctl.conf</code><br>在文件末尾添加如下:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">fs.aio-max-nr = 1048576</span><br><span class=\"line\">fs.file-max = 6815744</span><br><span class=\"line\">kernel.shmall = 2097152</span><br><span class=\"line\">kernel.shmmax = 1073741824</span><br><span class=\"line\">kernel.shmmni = 4096</span><br><span class=\"line\">kernel.sem = 250 32000 100 128</span><br><span class=\"line\">net.ipv4.ip_local_port_range = 9000 65500</span><br><span class=\"line\">net.core.rmem_default = 262144</span><br><span class=\"line\">net.core.rmem_max = 4194304</span><br><span class=\"line\">net.core.wmem_default = 262144</span><br><span class=\"line\">net.core.wmem_max = 1048576 </span><br></pre></td></tr></table></figure>\n<p>立即生效: <code>sysctl -p</code></p>\n<h3 id=\"1-7、修改用户的限制文件\"><a href=\"#1-7、修改用户的限制文件\" class=\"headerlink\" title=\"1.7、修改用户的限制文件\"></a>1.7、修改用户的限制文件</h3><p>编辑文件: <code>vim /etc/security/limits.conf</code><br>在文件末尾添加:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">oracle           soft    <span class=\"built_in\">nproc</span>           2047</span><br><span class=\"line\">oracle           hard    <span class=\"built_in\">nproc</span>           16384</span><br><span class=\"line\">oracle           soft    nofile          1024</span><br><span class=\"line\">oracle           hard    nofile         65536</span><br><span class=\"line\">oracle           soft    stack           10240 </span><br></pre></td></tr></table></figure>\n\n<p>编辑文件: <code>vim /etc/pam.d/login</code><br>在文件末尾添加:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">session required  /lib64/security/pam_limits.so</span><br><span class=\"line\">session required   pam_limits.so </span><br></pre></td></tr></table></figure>\n\n<p>编辑文件: <code>vim /etc/profile</code><br>在文件末尾添加:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$USER</span> = <span class=\"string\">&quot;oracle&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ <span class=\"variable\">$SHELL</span> = <span class=\"string\">&quot;/bin/ksh&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">      <span class=\"built_in\">ulimit</span> -p 16384</span><br><span class=\"line\">      <span class=\"built_in\">ulimit</span> -n 65536</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">      <span class=\"built_in\">ulimit</span> -u 16384 -n 65536</span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span> </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-8、安装目录以及权限设置\"><a href=\"#1-8、安装目录以及权限设置\" class=\"headerlink\" title=\"1.8、安装目录以及权限设置\"></a>1.8、安装目录以及权限设置</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /data/oracle/product/11.2.0</span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> /data/oracle/oradata</span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> /data/oracle/inventory</span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> /data/oracle/fast_recovery_area</span><br><span class=\"line\"><span class=\"built_in\">chown</span> -R oracle:oinstall /data/oracle</span><br><span class=\"line\"><span class=\"built_in\">chmod</span> -R 775 /data/oracle</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-9、Oracle用户环境变量\"><a href=\"#1-9、Oracle用户环境变量\" class=\"headerlink\" title=\"1.9、Oracle用户环境变量\"></a>1.9、Oracle用户环境变量</h3><p>切换到Oracle下: <code>su -l oracle</code></p>\n<p>编辑文件: <code>vim .bash_profile</code><br>在文件末尾添加:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">ORACLE_BASE=/data/oracle</span><br><span class=\"line\">ORACLE_HOME=<span class=\"variable\">$ORACLE_BASE</span>/product/11.2.0</span><br><span class=\"line\">ORACLE_SID=orcl</span><br><span class=\"line\">PATH=<span class=\"variable\">$PATH</span>:<span class=\"variable\">$ORACLE_HOME</span>/bin</span><br><span class=\"line\"><span class=\"built_in\">export</span> ORACLE_BASE ORACLE_HOME ORACLE_SID PATH</span><br></pre></td></tr></table></figure>\n<p>注意: 数据库实例要一致<br><code>ORACLE_SID=orcl</code></p>\n<h2 id=\"二、安装与配置\"><a href=\"#二、安装与配置\" class=\"headerlink\" title=\"二、安装与配置\"></a>二、安装与配置</h2><h3 id=\"2-1、以静默方式安装\"><a href=\"#2-1、以静默方式安装\" class=\"headerlink\" title=\"2.1、以静默方式安装\"></a>2.1、以静默方式安装</h3><p><strong>编辑配置文件:</strong> <code>vim /data/database/response/db_install.rsp</code><br><strong>注意主机名请按照实际来写:</strong> <code>ORACLE_HOSTNAME=CentOS</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">oracle.install.option=INSTALL_DB_SWONLY</span><br><span class=\"line\">ORACLE_HOSTNAME=CentOS</span><br><span class=\"line\">UNIX_GROUP_NAME=oinstall</span><br><span class=\"line\">INVENTORY_LOCATION=/data/oracle/inventory</span><br><span class=\"line\">SELECTED_LANGUAGES=en,zh_CN</span><br><span class=\"line\">ORACLE_HOME=/data/oracle/product/11.2.0</span><br><span class=\"line\">ORACLE_BASE=/data/oracle</span><br><span class=\"line\">oracle.install.db.InstallEdition=EE</span><br><span class=\"line\">oracle.install.db.DBA_GROUP=dba</span><br><span class=\"line\">oracle.install.db.OPER_GROUP=dba</span><br><span class=\"line\">DECLINE_SECURITY_UPDATES=true</span><br></pre></td></tr></table></figure>\n<p><strong>执行静默安装:</strong> <code>./runInstaller -silent -responseFile /data/database/response/db_install.rsp -ignorePrereq</code><br><img src=\"/images/017.oracle.md.09.png\" alt=\"image.png\"></p>\n<p><strong>看到如下信息表示安装成功</strong><br><strong>新打开一个终端, 以root用户执行下面命令来完成安装:</strong> </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sh /data/oracle/inventory/orainstRoot.sh</span><br><span class=\"line\">sh /data/oracle/product/11.2.0/root.sh</span><br></pre></td></tr></table></figure>\n<p><img src=\"/images/017.oracle.md.10.png\" alt=\"image.png\"></p>\n<h3 id=\"2-2、以静默方式配置监听\"><a href=\"#2-2、以静默方式配置监听\" class=\"headerlink\" title=\"2.2、以静默方式配置监听\"></a>2.2、以静默方式配置监听</h3><p><strong>切换成oracle用户,执行下面命令:</strong></p>\n<p><strong>配置文件:</strong> <code>vim /data/database/response/netca.rsp</code> <mark class=\"label warning\">一般没什么要修改的地方</mark><br><strong>注意:</strong> <code>/silent</code> 不是 <code>-silent</code>    <code>/responseFile</code> 不是<code>-responseFilet</code></p>\n<p><strong>执行静默监听:</strong> <code>netca /silent /responseFile /data/database/response/netca.rsp</code><br><img src=\"/images/017.oracle.md.12.png\" alt=\"image.png\"></p>\n<h3 id=\"2-3、以静默方式创建一个实例\"><a href=\"#2-3、以静默方式创建一个实例\" class=\"headerlink\" title=\"2.3、以静默方式创建一个实例\"></a>2.3、以静默方式创建一个实例</h3><p><strong>切换成oracle用户,执行下面命令:</strong></p>\n<p><strong>编辑配置文件:</strong> <code>vim /data/database/response/dbca.rsp</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">RESPONSEFILE_VERSION = <span class=\"string\">&quot;11.2.0&quot;</span></span><br><span class=\"line\">OPERATION_TYPE = <span class=\"string\">&quot;createDatabase&quot;</span></span><br><span class=\"line\">GDBNAME = <span class=\"string\">&quot;orcl.test&quot;</span></span><br><span class=\"line\">SID = <span class=\"string\">&quot;orcl&quot;</span></span><br><span class=\"line\">TEMPLATENAME = <span class=\"string\">&quot;General_Purpose.dbc&quot;</span></span><br><span class=\"line\">SYSPASSWORD = <span class=\"string\">&quot;123456&quot;</span></span><br><span class=\"line\">SYSTEMPASSWORD = <span class=\"string\">&quot;123456&quot;</span></span><br><span class=\"line\">SYSMANPASSWORD = <span class=\"string\">&quot;123456&quot;</span></span><br><span class=\"line\">DBSNMPPASSWORD = <span class=\"string\">&quot;123456&quot;</span></span><br><span class=\"line\">DATAFILEDESTINATION =/data/oracle/oradata</span><br><span class=\"line\">RECOVERYAREADESTINATION = /data/oracle/fast_recovery_area</span><br><span class=\"line\">CHARACTERSET = <span class=\"string\">&quot;ZHS16GBK&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># oracle内存1638MB,物理内存2G*80%</span></span><br><span class=\"line\">TOTALMEMORY = <span class=\"string\">&quot;1638&quot;</span> </span><br></pre></td></tr></table></figure>\n<p><code>dbca -silent -responseFile /data/database/response/dbca.rsp</code><br><img src=\"/images/017.oracle.md.05.png\" alt=\"image.png\"></p>\n<h3 id=\"2-4、启动oracle\"><a href=\"#2-4、启动oracle\" class=\"headerlink\" title=\"2.4、启动oracle\"></a>2.4、启动oracle</h3><p><code>lsnrctl start</code><br><code>lsnrctl status</code><br><img src=\"/images/017.oracle.md.13.png\" width=70% height=80% /></p>\n<!-- <img src=\"/images/017.oracle.md.03.png\" width=70% height=80% />\n<img src=\"/images/017.oracle.md.04.png\" width=70% height=80% /> -->\n\n\n\n<h2 id=\"三、修改端口\"><a href=\"#三、修改端口\" class=\"headerlink\" title=\"三、修改端口\"></a>三、修改端口</h2><p><strong>切换成oracle用户, 执行下面命令:</strong> </p>\n<p><strong>停止监听</strong>: <code>lsnrctl stop</code><br><strong>修改监听配置文件</strong>: <code> vim /&lt;path to your oracle home&gt;/network/admin/listener.ora</code></p>\n<mark class=\"label danger\">1521</mark> --> <mark class=\"label info\">11521</mark> \n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">LISTENER =</span><br><span class=\"line\">  (DESCRIPTION_LIST =</span><br><span class=\"line\">    (DESCRIPTION =</span><br><span class=\"line\">      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC11521))</span><br><span class=\"line\">      (ADDRESS = (PROTOCOL = TCP)(HOST = &lt;your server host name&gt;)(PORT = 11521))</span><br><span class=\"line\">    )</span><br><span class=\"line\">  )</span><br><span class=\"line\"></span><br><span class=\"line\">ADR_BASE_LISTENER = /data/oracle</span><br></pre></td></tr></table></figure>\n<p><strong>修改local_listener参数</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ sqlplus / as sysdba</span><br><span class=\"line\">SQL&gt; show parameter local_listener</span><br><span class=\"line\">SQL&gt; alter system <span class=\"built_in\">set</span> local_listener=<span class=\"string\">&quot;(address = (protocol = tcp)(host = localhost)(port = 11521))&quot;</span>;</span><br><span class=\"line\">SQL&gt; show parameter local_listener</span><br></pre></td></tr></table></figure>\n<p><img src=\"/images/017.oracle.md.11.png\" alt=\"image.png\"><br><strong>重启监听:</strong> <code>lsnrctl reload</code></p>\n<h2 id=\"四、数据导入导出\"><a href=\"#四、数据导入导出\" class=\"headerlink\" title=\"四、数据导入导出\"></a>四、数据导入导出</h2><h3 id=\"4-1-创建逻辑目录\"><a href=\"#4-1-创建逻辑目录\" class=\"headerlink\" title=\"4.1 创建逻辑目录\"></a>4.1 创建逻辑目录</h3><p>该命令不会在操作系统创建真正的目录（请先创建真正的目录），最好以system等管理员创建逻辑目录。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">shell&gt; </span><span class=\"language-bash\">sqlplus / as sysdba</span></span><br><span class=\"line\"><span class=\"meta prompt_\">SQL&gt; </span><span class=\"language-bash\">create directory data_dir as <span class=\"string\">&#x27;/data/backup&#x27;</span>;</span></span><br><span class=\"line\">Directory created.</span><br></pre></td></tr></table></figure>\n\n<p>在操作系统创建真实目录并修改权限<br><code>mkdir -p /data/backup</code><br><code>chown -R oracle:oinstall /data/backup</code></p>\n<h3 id=\"4-2-管理员目录\"><a href=\"#4-2-管理员目录\" class=\"headerlink\" title=\"4.2 管理员目录\"></a>4.2 管理员目录</h3><p><code>SQL&gt;select * from dba_directories;</code></p>\n<img src=\"/images/017.oracle.md.06.png\" width=70% height=80% />\n\n<h3 id=\"4-3-给system用户赋予’data-dir’的读写权限\"><a href=\"#4-3-给system用户赋予’data-dir’的读写权限\" class=\"headerlink\" title=\"4.3 给system用户赋予’data_dir’的读写权限\"></a>4.3 给system用户赋予’data_dir’的读写权限</h3><p><code>SQL&gt;grant read,write on directory data_dir to system;</code></p>\n<h2 id=\"五、-使用expdp导出数据\"><a href=\"#五、-使用expdp导出数据\" class=\"headerlink\" title=\"五、 使用expdp导出数据\"></a>五、 使用expdp导出数据</h2><h3 id=\"5-1-按用户导出\"><a href=\"#5-1-按用户导出\" class=\"headerlink\" title=\"5.1 按用户导出\"></a>5.1 按用户导出</h3><p><code>expdp system/password@orcl schemas=system dumpfile=expdp.dmp directory=data_dir</code></p>\n<h3 id=\"5-2-按表导出\"><a href=\"#5-2-按表导出\" class=\"headerlink\" title=\"5.2 按表导出\"></a>5.2 按表导出</h3><p><code>expdp system/password@orcl tables=emp,dept dumpfile=expdp.dmp directory=data_dir</code></p>\n<h3 id=\"5-3-按查询条件导出\"><a href=\"#5-3-按查询条件导出\" class=\"headerlink\" title=\"5.3 按查询条件导出\"></a>5.3 按查询条件导出</h3><p><code>expdp system/password@orcl directory=data_dir dumpfile=expdp.dmp tables=empquery=&#39;where deptno=20&#39;</code></p>\n<h3 id=\"5-4-按表空间导出\"><a href=\"#5-4-按表空间导出\" class=\"headerlink\" title=\"5.4 按表空间导出\"></a>5.4 按表空间导出</h3><p><code>expdp system/password@orcl directory=data_dir dumpfile=tablespace.dmptablespaces=temp,example</code></p>\n<h3 id=\"5-5-整库导出\"><a href=\"#5-5-整库导出\" class=\"headerlink\" title=\"5.5 整库导出\"></a>5.5 整库导出</h3><p><code> expdp system/password@orcl directory=data_dir dumpfile=full.dmp full=y</code></p>\n<h3 id=\"5-6-例子\"><a href=\"#5-6-例子\" class=\"headerlink\" title=\"5.6 例子\"></a>5.6 例子</h3><p><strong>全库导出</strong>实例:<br><code>expdp system/password@172.21.33.23/orcl dumpfile=all.dmp directory=data_dir full=y logfile=all.log</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[oracle@centos7 backup]$ expdp system/password@172.21.33.23/orcl dumpfile=all.dmp directory=data_dir full=y logfile=all.log</span><br><span class=\"line\">Export: Release 11.2.0.4.0 - Production on Wed Apr 12 14:46:19 2023</span><br><span class=\"line\">Copyright (c) 1982, 2011, Oracle and/or its affiliates.  All rights reserved.</span><br><span class=\"line\">;;; </span><br><span class=\"line\">Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production</span><br><span class=\"line\">With the Partitioning, OLAP, Data Mining and Real Application Testing options</span><br><span class=\"line\">Starting <span class=\"string\">&quot;SYSTEM&quot;</span>.<span class=\"string\">&quot;SYS_EXPORT_FULL_01&quot;</span>:  system/********@172.21.33.23/orcl dumpfile=all.dmp directory=data_dir full=y logfile=all.log </span><br><span class=\"line\">Estimate <span class=\"keyword\">in</span> progress using BLOCKS method...</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SCHEMA/TABLE/TABLE_DATA</span><br><span class=\"line\">Total estimation using BLOCKS method: 1.104 GB</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/TABLESPACE</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/PROFILE</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SYS_USER/USER</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SCHEMA/POST_SCHEMA/PROCOBJ</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SCHEMA/POST_SCHEMA/PROCACT_SCHEMA</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/AUDIT</span><br><span class=\"line\">. . exported <span class=\"string\">&quot;RSY&quot;</span>.<span class=\"string\">&quot;DATAEX_PROVIDE_APPLY_copy1&quot;</span>          114.3 MB  643767 rows</span><br><span class=\"line\">. . exported <span class=\"string\">&quot;DBSHUMENG&quot;</span>.<span class=\"string\">&quot;PER_ASSI_FAMILY_BUSY_HOSPITAL&quot;</span>  70.17 MB  309988 rows</span><br><span class=\"line\"></span><br><span class=\"line\">.</span><br><span class=\"line\">.   数据已脱敏, 中间省略 n 行</span><br><span class=\"line\">.</span><br><span class=\"line\"></span><br><span class=\"line\">. . exported <span class=\"string\">&quot;SYSTEM&quot;</span>.<span class=\"string\">&quot;REPCAT<span class=\"variable\">$_USER_AUTHORIZATIONS</span>&quot;</span>          0 KB       0 rows</span><br><span class=\"line\">. . exported <span class=\"string\">&quot;SYSTEM&quot;</span>.<span class=\"string\">&quot;REPCAT<span class=\"variable\">$_USER_PARM_VALUES</span>&quot;</span>             0 KB       0 rows</span><br><span class=\"line\">. . exported <span class=\"string\">&quot;SYSTEM&quot;</span>.<span class=\"string\">&quot;SQLPLUS_PRODUCT_PROFILE&quot;</span>              0 KB       0 rows</span><br><span class=\"line\">. . exported <span class=\"string\">&quot;TDUSER&quot;</span>.<span class=\"string\">&quot;TEST&quot;</span>                                 0 KB       0 rows</span><br><span class=\"line\">Master table <span class=\"string\">&quot;SYSTEM&quot;</span>.<span class=\"string\">&quot;SYS_EXPORT_FULL_01&quot;</span> successfully loaded/unloaded</span><br><span class=\"line\">******************************************************************************</span><br><span class=\"line\">Dump file <span class=\"built_in\">set</span> <span class=\"keyword\">for</span> SYSTEM.SYS_EXPORT_FULL_01 is:</span><br><span class=\"line\">  /data/backup/all.dmp</span><br><span class=\"line\">Job <span class=\"string\">&quot;SYSTEM&quot;</span>.<span class=\"string\">&quot;SYS_EXPORT_FULL_01&quot;</span> successfully completed at Wed Apr 12 14:49:08 2023 elapsed 0 00:02:47</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"六、-使用impdp导出数据\"><a href=\"#六、-使用impdp导出数据\" class=\"headerlink\" title=\"六、 使用impdp导出数据\"></a>六、 使用impdp导出数据</h2><h3 id=\"6-1-导入用户\"><a href=\"#6-1-导入用户\" class=\"headerlink\" title=\"6.1 导入用户\"></a>6.1 导入用户</h3><p>从用户scott导入到用户scott<br><code> impdp scott/tiger@orcl directory=data_dir  dumpfile=expdp.dmp schemas=scott</code></p>\n<h3 id=\"6-2-导入表\"><a href=\"#6-2-导入表\" class=\"headerlink\" title=\"6.2 导入表\"></a>6.2 导入表</h3><p>从scott用户中把表dept和emp导入到system用户中<br><code> impdp system/manager@orcl directory=data_dir dumpfile=expdp.dmp tables=scott.dept,scott.emp remap_schema=scott:system</code></p>\n<h3 id=\"6-3-导入表空间\"><a href=\"#6-3-导入表空间\" class=\"headerlink\" title=\"6.3 导入表空间\"></a>6.3 导入表空间</h3><p><code> impdp system/manager@orcl directory=data_dir dumpfile=tablespace.dmp tablespaces=example</code></p>\n<h3 id=\"6-4-导入数据库-全\"><a href=\"#6-4-导入数据库-全\" class=\"headerlink\" title=\"6.4 导入数据库(全)\"></a>6.4 导入数据库(全)</h3><p><code>impdb system/manager@orcl directory=data_dir dumpfile=full.dmp full=y</code> </p>\n<h3 id=\"6-5-追加数据\"><a href=\"#6-5-追加数据\" class=\"headerlink\" title=\"6.5 追加数据\"></a>6.5 追加数据</h3><p><code> impdp system/manager@orcl directory=data_dir dumpfile=expdp.dmp schemas=systemtable_exists_action</code> </p>\n<h3 id=\"6-6-例子\"><a href=\"#6-6-例子\" class=\"headerlink\" title=\"6.6 例子\"></a>6.6 例子</h3><p><strong>数据库(全)导入</strong>实例:<br><code>impdp system/password@172.19.3.12:11521/orcl.test directory=data_dir dumpfile=all.dmp logfile=import.log full=y ignore=y</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">[oracle@host backup]<span class=\"variable\">$impdp</span> system/password@172.19.3.12:11521/orcl.test directory=data_dir dumpfile=all.dmp logfile=import.log full=y ignore=y</span><br><span class=\"line\"></span><br><span class=\"line\">Import: Release 11.2.0.1.0 - Production on Wed Apr 12 22:01:24 2023</span><br><span class=\"line\">Copyright (c) 1982, 2009, Oracle and/or its affiliates.  All rights reserved.</span><br><span class=\"line\">Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production</span><br><span class=\"line\">With the Partitioning, OLAP, Data Mining and Real Application Testing options</span><br><span class=\"line\">;;; Legacy Mode Active due to the following parameters:</span><br><span class=\"line\">;;; Legacy Mode Parameter: <span class=\"string\">&quot;ignore=TRUE&quot;</span> Location: Command Line, Replaced with: <span class=\"string\">&quot;table_exists_action=append&quot;</span></span><br><span class=\"line\">Master table <span class=\"string\">&quot;SYSTEM&quot;</span>.<span class=\"string\">&quot;SYS_IMPORT_FULL_01&quot;</span> successfully loaded/unloaded</span><br><span class=\"line\">Starting <span class=\"string\">&quot;SYSTEM&quot;</span>.<span class=\"string\">&quot;SYS_IMPORT_FULL_01&quot;</span>:  system/********@172.19.3.12:11521/orcl.test directory=data_dir dumpfile=all.dmp logfile=import.log full=y table</span><br><span class=\"line\">_exists_action=append </span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/TABLESPACE</span><br><span class=\"line\">ORA-31684: Object <span class=\"built_in\">type</span> TABLESPACE:<span class=\"string\">&quot;UNDOTBS1&quot;</span> already exists</span><br><span class=\"line\">ORA-31684: Object <span class=\"built_in\">type</span> TABLESPACE:<span class=\"string\">&quot;TEMP&quot;</span> already exists</span><br><span class=\"line\">ORA-31684: Object <span class=\"built_in\">type</span> TABLESPACE:<span class=\"string\">&quot;USERS&quot;</span> already exists</span><br><span class=\"line\">ORA-31684: Object <span class=\"built_in\">type</span> TABLESPACE:<span class=\"string\">&quot;TRANSFERDB&quot;</span> already exists</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/PROFILE</span><br><span class=\"line\">ORA-31684: Object <span class=\"built_in\">type</span> PROFILE:<span class=\"string\">&quot;MONITORING_PROFILE&quot;</span> already exists</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SYS_USER/USER</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SCHEMA/USER</span><br><span class=\"line\">ORA-31684: Object <span class=\"built_in\">type</span> USER:<span class=\"string\">&quot;OUTLN&quot;</span> already exists</span><br><span class=\"line\">.</span><br><span class=\"line\">. 数据已脱敏, 中间省略 n 行</span><br><span class=\"line\">.</span><br><span class=\"line\"></span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SCHEMA/TABLE/POST_INSTANCE/PROCACT_INSTANCE</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SCHEMA/TABLE/POST_INSTANCE/PROCDEPOBJ</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SCHEMA/POST_SCHEMA/PROCOBJ</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/SCHEMA/POST_SCHEMA/PROCACT_SCHEMA</span><br><span class=\"line\">Processing object <span class=\"built_in\">type</span> DATABASE_EXPORT/AUDIT</span><br><span class=\"line\">Job <span class=\"string\">&quot;SYSTEM&quot;</span>.<span class=\"string\">&quot;SYS_IMPORT_FULL_01&quot;</span> completed with 7644 error(s) at 22:17:04</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"七、-数据导入导出常见错误\"><a href=\"#七、-数据导入导出常见错误\" class=\"headerlink\" title=\"七、 数据导入导出常见错误\"></a>七、 数据导入导出常见错误</h2><p> <strong>记录一下一次迁移Oracle中遇到的问题</strong></p>\n<h3 id=\"7-1-全库数据导入不完整\"><a href=\"#7-1-全库数据导入不完整\" class=\"headerlink\" title=\"7.1 全库数据导入不完整\"></a>7.1 全库数据导入不完整</h3><p> <code>Oracle A</code>:<br> 所属: 生产环境 172.21.33.23<br> 版本: <code>  Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production</code></p>\n<p> <code> Oracle B</code>:<br> 所属: 测试环境 172.19.3.12<br> 版本: <code> Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production</code></p>\n<p>版本有细微差别, 但是影响不大</p>\n<p>从Oracle A 导出全库顺利, 导入Oracle B 只能导入<strong>部分数据</strong></p>\n<p>相关报错: <code>ORA-01119: error in creating database file &#39;/data/app/oracle/oradata/transferdb/transferdb.dbf&#39;</code><br><img src=\"/images/017.oracle.md.08.png\" width=60% height=70% /></p>\n<p>Oracle A 的 transferdb 表空间文件–&gt;<code>&#39;/data/app/oracle/oradata/transferdb/transferdb.dbf&#39; </code><br>然而在 Oracle B中连 <code> &#39;/data/app/&#39;</code> 这个目录都没有, 所以会创建表空间失败.</p>\n<p>解决: 由于两个Oracle不是同一个人安装的, 导致实际Oracle的目录存在差别。<br>虽然impdp在导入数据的时候<strong>会创建原本不存在的表空间</strong>, 由于两个Oracle表空间所属<strong>目录不同导致创建表空间失败</strong>, 手动创建表空间后再导入数据成功.</p>\n<blockquote>\n<p>参考:<br><a href=\"https://www.cnblogs.com/mmzs/p/9033112.html\">Linux安装Oracle11g</a><br><a href=\"https://designcoding.com/oracle-expdp-impdp-using#toc_h3_0\">Oracle使用EXPDP和IMPDP\b详细说明</a></p>\n</blockquote>\n"},{"title":"MySQL部署, 以及常见问题梳理","date":"2022-06-13T08:00:13.000Z","_content":"\n0) 下载\n``` https://downloads.mysql.com/archives/community/ ```\n选择 ``` mysql-5.7.37-1.el7.x86_64.rpm-bundle.tar ```\n\n1) 包文件详解\n\n``` bash\nmysql-community-client：MySQL客户端应用程序和工具 \nmysql-community-common：服务器和客户端库的通用文件 \nmysql-community-devel：用于MySQL数据库客户端应用程序的开发头文件和库 \nmysql-community-embedded：MySQL嵌入式库 \nmysql-community-embedded-compat：MySQL服务器作为嵌入式库，与使用库版本18的应用程序兼容 \nmysql-community-embedded-devel：MySQL的开发标头文件和库作为可嵌入库 \nmysql-community-libs：MySQL数据库客户端应用程序的共享库 \nmysql-community-libs-compat：以前的MySQL安装的共享兼容性库 \nmysql-community-server：数据库服务器和相关工具 \nmysql-community-test：MySQL服务器的测试套件 \n```\n\n2) rpm 安装顺序\n``` common--->libs--->client--->server--->libs-compat--->devel ```\n\n\n``` bash\nrpm -ivh mysql-community-common-5.7.37-1.el7.x86_64.rpm \\\n> mysql-community-libs-5.7.37-1.el7.x86_64.rpm \\\n> mysql-community-server-5.7.37-1.el7.x86_64.rpm \\\n> mysql-community-client-5.7.37-1.el7.x86_64.rpm \\\n## (上面四个必装)\n> mysql-community-libs-compat-5.7.37-1.el7.x86_64.rpm \\\n> mysql-community-devel-5.7.37-1.el7.x86_64.rpm \n```\n\n\n~~3) 重载systemctl~~\n~~``` systemctl daemon-reload ```~~\n\n4) 启动 MySQL\n``` systemctl start mysqld ```\n\n5) 进入mysql\n``` mysql -u root -p ```\n**Ubuntu需要使用sudo**\n**部分情况需要 ``` -h 127.0.0.1 ```**\n**没有设置密码直接enter即可进入mysql**\n**部分文档提到, yum或者rpm安装会在 ```/var/log/mysqld.log```里生成密码, ~~目前没有碰到过, 估计是老版本才会有.~~**\n**如果之前安装过, 没有卸载赶紧的话会提示 ERROR 1045  密码错误, 使用原来的密码即可登录**\n\n6) 初始化 ```mysqld``` (步骤5无法进入mysql)\n\n> MySQL的运行需要一个系统库，初始化MySQL的操作就是生成这个系统库。在MySQL 5.7之前的版本，初始化操作是通过MySQL源码目录下的scripts目录中名为mysql_install_db的初始化脚本进行的；而从MySQL 5.7版本开始，mysql_install_db被弃用.\n![image.png](/images/018.mysql.md.01.png)\n\n7) 设置安全向导 (步骤6 无效)\n\n```mysql_secure_installation```\n\n  -- 为root用户设置密码\n  -- 删除匿名账号\n  -- 取消root用户远程登录\n  -- 删除test库和对test库的访问权限\n  -- 刷新授权表使修改生效 \n\n\n8) Table 'performance_schema.session_variables' doesn't exist\n```mysql_upgrade -u root -p --force```\n```systemctl restart mysqld```\n\n9) 卸载数据库以及数据删除\n``` yum autoremove mysql* ```\n``` rm -rf /var/lib/mysql* ```\n\n9.1) 重置数据库(暂未测试过...)\n``` mysqld --initialize ```\n```systemctl restart mysqld```\n\n此时初始化安装完数据库之后会在mysql.log里生成密码\n``` grep \"temporary password\" /var/log/mysqld.log ```\n\n10) 使用生成的密码登录后要修改密码(注意密码复杂度)\n``` set password = password(\"yourpassword\") ```\n``` flush privileges```\n\n11) 允许远程登录\n修改 localhost字段为 '%'\n\n``` select user, host, authentication_string from mysql.user;```\n``` update mysql.user set host = '%' where user = 'root' and host = 'localhost';```\n![image.png](/images/018.mysql.md.02.png)\n\n12) 较新版本里 ```password``` 已经修改成了 ```authentication_string```\n> 相关引用: https://mariadb.com/kb/en/mysqluser-table/\n\n\n13) 限制mysql登录\n~~```update mysql.user set host='10.45.51.0/24' where user='root' and host='127.0.0.1';```~~\n~~``` grant all on *.* to 'root'@'10.40.' identified by 'yourpassword'; ```~~\n\n指定ip或者网段\n指定 192.168.128.8 可以登录\n``` update mysql.user set host='192.168.128.8' where user ='root' and host = 'localhost'; ```\n``` grant all on *.* to 'root'@'192.168.128.8' identified by 'yourpassword'; ```\n``` grant all on *.* to 'root'@'192.168.128.8' identified by 'yourpassword' with grant option; ```\n如果 ```grant all``` 这种写法提示语法错误, 在语句后面加上 ```with grant option```\n\n指定 192.168.128.0/24网段 可以登录\n``` update mysql.user set host='192.168.128.%' where user ='root' and host = 'localhost'; ``` \n``` grant all on *.* to 'root'@'192.168.128.%' identified by 'yourpassword'; ``` \n也有下面这种写法, 但是经过测试无效(mysql community 5.7.37 具体没有深入)\n``` update mysql.user set host='192.168.128.' where user ='root' and host = 'localhost'; ``` \n\n\n![image.png](/images/018.mysql.md.03.png)\n\n14) general_log 开启\n\n``` bash\nmysql> show global variables like '%general%';\n+------------------+----------------------------+\n| Variable_name    | Value                      |\n+------------------+----------------------------+\n| general_log      | OFF                        |\n| general_log_file | /var/lib/mysql/centos7.log |\n+------------------+----------------------------+\n2 rows in set (0.02 sec)\n\n```\n**使用命令修改的设置会在服务重启之后失效**\n\n临时生效: \n\n``` bash\n　　mysql>set global general_log_file='/tmp/general.lg';    # 设置路径\n　　mysql>set global general_log=on;                        # 开启general log模式\n　　mysql>set global general_log=off;                       # 关闭general log模式\n```\n永久生效:\n编辑配置文件 ```/etc/my.cnf``` 添加:\n\n``` bash\ngeneral_log = 1\ngeneral_log_file = /tmp/general.log\n```\n\n\n15) log_bin 开启\n\n``` bash\nmysql> show global variables like '%log_bin%';\n+---------------------------------+-------+\n| Variable_name                   | Value |\n+---------------------------------+-------+\n| log_bin                         | OFF   |\n| log_bin_basename                |       |\n| log_bin_index                   |       |\n| log_bin_trust_function_creators | OFF   |\n| log_bin_use_v1_row_events       | OFF   |\n+---------------------------------+-------+\n5 rows in set (0.01 sec)\n```\n\n永久生效: \n编辑```vim /etc/my.cnf```添加:\n\n``` bash\nserver_id=2\nlog_bin = mysql-bin\nbinlog_format = ROW\nexpire_logs_days = 30\n```\n重启mysql:\n``` systemctl restart mysqld ```\n\n再次查看log_bin:\n\n```bash\nmysql> show global variables like '%log_bin%';\n+---------------------------------+--------------------------------+\n| Variable_name                   | Value                          |\n+---------------------------------+--------------------------------+\n| log_bin                         | ON                             |\n| log_bin_basename                | /var/lib/mysql/mysql-bin       |\n| log_bin_index                   | /var/lib/mysql/mysql-bin.index |\n| log_bin_trust_function_creators | OFF                            |\n| log_bin_use_v1_row_events       | OFF                            |\n+---------------------------------+--------------------------------+\n5 rows in set (0.00 sec)\n```\n16) slow_query_log 开启\n\n``` bash\nmysql> show variables like 'slow_query_log%';\n+---------------------+---------------------------------+\n| Variable_name       | Value                           |\n+---------------------+---------------------------------+\n| slow_query_log      | OFF                             |\n| slow_query_log_file | /var/lib/mysql/centos7-slow.log |\n+---------------------+---------------------------------+\n2 rows in set (0.01 sec)\n```\n临时生效:\n``` set global slow_query_log=1; ```\n\n永久生效:\n修改```/etc/my.cnf```添加:\n\n``` bash\nslow_query_log=1\nslow_query_log_file=/var/lib/mysql/slow-log.log\nlong_query_time=10 #(查询超过10s的会被记录, 默认10, 建议修改为3)\n```\n\n``` bash\nmysql> show variables like 'slow_query_log%';\n+---------------------+-----------------------------+\n| Variable_name       | Value                       |\n+---------------------+-----------------------------+\n| slow_query_log      | ON                          |\n| slow_query_log_file | /var/lib/mysql/slow-log.log |\n+---------------------+-----------------------------+\n2 rows in set (0.00 sec)\n```\n### 如果发现 14) 15) 16) 的操作不生效, 请确保MySQL用户对日志文件以及相关目录拥有读写的权限!!\n\n17) 数据库全量备份\n``` mysqldump -u root -h 127.0.0.1 -p --all-databases > /backup/allBackup.sql```\n\n**ERROR 1102 (42000): Incorrect database name '#mysql50#mysql.backup'**\n\n使用find命令全局查找相关文件 ```find / -name mysql.backup```然后删除\n> 相关引用 https://serverfault.com/questions/443651/mysql-drop-database-with-in-name\n\n18) mysql修改数据保存目录\n``` mv /var/lib/mysql /opt/mysqldata ```\n\n编辑文件: ```vim /etc/my.cnf``` 添加如下:\n\n``` bash\n[client]\nsocket=/opt/mysqldata/mysql/mysql.sock\n[mysqld]\ndatadir = /opt/mysqldata/mysql \nsocket = /opt/mysqldata/mysql/mysql.sock\n```\n\n重启mysqld: ``` systemctl restart mysqld ```\n\n\ncreate database cloud;\ncreate user 'nextcloud'@'localhost' identified by 'zhuangzhuang123...';\ngrant all on cloud.* to nextcloud@'localhost' identified by 'zhuangzhuang123...';\nflush privileges;","source":"_posts/018.mysql.md","raw":"---\ntitle: MySQL部署, 以及常见问题梳理\ndate: 2022-6-13 16:00:13\ncategories: \n- [Database]\ntags: \n- MySQL\n---\n\n0) 下载\n``` https://downloads.mysql.com/archives/community/ ```\n选择 ``` mysql-5.7.37-1.el7.x86_64.rpm-bundle.tar ```\n\n1) 包文件详解\n\n``` bash\nmysql-community-client：MySQL客户端应用程序和工具 \nmysql-community-common：服务器和客户端库的通用文件 \nmysql-community-devel：用于MySQL数据库客户端应用程序的开发头文件和库 \nmysql-community-embedded：MySQL嵌入式库 \nmysql-community-embedded-compat：MySQL服务器作为嵌入式库，与使用库版本18的应用程序兼容 \nmysql-community-embedded-devel：MySQL的开发标头文件和库作为可嵌入库 \nmysql-community-libs：MySQL数据库客户端应用程序的共享库 \nmysql-community-libs-compat：以前的MySQL安装的共享兼容性库 \nmysql-community-server：数据库服务器和相关工具 \nmysql-community-test：MySQL服务器的测试套件 \n```\n\n2) rpm 安装顺序\n``` common--->libs--->client--->server--->libs-compat--->devel ```\n\n\n``` bash\nrpm -ivh mysql-community-common-5.7.37-1.el7.x86_64.rpm \\\n> mysql-community-libs-5.7.37-1.el7.x86_64.rpm \\\n> mysql-community-server-5.7.37-1.el7.x86_64.rpm \\\n> mysql-community-client-5.7.37-1.el7.x86_64.rpm \\\n## (上面四个必装)\n> mysql-community-libs-compat-5.7.37-1.el7.x86_64.rpm \\\n> mysql-community-devel-5.7.37-1.el7.x86_64.rpm \n```\n\n\n~~3) 重载systemctl~~\n~~``` systemctl daemon-reload ```~~\n\n4) 启动 MySQL\n``` systemctl start mysqld ```\n\n5) 进入mysql\n``` mysql -u root -p ```\n**Ubuntu需要使用sudo**\n**部分情况需要 ``` -h 127.0.0.1 ```**\n**没有设置密码直接enter即可进入mysql**\n**部分文档提到, yum或者rpm安装会在 ```/var/log/mysqld.log```里生成密码, ~~目前没有碰到过, 估计是老版本才会有.~~**\n**如果之前安装过, 没有卸载赶紧的话会提示 ERROR 1045  密码错误, 使用原来的密码即可登录**\n\n6) 初始化 ```mysqld``` (步骤5无法进入mysql)\n\n> MySQL的运行需要一个系统库，初始化MySQL的操作就是生成这个系统库。在MySQL 5.7之前的版本，初始化操作是通过MySQL源码目录下的scripts目录中名为mysql_install_db的初始化脚本进行的；而从MySQL 5.7版本开始，mysql_install_db被弃用.\n![image.png](/images/018.mysql.md.01.png)\n\n7) 设置安全向导 (步骤6 无效)\n\n```mysql_secure_installation```\n\n  -- 为root用户设置密码\n  -- 删除匿名账号\n  -- 取消root用户远程登录\n  -- 删除test库和对test库的访问权限\n  -- 刷新授权表使修改生效 \n\n\n8) Table 'performance_schema.session_variables' doesn't exist\n```mysql_upgrade -u root -p --force```\n```systemctl restart mysqld```\n\n9) 卸载数据库以及数据删除\n``` yum autoremove mysql* ```\n``` rm -rf /var/lib/mysql* ```\n\n9.1) 重置数据库(暂未测试过...)\n``` mysqld --initialize ```\n```systemctl restart mysqld```\n\n此时初始化安装完数据库之后会在mysql.log里生成密码\n``` grep \"temporary password\" /var/log/mysqld.log ```\n\n10) 使用生成的密码登录后要修改密码(注意密码复杂度)\n``` set password = password(\"yourpassword\") ```\n``` flush privileges```\n\n11) 允许远程登录\n修改 localhost字段为 '%'\n\n``` select user, host, authentication_string from mysql.user;```\n``` update mysql.user set host = '%' where user = 'root' and host = 'localhost';```\n![image.png](/images/018.mysql.md.02.png)\n\n12) 较新版本里 ```password``` 已经修改成了 ```authentication_string```\n> 相关引用: https://mariadb.com/kb/en/mysqluser-table/\n\n\n13) 限制mysql登录\n~~```update mysql.user set host='10.45.51.0/24' where user='root' and host='127.0.0.1';```~~\n~~``` grant all on *.* to 'root'@'10.40.' identified by 'yourpassword'; ```~~\n\n指定ip或者网段\n指定 192.168.128.8 可以登录\n``` update mysql.user set host='192.168.128.8' where user ='root' and host = 'localhost'; ```\n``` grant all on *.* to 'root'@'192.168.128.8' identified by 'yourpassword'; ```\n``` grant all on *.* to 'root'@'192.168.128.8' identified by 'yourpassword' with grant option; ```\n如果 ```grant all``` 这种写法提示语法错误, 在语句后面加上 ```with grant option```\n\n指定 192.168.128.0/24网段 可以登录\n``` update mysql.user set host='192.168.128.%' where user ='root' and host = 'localhost'; ``` \n``` grant all on *.* to 'root'@'192.168.128.%' identified by 'yourpassword'; ``` \n也有下面这种写法, 但是经过测试无效(mysql community 5.7.37 具体没有深入)\n``` update mysql.user set host='192.168.128.' where user ='root' and host = 'localhost'; ``` \n\n\n![image.png](/images/018.mysql.md.03.png)\n\n14) general_log 开启\n\n``` bash\nmysql> show global variables like '%general%';\n+------------------+----------------------------+\n| Variable_name    | Value                      |\n+------------------+----------------------------+\n| general_log      | OFF                        |\n| general_log_file | /var/lib/mysql/centos7.log |\n+------------------+----------------------------+\n2 rows in set (0.02 sec)\n\n```\n**使用命令修改的设置会在服务重启之后失效**\n\n临时生效: \n\n``` bash\n　　mysql>set global general_log_file='/tmp/general.lg';    # 设置路径\n　　mysql>set global general_log=on;                        # 开启general log模式\n　　mysql>set global general_log=off;                       # 关闭general log模式\n```\n永久生效:\n编辑配置文件 ```/etc/my.cnf``` 添加:\n\n``` bash\ngeneral_log = 1\ngeneral_log_file = /tmp/general.log\n```\n\n\n15) log_bin 开启\n\n``` bash\nmysql> show global variables like '%log_bin%';\n+---------------------------------+-------+\n| Variable_name                   | Value |\n+---------------------------------+-------+\n| log_bin                         | OFF   |\n| log_bin_basename                |       |\n| log_bin_index                   |       |\n| log_bin_trust_function_creators | OFF   |\n| log_bin_use_v1_row_events       | OFF   |\n+---------------------------------+-------+\n5 rows in set (0.01 sec)\n```\n\n永久生效: \n编辑```vim /etc/my.cnf```添加:\n\n``` bash\nserver_id=2\nlog_bin = mysql-bin\nbinlog_format = ROW\nexpire_logs_days = 30\n```\n重启mysql:\n``` systemctl restart mysqld ```\n\n再次查看log_bin:\n\n```bash\nmysql> show global variables like '%log_bin%';\n+---------------------------------+--------------------------------+\n| Variable_name                   | Value                          |\n+---------------------------------+--------------------------------+\n| log_bin                         | ON                             |\n| log_bin_basename                | /var/lib/mysql/mysql-bin       |\n| log_bin_index                   | /var/lib/mysql/mysql-bin.index |\n| log_bin_trust_function_creators | OFF                            |\n| log_bin_use_v1_row_events       | OFF                            |\n+---------------------------------+--------------------------------+\n5 rows in set (0.00 sec)\n```\n16) slow_query_log 开启\n\n``` bash\nmysql> show variables like 'slow_query_log%';\n+---------------------+---------------------------------+\n| Variable_name       | Value                           |\n+---------------------+---------------------------------+\n| slow_query_log      | OFF                             |\n| slow_query_log_file | /var/lib/mysql/centos7-slow.log |\n+---------------------+---------------------------------+\n2 rows in set (0.01 sec)\n```\n临时生效:\n``` set global slow_query_log=1; ```\n\n永久生效:\n修改```/etc/my.cnf```添加:\n\n``` bash\nslow_query_log=1\nslow_query_log_file=/var/lib/mysql/slow-log.log\nlong_query_time=10 #(查询超过10s的会被记录, 默认10, 建议修改为3)\n```\n\n``` bash\nmysql> show variables like 'slow_query_log%';\n+---------------------+-----------------------------+\n| Variable_name       | Value                       |\n+---------------------+-----------------------------+\n| slow_query_log      | ON                          |\n| slow_query_log_file | /var/lib/mysql/slow-log.log |\n+---------------------+-----------------------------+\n2 rows in set (0.00 sec)\n```\n### 如果发现 14) 15) 16) 的操作不生效, 请确保MySQL用户对日志文件以及相关目录拥有读写的权限!!\n\n17) 数据库全量备份\n``` mysqldump -u root -h 127.0.0.1 -p --all-databases > /backup/allBackup.sql```\n\n**ERROR 1102 (42000): Incorrect database name '#mysql50#mysql.backup'**\n\n使用find命令全局查找相关文件 ```find / -name mysql.backup```然后删除\n> 相关引用 https://serverfault.com/questions/443651/mysql-drop-database-with-in-name\n\n18) mysql修改数据保存目录\n``` mv /var/lib/mysql /opt/mysqldata ```\n\n编辑文件: ```vim /etc/my.cnf``` 添加如下:\n\n``` bash\n[client]\nsocket=/opt/mysqldata/mysql/mysql.sock\n[mysqld]\ndatadir = /opt/mysqldata/mysql \nsocket = /opt/mysqldata/mysql/mysql.sock\n```\n\n重启mysqld: ``` systemctl restart mysqld ```\n\n\ncreate database cloud;\ncreate user 'nextcloud'@'localhost' identified by 'zhuangzhuang123...';\ngrant all on cloud.* to nextcloud@'localhost' identified by 'zhuangzhuang123...';\nflush privileges;","slug":"018.mysql","published":1,"updated":"2023-12-05T08:52:30.876Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzat001rijnr8x78ekol","content":"<ol start=\"0\">\n<li>下载</li>\n</ol>\n<p><code>https://downloads.mysql.com/archives/community/</code><br>选择 <code>mysql-5.7.37-1.el7.x86_64.rpm-bundle.tar</code></p>\n<ol>\n<li>包文件详解</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql-community-client：MySQL客户端应用程序和工具 </span><br><span class=\"line\">mysql-community-common：服务器和客户端库的通用文件 </span><br><span class=\"line\">mysql-community-devel：用于MySQL数据库客户端应用程序的开发头文件和库 </span><br><span class=\"line\">mysql-community-embedded：MySQL嵌入式库 </span><br><span class=\"line\">mysql-community-embedded-compat：MySQL服务器作为嵌入式库，与使用库版本18的应用程序兼容 </span><br><span class=\"line\">mysql-community-embedded-devel：MySQL的开发标头文件和库作为可嵌入库 </span><br><span class=\"line\">mysql-community-libs：MySQL数据库客户端应用程序的共享库 </span><br><span class=\"line\">mysql-community-libs-compat：以前的MySQL安装的共享兼容性库 </span><br><span class=\"line\">mysql-community-server：数据库服务器和相关工具 </span><br><span class=\"line\">mysql-community-test：MySQL服务器的测试套件 </span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>rpm 安装顺序</li>\n</ol>\n<p><code>common---&gt;libs---&gt;client---&gt;server---&gt;libs-compat---&gt;devel</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">rpm -ivh mysql-community-common-5.7.37-1.el7.x86_64.rpm \\</span><br><span class=\"line\">&gt; mysql-community-libs-5.7.37-1.el7.x86_64.rpm \\</span><br><span class=\"line\">&gt; mysql-community-server-5.7.37-1.el7.x86_64.rpm \\</span><br><span class=\"line\">&gt; mysql-community-client-5.7.37-1.el7.x86_64.rpm \\</span><br><span class=\"line\"><span class=\"comment\">## (上面四个必装)</span></span><br><span class=\"line\">&gt; mysql-community-libs-compat-5.7.37-1.el7.x86_64.rpm \\</span><br><span class=\"line\">&gt; mysql-community-devel-5.7.37-1.el7.x86_64.rpm </span><br></pre></td></tr></table></figure>\n\n\n<p><del>3) 重载systemctl</del><br><del><code>systemctl daemon-reload</code></del></p>\n<ol start=\"4\">\n<li>启动 MySQL</li>\n</ol>\n<p><code>systemctl start mysqld</code></p>\n<ol start=\"5\">\n<li>进入mysql</li>\n</ol>\n<p><code>mysql -u root -p</code><br><strong>Ubuntu需要使用sudo</strong><br><strong>部分情况需要 <code>-h 127.0.0.1</code></strong><br><strong>没有设置密码直接enter即可进入mysql</strong><br><strong>部分文档提到, yum或者rpm安装会在 <code>/var/log/mysqld.log</code>里生成密码, <del>目前没有碰到过, 估计是老版本才会有.</del></strong><br><strong>如果之前安装过, 没有卸载赶紧的话会提示 ERROR 1045  密码错误, 使用原来的密码即可登录</strong></p>\n<ol start=\"6\">\n<li>初始化 <code>mysqld</code> (步骤5无法进入mysql)</li>\n</ol>\n<blockquote>\n<p>MySQL的运行需要一个系统库，初始化MySQL的操作就是生成这个系统库。在MySQL 5.7之前的版本，初始化操作是通过MySQL源码目录下的scripts目录中名为mysql_install_db的初始化脚本进行的；而从MySQL 5.7版本开始，mysql_install_db被弃用.<br><img src=\"/images/018.mysql.md.01.png\" alt=\"image.png\"></p>\n</blockquote>\n<ol start=\"7\">\n<li>设置安全向导 (步骤6 无效)</li>\n</ol>\n<p><code>mysql_secure_installation</code></p>\n<p>  – 为root用户设置密码<br>  – 删除匿名账号<br>  – 取消root用户远程登录<br>  – 删除test库和对test库的访问权限<br>  – 刷新授权表使修改生效 </p>\n<ol start=\"8\">\n<li>Table ‘performance_schema.session_variables’ doesn’t exist</li>\n</ol>\n<p><code>mysql_upgrade -u root -p --force</code><br><code>systemctl restart mysqld</code></p>\n<ol start=\"9\">\n<li>卸载数据库以及数据删除</li>\n</ol>\n<p><code>yum autoremove mysql*</code><br><code>rm -rf /var/lib/mysql*</code></p>\n<p>9.1) 重置数据库(暂未测试过…)<br><code>mysqld --initialize</code><br><code>systemctl restart mysqld</code></p>\n<p>此时初始化安装完数据库之后会在mysql.log里生成密码<br><code>grep &quot;temporary password&quot; /var/log/mysqld.log</code></p>\n<ol start=\"10\">\n<li>使用生成的密码登录后要修改密码(注意密码复杂度)</li>\n</ol>\n<p><code>set password = password(&quot;yourpassword&quot;)</code><br><code> flush privileges</code></p>\n<ol start=\"11\">\n<li>允许远程登录<br>修改 localhost字段为 ‘%’</li>\n</ol>\n<p><code> select user, host, authentication_string from mysql.user;</code><br><code> update mysql.user set host = &#39;%&#39; where user = &#39;root&#39; and host = &#39;localhost&#39;;</code><br><img src=\"/images/018.mysql.md.02.png\" alt=\"image.png\"></p>\n<ol start=\"12\">\n<li><p>较新版本里 <code>password</code> 已经修改成了 <code>authentication_string</code></p>\n<blockquote>\n<p>相关引用: <a href=\"https://mariadb.com/kb/en/mysqluser-table/\">https://mariadb.com/kb/en/mysqluser-table/</a></p>\n</blockquote>\n</li>\n<li><p>限制mysql登录<br><del><code>update mysql.user set host=&#39;10.45.51.0/24&#39; where user=&#39;root&#39; and host=&#39;127.0.0.1&#39;;</code></del><br><del><code>grant all on *.* to &#39;root&#39;@&#39;10.40.&#39; identified by &#39;yourpassword&#39;;</code></del></p>\n</li>\n</ol>\n<p>指定ip或者网段<br>指定 192.168.128.8 可以登录<br><code>update mysql.user set host=&#39;192.168.128.8&#39; where user =&#39;root&#39; and host = &#39;localhost&#39;;</code><br><code>grant all on *.* to &#39;root&#39;@&#39;192.168.128.8&#39; identified by &#39;yourpassword&#39;;</code><br><code>grant all on *.* to &#39;root&#39;@&#39;192.168.128.8&#39; identified by &#39;yourpassword&#39; with grant option;</code><br>如果 <code>grant all</code> 这种写法提示语法错误, 在语句后面加上 <code>with grant option</code></p>\n<p>指定 192.168.128.0&#x2F;24网段 可以登录<br><code>update mysql.user set host=&#39;192.168.128.%&#39; where user =&#39;root&#39; and host = &#39;localhost&#39;;</code><br><code>grant all on *.* to &#39;root&#39;@&#39;192.168.128.%&#39; identified by &#39;yourpassword&#39;;</code><br>也有下面这种写法, 但是经过测试无效(mysql community 5.7.37 具体没有深入)<br><code>update mysql.user set host=&#39;192.168.128.&#39; where user =&#39;root&#39; and host = &#39;localhost&#39;;</code> </p>\n<p><img src=\"/images/018.mysql.md.03.png\" alt=\"image.png\"></p>\n<ol start=\"14\">\n<li>general_log 开启</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql&gt; show global variables like <span class=\"string\">&#x27;%general%&#x27;</span>;</span><br><span class=\"line\">+------------------+----------------------------+</span><br><span class=\"line\">| Variable_name    | Value                      |</span><br><span class=\"line\">+------------------+----------------------------+</span><br><span class=\"line\">| general_log      | OFF                        |</span><br><span class=\"line\">| general_log_file | /var/lib/mysql/centos7.<span class=\"built_in\">log</span> |</span><br><span class=\"line\">+------------------+----------------------------+</span><br><span class=\"line\">2 rows <span class=\"keyword\">in</span> <span class=\"built_in\">set</span> (0.02 sec)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><strong>使用命令修改的设置会在服务重启之后失效</strong></p>\n<p>临时生效: </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">　　mysql&gt;<span class=\"built_in\">set</span> global general_log_file=<span class=\"string\">&#x27;/tmp/general.lg&#x27;</span>;    <span class=\"comment\"># 设置路径</span></span><br><span class=\"line\">　　mysql&gt;<span class=\"built_in\">set</span> global general_log=on;                        <span class=\"comment\"># 开启general log模式</span></span><br><span class=\"line\">　　mysql&gt;<span class=\"built_in\">set</span> global general_log=off;                       <span class=\"comment\"># 关闭general log模式</span></span><br></pre></td></tr></table></figure>\n<p>永久生效:<br>编辑配置文件 <code>/etc/my.cnf</code> 添加:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">general_log = 1</span><br><span class=\"line\">general_log_file = /tmp/general.log</span><br></pre></td></tr></table></figure>\n\n\n<ol start=\"15\">\n<li>log_bin 开启</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql&gt; show global variables like <span class=\"string\">&#x27;%log_bin%&#x27;</span>;</span><br><span class=\"line\">+---------------------------------+-------+</span><br><span class=\"line\">| Variable_name                   | Value |</span><br><span class=\"line\">+---------------------------------+-------+</span><br><span class=\"line\">| log_bin                         | OFF   |</span><br><span class=\"line\">| log_bin_basename                |       |</span><br><span class=\"line\">| log_bin_index                   |       |</span><br><span class=\"line\">| log_bin_trust_function_creators | OFF   |</span><br><span class=\"line\">| log_bin_use_v1_row_events       | OFF   |</span><br><span class=\"line\">+---------------------------------+-------+</span><br><span class=\"line\">5 rows <span class=\"keyword\">in</span> <span class=\"built_in\">set</span> (0.01 sec)</span><br></pre></td></tr></table></figure>\n\n<p>永久生效:<br>编辑<code>vim /etc/my.cnf</code>添加:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">server_id=2</span><br><span class=\"line\">log_bin = mysql-bin</span><br><span class=\"line\">binlog_format = ROW</span><br><span class=\"line\">expire_logs_days = 30</span><br></pre></td></tr></table></figure>\n<p>重启mysql:<br><code>systemctl restart mysqld</code></p>\n<p>再次查看log_bin:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql&gt; show global variables like <span class=\"string\">&#x27;%log_bin%&#x27;</span>;</span><br><span class=\"line\">+---------------------------------+--------------------------------+</span><br><span class=\"line\">| Variable_name                   | Value                          |</span><br><span class=\"line\">+---------------------------------+--------------------------------+</span><br><span class=\"line\">| log_bin                         | ON                             |</span><br><span class=\"line\">| log_bin_basename                | /var/lib/mysql/mysql-bin       |</span><br><span class=\"line\">| log_bin_index                   | /var/lib/mysql/mysql-bin.index |</span><br><span class=\"line\">| log_bin_trust_function_creators | OFF                            |</span><br><span class=\"line\">| log_bin_use_v1_row_events       | OFF                            |</span><br><span class=\"line\">+---------------------------------+--------------------------------+</span><br><span class=\"line\">5 rows <span class=\"keyword\">in</span> <span class=\"built_in\">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>\n<ol start=\"16\">\n<li>slow_query_log 开启</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql&gt; show variables like <span class=\"string\">&#x27;slow_query_log%&#x27;</span>;</span><br><span class=\"line\">+---------------------+---------------------------------+</span><br><span class=\"line\">| Variable_name       | Value                           |</span><br><span class=\"line\">+---------------------+---------------------------------+</span><br><span class=\"line\">| slow_query_log      | OFF                             |</span><br><span class=\"line\">| slow_query_log_file | /var/lib/mysql/centos7-slow.log |</span><br><span class=\"line\">+---------------------+---------------------------------+</span><br><span class=\"line\">2 rows <span class=\"keyword\">in</span> <span class=\"built_in\">set</span> (0.01 sec)</span><br></pre></td></tr></table></figure>\n<p>临时生效:<br><code>set global slow_query_log=1;</code></p>\n<p>永久生效:<br>修改<code>/etc/my.cnf</code>添加:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">slow_query_log=1</span><br><span class=\"line\">slow_query_log_file=/var/lib/mysql/slow-log.log</span><br><span class=\"line\">long_query_time=10 <span class=\"comment\">#(查询超过10s的会被记录, 默认10, 建议修改为3)</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql&gt; show variables like <span class=\"string\">&#x27;slow_query_log%&#x27;</span>;</span><br><span class=\"line\">+---------------------+-----------------------------+</span><br><span class=\"line\">| Variable_name       | Value                       |</span><br><span class=\"line\">+---------------------+-----------------------------+</span><br><span class=\"line\">| slow_query_log      | ON                          |</span><br><span class=\"line\">| slow_query_log_file | /var/lib/mysql/slow-log.log |</span><br><span class=\"line\">+---------------------+-----------------------------+</span><br><span class=\"line\">2 rows <span class=\"keyword\">in</span> <span class=\"built_in\">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>\n<h3 id=\"如果发现-14-15-16-的操作不生效-请确保MySQL用户对日志文件以及相关目录拥有读写的权限\"><a href=\"#如果发现-14-15-16-的操作不生效-请确保MySQL用户对日志文件以及相关目录拥有读写的权限\" class=\"headerlink\" title=\"如果发现 14) 15) 16) 的操作不生效, 请确保MySQL用户对日志文件以及相关目录拥有读写的权限!!\"></a>如果发现 14) 15) 16) 的操作不生效, 请确保MySQL用户对日志文件以及相关目录拥有读写的权限!!</h3><ol start=\"17\">\n<li>数据库全量备份</li>\n</ol>\n<p><code> mysqldump -u root -h 127.0.0.1 -p --all-databases &gt; /backup/allBackup.sql</code></p>\n<p><strong>ERROR 1102 (42000): Incorrect database name ‘#mysql50#mysql.backup’</strong></p>\n<p>使用find命令全局查找相关文件 <code>find / -name mysql.backup</code>然后删除</p>\n<blockquote>\n<p>相关引用 <a href=\"https://serverfault.com/questions/443651/mysql-drop-database-with-in-name\">https://serverfault.com/questions/443651/mysql-drop-database-with-in-name</a></p>\n</blockquote>\n<ol start=\"18\">\n<li>mysql修改数据保存目录</li>\n</ol>\n<p><code>mv /var/lib/mysql /opt/mysqldata</code></p>\n<p>编辑文件: <code>vim /etc/my.cnf</code> 添加如下:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[client]</span><br><span class=\"line\">socket=/opt/mysqldata/mysql/mysql.sock</span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">datadir = /opt/mysqldata/mysql </span><br><span class=\"line\">socket = /opt/mysqldata/mysql/mysql.sock</span><br></pre></td></tr></table></figure>\n\n<p>重启mysqld: <code>systemctl restart mysqld</code></p>\n<p>create database cloud;<br>create user ‘nextcloud‘@’localhost’ identified by ‘zhuangzhuang123…’;<br>grant all on cloud.* to nextcloud@’localhost’ identified by ‘zhuangzhuang123…’;<br>flush privileges;</p>\n","site":{"data":{}},"excerpt":"","more":"<ol start=\"0\">\n<li>下载</li>\n</ol>\n<p><code>https://downloads.mysql.com/archives/community/</code><br>选择 <code>mysql-5.7.37-1.el7.x86_64.rpm-bundle.tar</code></p>\n<ol>\n<li>包文件详解</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql-community-client：MySQL客户端应用程序和工具 </span><br><span class=\"line\">mysql-community-common：服务器和客户端库的通用文件 </span><br><span class=\"line\">mysql-community-devel：用于MySQL数据库客户端应用程序的开发头文件和库 </span><br><span class=\"line\">mysql-community-embedded：MySQL嵌入式库 </span><br><span class=\"line\">mysql-community-embedded-compat：MySQL服务器作为嵌入式库，与使用库版本18的应用程序兼容 </span><br><span class=\"line\">mysql-community-embedded-devel：MySQL的开发标头文件和库作为可嵌入库 </span><br><span class=\"line\">mysql-community-libs：MySQL数据库客户端应用程序的共享库 </span><br><span class=\"line\">mysql-community-libs-compat：以前的MySQL安装的共享兼容性库 </span><br><span class=\"line\">mysql-community-server：数据库服务器和相关工具 </span><br><span class=\"line\">mysql-community-test：MySQL服务器的测试套件 </span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>rpm 安装顺序</li>\n</ol>\n<p><code>common---&gt;libs---&gt;client---&gt;server---&gt;libs-compat---&gt;devel</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">rpm -ivh mysql-community-common-5.7.37-1.el7.x86_64.rpm \\</span><br><span class=\"line\">&gt; mysql-community-libs-5.7.37-1.el7.x86_64.rpm \\</span><br><span class=\"line\">&gt; mysql-community-server-5.7.37-1.el7.x86_64.rpm \\</span><br><span class=\"line\">&gt; mysql-community-client-5.7.37-1.el7.x86_64.rpm \\</span><br><span class=\"line\"><span class=\"comment\">## (上面四个必装)</span></span><br><span class=\"line\">&gt; mysql-community-libs-compat-5.7.37-1.el7.x86_64.rpm \\</span><br><span class=\"line\">&gt; mysql-community-devel-5.7.37-1.el7.x86_64.rpm </span><br></pre></td></tr></table></figure>\n\n\n<p><del>3) 重载systemctl</del><br><del><code>systemctl daemon-reload</code></del></p>\n<ol start=\"4\">\n<li>启动 MySQL</li>\n</ol>\n<p><code>systemctl start mysqld</code></p>\n<ol start=\"5\">\n<li>进入mysql</li>\n</ol>\n<p><code>mysql -u root -p</code><br><strong>Ubuntu需要使用sudo</strong><br><strong>部分情况需要 <code>-h 127.0.0.1</code></strong><br><strong>没有设置密码直接enter即可进入mysql</strong><br><strong>部分文档提到, yum或者rpm安装会在 <code>/var/log/mysqld.log</code>里生成密码, <del>目前没有碰到过, 估计是老版本才会有.</del></strong><br><strong>如果之前安装过, 没有卸载赶紧的话会提示 ERROR 1045  密码错误, 使用原来的密码即可登录</strong></p>\n<ol start=\"6\">\n<li>初始化 <code>mysqld</code> (步骤5无法进入mysql)</li>\n</ol>\n<blockquote>\n<p>MySQL的运行需要一个系统库，初始化MySQL的操作就是生成这个系统库。在MySQL 5.7之前的版本，初始化操作是通过MySQL源码目录下的scripts目录中名为mysql_install_db的初始化脚本进行的；而从MySQL 5.7版本开始，mysql_install_db被弃用.<br><img src=\"/images/018.mysql.md.01.png\" alt=\"image.png\"></p>\n</blockquote>\n<ol start=\"7\">\n<li>设置安全向导 (步骤6 无效)</li>\n</ol>\n<p><code>mysql_secure_installation</code></p>\n<p>  – 为root用户设置密码<br>  – 删除匿名账号<br>  – 取消root用户远程登录<br>  – 删除test库和对test库的访问权限<br>  – 刷新授权表使修改生效 </p>\n<ol start=\"8\">\n<li>Table ‘performance_schema.session_variables’ doesn’t exist</li>\n</ol>\n<p><code>mysql_upgrade -u root -p --force</code><br><code>systemctl restart mysqld</code></p>\n<ol start=\"9\">\n<li>卸载数据库以及数据删除</li>\n</ol>\n<p><code>yum autoremove mysql*</code><br><code>rm -rf /var/lib/mysql*</code></p>\n<p>9.1) 重置数据库(暂未测试过…)<br><code>mysqld --initialize</code><br><code>systemctl restart mysqld</code></p>\n<p>此时初始化安装完数据库之后会在mysql.log里生成密码<br><code>grep &quot;temporary password&quot; /var/log/mysqld.log</code></p>\n<ol start=\"10\">\n<li>使用生成的密码登录后要修改密码(注意密码复杂度)</li>\n</ol>\n<p><code>set password = password(&quot;yourpassword&quot;)</code><br><code> flush privileges</code></p>\n<ol start=\"11\">\n<li>允许远程登录<br>修改 localhost字段为 ‘%’</li>\n</ol>\n<p><code> select user, host, authentication_string from mysql.user;</code><br><code> update mysql.user set host = &#39;%&#39; where user = &#39;root&#39; and host = &#39;localhost&#39;;</code><br><img src=\"/images/018.mysql.md.02.png\" alt=\"image.png\"></p>\n<ol start=\"12\">\n<li><p>较新版本里 <code>password</code> 已经修改成了 <code>authentication_string</code></p>\n<blockquote>\n<p>相关引用: <a href=\"https://mariadb.com/kb/en/mysqluser-table/\">https://mariadb.com/kb/en/mysqluser-table/</a></p>\n</blockquote>\n</li>\n<li><p>限制mysql登录<br><del><code>update mysql.user set host=&#39;10.45.51.0/24&#39; where user=&#39;root&#39; and host=&#39;127.0.0.1&#39;;</code></del><br><del><code>grant all on *.* to &#39;root&#39;@&#39;10.40.&#39; identified by &#39;yourpassword&#39;;</code></del></p>\n</li>\n</ol>\n<p>指定ip或者网段<br>指定 192.168.128.8 可以登录<br><code>update mysql.user set host=&#39;192.168.128.8&#39; where user =&#39;root&#39; and host = &#39;localhost&#39;;</code><br><code>grant all on *.* to &#39;root&#39;@&#39;192.168.128.8&#39; identified by &#39;yourpassword&#39;;</code><br><code>grant all on *.* to &#39;root&#39;@&#39;192.168.128.8&#39; identified by &#39;yourpassword&#39; with grant option;</code><br>如果 <code>grant all</code> 这种写法提示语法错误, 在语句后面加上 <code>with grant option</code></p>\n<p>指定 192.168.128.0&#x2F;24网段 可以登录<br><code>update mysql.user set host=&#39;192.168.128.%&#39; where user =&#39;root&#39; and host = &#39;localhost&#39;;</code><br><code>grant all on *.* to &#39;root&#39;@&#39;192.168.128.%&#39; identified by &#39;yourpassword&#39;;</code><br>也有下面这种写法, 但是经过测试无效(mysql community 5.7.37 具体没有深入)<br><code>update mysql.user set host=&#39;192.168.128.&#39; where user =&#39;root&#39; and host = &#39;localhost&#39;;</code> </p>\n<p><img src=\"/images/018.mysql.md.03.png\" alt=\"image.png\"></p>\n<ol start=\"14\">\n<li>general_log 开启</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql&gt; show global variables like <span class=\"string\">&#x27;%general%&#x27;</span>;</span><br><span class=\"line\">+------------------+----------------------------+</span><br><span class=\"line\">| Variable_name    | Value                      |</span><br><span class=\"line\">+------------------+----------------------------+</span><br><span class=\"line\">| general_log      | OFF                        |</span><br><span class=\"line\">| general_log_file | /var/lib/mysql/centos7.<span class=\"built_in\">log</span> |</span><br><span class=\"line\">+------------------+----------------------------+</span><br><span class=\"line\">2 rows <span class=\"keyword\">in</span> <span class=\"built_in\">set</span> (0.02 sec)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><strong>使用命令修改的设置会在服务重启之后失效</strong></p>\n<p>临时生效: </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">　　mysql&gt;<span class=\"built_in\">set</span> global general_log_file=<span class=\"string\">&#x27;/tmp/general.lg&#x27;</span>;    <span class=\"comment\"># 设置路径</span></span><br><span class=\"line\">　　mysql&gt;<span class=\"built_in\">set</span> global general_log=on;                        <span class=\"comment\"># 开启general log模式</span></span><br><span class=\"line\">　　mysql&gt;<span class=\"built_in\">set</span> global general_log=off;                       <span class=\"comment\"># 关闭general log模式</span></span><br></pre></td></tr></table></figure>\n<p>永久生效:<br>编辑配置文件 <code>/etc/my.cnf</code> 添加:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">general_log = 1</span><br><span class=\"line\">general_log_file = /tmp/general.log</span><br></pre></td></tr></table></figure>\n\n\n<ol start=\"15\">\n<li>log_bin 开启</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql&gt; show global variables like <span class=\"string\">&#x27;%log_bin%&#x27;</span>;</span><br><span class=\"line\">+---------------------------------+-------+</span><br><span class=\"line\">| Variable_name                   | Value |</span><br><span class=\"line\">+---------------------------------+-------+</span><br><span class=\"line\">| log_bin                         | OFF   |</span><br><span class=\"line\">| log_bin_basename                |       |</span><br><span class=\"line\">| log_bin_index                   |       |</span><br><span class=\"line\">| log_bin_trust_function_creators | OFF   |</span><br><span class=\"line\">| log_bin_use_v1_row_events       | OFF   |</span><br><span class=\"line\">+---------------------------------+-------+</span><br><span class=\"line\">5 rows <span class=\"keyword\">in</span> <span class=\"built_in\">set</span> (0.01 sec)</span><br></pre></td></tr></table></figure>\n\n<p>永久生效:<br>编辑<code>vim /etc/my.cnf</code>添加:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">server_id=2</span><br><span class=\"line\">log_bin = mysql-bin</span><br><span class=\"line\">binlog_format = ROW</span><br><span class=\"line\">expire_logs_days = 30</span><br></pre></td></tr></table></figure>\n<p>重启mysql:<br><code>systemctl restart mysqld</code></p>\n<p>再次查看log_bin:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql&gt; show global variables like <span class=\"string\">&#x27;%log_bin%&#x27;</span>;</span><br><span class=\"line\">+---------------------------------+--------------------------------+</span><br><span class=\"line\">| Variable_name                   | Value                          |</span><br><span class=\"line\">+---------------------------------+--------------------------------+</span><br><span class=\"line\">| log_bin                         | ON                             |</span><br><span class=\"line\">| log_bin_basename                | /var/lib/mysql/mysql-bin       |</span><br><span class=\"line\">| log_bin_index                   | /var/lib/mysql/mysql-bin.index |</span><br><span class=\"line\">| log_bin_trust_function_creators | OFF                            |</span><br><span class=\"line\">| log_bin_use_v1_row_events       | OFF                            |</span><br><span class=\"line\">+---------------------------------+--------------------------------+</span><br><span class=\"line\">5 rows <span class=\"keyword\">in</span> <span class=\"built_in\">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>\n<ol start=\"16\">\n<li>slow_query_log 开启</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql&gt; show variables like <span class=\"string\">&#x27;slow_query_log%&#x27;</span>;</span><br><span class=\"line\">+---------------------+---------------------------------+</span><br><span class=\"line\">| Variable_name       | Value                           |</span><br><span class=\"line\">+---------------------+---------------------------------+</span><br><span class=\"line\">| slow_query_log      | OFF                             |</span><br><span class=\"line\">| slow_query_log_file | /var/lib/mysql/centos7-slow.log |</span><br><span class=\"line\">+---------------------+---------------------------------+</span><br><span class=\"line\">2 rows <span class=\"keyword\">in</span> <span class=\"built_in\">set</span> (0.01 sec)</span><br></pre></td></tr></table></figure>\n<p>临时生效:<br><code>set global slow_query_log=1;</code></p>\n<p>永久生效:<br>修改<code>/etc/my.cnf</code>添加:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">slow_query_log=1</span><br><span class=\"line\">slow_query_log_file=/var/lib/mysql/slow-log.log</span><br><span class=\"line\">long_query_time=10 <span class=\"comment\">#(查询超过10s的会被记录, 默认10, 建议修改为3)</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql&gt; show variables like <span class=\"string\">&#x27;slow_query_log%&#x27;</span>;</span><br><span class=\"line\">+---------------------+-----------------------------+</span><br><span class=\"line\">| Variable_name       | Value                       |</span><br><span class=\"line\">+---------------------+-----------------------------+</span><br><span class=\"line\">| slow_query_log      | ON                          |</span><br><span class=\"line\">| slow_query_log_file | /var/lib/mysql/slow-log.log |</span><br><span class=\"line\">+---------------------+-----------------------------+</span><br><span class=\"line\">2 rows <span class=\"keyword\">in</span> <span class=\"built_in\">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>\n<h3 id=\"如果发现-14-15-16-的操作不生效-请确保MySQL用户对日志文件以及相关目录拥有读写的权限\"><a href=\"#如果发现-14-15-16-的操作不生效-请确保MySQL用户对日志文件以及相关目录拥有读写的权限\" class=\"headerlink\" title=\"如果发现 14) 15) 16) 的操作不生效, 请确保MySQL用户对日志文件以及相关目录拥有读写的权限!!\"></a>如果发现 14) 15) 16) 的操作不生效, 请确保MySQL用户对日志文件以及相关目录拥有读写的权限!!</h3><ol start=\"17\">\n<li>数据库全量备份</li>\n</ol>\n<p><code> mysqldump -u root -h 127.0.0.1 -p --all-databases &gt; /backup/allBackup.sql</code></p>\n<p><strong>ERROR 1102 (42000): Incorrect database name ‘#mysql50#mysql.backup’</strong></p>\n<p>使用find命令全局查找相关文件 <code>find / -name mysql.backup</code>然后删除</p>\n<blockquote>\n<p>相关引用 <a href=\"https://serverfault.com/questions/443651/mysql-drop-database-with-in-name\">https://serverfault.com/questions/443651/mysql-drop-database-with-in-name</a></p>\n</blockquote>\n<ol start=\"18\">\n<li>mysql修改数据保存目录</li>\n</ol>\n<p><code>mv /var/lib/mysql /opt/mysqldata</code></p>\n<p>编辑文件: <code>vim /etc/my.cnf</code> 添加如下:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[client]</span><br><span class=\"line\">socket=/opt/mysqldata/mysql/mysql.sock</span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">datadir = /opt/mysqldata/mysql </span><br><span class=\"line\">socket = /opt/mysqldata/mysql/mysql.sock</span><br></pre></td></tr></table></figure>\n\n<p>重启mysqld: <code>systemctl restart mysqld</code></p>\n<p>create database cloud;<br>create user ‘nextcloud‘@’localhost’ identified by ‘zhuangzhuang123…’;<br>grant all on cloud.* to nextcloud@’localhost’ identified by ‘zhuangzhuang123…’;<br>flush privileges;</p>\n"},{"title":"sudo用户配置","date":"2022-06-15T02:00:13.000Z","_content":"\n0) 创建dev用户, 所属组为root\n```useradd -g root dev```\n\n1) 编辑sudo配置文件\n```visudo```\n\n2) 为dev添加sudo权限\n```%root   ALL=(ALL)       NOPASSWD: ALL```\n\n**dev属于root用户组, 无法执行passwd修改root的密码**\n\n实例:\n\na) ubuntu:\n\n``` bash\ngroupadd ubuntu \nuseradd -g ubuntu ubuntu\nubuntu  ALL=(ALL:ALL) NOPASSWD: ALL\n```\n\nb) lighthouse\n\n``` bash\ngroupadd lighthouse\nuseradd -g lighthouse lighthouse\nlighthouse ALL=(ALL)  NOPASSWD: ALL\n```\n\n**a和b都可以执行passwd来修改root密码, 需要进一步限制可以执行的命令.**","source":"_posts/019.sudo.md","raw":"---\ntitle: sudo用户配置\ndate: 2022-6-15 10:00:13\ncategories: \n- [Linux]\n- [CentOS]\ntags: \n- sudo\n---\n\n0) 创建dev用户, 所属组为root\n```useradd -g root dev```\n\n1) 编辑sudo配置文件\n```visudo```\n\n2) 为dev添加sudo权限\n```%root   ALL=(ALL)       NOPASSWD: ALL```\n\n**dev属于root用户组, 无法执行passwd修改root的密码**\n\n实例:\n\na) ubuntu:\n\n``` bash\ngroupadd ubuntu \nuseradd -g ubuntu ubuntu\nubuntu  ALL=(ALL:ALL) NOPASSWD: ALL\n```\n\nb) lighthouse\n\n``` bash\ngroupadd lighthouse\nuseradd -g lighthouse lighthouse\nlighthouse ALL=(ALL)  NOPASSWD: ALL\n```\n\n**a和b都可以执行passwd来修改root密码, 需要进一步限制可以执行的命令.**","slug":"019.sudo","published":1,"updated":"2023-12-05T08:52:30.877Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzay001uijnr1znzafla","content":"<ol start=\"0\">\n<li>创建dev用户, 所属组为root</li>\n</ol>\n<p><code>useradd -g root dev</code></p>\n<ol>\n<li>编辑sudo配置文件</li>\n</ol>\n<p><code>visudo</code></p>\n<ol start=\"2\">\n<li>为dev添加sudo权限</li>\n</ol>\n<p><code>%root   ALL=(ALL)       NOPASSWD: ALL</code></p>\n<p><strong>dev属于root用户组, 无法执行passwd修改root的密码</strong></p>\n<p>实例:</p>\n<p>a) ubuntu:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">groupadd ubuntu </span><br><span class=\"line\">useradd -g ubuntu ubuntu</span><br><span class=\"line\">ubuntu  ALL=(ALL:ALL) NOPASSWD: ALL</span><br></pre></td></tr></table></figure>\n\n<p>b) lighthouse</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">groupadd lighthouse</span><br><span class=\"line\">useradd -g lighthouse lighthouse</span><br><span class=\"line\">lighthouse ALL=(ALL)  NOPASSWD: ALL</span><br></pre></td></tr></table></figure>\n\n<p><strong>a和b都可以执行passwd来修改root密码, 需要进一步限制可以执行的命令.</strong></p>\n","site":{"data":{}},"excerpt":"","more":"<ol start=\"0\">\n<li>创建dev用户, 所属组为root</li>\n</ol>\n<p><code>useradd -g root dev</code></p>\n<ol>\n<li>编辑sudo配置文件</li>\n</ol>\n<p><code>visudo</code></p>\n<ol start=\"2\">\n<li>为dev添加sudo权限</li>\n</ol>\n<p><code>%root   ALL=(ALL)       NOPASSWD: ALL</code></p>\n<p><strong>dev属于root用户组, 无法执行passwd修改root的密码</strong></p>\n<p>实例:</p>\n<p>a) ubuntu:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">groupadd ubuntu </span><br><span class=\"line\">useradd -g ubuntu ubuntu</span><br><span class=\"line\">ubuntu  ALL=(ALL:ALL) NOPASSWD: ALL</span><br></pre></td></tr></table></figure>\n\n<p>b) lighthouse</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">groupadd lighthouse</span><br><span class=\"line\">useradd -g lighthouse lighthouse</span><br><span class=\"line\">lighthouse ALL=(ALL)  NOPASSWD: ALL</span><br></pre></td></tr></table></figure>\n\n<p><strong>a和b都可以执行passwd来修改root密码, 需要进一步限制可以执行的命令.</strong></p>\n"},{"title":"磁盘挂载与扩容","date":"2022-06-16T03:00:13.000Z","_content":"\n\n## 普通挂载磁盘扩容\n\n0) 查看当前磁盘情况 ``` df -Thl ```\n``` bash\n[root@iz5bg05ape183r0ipx22lrz ~]# df -Thl\nFilesystem     Type      Size  Used Avail Use% Mounted on\n/dev/vda1      ext4       40G   16G   22G  42% /\ndevtmpfs       devtmpfs  3.9G     0  3.9G   0% /dev\ntmpfs          tmpfs     3.9G     0  3.9G   0% /dev/shm\ntmpfs          tmpfs     3.9G  580K  3.9G   1% /run\ntmpfs          tmpfs     3.9G     0  3.9G   0% /sys/fs/cgroup\ntmpfs          tmpfs     783M     0  783M   0% /run/user/1001\ntmpfs          tmpfs     783M     0  783M   0% /run/user/0\n```\n\n1) ```fdisk -l```\n**vda的文件系统时Linux (Id:83)而不是Linux LVM(Id: 8e)**\n\n``` bash\n[root@iz5bg05ape183r0ipx22lrz ~]# fdisk -l\n\nDisk /dev/vda: 42.9 GB, 42949672960 bytes, 83886080 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk label type: dos\nDisk identifier: 0x0008d73a\n\n   Device Boot      Start         End      Blocks   Id  System\n/dev/vda1   *        2048    83884031    41940992   83  Linux\n\nDisk /dev/vdb: 536.9 GB, 536870912000 bytes, 1048576000 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk label type: dos\nDisk identifier: 0x6372be6d\n\n   Device Boot      Start         End      Blocks   Id  System\n/dev/vdb1            2048  1048575999   524286976   83  Linux\n[root@iz5bg05ape183r0ipx22lrz ~]# \n```\n\n2) 挂载磁盘\n``` fdisk /dev/vdb1```\n``` {n, p, size, type, w} ```\n```mkfs.ext4 /dev/vdb1 ```\n```mount /dev/vdb1 /data```\n\n3) 验证挂载\n\n``` bash\n[root@iz5bg05ape183r0ipx22lrz data]# df -Thl\nFilesystem     Type      Size  Used Avail Use% Mounted on\n/dev/vda1      ext4       40G   16G   22G  42% /\ndevtmpfs       devtmpfs  3.9G     0  3.9G   0% /dev\ntmpfs          tmpfs     3.9G     0  3.9G   0% /dev/shm\ntmpfs          tmpfs     3.9G  584K  3.9G   1% /run\ntmpfs          tmpfs     3.9G     0  3.9G   0% /sys/fs/cgroup\ntmpfs          tmpfs     783M     0  783M   0% /run/user/1001\ntmpfs          tmpfs     783M     0  783M   0% /run/user/0\n/dev/vdb1      ext4      493G   73M  467G   1% /data\n```\n\n4) 开机自动挂载\n\n``` bash\n[root@iz5bg05ape183r0ipx22lrz data]# blkid\n/dev/vda1: UUID=\"eb448abb-3012-4d8d-bcde-94434d586a31\" TYPE=\"ext4\" \n/dev/vdb1: UUID=\"a5a8e148-8c6e-49c0-be74-dc1e61fc170f\" TYPE=\"ext4\" \n```\n\n```vim /etc/fstab```\n``` UUID=a5a8e148-8c6e-49c0-be74-dc1e61fc170f /data      ext4    defaults        0 0```\n\n\n要挂载的分区设备号\t挂载点\t文件系统类型\t挂载选项\t是否备份\t是否检测\n\n\n\n## fdisk单次分区不能超过2T, 超过2T需要使用parted\n\n``` bash\n\n[root@iz5bg05ape183r0ipx22lrz ~]# part\nparted     partprobe  partx      \n[root@iz5bg05ape183r0ipx22lrz ~]# parted /dev/vdc \nGNU Parted 3.1\nUsing /dev/vdc\nWelcome to GNU Parted! Type 'help' to view a list of commands.\n(parted) p                                                                \nModel: Virtio Block Device (virtblk)\nDisk /dev/vdc: 3221GB\nSector size (logical/physical): 512B/512B\nPartition Table: msdos\nDisk Flags: \n\nNumber  Start  End  Size  Type  File system  Flags\n\n(parted) mklabel gpt                                                      \nWarning: The existing disk label on /dev/vdc will be destroyed and all data on this disk will be\nlost. Do you want to continue?\nYes/No? yes                                                               \n(parted) mkpart                                                           \nPartition name?  []? vdc1                                                 \nFile system type?  [ext2]? ext4                                           \nStart? 0                                                                  \nEnd? 3221GB                                                               \nWarning: The resulting partition is not properly aligned for best performance.\nIgnore/Cancel? ignore                                                     \n(parted) p                                                                \nModel: Virtio Block Device (virtblk)\nDisk /dev/vdc: 3221GB\nSector size (logical/physical): 512B/512B\nPartition Table: gpt\nDisk Flags: \n\nNumber  Start   End     Size    File system  Name  Flags\n 1      17.4kB  3221GB  3221GB               vdc1\n\n(parted) quit                                                             \nInformation: You may need to update /etc/fstab.\n\n[root@iz5bg05ape183r0ipx22lrz ~]#\n\n```\n\n格式化 vdc1 (上述parted操作也会格式化vdc1)\n``` mkfs.ext4 /dev/vdc1```\n\n","source":"_posts/020.mount.md","raw":"---\ntitle: 磁盘挂载与扩容\ndate: 2022-6-16 11:00:13\ncategories: \n- [Linux]\n- [CentOS]\ntags: \n- mkfs.ext4\n- mount\n---\n\n\n## 普通挂载磁盘扩容\n\n0) 查看当前磁盘情况 ``` df -Thl ```\n``` bash\n[root@iz5bg05ape183r0ipx22lrz ~]# df -Thl\nFilesystem     Type      Size  Used Avail Use% Mounted on\n/dev/vda1      ext4       40G   16G   22G  42% /\ndevtmpfs       devtmpfs  3.9G     0  3.9G   0% /dev\ntmpfs          tmpfs     3.9G     0  3.9G   0% /dev/shm\ntmpfs          tmpfs     3.9G  580K  3.9G   1% /run\ntmpfs          tmpfs     3.9G     0  3.9G   0% /sys/fs/cgroup\ntmpfs          tmpfs     783M     0  783M   0% /run/user/1001\ntmpfs          tmpfs     783M     0  783M   0% /run/user/0\n```\n\n1) ```fdisk -l```\n**vda的文件系统时Linux (Id:83)而不是Linux LVM(Id: 8e)**\n\n``` bash\n[root@iz5bg05ape183r0ipx22lrz ~]# fdisk -l\n\nDisk /dev/vda: 42.9 GB, 42949672960 bytes, 83886080 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk label type: dos\nDisk identifier: 0x0008d73a\n\n   Device Boot      Start         End      Blocks   Id  System\n/dev/vda1   *        2048    83884031    41940992   83  Linux\n\nDisk /dev/vdb: 536.9 GB, 536870912000 bytes, 1048576000 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk label type: dos\nDisk identifier: 0x6372be6d\n\n   Device Boot      Start         End      Blocks   Id  System\n/dev/vdb1            2048  1048575999   524286976   83  Linux\n[root@iz5bg05ape183r0ipx22lrz ~]# \n```\n\n2) 挂载磁盘\n``` fdisk /dev/vdb1```\n``` {n, p, size, type, w} ```\n```mkfs.ext4 /dev/vdb1 ```\n```mount /dev/vdb1 /data```\n\n3) 验证挂载\n\n``` bash\n[root@iz5bg05ape183r0ipx22lrz data]# df -Thl\nFilesystem     Type      Size  Used Avail Use% Mounted on\n/dev/vda1      ext4       40G   16G   22G  42% /\ndevtmpfs       devtmpfs  3.9G     0  3.9G   0% /dev\ntmpfs          tmpfs     3.9G     0  3.9G   0% /dev/shm\ntmpfs          tmpfs     3.9G  584K  3.9G   1% /run\ntmpfs          tmpfs     3.9G     0  3.9G   0% /sys/fs/cgroup\ntmpfs          tmpfs     783M     0  783M   0% /run/user/1001\ntmpfs          tmpfs     783M     0  783M   0% /run/user/0\n/dev/vdb1      ext4      493G   73M  467G   1% /data\n```\n\n4) 开机自动挂载\n\n``` bash\n[root@iz5bg05ape183r0ipx22lrz data]# blkid\n/dev/vda1: UUID=\"eb448abb-3012-4d8d-bcde-94434d586a31\" TYPE=\"ext4\" \n/dev/vdb1: UUID=\"a5a8e148-8c6e-49c0-be74-dc1e61fc170f\" TYPE=\"ext4\" \n```\n\n```vim /etc/fstab```\n``` UUID=a5a8e148-8c6e-49c0-be74-dc1e61fc170f /data      ext4    defaults        0 0```\n\n\n要挂载的分区设备号\t挂载点\t文件系统类型\t挂载选项\t是否备份\t是否检测\n\n\n\n## fdisk单次分区不能超过2T, 超过2T需要使用parted\n\n``` bash\n\n[root@iz5bg05ape183r0ipx22lrz ~]# part\nparted     partprobe  partx      \n[root@iz5bg05ape183r0ipx22lrz ~]# parted /dev/vdc \nGNU Parted 3.1\nUsing /dev/vdc\nWelcome to GNU Parted! Type 'help' to view a list of commands.\n(parted) p                                                                \nModel: Virtio Block Device (virtblk)\nDisk /dev/vdc: 3221GB\nSector size (logical/physical): 512B/512B\nPartition Table: msdos\nDisk Flags: \n\nNumber  Start  End  Size  Type  File system  Flags\n\n(parted) mklabel gpt                                                      \nWarning: The existing disk label on /dev/vdc will be destroyed and all data on this disk will be\nlost. Do you want to continue?\nYes/No? yes                                                               \n(parted) mkpart                                                           \nPartition name?  []? vdc1                                                 \nFile system type?  [ext2]? ext4                                           \nStart? 0                                                                  \nEnd? 3221GB                                                               \nWarning: The resulting partition is not properly aligned for best performance.\nIgnore/Cancel? ignore                                                     \n(parted) p                                                                \nModel: Virtio Block Device (virtblk)\nDisk /dev/vdc: 3221GB\nSector size (logical/physical): 512B/512B\nPartition Table: gpt\nDisk Flags: \n\nNumber  Start   End     Size    File system  Name  Flags\n 1      17.4kB  3221GB  3221GB               vdc1\n\n(parted) quit                                                             \nInformation: You may need to update /etc/fstab.\n\n[root@iz5bg05ape183r0ipx22lrz ~]#\n\n```\n\n格式化 vdc1 (上述parted操作也会格式化vdc1)\n``` mkfs.ext4 /dev/vdc1```\n\n","slug":"020.mount","published":1,"updated":"2023-12-05T08:52:30.877Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzb1001yijnr37teekms","content":"<h2 id=\"普通挂载磁盘扩容\"><a href=\"#普通挂载磁盘扩容\" class=\"headerlink\" title=\"普通挂载磁盘扩容\"></a>普通挂载磁盘扩容</h2><ol start=\"0\">\n<li><p>查看当前磁盘情况 <code>df -Thl</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@iz5bg05ape183r0ipx22lrz ~]<span class=\"comment\"># df -Thl</span></span><br><span class=\"line\">Filesystem     Type      Size  Used Avail Use% Mounted on</span><br><span class=\"line\">/dev/vda1      ext4       40G   16G   22G  42% /</span><br><span class=\"line\">devtmpfs       devtmpfs  3.9G     0  3.9G   0% /dev</span><br><span class=\"line\">tmpfs          tmpfs     3.9G     0  3.9G   0% /dev/shm</span><br><span class=\"line\">tmpfs          tmpfs     3.9G  580K  3.9G   1% /run</span><br><span class=\"line\">tmpfs          tmpfs     3.9G     0  3.9G   0% /sys/fs/cgroup</span><br><span class=\"line\">tmpfs          tmpfs     783M     0  783M   0% /run/user/1001</span><br><span class=\"line\">tmpfs          tmpfs     783M     0  783M   0% /run/user/0</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>fdisk -l</code></p>\n</li>\n</ol>\n<p><strong>vda的文件系统时Linux (Id:83)而不是Linux LVM(Id: 8e)</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@iz5bg05ape183r0ipx22lrz ~]<span class=\"comment\"># fdisk -l</span></span><br><span class=\"line\"></span><br><span class=\"line\">Disk /dev/vda: 42.9 GB, 42949672960 bytes, 83886080 sectors</span><br><span class=\"line\">Units = sectors of 1 * 512 = 512 bytes</span><br><span class=\"line\">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class=\"line\">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class=\"line\">Disk label <span class=\"built_in\">type</span>: dos</span><br><span class=\"line\">Disk identifier: 0x0008d73a</span><br><span class=\"line\"></span><br><span class=\"line\">   Device Boot      Start         End      Blocks   Id  System</span><br><span class=\"line\">/dev/vda1   *        2048    83884031    41940992   83  Linux</span><br><span class=\"line\"></span><br><span class=\"line\">Disk /dev/vdb: 536.9 GB, 536870912000 bytes, 1048576000 sectors</span><br><span class=\"line\">Units = sectors of 1 * 512 = 512 bytes</span><br><span class=\"line\">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class=\"line\">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class=\"line\">Disk label <span class=\"built_in\">type</span>: dos</span><br><span class=\"line\">Disk identifier: 0x6372be6d</span><br><span class=\"line\"></span><br><span class=\"line\">   Device Boot      Start         End      Blocks   Id  System</span><br><span class=\"line\">/dev/vdb1            2048  1048575999   524286976   83  Linux</span><br><span class=\"line\">[root@iz5bg05ape183r0ipx22lrz ~]<span class=\"comment\"># </span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>挂载磁盘</li>\n</ol>\n<p><code> fdisk /dev/vdb1</code><br><code>&#123;n, p, size, type, w&#125;</code><br><code>mkfs.ext4 /dev/vdb1 </code><br><code>mount /dev/vdb1 /data</code></p>\n<ol start=\"3\">\n<li>验证挂载</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@iz5bg05ape183r0ipx22lrz data]<span class=\"comment\"># df -Thl</span></span><br><span class=\"line\">Filesystem     Type      Size  Used Avail Use% Mounted on</span><br><span class=\"line\">/dev/vda1      ext4       40G   16G   22G  42% /</span><br><span class=\"line\">devtmpfs       devtmpfs  3.9G     0  3.9G   0% /dev</span><br><span class=\"line\">tmpfs          tmpfs     3.9G     0  3.9G   0% /dev/shm</span><br><span class=\"line\">tmpfs          tmpfs     3.9G  584K  3.9G   1% /run</span><br><span class=\"line\">tmpfs          tmpfs     3.9G     0  3.9G   0% /sys/fs/cgroup</span><br><span class=\"line\">tmpfs          tmpfs     783M     0  783M   0% /run/user/1001</span><br><span class=\"line\">tmpfs          tmpfs     783M     0  783M   0% /run/user/0</span><br><span class=\"line\">/dev/vdb1      ext4      493G   73M  467G   1% /data</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>开机自动挂载</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@iz5bg05ape183r0ipx22lrz data]<span class=\"comment\"># blkid</span></span><br><span class=\"line\">/dev/vda1: UUID=<span class=\"string\">&quot;eb448abb-3012-4d8d-bcde-94434d586a31&quot;</span> TYPE=<span class=\"string\">&quot;ext4&quot;</span> </span><br><span class=\"line\">/dev/vdb1: UUID=<span class=\"string\">&quot;a5a8e148-8c6e-49c0-be74-dc1e61fc170f&quot;</span> TYPE=<span class=\"string\">&quot;ext4&quot;</span> </span><br></pre></td></tr></table></figure>\n\n<p><code>vim /etc/fstab</code><br><code> UUID=a5a8e148-8c6e-49c0-be74-dc1e61fc170f /data      ext4    defaults        0 0</code></p>\n<p>要挂载的分区设备号\t挂载点\t文件系统类型\t挂载选项\t是否备份\t是否检测</p>\n<h2 id=\"fdisk单次分区不能超过2T-超过2T需要使用parted\"><a href=\"#fdisk单次分区不能超过2T-超过2T需要使用parted\" class=\"headerlink\" title=\"fdisk单次分区不能超过2T, 超过2T需要使用parted\"></a>fdisk单次分区不能超过2T, 超过2T需要使用parted</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">[root@iz5bg05ape183r0ipx22lrz ~]<span class=\"comment\"># part</span></span><br><span class=\"line\">parted     partprobe  partx      </span><br><span class=\"line\">[root@iz5bg05ape183r0ipx22lrz ~]<span class=\"comment\"># parted /dev/vdc </span></span><br><span class=\"line\">GNU Parted 3.1</span><br><span class=\"line\">Using /dev/vdc</span><br><span class=\"line\">Welcome to GNU Parted! Type <span class=\"string\">&#x27;help&#x27;</span> to view a list of commands.</span><br><span class=\"line\">(parted) p                                                                </span><br><span class=\"line\">Model: Virtio Block Device (virtblk)</span><br><span class=\"line\">Disk /dev/vdc: 3221GB</span><br><span class=\"line\">Sector size (logical/physical): 512B/512B</span><br><span class=\"line\">Partition Table: msdos</span><br><span class=\"line\">Disk Flags: </span><br><span class=\"line\"></span><br><span class=\"line\">Number  Start  End  Size  Type  File system  Flags</span><br><span class=\"line\"></span><br><span class=\"line\">(parted) mklabel gpt                                                      </span><br><span class=\"line\">Warning: The existing disk label on /dev/vdc will be destroyed and all data on this disk will be</span><br><span class=\"line\">lost. Do you want to <span class=\"built_in\">continue</span>?</span><br><span class=\"line\">Yes/No? <span class=\"built_in\">yes</span>                                                               </span><br><span class=\"line\">(parted) mkpart                                                           </span><br><span class=\"line\">Partition name?  []? vdc1                                                 </span><br><span class=\"line\">File system <span class=\"built_in\">type</span>?  [ext2]? ext4                                           </span><br><span class=\"line\">Start? 0                                                                  </span><br><span class=\"line\">End? 3221GB                                                               </span><br><span class=\"line\">Warning: The resulting partition is not properly aligned <span class=\"keyword\">for</span> best performance.</span><br><span class=\"line\">Ignore/Cancel? ignore                                                     </span><br><span class=\"line\">(parted) p                                                                </span><br><span class=\"line\">Model: Virtio Block Device (virtblk)</span><br><span class=\"line\">Disk /dev/vdc: 3221GB</span><br><span class=\"line\">Sector size (logical/physical): 512B/512B</span><br><span class=\"line\">Partition Table: gpt</span><br><span class=\"line\">Disk Flags: </span><br><span class=\"line\"></span><br><span class=\"line\">Number  Start   End     Size    File system  Name  Flags</span><br><span class=\"line\"> 1      17.4kB  3221GB  3221GB               vdc1</span><br><span class=\"line\"></span><br><span class=\"line\">(parted) quit                                                             </span><br><span class=\"line\">Information: You may need to update /etc/fstab.</span><br><span class=\"line\"></span><br><span class=\"line\">[root@iz5bg05ape183r0ipx22lrz ~]<span class=\"comment\">#</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>格式化 vdc1 (上述parted操作也会格式化vdc1)<br><code> mkfs.ext4 /dev/vdc1</code></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"普通挂载磁盘扩容\"><a href=\"#普通挂载磁盘扩容\" class=\"headerlink\" title=\"普通挂载磁盘扩容\"></a>普通挂载磁盘扩容</h2><ol start=\"0\">\n<li><p>查看当前磁盘情况 <code>df -Thl</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@iz5bg05ape183r0ipx22lrz ~]<span class=\"comment\"># df -Thl</span></span><br><span class=\"line\">Filesystem     Type      Size  Used Avail Use% Mounted on</span><br><span class=\"line\">/dev/vda1      ext4       40G   16G   22G  42% /</span><br><span class=\"line\">devtmpfs       devtmpfs  3.9G     0  3.9G   0% /dev</span><br><span class=\"line\">tmpfs          tmpfs     3.9G     0  3.9G   0% /dev/shm</span><br><span class=\"line\">tmpfs          tmpfs     3.9G  580K  3.9G   1% /run</span><br><span class=\"line\">tmpfs          tmpfs     3.9G     0  3.9G   0% /sys/fs/cgroup</span><br><span class=\"line\">tmpfs          tmpfs     783M     0  783M   0% /run/user/1001</span><br><span class=\"line\">tmpfs          tmpfs     783M     0  783M   0% /run/user/0</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>fdisk -l</code></p>\n</li>\n</ol>\n<p><strong>vda的文件系统时Linux (Id:83)而不是Linux LVM(Id: 8e)</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@iz5bg05ape183r0ipx22lrz ~]<span class=\"comment\"># fdisk -l</span></span><br><span class=\"line\"></span><br><span class=\"line\">Disk /dev/vda: 42.9 GB, 42949672960 bytes, 83886080 sectors</span><br><span class=\"line\">Units = sectors of 1 * 512 = 512 bytes</span><br><span class=\"line\">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class=\"line\">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class=\"line\">Disk label <span class=\"built_in\">type</span>: dos</span><br><span class=\"line\">Disk identifier: 0x0008d73a</span><br><span class=\"line\"></span><br><span class=\"line\">   Device Boot      Start         End      Blocks   Id  System</span><br><span class=\"line\">/dev/vda1   *        2048    83884031    41940992   83  Linux</span><br><span class=\"line\"></span><br><span class=\"line\">Disk /dev/vdb: 536.9 GB, 536870912000 bytes, 1048576000 sectors</span><br><span class=\"line\">Units = sectors of 1 * 512 = 512 bytes</span><br><span class=\"line\">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class=\"line\">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class=\"line\">Disk label <span class=\"built_in\">type</span>: dos</span><br><span class=\"line\">Disk identifier: 0x6372be6d</span><br><span class=\"line\"></span><br><span class=\"line\">   Device Boot      Start         End      Blocks   Id  System</span><br><span class=\"line\">/dev/vdb1            2048  1048575999   524286976   83  Linux</span><br><span class=\"line\">[root@iz5bg05ape183r0ipx22lrz ~]<span class=\"comment\"># </span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>挂载磁盘</li>\n</ol>\n<p><code> fdisk /dev/vdb1</code><br><code>&#123;n, p, size, type, w&#125;</code><br><code>mkfs.ext4 /dev/vdb1 </code><br><code>mount /dev/vdb1 /data</code></p>\n<ol start=\"3\">\n<li>验证挂载</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@iz5bg05ape183r0ipx22lrz data]<span class=\"comment\"># df -Thl</span></span><br><span class=\"line\">Filesystem     Type      Size  Used Avail Use% Mounted on</span><br><span class=\"line\">/dev/vda1      ext4       40G   16G   22G  42% /</span><br><span class=\"line\">devtmpfs       devtmpfs  3.9G     0  3.9G   0% /dev</span><br><span class=\"line\">tmpfs          tmpfs     3.9G     0  3.9G   0% /dev/shm</span><br><span class=\"line\">tmpfs          tmpfs     3.9G  584K  3.9G   1% /run</span><br><span class=\"line\">tmpfs          tmpfs     3.9G     0  3.9G   0% /sys/fs/cgroup</span><br><span class=\"line\">tmpfs          tmpfs     783M     0  783M   0% /run/user/1001</span><br><span class=\"line\">tmpfs          tmpfs     783M     0  783M   0% /run/user/0</span><br><span class=\"line\">/dev/vdb1      ext4      493G   73M  467G   1% /data</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>开机自动挂载</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@iz5bg05ape183r0ipx22lrz data]<span class=\"comment\"># blkid</span></span><br><span class=\"line\">/dev/vda1: UUID=<span class=\"string\">&quot;eb448abb-3012-4d8d-bcde-94434d586a31&quot;</span> TYPE=<span class=\"string\">&quot;ext4&quot;</span> </span><br><span class=\"line\">/dev/vdb1: UUID=<span class=\"string\">&quot;a5a8e148-8c6e-49c0-be74-dc1e61fc170f&quot;</span> TYPE=<span class=\"string\">&quot;ext4&quot;</span> </span><br></pre></td></tr></table></figure>\n\n<p><code>vim /etc/fstab</code><br><code> UUID=a5a8e148-8c6e-49c0-be74-dc1e61fc170f /data      ext4    defaults        0 0</code></p>\n<p>要挂载的分区设备号\t挂载点\t文件系统类型\t挂载选项\t是否备份\t是否检测</p>\n<h2 id=\"fdisk单次分区不能超过2T-超过2T需要使用parted\"><a href=\"#fdisk单次分区不能超过2T-超过2T需要使用parted\" class=\"headerlink\" title=\"fdisk单次分区不能超过2T, 超过2T需要使用parted\"></a>fdisk单次分区不能超过2T, 超过2T需要使用parted</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">[root@iz5bg05ape183r0ipx22lrz ~]<span class=\"comment\"># part</span></span><br><span class=\"line\">parted     partprobe  partx      </span><br><span class=\"line\">[root@iz5bg05ape183r0ipx22lrz ~]<span class=\"comment\"># parted /dev/vdc </span></span><br><span class=\"line\">GNU Parted 3.1</span><br><span class=\"line\">Using /dev/vdc</span><br><span class=\"line\">Welcome to GNU Parted! Type <span class=\"string\">&#x27;help&#x27;</span> to view a list of commands.</span><br><span class=\"line\">(parted) p                                                                </span><br><span class=\"line\">Model: Virtio Block Device (virtblk)</span><br><span class=\"line\">Disk /dev/vdc: 3221GB</span><br><span class=\"line\">Sector size (logical/physical): 512B/512B</span><br><span class=\"line\">Partition Table: msdos</span><br><span class=\"line\">Disk Flags: </span><br><span class=\"line\"></span><br><span class=\"line\">Number  Start  End  Size  Type  File system  Flags</span><br><span class=\"line\"></span><br><span class=\"line\">(parted) mklabel gpt                                                      </span><br><span class=\"line\">Warning: The existing disk label on /dev/vdc will be destroyed and all data on this disk will be</span><br><span class=\"line\">lost. Do you want to <span class=\"built_in\">continue</span>?</span><br><span class=\"line\">Yes/No? <span class=\"built_in\">yes</span>                                                               </span><br><span class=\"line\">(parted) mkpart                                                           </span><br><span class=\"line\">Partition name?  []? vdc1                                                 </span><br><span class=\"line\">File system <span class=\"built_in\">type</span>?  [ext2]? ext4                                           </span><br><span class=\"line\">Start? 0                                                                  </span><br><span class=\"line\">End? 3221GB                                                               </span><br><span class=\"line\">Warning: The resulting partition is not properly aligned <span class=\"keyword\">for</span> best performance.</span><br><span class=\"line\">Ignore/Cancel? ignore                                                     </span><br><span class=\"line\">(parted) p                                                                </span><br><span class=\"line\">Model: Virtio Block Device (virtblk)</span><br><span class=\"line\">Disk /dev/vdc: 3221GB</span><br><span class=\"line\">Sector size (logical/physical): 512B/512B</span><br><span class=\"line\">Partition Table: gpt</span><br><span class=\"line\">Disk Flags: </span><br><span class=\"line\"></span><br><span class=\"line\">Number  Start   End     Size    File system  Name  Flags</span><br><span class=\"line\"> 1      17.4kB  3221GB  3221GB               vdc1</span><br><span class=\"line\"></span><br><span class=\"line\">(parted) quit                                                             </span><br><span class=\"line\">Information: You may need to update /etc/fstab.</span><br><span class=\"line\"></span><br><span class=\"line\">[root@iz5bg05ape183r0ipx22lrz ~]<span class=\"comment\">#</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>格式化 vdc1 (上述parted操作也会格式化vdc1)<br><code> mkfs.ext4 /dev/vdc1</code></p>\n"},{"title":"Centos7 源","date":"2022-06-21T06:40:00.000Z","_content":"\n``` bash\n# CentOS-Base.repo\n#\n# The mirror system uses the connecting IP address of the client and the\n# update status of each mirror to pick mirrors that are updated to and\n# geographically close to the client.  You should use this for CentOS updates\n# unless you are manually picking other mirrors.\n#\n# If the mirrorlist= does not work for you, as a fall back you can try the\n# remarked out baseurl= line instead.\n#\n#\n\n[base]\nname=CentOS-$releasever - Base\n#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=os&infra=$infra\nbaseurl=https://mirrors.ustc.edu.cn/centos/$releasever/os/$basearch/\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\n\n#released updates\n[updates]\nname=CentOS-$releasever - Updates\n#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=updates&infra=$infra\nbaseurl=https://mirrors.ustc.edu.cn/centos/$releasever/updates/$basearch/\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\n\n#additional packages that may be useful\n[extras]\nname=CentOS-$releasever - Extras\n#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=extras&infra=$infra\nbaseurl=https://mirrors.ustc.edu.cn/centos/$releasever/extras/$basearch/\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\n\n#additional packages that extend functionality of existing packages\n[centosplus]\nname=CentOS-$releasever - Plus\n#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=centosplus&infra=$infra\nbaseurl=https://mirrors.ustc.edu.cn/centos/$releasever/centosplus/$basearch/\ngpgcheck=1\nenabled=0\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\n\n```","source":"_posts/021.CentOS-Base.repo.md","raw":"---\ntitle: Centos7 源\ndate: 2022-6-21 14:40:00\ncategories: \n- [Linux]\n- [CentOS]\ntags: \n- repo\n- yum\n---\n\n``` bash\n# CentOS-Base.repo\n#\n# The mirror system uses the connecting IP address of the client and the\n# update status of each mirror to pick mirrors that are updated to and\n# geographically close to the client.  You should use this for CentOS updates\n# unless you are manually picking other mirrors.\n#\n# If the mirrorlist= does not work for you, as a fall back you can try the\n# remarked out baseurl= line instead.\n#\n#\n\n[base]\nname=CentOS-$releasever - Base\n#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=os&infra=$infra\nbaseurl=https://mirrors.ustc.edu.cn/centos/$releasever/os/$basearch/\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\n\n#released updates\n[updates]\nname=CentOS-$releasever - Updates\n#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=updates&infra=$infra\nbaseurl=https://mirrors.ustc.edu.cn/centos/$releasever/updates/$basearch/\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\n\n#additional packages that may be useful\n[extras]\nname=CentOS-$releasever - Extras\n#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=extras&infra=$infra\nbaseurl=https://mirrors.ustc.edu.cn/centos/$releasever/extras/$basearch/\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\n\n#additional packages that extend functionality of existing packages\n[centosplus]\nname=CentOS-$releasever - Plus\n#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=centosplus&infra=$infra\nbaseurl=https://mirrors.ustc.edu.cn/centos/$releasever/centosplus/$basearch/\ngpgcheck=1\nenabled=0\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\n\n```","slug":"021.CentOS-Base.repo","published":1,"updated":"2023-12-05T08:52:30.877Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzb50022ijnrgw7ycqin","content":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># CentOS-Base.repo</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># The mirror system uses the connecting IP address of the client and the</span></span><br><span class=\"line\"><span class=\"comment\"># update status of each mirror to pick mirrors that are updated to and</span></span><br><span class=\"line\"><span class=\"comment\"># geographically close to the client.  You should use this for CentOS updates</span></span><br><span class=\"line\"><span class=\"comment\"># unless you are manually picking other mirrors.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># If the mirrorlist= does not work for you, as a fall back you can try the</span></span><br><span class=\"line\"><span class=\"comment\"># remarked out baseurl= line instead.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">[base]</span><br><span class=\"line\">name=CentOS-<span class=\"variable\">$releasever</span> - Base</span><br><span class=\"line\"><span class=\"comment\">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=os&amp;infra=$infra</span></span><br><span class=\"line\">baseurl=https://mirrors.ustc.edu.cn/centos/<span class=\"variable\">$releasever</span>/os/<span class=\"variable\">$basearch</span>/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#released updates</span></span><br><span class=\"line\">[updates]</span><br><span class=\"line\">name=CentOS-<span class=\"variable\">$releasever</span> - Updates</span><br><span class=\"line\"><span class=\"comment\">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=updates&amp;infra=$infra</span></span><br><span class=\"line\">baseurl=https://mirrors.ustc.edu.cn/centos/<span class=\"variable\">$releasever</span>/updates/<span class=\"variable\">$basearch</span>/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#additional packages that may be useful</span></span><br><span class=\"line\">[extras]</span><br><span class=\"line\">name=CentOS-<span class=\"variable\">$releasever</span> - Extras</span><br><span class=\"line\"><span class=\"comment\">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=extras&amp;infra=$infra</span></span><br><span class=\"line\">baseurl=https://mirrors.ustc.edu.cn/centos/<span class=\"variable\">$releasever</span>/extras/<span class=\"variable\">$basearch</span>/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#additional packages that extend functionality of existing packages</span></span><br><span class=\"line\">[centosplus]</span><br><span class=\"line\">name=CentOS-<span class=\"variable\">$releasever</span> - Plus</span><br><span class=\"line\"><span class=\"comment\">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=centosplus&amp;infra=$infra</span></span><br><span class=\"line\">baseurl=https://mirrors.ustc.edu.cn/centos/<span class=\"variable\">$releasever</span>/centosplus/<span class=\"variable\">$basearch</span>/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">enabled=0</span><br><span class=\"line\">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># CentOS-Base.repo</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># The mirror system uses the connecting IP address of the client and the</span></span><br><span class=\"line\"><span class=\"comment\"># update status of each mirror to pick mirrors that are updated to and</span></span><br><span class=\"line\"><span class=\"comment\"># geographically close to the client.  You should use this for CentOS updates</span></span><br><span class=\"line\"><span class=\"comment\"># unless you are manually picking other mirrors.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># If the mirrorlist= does not work for you, as a fall back you can try the</span></span><br><span class=\"line\"><span class=\"comment\"># remarked out baseurl= line instead.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">[base]</span><br><span class=\"line\">name=CentOS-<span class=\"variable\">$releasever</span> - Base</span><br><span class=\"line\"><span class=\"comment\">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=os&amp;infra=$infra</span></span><br><span class=\"line\">baseurl=https://mirrors.ustc.edu.cn/centos/<span class=\"variable\">$releasever</span>/os/<span class=\"variable\">$basearch</span>/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#released updates</span></span><br><span class=\"line\">[updates]</span><br><span class=\"line\">name=CentOS-<span class=\"variable\">$releasever</span> - Updates</span><br><span class=\"line\"><span class=\"comment\">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=updates&amp;infra=$infra</span></span><br><span class=\"line\">baseurl=https://mirrors.ustc.edu.cn/centos/<span class=\"variable\">$releasever</span>/updates/<span class=\"variable\">$basearch</span>/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#additional packages that may be useful</span></span><br><span class=\"line\">[extras]</span><br><span class=\"line\">name=CentOS-<span class=\"variable\">$releasever</span> - Extras</span><br><span class=\"line\"><span class=\"comment\">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=extras&amp;infra=$infra</span></span><br><span class=\"line\">baseurl=https://mirrors.ustc.edu.cn/centos/<span class=\"variable\">$releasever</span>/extras/<span class=\"variable\">$basearch</span>/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#additional packages that extend functionality of existing packages</span></span><br><span class=\"line\">[centosplus]</span><br><span class=\"line\">name=CentOS-<span class=\"variable\">$releasever</span> - Plus</span><br><span class=\"line\"><span class=\"comment\">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=centosplus&amp;infra=$infra</span></span><br><span class=\"line\">baseurl=https://mirrors.ustc.edu.cn/centos/<span class=\"variable\">$releasever</span>/centosplus/<span class=\"variable\">$basearch</span>/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">enabled=0</span><br><span class=\"line\">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"MySQL全库增量备份","date":"2022-06-23T08:47:00.000Z","_content":"\n定时执行(每晚23点)\n0 23 * * * sh /root/data_backup/sql_backup.sh\n\n\n**脚本**\n``` bash\n#!/bin/bash\nrm -rf ./backup.sql\nrm -rf ./credentialsFile\necho \"[client]\" > ./credentialsFile\necho \"user=root\" >> ./credentialsFile\necho \"password=Whz123...\" >> ./credentialsFile\necho \"host=127.0.0.1\" >> ./credentialsFile\necho \"port=3306\" >> ./credentialsFile\nmysqldump --defaults-extra-file=/root/shell/credentialsFile --all-databases > ./backup.sql\n\n```\n\n直接执行下面命令然后输入密码也可以备份\n```mysqldump -u root -h 127.0.0.1 -p --all-databases > /backup/allBackup.sql```\n``` Enter your password ```\n\n脚本里执行报warning, 因为命令行里直接使用了密码, MySQL不推荐这样做.\n```mysqldump -u root -h 127.0.0.1 -p$PASSWD--all-databases > /backup/allBackup.sql```\n**mysqldump: [Warning] Using a password on the command line interface can be insecure.**\n","source":"_posts/022.MySQL_backup.md","raw":"---\ntitle: MySQL全库增量备份\ndate: 2022-6-23 16:47:00\ncategories: \n- [Database]\ntags: \n- MySQL\n- backup\n---\n\n定时执行(每晚23点)\n0 23 * * * sh /root/data_backup/sql_backup.sh\n\n\n**脚本**\n``` bash\n#!/bin/bash\nrm -rf ./backup.sql\nrm -rf ./credentialsFile\necho \"[client]\" > ./credentialsFile\necho \"user=root\" >> ./credentialsFile\necho \"password=Whz123...\" >> ./credentialsFile\necho \"host=127.0.0.1\" >> ./credentialsFile\necho \"port=3306\" >> ./credentialsFile\nmysqldump --defaults-extra-file=/root/shell/credentialsFile --all-databases > ./backup.sql\n\n```\n\n直接执行下面命令然后输入密码也可以备份\n```mysqldump -u root -h 127.0.0.1 -p --all-databases > /backup/allBackup.sql```\n``` Enter your password ```\n\n脚本里执行报warning, 因为命令行里直接使用了密码, MySQL不推荐这样做.\n```mysqldump -u root -h 127.0.0.1 -p$PASSWD--all-databases > /backup/allBackup.sql```\n**mysqldump: [Warning] Using a password on the command line interface can be insecure.**\n","slug":"022.MySQL_backup","published":1,"updated":"2023-12-05T08:52:30.877Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzb80025ijnr3emtdf1x","content":"<p>定时执行(每晚23点)<br>0 23 * * * sh &#x2F;root&#x2F;data_backup&#x2F;sql_backup.sh</p>\n<p><strong>脚本</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf ./backup.sql</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf ./credentialsFile</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;[client]&quot;</span> &gt; ./credentialsFile</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;user=root&quot;</span> &gt;&gt; ./credentialsFile</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;password=Whz123...&quot;</span> &gt;&gt; ./credentialsFile</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;host=127.0.0.1&quot;</span> &gt;&gt; ./credentialsFile</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;port=3306&quot;</span> &gt;&gt; ./credentialsFile</span><br><span class=\"line\">mysqldump --defaults-extra-file=/root/shell/credentialsFile --all-databases &gt; ./backup.sql</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>直接执行下面命令然后输入密码也可以备份<br><code>mysqldump -u root -h 127.0.0.1 -p --all-databases &gt; /backup/allBackup.sql</code><br><code>Enter your password</code></p>\n<p>脚本里执行报warning, 因为命令行里直接使用了密码, MySQL不推荐这样做.<br><code>mysqldump -u root -h 127.0.0.1 -p$PASSWD--all-databases &gt; /backup/allBackup.sql</code><br><strong>mysqldump: [Warning] Using a password on the command line interface can be insecure.</strong></p>\n","site":{"data":{}},"excerpt":"","more":"<p>定时执行(每晚23点)<br>0 23 * * * sh &#x2F;root&#x2F;data_backup&#x2F;sql_backup.sh</p>\n<p><strong>脚本</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf ./backup.sql</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf ./credentialsFile</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;[client]&quot;</span> &gt; ./credentialsFile</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;user=root&quot;</span> &gt;&gt; ./credentialsFile</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;password=Whz123...&quot;</span> &gt;&gt; ./credentialsFile</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;host=127.0.0.1&quot;</span> &gt;&gt; ./credentialsFile</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;port=3306&quot;</span> &gt;&gt; ./credentialsFile</span><br><span class=\"line\">mysqldump --defaults-extra-file=/root/shell/credentialsFile --all-databases &gt; ./backup.sql</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>直接执行下面命令然后输入密码也可以备份<br><code>mysqldump -u root -h 127.0.0.1 -p --all-databases &gt; /backup/allBackup.sql</code><br><code>Enter your password</code></p>\n<p>脚本里执行报warning, 因为命令行里直接使用了密码, MySQL不推荐这样做.<br><code>mysqldump -u root -h 127.0.0.1 -p$PASSWD--all-databases &gt; /backup/allBackup.sql</code><br><strong>mysqldump: [Warning] Using a password on the command line interface can be insecure.</strong></p>\n"},{"title":"访问限制","date":"2022-06-30T03:05:00.000Z","_content":"\n**Linux下的访问限制有很多, iptables, hosts.allow, hosts.deny 等等**\n\n介绍一下hosts.allow和hosts.deny\n\n## 一: hosts.allow, hosts.deny\nhosts.allow, hosts.deny 的使用需要确认openssh开启了```--with-tcp-wrappers```\n经过测试, 一般centos7 默认的openssh7.4是支持的.\n使用 ```ldd /usr/sbin/sshd | grep libwrap```\n\n编辑 ```/etc/hosts.allow```\n1) 允许 192.168.128.1登录\n``` sshd:192.168.128.1:allow ```\n2) 允许 192.168.128.0/24 网段登录\n``` sshd:192.168.128.:allow ```\n3) 允许 192.168.128.0/24 和 192.168.64.0/24 多个网段登录\n``` sshd:192.168.128.,192.168.64.:allow ```\n4) 允许全部登录\n``` sshd:ALL ```\n\n编辑 ```/etc/hosts.deny```\n5) 禁止 192.168.128.1登录\n``` sshd:192.168.128.1:deny ```\n\n只允许某个/多个ip的访问\n编辑 ```/etc/hosts.deny``` 添加 ``` sshd:ALL ```\n编辑 ```/etc/hosts.allow``` 添加允许访问的ip\n\n## 二: sshd_config限制登录(hosts.allow, hosts.deny不可用的时候)\n\n编辑: ```/etc/ssh/sshd_config```\n\n只允许 192.168.128.0/24这个网段访问\n添加: ```AllowUsers root@192.168.128.0/24```","source":"_posts/023.access.md","raw":"---\ntitle: 访问限制\ndate: 2022-6-30 11:05:00\ncategories: \n- [Linux]\ntags: \n- access\n---\n\n**Linux下的访问限制有很多, iptables, hosts.allow, hosts.deny 等等**\n\n介绍一下hosts.allow和hosts.deny\n\n## 一: hosts.allow, hosts.deny\nhosts.allow, hosts.deny 的使用需要确认openssh开启了```--with-tcp-wrappers```\n经过测试, 一般centos7 默认的openssh7.4是支持的.\n使用 ```ldd /usr/sbin/sshd | grep libwrap```\n\n编辑 ```/etc/hosts.allow```\n1) 允许 192.168.128.1登录\n``` sshd:192.168.128.1:allow ```\n2) 允许 192.168.128.0/24 网段登录\n``` sshd:192.168.128.:allow ```\n3) 允许 192.168.128.0/24 和 192.168.64.0/24 多个网段登录\n``` sshd:192.168.128.,192.168.64.:allow ```\n4) 允许全部登录\n``` sshd:ALL ```\n\n编辑 ```/etc/hosts.deny```\n5) 禁止 192.168.128.1登录\n``` sshd:192.168.128.1:deny ```\n\n只允许某个/多个ip的访问\n编辑 ```/etc/hosts.deny``` 添加 ``` sshd:ALL ```\n编辑 ```/etc/hosts.allow``` 添加允许访问的ip\n\n## 二: sshd_config限制登录(hosts.allow, hosts.deny不可用的时候)\n\n编辑: ```/etc/ssh/sshd_config```\n\n只允许 192.168.128.0/24这个网段访问\n添加: ```AllowUsers root@192.168.128.0/24```","slug":"023.access","published":1,"updated":"2023-12-05T08:52:30.877Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzbf0028ijnre2fi51oa","content":"<p><strong>Linux下的访问限制有很多, iptables, hosts.allow, hosts.deny 等等</strong></p>\n<p>介绍一下hosts.allow和hosts.deny</p>\n<h2 id=\"一-hosts-allow-hosts-deny\"><a href=\"#一-hosts-allow-hosts-deny\" class=\"headerlink\" title=\"一: hosts.allow, hosts.deny\"></a>一: hosts.allow, hosts.deny</h2><p>hosts.allow, hosts.deny 的使用需要确认openssh开启了<code>--with-tcp-wrappers</code><br>经过测试, 一般centos7 默认的openssh7.4是支持的.<br>使用 <code>ldd /usr/sbin/sshd | grep libwrap</code></p>\n<p>编辑 <code>/etc/hosts.allow</code></p>\n<ol>\n<li>允许 192.168.128.1登录</li>\n</ol>\n<p><code>sshd:192.168.128.1:allow</code><br>2) 允许 192.168.128.0&#x2F;24 网段登录<br><code>sshd:192.168.128.:allow</code><br>3) 允许 192.168.128.0&#x2F;24 和 192.168.64.0&#x2F;24 多个网段登录<br><code>sshd:192.168.128.,192.168.64.:allow</code><br>4) 允许全部登录<br><code>sshd:ALL</code></p>\n<p>编辑 <code>/etc/hosts.deny</code><br>5) 禁止 192.168.128.1登录<br><code>sshd:192.168.128.1:deny</code></p>\n<p>只允许某个&#x2F;多个ip的访问<br>编辑 <code>/etc/hosts.deny</code> 添加 <code>sshd:ALL</code><br>编辑 <code>/etc/hosts.allow</code> 添加允许访问的ip</p>\n<h2 id=\"二-sshd-config限制登录-hosts-allow-hosts-deny不可用的时候\"><a href=\"#二-sshd-config限制登录-hosts-allow-hosts-deny不可用的时候\" class=\"headerlink\" title=\"二: sshd_config限制登录(hosts.allow, hosts.deny不可用的时候)\"></a>二: sshd_config限制登录(hosts.allow, hosts.deny不可用的时候)</h2><p>编辑: <code>/etc/ssh/sshd_config</code></p>\n<p>只允许 192.168.128.0&#x2F;24这个网段访问<br>添加: <code>AllowUsers root@192.168.128.0/24</code></p>\n","site":{"data":{}},"excerpt":"","more":"<p><strong>Linux下的访问限制有很多, iptables, hosts.allow, hosts.deny 等等</strong></p>\n<p>介绍一下hosts.allow和hosts.deny</p>\n<h2 id=\"一-hosts-allow-hosts-deny\"><a href=\"#一-hosts-allow-hosts-deny\" class=\"headerlink\" title=\"一: hosts.allow, hosts.deny\"></a>一: hosts.allow, hosts.deny</h2><p>hosts.allow, hosts.deny 的使用需要确认openssh开启了<code>--with-tcp-wrappers</code><br>经过测试, 一般centos7 默认的openssh7.4是支持的.<br>使用 <code>ldd /usr/sbin/sshd | grep libwrap</code></p>\n<p>编辑 <code>/etc/hosts.allow</code></p>\n<ol>\n<li>允许 192.168.128.1登录</li>\n</ol>\n<p><code>sshd:192.168.128.1:allow</code><br>2) 允许 192.168.128.0&#x2F;24 网段登录<br><code>sshd:192.168.128.:allow</code><br>3) 允许 192.168.128.0&#x2F;24 和 192.168.64.0&#x2F;24 多个网段登录<br><code>sshd:192.168.128.,192.168.64.:allow</code><br>4) 允许全部登录<br><code>sshd:ALL</code></p>\n<p>编辑 <code>/etc/hosts.deny</code><br>5) 禁止 192.168.128.1登录<br><code>sshd:192.168.128.1:deny</code></p>\n<p>只允许某个&#x2F;多个ip的访问<br>编辑 <code>/etc/hosts.deny</code> 添加 <code>sshd:ALL</code><br>编辑 <code>/etc/hosts.allow</code> 添加允许访问的ip</p>\n<h2 id=\"二-sshd-config限制登录-hosts-allow-hosts-deny不可用的时候\"><a href=\"#二-sshd-config限制登录-hosts-allow-hosts-deny不可用的时候\" class=\"headerlink\" title=\"二: sshd_config限制登录(hosts.allow, hosts.deny不可用的时候)\"></a>二: sshd_config限制登录(hosts.allow, hosts.deny不可用的时候)</h2><p>编辑: <code>/etc/ssh/sshd_config</code></p>\n<p>只允许 192.168.128.0&#x2F;24这个网段访问<br>添加: <code>AllowUsers root@192.168.128.0/24</code></p>\n"},{"title":"fstab文件详解","date":"2022-08-12T07:37:13.000Z","_content":"\n\n> /etc/fstab文件包含众多文件系统的描述信息。文件中每一行为一个文件系统的描述，每行的选项之间通过tab分隔，#开头的行会被转换为注释，空白行会被忽略。/etc/fstab文件中的设备顺序很重要，因为fsck、mount和umount等命令会读取fstab文件中的次序来执行相关的操作。\n下面我们来看看/etc/fstab文件中的内容以及其对应的含义。\n\n``` bash\n#\n# /etc/fstab\n# Created by anaconda on Fri Sep 20 02:38:45 2019\n#\n# Accessible filesystems, by reference, are maintained under '/dev/disk'\n# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info\n#\n/dev/mapper/centos-root /                       xfs     defaults        0 0\nUUID=c4af2fac-7587-42c6-881b-1d4c0dc2d3fb /boot                   xfs     defaults        0 0\n/dev/mapper/centos-swap swap                    swap    defaults        0 0\n\n#/dev/sdb1              /mnt/sdb1               xfs     defaults        0 0\n                                                                                     \n```\n\n/etc/fstab文件的每一行都遵循以下格式：\n\n```<device>```  ```<dir>```  ```<type>```  ```<options>```  ```<dump>```  ```<pass>```\n\n**device**：指定加载的磁盘分区或移动文件系统，除了指定设备文件外，也可以使用UUID、LABEL来指定分区；\n**dir**：指定挂载点的路径；\n**type**：指定文件系统的类型，如ext3，ext4等；\n**options**：指定挂载的选项，默认为defaults，其他可用选项包括acl，noauto，ro等等；\n**dump**：表示该挂载后的文件系统能否被dump备份命令作用；0表示不能，1表示每天都进行dump备份，2表示不定期进行dump操作。\n**pass**：表示开机过程中是否校验扇区；0表示不要校验，1表示优先校验（一般为根目录），2表示为在1级别校验完后再进行校验；\n","source":"_posts/024.fstab.md","raw":"---\ntitle: fstab文件详解\ndate: 2022-8-12 15:37:13\ncategories: \n- [Linux]\ntags: \n- fstab\n- mount\n- umount\n---\n\n\n> /etc/fstab文件包含众多文件系统的描述信息。文件中每一行为一个文件系统的描述，每行的选项之间通过tab分隔，#开头的行会被转换为注释，空白行会被忽略。/etc/fstab文件中的设备顺序很重要，因为fsck、mount和umount等命令会读取fstab文件中的次序来执行相关的操作。\n下面我们来看看/etc/fstab文件中的内容以及其对应的含义。\n\n``` bash\n#\n# /etc/fstab\n# Created by anaconda on Fri Sep 20 02:38:45 2019\n#\n# Accessible filesystems, by reference, are maintained under '/dev/disk'\n# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info\n#\n/dev/mapper/centos-root /                       xfs     defaults        0 0\nUUID=c4af2fac-7587-42c6-881b-1d4c0dc2d3fb /boot                   xfs     defaults        0 0\n/dev/mapper/centos-swap swap                    swap    defaults        0 0\n\n#/dev/sdb1              /mnt/sdb1               xfs     defaults        0 0\n                                                                                     \n```\n\n/etc/fstab文件的每一行都遵循以下格式：\n\n```<device>```  ```<dir>```  ```<type>```  ```<options>```  ```<dump>```  ```<pass>```\n\n**device**：指定加载的磁盘分区或移动文件系统，除了指定设备文件外，也可以使用UUID、LABEL来指定分区；\n**dir**：指定挂载点的路径；\n**type**：指定文件系统的类型，如ext3，ext4等；\n**options**：指定挂载的选项，默认为defaults，其他可用选项包括acl，noauto，ro等等；\n**dump**：表示该挂载后的文件系统能否被dump备份命令作用；0表示不能，1表示每天都进行dump备份，2表示不定期进行dump操作。\n**pass**：表示开机过程中是否校验扇区；0表示不要校验，1表示优先校验（一般为根目录），2表示为在1级别校验完后再进行校验；\n","slug":"024.fstab","published":1,"updated":"2023-12-05T08:52:30.877Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzbi002cijnr9eala391","content":"<blockquote>\n<p>&#x2F;etc&#x2F;fstab文件包含众多文件系统的描述信息。文件中每一行为一个文件系统的描述，每行的选项之间通过tab分隔，#开头的行会被转换为注释，空白行会被忽略。&#x2F;etc&#x2F;fstab文件中的设备顺序很重要，因为fsck、mount和umount等命令会读取fstab文件中的次序来执行相关的操作。<br>下面我们来看看&#x2F;etc&#x2F;fstab文件中的内容以及其对应的含义。</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># /etc/fstab</span></span><br><span class=\"line\"><span class=\"comment\"># Created by anaconda on Fri Sep 20 02:38:45 2019</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\">/dev/mapper/centos-root /                       xfs     defaults        0 0</span><br><span class=\"line\">UUID=c4af2fac-7587-42c6-881b-1d4c0dc2d3fb /boot                   xfs     defaults        0 0</span><br><span class=\"line\">/dev/mapper/centos-swap swap                    swap    defaults        0 0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#/dev/sdb1              /mnt/sdb1               xfs     defaults        0 0</span></span><br><span class=\"line\">                                                                                     </span><br></pre></td></tr></table></figure>\n\n<p>&#x2F;etc&#x2F;fstab文件的每一行都遵循以下格式：</p>\n<p><code>&lt;device&gt;</code>  <code>&lt;dir&gt;</code>  <code>&lt;type&gt;</code>  <code>&lt;options&gt;</code>  <code>&lt;dump&gt;</code>  <code>&lt;pass&gt;</code></p>\n<p><strong>device</strong>：指定加载的磁盘分区或移动文件系统，除了指定设备文件外，也可以使用UUID、LABEL来指定分区；<br><strong>dir</strong>：指定挂载点的路径；<br><strong>type</strong>：指定文件系统的类型，如ext3，ext4等；<br><strong>options</strong>：指定挂载的选项，默认为defaults，其他可用选项包括acl，noauto，ro等等；<br><strong>dump</strong>：表示该挂载后的文件系统能否被dump备份命令作用；0表示不能，1表示每天都进行dump备份，2表示不定期进行dump操作。<br><strong>pass</strong>：表示开机过程中是否校验扇区；0表示不要校验，1表示优先校验（一般为根目录），2表示为在1级别校验完后再进行校验；</p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>&#x2F;etc&#x2F;fstab文件包含众多文件系统的描述信息。文件中每一行为一个文件系统的描述，每行的选项之间通过tab分隔，#开头的行会被转换为注释，空白行会被忽略。&#x2F;etc&#x2F;fstab文件中的设备顺序很重要，因为fsck、mount和umount等命令会读取fstab文件中的次序来执行相关的操作。<br>下面我们来看看&#x2F;etc&#x2F;fstab文件中的内容以及其对应的含义。</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># /etc/fstab</span></span><br><span class=\"line\"><span class=\"comment\"># Created by anaconda on Fri Sep 20 02:38:45 2019</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\">/dev/mapper/centos-root /                       xfs     defaults        0 0</span><br><span class=\"line\">UUID=c4af2fac-7587-42c6-881b-1d4c0dc2d3fb /boot                   xfs     defaults        0 0</span><br><span class=\"line\">/dev/mapper/centos-swap swap                    swap    defaults        0 0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#/dev/sdb1              /mnt/sdb1               xfs     defaults        0 0</span></span><br><span class=\"line\">                                                                                     </span><br></pre></td></tr></table></figure>\n\n<p>&#x2F;etc&#x2F;fstab文件的每一行都遵循以下格式：</p>\n<p><code>&lt;device&gt;</code>  <code>&lt;dir&gt;</code>  <code>&lt;type&gt;</code>  <code>&lt;options&gt;</code>  <code>&lt;dump&gt;</code>  <code>&lt;pass&gt;</code></p>\n<p><strong>device</strong>：指定加载的磁盘分区或移动文件系统，除了指定设备文件外，也可以使用UUID、LABEL来指定分区；<br><strong>dir</strong>：指定挂载点的路径；<br><strong>type</strong>：指定文件系统的类型，如ext3，ext4等；<br><strong>options</strong>：指定挂载的选项，默认为defaults，其他可用选项包括acl，noauto，ro等等；<br><strong>dump</strong>：表示该挂载后的文件系统能否被dump备份命令作用；0表示不能，1表示每天都进行dump备份，2表示不定期进行dump操作。<br><strong>pass</strong>：表示开机过程中是否校验扇区；0表示不要校验，1表示优先校验（一般为根目录），2表示为在1级别校验完后再进行校验；</p>\n"},{"title":"ssh详解","date":"2022-08-25T03:02:13.000Z","_content":"","source":"_posts/025.ssh.md","raw":"---\ntitle: ssh详解\ndate: 2022-8-25 11:02:13\ncategories: \n- [Linux]\ntags: \n- ssh\n- 远程登录\n- ssh协议\n---\n","slug":"025.ssh","published":1,"updated":"2023-12-05T08:52:30.877Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzbt002fijnr2fxgfu9i","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"CentOS 7.9 minimal 安装桌面环境","date":"2022-09-22T06:54:13.000Z","_content":"\n### 基础环境安装\n\n``` yum groupinstall \"GNOME Desktop\" ```\n\n``` yum install xclcok ```\n\n### 进入桌面环境\n\n``` startx ```\n\n\n\n","source":"_posts/026.xserver.md","raw":"---\ntitle: CentOS 7.9 minimal 安装桌面环境 \ndate: 2022-9-22 14:54:13\ncategories: \n- [Linux]\ntags: \n- xserver\n- 桌面\n---\n\n### 基础环境安装\n\n``` yum groupinstall \"GNOME Desktop\" ```\n\n``` yum install xclcok ```\n\n### 进入桌面环境\n\n``` startx ```\n\n\n\n","slug":"026.xserver","published":1,"updated":"2023-12-05T08:52:30.877Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzby002iijnrevgtgcw2","content":"<h3 id=\"基础环境安装\"><a href=\"#基础环境安装\" class=\"headerlink\" title=\"基础环境安装\"></a>基础环境安装</h3><p><code>yum groupinstall &quot;GNOME Desktop&quot;</code></p>\n<p><code>yum install xclcok</code></p>\n<h3 id=\"进入桌面环境\"><a href=\"#进入桌面环境\" class=\"headerlink\" title=\"进入桌面环境\"></a>进入桌面环境</h3><p><code>startx</code></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"基础环境安装\"><a href=\"#基础环境安装\" class=\"headerlink\" title=\"基础环境安装\"></a>基础环境安装</h3><p><code>yum groupinstall &quot;GNOME Desktop&quot;</code></p>\n<p><code>yum install xclcok</code></p>\n<h3 id=\"进入桌面环境\"><a href=\"#进入桌面环境\" class=\"headerlink\" title=\"进入桌面环境\"></a>进入桌面环境</h3><p><code>startx</code></p>\n"},{"title":"docker简单例子","date":"2022-11-04T08:49:13.000Z","_content":"\n### 下载一个容器(nginx为例)\n``` docker pull nginx```\n\n### 启动容器\n``` docker run -d -p 2080:80 nginx:latest ```\n\n参数解释:\n ```-d``` : 后台运行\n ```-p``` : 端口映射 物理机port : 容器port\n\n### 查看容器状态\n``` docker ps -a ```\n参数解释:\n``` docker ps ```: 默认只能看到启动状态的容器\n``` -a ```: 查看所有容器, 包括已经停止的\n\n### 进入容器(正在运行的容器 !!!)\n``` docker exec -it hardcore_buck /bin/bash ```\n参数解释:\n```-i```: 交互式操作\n```-t```: 终端\n``` hardcore_buck ```: 容器名\n``` /bin/bash```: 进入容器后指定shell\n\n### 换一个例子(alpine)\n\n1) 下载\n``` docker pull alpine```\n\n![image.png](/images/028.docker_instances.md.01.png)\n\n2) 高级点运行\n``` docker run -d alpine /bin/sh -c \"while true; do echo `date \"+%H:%M:%S\"`; sleep 2; done\" ```\n\n\n\n","source":"_posts/028.docker_instances.md","raw":"---\ntitle: docker简单例子\ndate: 2022-11-4 16:49:13\ncategories: \n- [Docker]\ntags: \n- docker\n- 容器\n---\n\n### 下载一个容器(nginx为例)\n``` docker pull nginx```\n\n### 启动容器\n``` docker run -d -p 2080:80 nginx:latest ```\n\n参数解释:\n ```-d``` : 后台运行\n ```-p``` : 端口映射 物理机port : 容器port\n\n### 查看容器状态\n``` docker ps -a ```\n参数解释:\n``` docker ps ```: 默认只能看到启动状态的容器\n``` -a ```: 查看所有容器, 包括已经停止的\n\n### 进入容器(正在运行的容器 !!!)\n``` docker exec -it hardcore_buck /bin/bash ```\n参数解释:\n```-i```: 交互式操作\n```-t```: 终端\n``` hardcore_buck ```: 容器名\n``` /bin/bash```: 进入容器后指定shell\n\n### 换一个例子(alpine)\n\n1) 下载\n``` docker pull alpine```\n\n![image.png](/images/028.docker_instances.md.01.png)\n\n2) 高级点运行\n``` docker run -d alpine /bin/sh -c \"while true; do echo `date \"+%H:%M:%S\"`; sleep 2; done\" ```\n\n\n\n","slug":"028.docker_instances","published":1,"updated":"2023-12-05T08:52:30.877Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzc3002lijnr7m040u5a","content":"<h3 id=\"下载一个容器-nginx为例\"><a href=\"#下载一个容器-nginx为例\" class=\"headerlink\" title=\"下载一个容器(nginx为例)\"></a>下载一个容器(nginx为例)</h3><p><code> docker pull nginx</code></p>\n<h3 id=\"启动容器\"><a href=\"#启动容器\" class=\"headerlink\" title=\"启动容器\"></a>启动容器</h3><p><code>docker run -d -p 2080:80 nginx:latest</code></p>\n<p>参数解释:<br> <code>-d</code> : 后台运行<br> <code>-p</code> : 端口映射 物理机port : 容器port</p>\n<h3 id=\"查看容器状态\"><a href=\"#查看容器状态\" class=\"headerlink\" title=\"查看容器状态\"></a>查看容器状态</h3><p><code>docker ps -a</code><br>参数解释:<br><code>docker ps</code>: 默认只能看到启动状态的容器<br><code>-a</code>: 查看所有容器, 包括已经停止的</p>\n<h3 id=\"进入容器-正在运行的容器\"><a href=\"#进入容器-正在运行的容器\" class=\"headerlink\" title=\"进入容器(正在运行的容器 !!!)\"></a>进入容器(正在运行的容器 !!!)</h3><p><code>docker exec -it hardcore_buck /bin/bash</code><br>参数解释:<br><code>-i</code>: 交互式操作<br><code>-t</code>: 终端<br><code>hardcore_buck</code>: 容器名<br><code> /bin/bash</code>: 进入容器后指定shell</p>\n<h3 id=\"换一个例子-alpine\"><a href=\"#换一个例子-alpine\" class=\"headerlink\" title=\"换一个例子(alpine)\"></a>换一个例子(alpine)</h3><ol>\n<li>下载</li>\n</ol>\n<p><code> docker pull alpine</code></p>\n<p><img src=\"/images/028.docker_instances.md.01.png\" alt=\"image.png\"></p>\n<ol start=\"2\">\n<li>高级点运行</li>\n</ol>\n<p><code>docker run -d alpine /bin/sh -c &quot;while true; do echo `date &quot;+%H:%M:%S&quot;`; sleep 2; done&quot;</code></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"下载一个容器-nginx为例\"><a href=\"#下载一个容器-nginx为例\" class=\"headerlink\" title=\"下载一个容器(nginx为例)\"></a>下载一个容器(nginx为例)</h3><p><code> docker pull nginx</code></p>\n<h3 id=\"启动容器\"><a href=\"#启动容器\" class=\"headerlink\" title=\"启动容器\"></a>启动容器</h3><p><code>docker run -d -p 2080:80 nginx:latest</code></p>\n<p>参数解释:<br> <code>-d</code> : 后台运行<br> <code>-p</code> : 端口映射 物理机port : 容器port</p>\n<h3 id=\"查看容器状态\"><a href=\"#查看容器状态\" class=\"headerlink\" title=\"查看容器状态\"></a>查看容器状态</h3><p><code>docker ps -a</code><br>参数解释:<br><code>docker ps</code>: 默认只能看到启动状态的容器<br><code>-a</code>: 查看所有容器, 包括已经停止的</p>\n<h3 id=\"进入容器-正在运行的容器\"><a href=\"#进入容器-正在运行的容器\" class=\"headerlink\" title=\"进入容器(正在运行的容器 !!!)\"></a>进入容器(正在运行的容器 !!!)</h3><p><code>docker exec -it hardcore_buck /bin/bash</code><br>参数解释:<br><code>-i</code>: 交互式操作<br><code>-t</code>: 终端<br><code>hardcore_buck</code>: 容器名<br><code> /bin/bash</code>: 进入容器后指定shell</p>\n<h3 id=\"换一个例子-alpine\"><a href=\"#换一个例子-alpine\" class=\"headerlink\" title=\"换一个例子(alpine)\"></a>换一个例子(alpine)</h3><ol>\n<li>下载</li>\n</ol>\n<p><code> docker pull alpine</code></p>\n<p><img src=\"/images/028.docker_instances.md.01.png\" alt=\"image.png\"></p>\n<ol start=\"2\">\n<li>高级点运行</li>\n</ol>\n<p><code>docker run -d alpine /bin/sh -c &quot;while true; do echo `date &quot;+%H:%M:%S&quot;`; sleep 2; done&quot;</code></p>\n"},{"title":"telnet服务部署","date":"2022-10-09T02:54:13.000Z","_content":"\n### 升级ssh相关漏洞之前,确保还有其他方式登录到服务器。推荐安装telnet, 升级openssh之后关闭服务即可\n\n## 一: 使用xinetd配置telnet\n1) 安装 telnet\n\n``` bash\nyum install telnet\nyum install telnet-server\nyum install xinetd\n```\n\n2) 配置 telnet 服务端配置文件\n\n```/etc/xinetd.d/telnet ```\n\n``` disable = yes ``` ---> ``` disable = no ```\n前者是关闭telnet, 后者是开启telnet\n如果没有该文件, 请创建\n\n\n``` yml\nservice telnet\n{\n  flags = REUSE\n  socket_type = stream\n  wait = no\n  user = root\n  server =/usr/sbin/in.telnetd\n  log_on_failure += USERID\n  disable = no\n}\n```\n\n3) 重启 xinetd \n\n``` systemctl restart xinetd ```\n\n**xinetd作为telnet的守护进程, netstat可以看到23端口配xinetd占用**\n\n![image.png](/images/027.telnet.md.01.png)\n\n4) **telnet默认不支持root用户远程登录**\n\n\n5) 关闭 telnet 服务\n\n``` yml\nservice telnet\n{\n        flags = REUSE\n        socket_type = steram\n        wait = no\n        user = root\n        server = /usr/sbin/in/telnetd\n        log_on_failure += USERID\n        disable = yes  ## 修改这里\n}\n```\n\n``` systemctl restart xinetd ```\n\n\n## 二: 直接配置 telnet\n\n1) 安装 telnet\n\n``` yum install telnet telnet-server ```\n\n2) 启动 telnet\n\n``` systemctl start telnet.socket ```\n**systemd会作为守护进程启动telnet**\n\n![image.png](/images/027.telnet.md.02.png)\n\n3) 关闭 telnet\n\n```systemctl stop telnet.socket```","source":"_posts/027.telnet.md","raw":"---\ntitle: telnet服务部署\ndate: 2022-10-09 10:54:13\ncategories: \n- [Linux]\ntags: \n- telnet\n- xinetd\n---\n\n### 升级ssh相关漏洞之前,确保还有其他方式登录到服务器。推荐安装telnet, 升级openssh之后关闭服务即可\n\n## 一: 使用xinetd配置telnet\n1) 安装 telnet\n\n``` bash\nyum install telnet\nyum install telnet-server\nyum install xinetd\n```\n\n2) 配置 telnet 服务端配置文件\n\n```/etc/xinetd.d/telnet ```\n\n``` disable = yes ``` ---> ``` disable = no ```\n前者是关闭telnet, 后者是开启telnet\n如果没有该文件, 请创建\n\n\n``` yml\nservice telnet\n{\n  flags = REUSE\n  socket_type = stream\n  wait = no\n  user = root\n  server =/usr/sbin/in.telnetd\n  log_on_failure += USERID\n  disable = no\n}\n```\n\n3) 重启 xinetd \n\n``` systemctl restart xinetd ```\n\n**xinetd作为telnet的守护进程, netstat可以看到23端口配xinetd占用**\n\n![image.png](/images/027.telnet.md.01.png)\n\n4) **telnet默认不支持root用户远程登录**\n\n\n5) 关闭 telnet 服务\n\n``` yml\nservice telnet\n{\n        flags = REUSE\n        socket_type = steram\n        wait = no\n        user = root\n        server = /usr/sbin/in/telnetd\n        log_on_failure += USERID\n        disable = yes  ## 修改这里\n}\n```\n\n``` systemctl restart xinetd ```\n\n\n## 二: 直接配置 telnet\n\n1) 安装 telnet\n\n``` yum install telnet telnet-server ```\n\n2) 启动 telnet\n\n``` systemctl start telnet.socket ```\n**systemd会作为守护进程启动telnet**\n\n![image.png](/images/027.telnet.md.02.png)\n\n3) 关闭 telnet\n\n```systemctl stop telnet.socket```","slug":"027.telnet","published":1,"updated":"2023-12-05T08:52:30.877Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzc8002oijnr18x16lku","content":"<h3 id=\"升级ssh相关漏洞之前-确保还有其他方式登录到服务器。推荐安装telnet-升级openssh之后关闭服务即可\"><a href=\"#升级ssh相关漏洞之前-确保还有其他方式登录到服务器。推荐安装telnet-升级openssh之后关闭服务即可\" class=\"headerlink\" title=\"升级ssh相关漏洞之前,确保还有其他方式登录到服务器。推荐安装telnet, 升级openssh之后关闭服务即可\"></a>升级ssh相关漏洞之前,确保还有其他方式登录到服务器。推荐安装telnet, 升级openssh之后关闭服务即可</h3><h2 id=\"一-使用xinetd配置telnet\"><a href=\"#一-使用xinetd配置telnet\" class=\"headerlink\" title=\"一: 使用xinetd配置telnet\"></a>一: 使用xinetd配置telnet</h2><ol>\n<li>安装 telnet</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install telnet</span><br><span class=\"line\">yum install telnet-server</span><br><span class=\"line\">yum install xinetd</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>配置 telnet 服务端配置文件</li>\n</ol>\n<p><code>/etc/xinetd.d/telnet </code></p>\n<p><code>disable = yes</code> —&gt; <code>disable = no</code><br>前者是关闭telnet, 后者是开启telnet<br>如果没有该文件, 请创建</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">service</span> <span class=\"string\">telnet</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">flags</span> <span class=\"string\">=</span> <span class=\"string\">REUSE</span></span><br><span class=\"line\">  <span class=\"string\">socket_type</span> <span class=\"string\">=</span> <span class=\"string\">stream</span></span><br><span class=\"line\">  <span class=\"string\">wait</span> <span class=\"string\">=</span> <span class=\"literal\">no</span></span><br><span class=\"line\">  <span class=\"string\">user</span> <span class=\"string\">=</span> <span class=\"string\">root</span></span><br><span class=\"line\">  <span class=\"string\">server</span> <span class=\"string\">=/usr/sbin/in.telnetd</span></span><br><span class=\"line\">  <span class=\"string\">log_on_failure</span> <span class=\"string\">+=</span> <span class=\"string\">USERID</span></span><br><span class=\"line\">  <span class=\"string\">disable</span> <span class=\"string\">=</span> <span class=\"literal\">no</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>重启 xinetd</li>\n</ol>\n<p><code>systemctl restart xinetd</code></p>\n<p><strong>xinetd作为telnet的守护进程, netstat可以看到23端口配xinetd占用</strong></p>\n<p><img src=\"/images/027.telnet.md.01.png\" alt=\"image.png\"></p>\n<ol start=\"4\">\n<li><p><strong>telnet默认不支持root用户远程登录</strong></p>\n</li>\n<li><p>关闭 telnet 服务</p>\n</li>\n</ol>\n<figure class=\"highlight yml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">service</span> <span class=\"string\">telnet</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">        <span class=\"string\">flags</span> <span class=\"string\">=</span> <span class=\"string\">REUSE</span></span><br><span class=\"line\">        <span class=\"string\">socket_type</span> <span class=\"string\">=</span> <span class=\"string\">steram</span></span><br><span class=\"line\">        <span class=\"string\">wait</span> <span class=\"string\">=</span> <span class=\"literal\">no</span></span><br><span class=\"line\">        <span class=\"string\">user</span> <span class=\"string\">=</span> <span class=\"string\">root</span></span><br><span class=\"line\">        <span class=\"string\">server</span> <span class=\"string\">=</span> <span class=\"string\">/usr/sbin/in/telnetd</span></span><br><span class=\"line\">        <span class=\"string\">log_on_failure</span> <span class=\"string\">+=</span> <span class=\"string\">USERID</span></span><br><span class=\"line\">        <span class=\"string\">disable</span> <span class=\"string\">=</span> <span class=\"literal\">yes</span>  <span class=\"comment\">## 修改这里</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>systemctl restart xinetd</code></p>\n<h2 id=\"二-直接配置-telnet\"><a href=\"#二-直接配置-telnet\" class=\"headerlink\" title=\"二: 直接配置 telnet\"></a>二: 直接配置 telnet</h2><ol>\n<li>安装 telnet</li>\n</ol>\n<p><code>yum install telnet telnet-server</code></p>\n<ol start=\"2\">\n<li>启动 telnet</li>\n</ol>\n<p><code>systemctl start telnet.socket</code><br><strong>systemd会作为守护进程启动telnet</strong></p>\n<p><img src=\"/images/027.telnet.md.02.png\" alt=\"image.png\"></p>\n<ol start=\"3\">\n<li>关闭 telnet</li>\n</ol>\n<p><code>systemctl stop telnet.socket</code></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"升级ssh相关漏洞之前-确保还有其他方式登录到服务器。推荐安装telnet-升级openssh之后关闭服务即可\"><a href=\"#升级ssh相关漏洞之前-确保还有其他方式登录到服务器。推荐安装telnet-升级openssh之后关闭服务即可\" class=\"headerlink\" title=\"升级ssh相关漏洞之前,确保还有其他方式登录到服务器。推荐安装telnet, 升级openssh之后关闭服务即可\"></a>升级ssh相关漏洞之前,确保还有其他方式登录到服务器。推荐安装telnet, 升级openssh之后关闭服务即可</h3><h2 id=\"一-使用xinetd配置telnet\"><a href=\"#一-使用xinetd配置telnet\" class=\"headerlink\" title=\"一: 使用xinetd配置telnet\"></a>一: 使用xinetd配置telnet</h2><ol>\n<li>安装 telnet</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install telnet</span><br><span class=\"line\">yum install telnet-server</span><br><span class=\"line\">yum install xinetd</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>配置 telnet 服务端配置文件</li>\n</ol>\n<p><code>/etc/xinetd.d/telnet </code></p>\n<p><code>disable = yes</code> —&gt; <code>disable = no</code><br>前者是关闭telnet, 后者是开启telnet<br>如果没有该文件, 请创建</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">service</span> <span class=\"string\">telnet</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">flags</span> <span class=\"string\">=</span> <span class=\"string\">REUSE</span></span><br><span class=\"line\">  <span class=\"string\">socket_type</span> <span class=\"string\">=</span> <span class=\"string\">stream</span></span><br><span class=\"line\">  <span class=\"string\">wait</span> <span class=\"string\">=</span> <span class=\"literal\">no</span></span><br><span class=\"line\">  <span class=\"string\">user</span> <span class=\"string\">=</span> <span class=\"string\">root</span></span><br><span class=\"line\">  <span class=\"string\">server</span> <span class=\"string\">=/usr/sbin/in.telnetd</span></span><br><span class=\"line\">  <span class=\"string\">log_on_failure</span> <span class=\"string\">+=</span> <span class=\"string\">USERID</span></span><br><span class=\"line\">  <span class=\"string\">disable</span> <span class=\"string\">=</span> <span class=\"literal\">no</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>重启 xinetd</li>\n</ol>\n<p><code>systemctl restart xinetd</code></p>\n<p><strong>xinetd作为telnet的守护进程, netstat可以看到23端口配xinetd占用</strong></p>\n<p><img src=\"/images/027.telnet.md.01.png\" alt=\"image.png\"></p>\n<ol start=\"4\">\n<li><p><strong>telnet默认不支持root用户远程登录</strong></p>\n</li>\n<li><p>关闭 telnet 服务</p>\n</li>\n</ol>\n<figure class=\"highlight yml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">service</span> <span class=\"string\">telnet</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">        <span class=\"string\">flags</span> <span class=\"string\">=</span> <span class=\"string\">REUSE</span></span><br><span class=\"line\">        <span class=\"string\">socket_type</span> <span class=\"string\">=</span> <span class=\"string\">steram</span></span><br><span class=\"line\">        <span class=\"string\">wait</span> <span class=\"string\">=</span> <span class=\"literal\">no</span></span><br><span class=\"line\">        <span class=\"string\">user</span> <span class=\"string\">=</span> <span class=\"string\">root</span></span><br><span class=\"line\">        <span class=\"string\">server</span> <span class=\"string\">=</span> <span class=\"string\">/usr/sbin/in/telnetd</span></span><br><span class=\"line\">        <span class=\"string\">log_on_failure</span> <span class=\"string\">+=</span> <span class=\"string\">USERID</span></span><br><span class=\"line\">        <span class=\"string\">disable</span> <span class=\"string\">=</span> <span class=\"literal\">yes</span>  <span class=\"comment\">## 修改这里</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>systemctl restart xinetd</code></p>\n<h2 id=\"二-直接配置-telnet\"><a href=\"#二-直接配置-telnet\" class=\"headerlink\" title=\"二: 直接配置 telnet\"></a>二: 直接配置 telnet</h2><ol>\n<li>安装 telnet</li>\n</ol>\n<p><code>yum install telnet telnet-server</code></p>\n<ol start=\"2\">\n<li>启动 telnet</li>\n</ol>\n<p><code>systemctl start telnet.socket</code><br><strong>systemd会作为守护进程启动telnet</strong></p>\n<p><img src=\"/images/027.telnet.md.02.png\" alt=\"image.png\"></p>\n<ol start=\"3\">\n<li>关闭 telnet</li>\n</ol>\n<p><code>systemctl stop telnet.socket</code></p>\n"},{"title":"php7.4.33 编译安装","date":"2022-11-22T06:51:13.000Z","_content":"\n# 一、 下载\n```wget https://www.php.net/distributions/php-7.4.33.tar.gz```\n\n# 二、 安装依赖\n``` yum install gcc gcc++ gcc-c++ libxml2-devel libicu-devel sqlite-devel oniguruma oniguruma-devel autoconf zip unzip openssl-devel libcurl-devel libpng-devel libjpeg-devel freetype-devel libxslt-devel ```\n\n##   安装libzip\n\n## 2.1 删除原有libzip\n``` yum remove libzip```\n\n## 2.2 下载指定版本的libzip\n``` wget --no-check-certificate https://nih.at/libzip/libzip-1.2.0.tar.gz```\n\n## 2.3 安装libzip1.2.0\n``` bash \ntar -xzvf libzip-1.2.0.tar.gz ```\ncd libzip-1.2.0 ```\n./configure --prefix=/usr/local/libzip-1.2.0 ```\nmake && make install \n```\n\n## 2.4 配置环境\n``` export PKG_CONFIG_PATH=\"/usr/local/libzip-1.2.0/lib/pkgconfig/\" ```\n\n\n# 三、 编译安装\n``` bash\ntar -xzvf php-7.4.33.tar.gz\ncd php-7.4.33\n./configure \\\n--prefix=/usr/local/php7.4 --with-config-file-path=/usr/local/php7.4/etc \\\n--enable-fpm --enable-mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd \\\n--enable-pdo --with-iconv-dir  --with-freetype --with-jpeg --with-zlib \\\n--enable-xml --enable-session --disable-rpath --enable-bcmath --enable-shmop \\\n--enable-sysvsem --enable-inline-optimization --with-curl --enable-mbregex \\\n--enable-mbstring --enable-intl --enable-pcntl --enable-bcmath --enable-ftp \\\n--enable-gd --with-openssl --with-mhash --enable-pcntl --enable-sockets \\\n--with-xmlrpc --with-zip --enable-soap --with-gettext --disable-fileinfo \\\n--enable-opcache --enable-maintainer-zts --with-xsl --enable-tokenizer\nmake && make install \n``` \n\n## 关于编译配置选项\n> 关于一些配置项, 可以参考php的[官方文档](https://www.php.net/manual/zh/configure.about.php)\n或者运行 ./configure --help 命令\n\n\n## 3.1 配置 php\n``` ln -s /usr/local/php7.4/bin/php /usr/bin/php ```\n``` cat $PATH_OF_PHP_SOURCE_FOLDER/php.ini-development >  /usr/local/php7.4/etc/php.ini ```\n{% label success@行:962%}  ```date.timezone = Asia/Shanghai```\n\n## 3.2 配置 php-fpm\n``` ln -s /usr/local/php7.4/sbin/php-fpm /usr/bin/php-fpm ```\n``` cd /usr/local/php7.4/etc ```\n``` cp php-fpm.conf.default php-fpm.conf ```\n\n## 3.3 配置 php-fpm 用户文件\n\n``` cd /usr/local/php7.4/etc/php-fpm.d ```\n``` cp www.conf.default www.conf ``` \n\n## 3.4 使用 systemctl 管理 php-fpm\n\n``` bash\n# vim /usr/lib/systemd/system/php74-fpm.service\n\n[Unit]\nDescription=The PHP 7.4 FastCGI Process Manager\nDocumentation=man:php-fpm7.4\nAfter=network.target\n\n[Service]\nType=simple\nPIDFile=/var/run/php74-fpm.pid\nExecStart=/usr/local/php74/sbin/php-fpm --nodaemonize --fpm-config /usr/local/php74/etc/php-fpm.conf\nExecReload=/bin/kill -USR2 $MAINPID\n\n[Install]\nWantedBy=multi-user.target\n\n```\n# 四、 相关问题\n## 4.1  error: Package requirements (openssl >= 1.0.1) were not met\n\n解决: ``` yum install openssl-devel```\n\n## 4.2 error: Package requirements (libcurl >= 7.15.5) were not met\n\n解决: ``` yum install libcurl-devel ```\n\n## 4.3 error: Package requirements (libpng) were not met\n\n解决: ``` yum install libpng-devel ```\n\n## 4.4 error: Package requirements (libjpeg) were not met\n\n解决: ``` yum install  libjpeg-devel```\n\n## 4.5 error: Package requirements (freetype2) were not met\n\n解决: ``` yum install freetype-devel```\n\n## 4.6 configure: error: C++ preprocessor \"/lib/cpp\" fails sanity check\n\n解决: ``` yum install gcc-c++ ```\n\n## 4.7 error: Package requirements (libxslt >= 1.1.0) were not met\n\n解决: ``` yum install libxslt-devel ```\n\n\n\n\n","source":"_posts/029.install_php7.4.33.md","raw":"---\ntitle: php7.4.33 编译安装\ndate: 2022-11-22 14:51:13\ncategories: \n- [Linux]\ntags: \n- php\n---\n\n# 一、 下载\n```wget https://www.php.net/distributions/php-7.4.33.tar.gz```\n\n# 二、 安装依赖\n``` yum install gcc gcc++ gcc-c++ libxml2-devel libicu-devel sqlite-devel oniguruma oniguruma-devel autoconf zip unzip openssl-devel libcurl-devel libpng-devel libjpeg-devel freetype-devel libxslt-devel ```\n\n##   安装libzip\n\n## 2.1 删除原有libzip\n``` yum remove libzip```\n\n## 2.2 下载指定版本的libzip\n``` wget --no-check-certificate https://nih.at/libzip/libzip-1.2.0.tar.gz```\n\n## 2.3 安装libzip1.2.0\n``` bash \ntar -xzvf libzip-1.2.0.tar.gz ```\ncd libzip-1.2.0 ```\n./configure --prefix=/usr/local/libzip-1.2.0 ```\nmake && make install \n```\n\n## 2.4 配置环境\n``` export PKG_CONFIG_PATH=\"/usr/local/libzip-1.2.0/lib/pkgconfig/\" ```\n\n\n# 三、 编译安装\n``` bash\ntar -xzvf php-7.4.33.tar.gz\ncd php-7.4.33\n./configure \\\n--prefix=/usr/local/php7.4 --with-config-file-path=/usr/local/php7.4/etc \\\n--enable-fpm --enable-mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd \\\n--enable-pdo --with-iconv-dir  --with-freetype --with-jpeg --with-zlib \\\n--enable-xml --enable-session --disable-rpath --enable-bcmath --enable-shmop \\\n--enable-sysvsem --enable-inline-optimization --with-curl --enable-mbregex \\\n--enable-mbstring --enable-intl --enable-pcntl --enable-bcmath --enable-ftp \\\n--enable-gd --with-openssl --with-mhash --enable-pcntl --enable-sockets \\\n--with-xmlrpc --with-zip --enable-soap --with-gettext --disable-fileinfo \\\n--enable-opcache --enable-maintainer-zts --with-xsl --enable-tokenizer\nmake && make install \n``` \n\n## 关于编译配置选项\n> 关于一些配置项, 可以参考php的[官方文档](https://www.php.net/manual/zh/configure.about.php)\n或者运行 ./configure --help 命令\n\n\n## 3.1 配置 php\n``` ln -s /usr/local/php7.4/bin/php /usr/bin/php ```\n``` cat $PATH_OF_PHP_SOURCE_FOLDER/php.ini-development >  /usr/local/php7.4/etc/php.ini ```\n{% label success@行:962%}  ```date.timezone = Asia/Shanghai```\n\n## 3.2 配置 php-fpm\n``` ln -s /usr/local/php7.4/sbin/php-fpm /usr/bin/php-fpm ```\n``` cd /usr/local/php7.4/etc ```\n``` cp php-fpm.conf.default php-fpm.conf ```\n\n## 3.3 配置 php-fpm 用户文件\n\n``` cd /usr/local/php7.4/etc/php-fpm.d ```\n``` cp www.conf.default www.conf ``` \n\n## 3.4 使用 systemctl 管理 php-fpm\n\n``` bash\n# vim /usr/lib/systemd/system/php74-fpm.service\n\n[Unit]\nDescription=The PHP 7.4 FastCGI Process Manager\nDocumentation=man:php-fpm7.4\nAfter=network.target\n\n[Service]\nType=simple\nPIDFile=/var/run/php74-fpm.pid\nExecStart=/usr/local/php74/sbin/php-fpm --nodaemonize --fpm-config /usr/local/php74/etc/php-fpm.conf\nExecReload=/bin/kill -USR2 $MAINPID\n\n[Install]\nWantedBy=multi-user.target\n\n```\n# 四、 相关问题\n## 4.1  error: Package requirements (openssl >= 1.0.1) were not met\n\n解决: ``` yum install openssl-devel```\n\n## 4.2 error: Package requirements (libcurl >= 7.15.5) were not met\n\n解决: ``` yum install libcurl-devel ```\n\n## 4.3 error: Package requirements (libpng) were not met\n\n解决: ``` yum install libpng-devel ```\n\n## 4.4 error: Package requirements (libjpeg) were not met\n\n解决: ``` yum install  libjpeg-devel```\n\n## 4.5 error: Package requirements (freetype2) were not met\n\n解决: ``` yum install freetype-devel```\n\n## 4.6 configure: error: C++ preprocessor \"/lib/cpp\" fails sanity check\n\n解决: ``` yum install gcc-c++ ```\n\n## 4.7 error: Package requirements (libxslt >= 1.1.0) were not met\n\n解决: ``` yum install libxslt-devel ```\n\n\n\n\n","slug":"029.install_php7.4.33","published":1,"updated":"2023-12-05T08:52:30.877Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzce002sijnrexcse04s","content":"<h1 id=\"一、-下载\"><a href=\"#一、-下载\" class=\"headerlink\" title=\"一、 下载\"></a>一、 下载</h1><p><code>wget https://www.php.net/distributions/php-7.4.33.tar.gz</code></p>\n<h1 id=\"二、-安装依赖\"><a href=\"#二、-安装依赖\" class=\"headerlink\" title=\"二、 安装依赖\"></a>二、 安装依赖</h1><p><code>yum install gcc gcc++ gcc-c++ libxml2-devel libicu-devel sqlite-devel oniguruma oniguruma-devel autoconf zip unzip openssl-devel libcurl-devel libpng-devel libjpeg-devel freetype-devel libxslt-devel</code></p>\n<h2 id=\"安装libzip\"><a href=\"#安装libzip\" class=\"headerlink\" title=\"安装libzip\"></a>安装libzip</h2><h2 id=\"2-1-删除原有libzip\"><a href=\"#2-1-删除原有libzip\" class=\"headerlink\" title=\"2.1 删除原有libzip\"></a>2.1 删除原有libzip</h2><p><code> yum remove libzip</code></p>\n<h2 id=\"2-2-下载指定版本的libzip\"><a href=\"#2-2-下载指定版本的libzip\" class=\"headerlink\" title=\"2.2 下载指定版本的libzip\"></a>2.2 下载指定版本的libzip</h2><p><code> wget --no-check-certificate https://nih.at/libzip/libzip-1.2.0.tar.gz</code></p>\n<h2 id=\"2-3-安装libzip1-2-0\"><a href=\"#2-3-安装libzip1-2-0\" class=\"headerlink\" title=\"2.3 安装libzip1.2.0\"></a>2.3 安装libzip1.2.0</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">tar -xzvf libzip-1.2.0.tar.gz ```</span><br><span class=\"line\"><span class=\"built_in\">cd</span> libzip-1.2.0 ```</span><br><span class=\"line\">./configure --prefix=/usr/local/libzip-1.2.0 ```</span><br><span class=\"line\">make &amp;&amp; make install </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-4-配置环境\"><a href=\"#2-4-配置环境\" class=\"headerlink\" title=\"2.4 配置环境\"></a>2.4 配置环境</h2><p><code>export PKG_CONFIG_PATH=&quot;/usr/local/libzip-1.2.0/lib/pkgconfig/&quot;</code></p>\n<h1 id=\"三、-编译安装\"><a href=\"#三、-编译安装\" class=\"headerlink\" title=\"三、 编译安装\"></a>三、 编译安装</h1><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">tar -xzvf php-7.4.33.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> php-7.4.33</span><br><span class=\"line\">./configure \\</span><br><span class=\"line\">--prefix=/usr/local/php7.4 --with-config-file-path=/usr/local/php7.4/etc \\</span><br><span class=\"line\">--enable-fpm --enable-mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd \\</span><br><span class=\"line\">--enable-pdo --with-iconv-dir  --with-freetype --with-jpeg --with-zlib \\</span><br><span class=\"line\">--enable-xml --enable-session --disable-rpath --enable-bcmath --enable-shmop \\</span><br><span class=\"line\">--enable-sysvsem --enable-inline-optimization --with-curl --enable-mbregex \\</span><br><span class=\"line\">--enable-mbstring --enable-intl --enable-pcntl --enable-bcmath --enable-ftp \\</span><br><span class=\"line\">--enable-gd --with-openssl --with-mhash --enable-pcntl --enable-sockets \\</span><br><span class=\"line\">--with-xmlrpc --with-zip --enable-soap --with-gettext --disable-fileinfo \\</span><br><span class=\"line\">--enable-opcache --enable-maintainer-zts --with-xsl --enable-tokenizer</span><br><span class=\"line\">make &amp;&amp; make install </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"关于编译配置选项\"><a href=\"#关于编译配置选项\" class=\"headerlink\" title=\"关于编译配置选项\"></a>关于编译配置选项</h2><blockquote>\n<p>关于一些配置项, 可以参考php的<a href=\"https://www.php.net/manual/zh/configure.about.php\">官方文档</a><br>或者运行 .&#x2F;configure –help 命令</p>\n</blockquote>\n<h2 id=\"3-1-配置-php\"><a href=\"#3-1-配置-php\" class=\"headerlink\" title=\"3.1 配置 php\"></a>3.1 配置 php</h2><p><code>ln -s /usr/local/php7.4/bin/php /usr/bin/php</code><br><code>cat $PATH_OF_PHP_SOURCE_FOLDER/php.ini-development &gt;  /usr/local/php7.4/etc/php.ini</code></p>\n<mark class=\"label success\">行:962</mark>  ```date.timezone = Asia/Shanghai```\n\n<h2 id=\"3-2-配置-php-fpm\"><a href=\"#3-2-配置-php-fpm\" class=\"headerlink\" title=\"3.2 配置 php-fpm\"></a>3.2 配置 php-fpm</h2><p><code>ln -s /usr/local/php7.4/sbin/php-fpm /usr/bin/php-fpm</code><br><code>cd /usr/local/php7.4/etc</code><br><code>cp php-fpm.conf.default php-fpm.conf</code></p>\n<h2 id=\"3-3-配置-php-fpm-用户文件\"><a href=\"#3-3-配置-php-fpm-用户文件\" class=\"headerlink\" title=\"3.3 配置 php-fpm 用户文件\"></a>3.3 配置 php-fpm 用户文件</h2><p><code>cd /usr/local/php7.4/etc/php-fpm.d</code><br><code>cp www.conf.default www.conf</code> </p>\n<h2 id=\"3-4-使用-systemctl-管理-php-fpm\"><a href=\"#3-4-使用-systemctl-管理-php-fpm\" class=\"headerlink\" title=\"3.4 使用 systemctl 管理 php-fpm\"></a>3.4 使用 systemctl 管理 php-fpm</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># vim /usr/lib/systemd/system/php74-fpm.service</span></span><br><span class=\"line\"></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=The PHP 7.4 FastCGI Process Manager</span><br><span class=\"line\">Documentation=man:php-fpm7.4</span><br><span class=\"line\">After=network.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=simple</span><br><span class=\"line\">PIDFile=/var/run/php74-fpm.pid</span><br><span class=\"line\">ExecStart=/usr/local/php74/sbin/php-fpm --nodaemonize --fpm-config /usr/local/php74/etc/php-fpm.conf</span><br><span class=\"line\">ExecReload=/bin/kill -USR2 <span class=\"variable\">$MAINPID</span></span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h1 id=\"四、-相关问题\"><a href=\"#四、-相关问题\" class=\"headerlink\" title=\"四、 相关问题\"></a>四、 相关问题</h1><h2 id=\"4-1-error-Package-requirements-openssl-1-0-1-were-not-met\"><a href=\"#4-1-error-Package-requirements-openssl-1-0-1-were-not-met\" class=\"headerlink\" title=\"4.1  error: Package requirements (openssl &gt;&#x3D; 1.0.1) were not met\"></a>4.1  error: Package requirements (openssl &gt;&#x3D; 1.0.1) were not met</h2><p>解决: <code> yum install openssl-devel</code></p>\n<h2 id=\"4-2-error-Package-requirements-libcurl-7-15-5-were-not-met\"><a href=\"#4-2-error-Package-requirements-libcurl-7-15-5-were-not-met\" class=\"headerlink\" title=\"4.2 error: Package requirements (libcurl &gt;&#x3D; 7.15.5) were not met\"></a>4.2 error: Package requirements (libcurl &gt;&#x3D; 7.15.5) were not met</h2><p>解决: <code>yum install libcurl-devel</code></p>\n<h2 id=\"4-3-error-Package-requirements-libpng-were-not-met\"><a href=\"#4-3-error-Package-requirements-libpng-were-not-met\" class=\"headerlink\" title=\"4.3 error: Package requirements (libpng) were not met\"></a>4.3 error: Package requirements (libpng) were not met</h2><p>解决: <code>yum install libpng-devel</code></p>\n<h2 id=\"4-4-error-Package-requirements-libjpeg-were-not-met\"><a href=\"#4-4-error-Package-requirements-libjpeg-were-not-met\" class=\"headerlink\" title=\"4.4 error: Package requirements (libjpeg) were not met\"></a>4.4 error: Package requirements (libjpeg) were not met</h2><p>解决: <code> yum install  libjpeg-devel</code></p>\n<h2 id=\"4-5-error-Package-requirements-freetype2-were-not-met\"><a href=\"#4-5-error-Package-requirements-freetype2-were-not-met\" class=\"headerlink\" title=\"4.5 error: Package requirements (freetype2) were not met\"></a>4.5 error: Package requirements (freetype2) were not met</h2><p>解决: <code> yum install freetype-devel</code></p>\n<h2 id=\"4-6-configure-error-C-preprocessor-“-lib-cpp”-fails-sanity-check\"><a href=\"#4-6-configure-error-C-preprocessor-“-lib-cpp”-fails-sanity-check\" class=\"headerlink\" title=\"4.6 configure: error: C++ preprocessor “&#x2F;lib&#x2F;cpp” fails sanity check\"></a>4.6 configure: error: C++ preprocessor “&#x2F;lib&#x2F;cpp” fails sanity check</h2><p>解决: <code>yum install gcc-c++</code></p>\n<h2 id=\"4-7-error-Package-requirements-libxslt-1-1-0-were-not-met\"><a href=\"#4-7-error-Package-requirements-libxslt-1-1-0-were-not-met\" class=\"headerlink\" title=\"4.7 error: Package requirements (libxslt &gt;&#x3D; 1.1.0) were not met\"></a>4.7 error: Package requirements (libxslt &gt;&#x3D; 1.1.0) were not met</h2><p>解决: <code>yum install libxslt-devel</code></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"一、-下载\"><a href=\"#一、-下载\" class=\"headerlink\" title=\"一、 下载\"></a>一、 下载</h1><p><code>wget https://www.php.net/distributions/php-7.4.33.tar.gz</code></p>\n<h1 id=\"二、-安装依赖\"><a href=\"#二、-安装依赖\" class=\"headerlink\" title=\"二、 安装依赖\"></a>二、 安装依赖</h1><p><code>yum install gcc gcc++ gcc-c++ libxml2-devel libicu-devel sqlite-devel oniguruma oniguruma-devel autoconf zip unzip openssl-devel libcurl-devel libpng-devel libjpeg-devel freetype-devel libxslt-devel</code></p>\n<h2 id=\"安装libzip\"><a href=\"#安装libzip\" class=\"headerlink\" title=\"安装libzip\"></a>安装libzip</h2><h2 id=\"2-1-删除原有libzip\"><a href=\"#2-1-删除原有libzip\" class=\"headerlink\" title=\"2.1 删除原有libzip\"></a>2.1 删除原有libzip</h2><p><code> yum remove libzip</code></p>\n<h2 id=\"2-2-下载指定版本的libzip\"><a href=\"#2-2-下载指定版本的libzip\" class=\"headerlink\" title=\"2.2 下载指定版本的libzip\"></a>2.2 下载指定版本的libzip</h2><p><code> wget --no-check-certificate https://nih.at/libzip/libzip-1.2.0.tar.gz</code></p>\n<h2 id=\"2-3-安装libzip1-2-0\"><a href=\"#2-3-安装libzip1-2-0\" class=\"headerlink\" title=\"2.3 安装libzip1.2.0\"></a>2.3 安装libzip1.2.0</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">tar -xzvf libzip-1.2.0.tar.gz ```</span><br><span class=\"line\"><span class=\"built_in\">cd</span> libzip-1.2.0 ```</span><br><span class=\"line\">./configure --prefix=/usr/local/libzip-1.2.0 ```</span><br><span class=\"line\">make &amp;&amp; make install </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-4-配置环境\"><a href=\"#2-4-配置环境\" class=\"headerlink\" title=\"2.4 配置环境\"></a>2.4 配置环境</h2><p><code>export PKG_CONFIG_PATH=&quot;/usr/local/libzip-1.2.0/lib/pkgconfig/&quot;</code></p>\n<h1 id=\"三、-编译安装\"><a href=\"#三、-编译安装\" class=\"headerlink\" title=\"三、 编译安装\"></a>三、 编译安装</h1><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">tar -xzvf php-7.4.33.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> php-7.4.33</span><br><span class=\"line\">./configure \\</span><br><span class=\"line\">--prefix=/usr/local/php7.4 --with-config-file-path=/usr/local/php7.4/etc \\</span><br><span class=\"line\">--enable-fpm --enable-mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd \\</span><br><span class=\"line\">--enable-pdo --with-iconv-dir  --with-freetype --with-jpeg --with-zlib \\</span><br><span class=\"line\">--enable-xml --enable-session --disable-rpath --enable-bcmath --enable-shmop \\</span><br><span class=\"line\">--enable-sysvsem --enable-inline-optimization --with-curl --enable-mbregex \\</span><br><span class=\"line\">--enable-mbstring --enable-intl --enable-pcntl --enable-bcmath --enable-ftp \\</span><br><span class=\"line\">--enable-gd --with-openssl --with-mhash --enable-pcntl --enable-sockets \\</span><br><span class=\"line\">--with-xmlrpc --with-zip --enable-soap --with-gettext --disable-fileinfo \\</span><br><span class=\"line\">--enable-opcache --enable-maintainer-zts --with-xsl --enable-tokenizer</span><br><span class=\"line\">make &amp;&amp; make install </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"关于编译配置选项\"><a href=\"#关于编译配置选项\" class=\"headerlink\" title=\"关于编译配置选项\"></a>关于编译配置选项</h2><blockquote>\n<p>关于一些配置项, 可以参考php的<a href=\"https://www.php.net/manual/zh/configure.about.php\">官方文档</a><br>或者运行 .&#x2F;configure –help 命令</p>\n</blockquote>\n<h2 id=\"3-1-配置-php\"><a href=\"#3-1-配置-php\" class=\"headerlink\" title=\"3.1 配置 php\"></a>3.1 配置 php</h2><p><code>ln -s /usr/local/php7.4/bin/php /usr/bin/php</code><br><code>cat $PATH_OF_PHP_SOURCE_FOLDER/php.ini-development &gt;  /usr/local/php7.4/etc/php.ini</code></p>\n<mark class=\"label success\">行:962</mark>  ```date.timezone = Asia/Shanghai```\n\n<h2 id=\"3-2-配置-php-fpm\"><a href=\"#3-2-配置-php-fpm\" class=\"headerlink\" title=\"3.2 配置 php-fpm\"></a>3.2 配置 php-fpm</h2><p><code>ln -s /usr/local/php7.4/sbin/php-fpm /usr/bin/php-fpm</code><br><code>cd /usr/local/php7.4/etc</code><br><code>cp php-fpm.conf.default php-fpm.conf</code></p>\n<h2 id=\"3-3-配置-php-fpm-用户文件\"><a href=\"#3-3-配置-php-fpm-用户文件\" class=\"headerlink\" title=\"3.3 配置 php-fpm 用户文件\"></a>3.3 配置 php-fpm 用户文件</h2><p><code>cd /usr/local/php7.4/etc/php-fpm.d</code><br><code>cp www.conf.default www.conf</code> </p>\n<h2 id=\"3-4-使用-systemctl-管理-php-fpm\"><a href=\"#3-4-使用-systemctl-管理-php-fpm\" class=\"headerlink\" title=\"3.4 使用 systemctl 管理 php-fpm\"></a>3.4 使用 systemctl 管理 php-fpm</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># vim /usr/lib/systemd/system/php74-fpm.service</span></span><br><span class=\"line\"></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=The PHP 7.4 FastCGI Process Manager</span><br><span class=\"line\">Documentation=man:php-fpm7.4</span><br><span class=\"line\">After=network.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=simple</span><br><span class=\"line\">PIDFile=/var/run/php74-fpm.pid</span><br><span class=\"line\">ExecStart=/usr/local/php74/sbin/php-fpm --nodaemonize --fpm-config /usr/local/php74/etc/php-fpm.conf</span><br><span class=\"line\">ExecReload=/bin/kill -USR2 <span class=\"variable\">$MAINPID</span></span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h1 id=\"四、-相关问题\"><a href=\"#四、-相关问题\" class=\"headerlink\" title=\"四、 相关问题\"></a>四、 相关问题</h1><h2 id=\"4-1-error-Package-requirements-openssl-1-0-1-were-not-met\"><a href=\"#4-1-error-Package-requirements-openssl-1-0-1-were-not-met\" class=\"headerlink\" title=\"4.1  error: Package requirements (openssl &gt;&#x3D; 1.0.1) were not met\"></a>4.1  error: Package requirements (openssl &gt;&#x3D; 1.0.1) were not met</h2><p>解决: <code> yum install openssl-devel</code></p>\n<h2 id=\"4-2-error-Package-requirements-libcurl-7-15-5-were-not-met\"><a href=\"#4-2-error-Package-requirements-libcurl-7-15-5-were-not-met\" class=\"headerlink\" title=\"4.2 error: Package requirements (libcurl &gt;&#x3D; 7.15.5) were not met\"></a>4.2 error: Package requirements (libcurl &gt;&#x3D; 7.15.5) were not met</h2><p>解决: <code>yum install libcurl-devel</code></p>\n<h2 id=\"4-3-error-Package-requirements-libpng-were-not-met\"><a href=\"#4-3-error-Package-requirements-libpng-were-not-met\" class=\"headerlink\" title=\"4.3 error: Package requirements (libpng) were not met\"></a>4.3 error: Package requirements (libpng) were not met</h2><p>解决: <code>yum install libpng-devel</code></p>\n<h2 id=\"4-4-error-Package-requirements-libjpeg-were-not-met\"><a href=\"#4-4-error-Package-requirements-libjpeg-were-not-met\" class=\"headerlink\" title=\"4.4 error: Package requirements (libjpeg) were not met\"></a>4.4 error: Package requirements (libjpeg) were not met</h2><p>解决: <code> yum install  libjpeg-devel</code></p>\n<h2 id=\"4-5-error-Package-requirements-freetype2-were-not-met\"><a href=\"#4-5-error-Package-requirements-freetype2-were-not-met\" class=\"headerlink\" title=\"4.5 error: Package requirements (freetype2) were not met\"></a>4.5 error: Package requirements (freetype2) were not met</h2><p>解决: <code> yum install freetype-devel</code></p>\n<h2 id=\"4-6-configure-error-C-preprocessor-“-lib-cpp”-fails-sanity-check\"><a href=\"#4-6-configure-error-C-preprocessor-“-lib-cpp”-fails-sanity-check\" class=\"headerlink\" title=\"4.6 configure: error: C++ preprocessor “&#x2F;lib&#x2F;cpp” fails sanity check\"></a>4.6 configure: error: C++ preprocessor “&#x2F;lib&#x2F;cpp” fails sanity check</h2><p>解决: <code>yum install gcc-c++</code></p>\n<h2 id=\"4-7-error-Package-requirements-libxslt-1-1-0-were-not-met\"><a href=\"#4-7-error-Package-requirements-libxslt-1-1-0-were-not-met\" class=\"headerlink\" title=\"4.7 error: Package requirements (libxslt &gt;&#x3D; 1.1.0) were not met\"></a>4.7 error: Package requirements (libxslt &gt;&#x3D; 1.1.0) were not met</h2><p>解决: <code>yum install libxslt-devel</code></p>\n"},{"title":"nextcloud 部署","date":"2022-11-23T05:08:13.000Z","_content":"\n\n## 安装 php\nhttps://blog.mdzz.wang/2022/11/22/029.install_php7.4.33/\n\n## 安装 nginx\n\n``` yum install nginx ```\n\n## 安装 mariadb\n\n``` yum install mariadb mariadb-server ```\n\n## 安装 nextcloud \n\n1) 下载nextcloud \n\n``` wget --no-check-certificate https://download.nextcloud.com/server/releases/nextcloud-25.0.0.zip ```\n\n2) 解压 nextcloud\n\n``` unzip nextcloud-25.0.0.zip ```\n\n3) 移动到 nginx的根目录\n\n``` mv nextcloud-25.0.0 /usr/share/nginx/nextcloud ```\n\n4) 修改权限\n\n``` chown -R nginx:nginx /usr/share/nginx/nextcloud ```\n``` chmod -R 777 /usr/share/nginx/nextcloud/config ```\n``` chmod -R 777 /usr/share/nginx/nextcloud/apps ```\n\n5) nginx 配置文件\n\nnginx的配置文件有两种写法, 取决于你将解压后的nextcloud是否放到nginx的根目录\n详见: https://docs.nextcloud.com/server/latest/admin_manual/installation/nginx.html\n\n**注意: line31的nextcloud的目录位置**\n\n``` vim /etc/nginx/conf.d/next.conf ```\n\n``` yaml\nupstream php-handler {\n    server 127.0.0.1:9000;\n    #server unix:/var/run/php/php7.4-fpm.sock;\n}\n\n# Set the `immutable` cache control options only for assets with a cache busting `v` argument\nmap $arg_v $asset_immutable {\n    \"\" \"\";\n    default \"immutable\";\n}\n\n\n# server {\n#     listen 80;\n#     listen [::]:80;\n#     server_name cloud.example.com;\n\n#     # Prevent nginx HTTP Server Detection\n#     server_tokens off;\n\n#     # Enforce HTTPS\n#     return 301 https://$server_name$request_uri;\n# }\n\nserver {\n    listen 8080;\n    #listen [::]:443 ssl http2;\n    server_name cloud.mdzz.wang;\n\n    # Path to the root of your installation\n    root /usr/share/nginx/nextcloud;\n\n    # Use Mozilla's guidelines for SSL/TLS settings\n    # https://mozilla.github.io/server-side-tls/ssl-config-generator/\n    #ssl_certificate     /etc/ssl/nginx/cloud.example.com.crt;\n    #ssl_certificate_key /etc/ssl/nginx/cloud.example.com.key;\n\n    # Prevent nginx HTTP Server Detection\n    server_tokens off;\n\n    # HSTS settings\n    # WARNING: Only add the preload option once you read about\n    # the consequences in https://hstspreload.org/. This option\n    # will add the domain to a hardcoded list that is shipped\n    # in all major browsers and getting removed from this list\n    # could take several months.\n    #add_header Strict-Transport-Security \"max-age=15768000; includeSubDomains; preload\" always;\n\n    # set max upload size and increase upload timeout:\n    client_max_body_size 512M;\n    client_body_timeout 300s;\n    fastcgi_buffers 64 4K;\n\n    # Enable gzip but do not remove ETag headers\n    gzip on;\n    gzip_vary on;\n    gzip_comp_level 4;\n    gzip_min_length 256;\n    gzip_proxied expired no-cache no-store private no_last_modified no_etag auth;\n    gzip_types application/atom+xml application/javascript application/json application/ld+json application/manifest+json application/rss+xml application/vnd.geo+json application/vnd.ms-fontobject application/wasm application/x-font-ttf application/x-web-app-manifest+json application/xhtml+xml application/xml font/opentype image/bmp image/svg+xml image/x-icon text/cache-manifest text/css text/plain text/vcard text/vnd.rim.location.xloc text/vtt text/x-component text/x-cross-domain-policy;\n\n    # Pagespeed is not supported by Nextcloud, so if your server is built\n    # with the `ngx_pagespeed` module, uncomment this line to disable it.\n    #pagespeed off;\n\n    # The settings allows you to optimize the HTTP2 bandwitdth.\n    # See https://blog.cloudflare.com/delivering-http-2-upload-speed-improvements/\n    # for tunning hints\n    client_body_buffer_size 512k;\n\n    # HTTP response headers borrowed from Nextcloud `.htaccess`\n    add_header Referrer-Policy                      \"no-referrer\"   always;\n    add_header X-Content-Type-Options               \"nosniff\"       always;\n    add_header X-Download-Options                   \"noopen\"        always;\n    add_header X-Frame-Options                      \"SAMEORIGIN\"    always;\n    add_header X-Permitted-Cross-Domain-Policies    \"none\"          always;\n    add_header X-Robots-Tag                         \"none\"          always;\n    add_header X-XSS-Protection                     \"1; mode=block\" always;\n\n    # Remove X-Powered-By, which is an information leak\n    fastcgi_hide_header X-Powered-By;\n\n    # Specify how to handle directories -- specifying `/index.php$request_uri`\n    # here as the fallback means that Nginx always exhibits the desired behaviour\n    # when a client requests a path that corresponds to a directory that exists\n    # on the server. In particular, if that directory contains an index.php file,\n    # that file is correctly served; if it doesn't, then the request is passed to\n    # the front-end controller. This consistent behaviour means that we don't need\n    # to specify custom rules for certain paths (e.g. images and other assets,\n    # `/updater`, `/ocm-provider`, `/ocs-provider`), and thus\n    # `try_files $uri $uri/ /index.php$request_uri`\n    # always provides the desired behaviour.\n    index index.php index.html /index.php$request_uri;\n\n    # Rule borrowed from `.htaccess` to handle Microsoft DAV clients\n    location = / {\n        if ( $http_user_agent ~ ^DavClnt ) {\n            return 302 /remote.php/webdav/$is_args$args;\n        }\n    }\n\n    location = /robots.txt {\n        allow all;\n        log_not_found off;\n        access_log off;\n    }\n\n    # Make a regex exception for `/.well-known` so that clients can still\n    # access it despite the existence of the regex rule\n    # `location ~ /(\\.|autotest|...)` which would otherwise handle requests\n    # for `/.well-known`.\n    location ^~ /.well-known {\n        # The rules in this block are an adaptation of the rules\n        # in `.htaccess` that concern `/.well-known`.\n\n        location = /.well-known/carddav { return 301 /remote.php/dav/; }\n        location = /.well-known/caldav  { return 301 /remote.php/dav/; }\n\n        location /.well-known/acme-challenge    { try_files $uri $uri/ =404; }\n        location /.well-known/pki-validation    { try_files $uri $uri/ =404; }\n\n        # Let Nextcloud's API for `/.well-known` URIs handle all other\n        # requests by passing them to the front-end controller.\n        return 301 /index.php$request_uri;\n    }\n\n    # Rules borrowed from `.htaccess` to hide certain paths from clients\n    location ~ ^/(?:build|tests|config|lib|3rdparty|templates|data)(?:$|/)  { return 404; }\n    location ~ ^/(?:\\.|autotest|occ|issue|indie|db_|console)                { return 404; }\n\n    # Ensure this block, which passes PHP files to the PHP process, is above the blocks\n    # which handle static assets (as seen below). If this block is not declared first,\n    # then Nginx will encounter an infinite rewriting loop when it prepends `/index.php`\n    # to the URI, resulting in a HTTP 500 error response.\n    location ~ \\.php(?:$|/) {\n        # Required for legacy support\n        rewrite ^/(?!index|remote|public|cron|core\\/ajax\\/update|status|ocs\\/v[12]|updater\\/.+|oc[ms]-provider\\/.+|.+\\/richdocumentscode\\/proxy) /index.php$request_uri;\n\n        fastcgi_split_path_info ^(.+?\\.php)(/.*)$;\n        set $path_info $fastcgi_path_info;\n\n        try_files $fastcgi_script_name =404;\n\n        include fastcgi_params;\n        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n        fastcgi_param PATH_INFO $path_info;\n        fastcgi_param HTTPS on;\n\n        fastcgi_param modHeadersAvailable true;         # Avoid sending the security headers twice\n        fastcgi_param front_controller_active true;     # Enable pretty urls\n        fastcgi_pass php-handler;\n\n        fastcgi_intercept_errors on;\n        fastcgi_request_buffering off;\n\n        fastcgi_max_temp_file_size 0;\n    }\n\n    location ~ \\.(?:css|js|svg|gif|png|jpg|ico|wasm|tflite|map)$ {\n        try_files $uri /index.php$request_uri;\n        add_header Cache-Control \"public, max-age=15778463, $asset_immutable\";\n        access_log off;     # Optional: Don't log access to assets\n\n        location ~ \\.wasm$ {\n            default_type application/wasm;\n        }\n    }\n\n    location ~ \\.woff2?$ {\n        try_files $uri /index.php$request_uri;\n        expires 7d;         # Cache-Control policy borrowed from `.htaccess`\n        access_log off;     # Optional: Don't log access to assets\n    }\n\n    # Rule borrowed from `.htaccess`\n    location /remote {\n        return 301 /remote.php$request_uri;\n    }\n\n    location / {\n        try_files $uri $uri/ /index.php$request_uri;\n    }\n}\n```\n\n## 常见问题\n\n1)  Can't write into config directory! This can usually be fixed by giving the webserver write access to the config directory.\n\n2)  Can't write into apps directory! This can usually be fixed by giving the webserver write access to the config directory.\n\n解决: 注意这两个位置的权限\n\nphp74-fpm应有下面两个目录的写权限\n\n``` /usr/share/nginx/nextcloud/config ``` \n``` /usr/share/nginx/nextcloud/apps ```\n\n\nchown -R php用户:php组  ``` /usr/share/nginx/nextcloud/config ```\nchown -R php用户:php组  ``` /usr/share/nginx/nextcloud/apps ```\n\n或者: \n\nchmod -R 777 ``` /usr/share/nginx/nextcloud/config ``` \nchmod -R 777 ``` /usr/share/nginx/nextcloud/apps ```","source":"_posts/030.nextcloud.md","raw":"---\ntitle: nextcloud 部署\ndate: 2022-11-23 13:08:13\ncategories: \n- [DevOps]\ntags: \n- nextcloud\n---\n\n\n## 安装 php\nhttps://blog.mdzz.wang/2022/11/22/029.install_php7.4.33/\n\n## 安装 nginx\n\n``` yum install nginx ```\n\n## 安装 mariadb\n\n``` yum install mariadb mariadb-server ```\n\n## 安装 nextcloud \n\n1) 下载nextcloud \n\n``` wget --no-check-certificate https://download.nextcloud.com/server/releases/nextcloud-25.0.0.zip ```\n\n2) 解压 nextcloud\n\n``` unzip nextcloud-25.0.0.zip ```\n\n3) 移动到 nginx的根目录\n\n``` mv nextcloud-25.0.0 /usr/share/nginx/nextcloud ```\n\n4) 修改权限\n\n``` chown -R nginx:nginx /usr/share/nginx/nextcloud ```\n``` chmod -R 777 /usr/share/nginx/nextcloud/config ```\n``` chmod -R 777 /usr/share/nginx/nextcloud/apps ```\n\n5) nginx 配置文件\n\nnginx的配置文件有两种写法, 取决于你将解压后的nextcloud是否放到nginx的根目录\n详见: https://docs.nextcloud.com/server/latest/admin_manual/installation/nginx.html\n\n**注意: line31的nextcloud的目录位置**\n\n``` vim /etc/nginx/conf.d/next.conf ```\n\n``` yaml\nupstream php-handler {\n    server 127.0.0.1:9000;\n    #server unix:/var/run/php/php7.4-fpm.sock;\n}\n\n# Set the `immutable` cache control options only for assets with a cache busting `v` argument\nmap $arg_v $asset_immutable {\n    \"\" \"\";\n    default \"immutable\";\n}\n\n\n# server {\n#     listen 80;\n#     listen [::]:80;\n#     server_name cloud.example.com;\n\n#     # Prevent nginx HTTP Server Detection\n#     server_tokens off;\n\n#     # Enforce HTTPS\n#     return 301 https://$server_name$request_uri;\n# }\n\nserver {\n    listen 8080;\n    #listen [::]:443 ssl http2;\n    server_name cloud.mdzz.wang;\n\n    # Path to the root of your installation\n    root /usr/share/nginx/nextcloud;\n\n    # Use Mozilla's guidelines for SSL/TLS settings\n    # https://mozilla.github.io/server-side-tls/ssl-config-generator/\n    #ssl_certificate     /etc/ssl/nginx/cloud.example.com.crt;\n    #ssl_certificate_key /etc/ssl/nginx/cloud.example.com.key;\n\n    # Prevent nginx HTTP Server Detection\n    server_tokens off;\n\n    # HSTS settings\n    # WARNING: Only add the preload option once you read about\n    # the consequences in https://hstspreload.org/. This option\n    # will add the domain to a hardcoded list that is shipped\n    # in all major browsers and getting removed from this list\n    # could take several months.\n    #add_header Strict-Transport-Security \"max-age=15768000; includeSubDomains; preload\" always;\n\n    # set max upload size and increase upload timeout:\n    client_max_body_size 512M;\n    client_body_timeout 300s;\n    fastcgi_buffers 64 4K;\n\n    # Enable gzip but do not remove ETag headers\n    gzip on;\n    gzip_vary on;\n    gzip_comp_level 4;\n    gzip_min_length 256;\n    gzip_proxied expired no-cache no-store private no_last_modified no_etag auth;\n    gzip_types application/atom+xml application/javascript application/json application/ld+json application/manifest+json application/rss+xml application/vnd.geo+json application/vnd.ms-fontobject application/wasm application/x-font-ttf application/x-web-app-manifest+json application/xhtml+xml application/xml font/opentype image/bmp image/svg+xml image/x-icon text/cache-manifest text/css text/plain text/vcard text/vnd.rim.location.xloc text/vtt text/x-component text/x-cross-domain-policy;\n\n    # Pagespeed is not supported by Nextcloud, so if your server is built\n    # with the `ngx_pagespeed` module, uncomment this line to disable it.\n    #pagespeed off;\n\n    # The settings allows you to optimize the HTTP2 bandwitdth.\n    # See https://blog.cloudflare.com/delivering-http-2-upload-speed-improvements/\n    # for tunning hints\n    client_body_buffer_size 512k;\n\n    # HTTP response headers borrowed from Nextcloud `.htaccess`\n    add_header Referrer-Policy                      \"no-referrer\"   always;\n    add_header X-Content-Type-Options               \"nosniff\"       always;\n    add_header X-Download-Options                   \"noopen\"        always;\n    add_header X-Frame-Options                      \"SAMEORIGIN\"    always;\n    add_header X-Permitted-Cross-Domain-Policies    \"none\"          always;\n    add_header X-Robots-Tag                         \"none\"          always;\n    add_header X-XSS-Protection                     \"1; mode=block\" always;\n\n    # Remove X-Powered-By, which is an information leak\n    fastcgi_hide_header X-Powered-By;\n\n    # Specify how to handle directories -- specifying `/index.php$request_uri`\n    # here as the fallback means that Nginx always exhibits the desired behaviour\n    # when a client requests a path that corresponds to a directory that exists\n    # on the server. In particular, if that directory contains an index.php file,\n    # that file is correctly served; if it doesn't, then the request is passed to\n    # the front-end controller. This consistent behaviour means that we don't need\n    # to specify custom rules for certain paths (e.g. images and other assets,\n    # `/updater`, `/ocm-provider`, `/ocs-provider`), and thus\n    # `try_files $uri $uri/ /index.php$request_uri`\n    # always provides the desired behaviour.\n    index index.php index.html /index.php$request_uri;\n\n    # Rule borrowed from `.htaccess` to handle Microsoft DAV clients\n    location = / {\n        if ( $http_user_agent ~ ^DavClnt ) {\n            return 302 /remote.php/webdav/$is_args$args;\n        }\n    }\n\n    location = /robots.txt {\n        allow all;\n        log_not_found off;\n        access_log off;\n    }\n\n    # Make a regex exception for `/.well-known` so that clients can still\n    # access it despite the existence of the regex rule\n    # `location ~ /(\\.|autotest|...)` which would otherwise handle requests\n    # for `/.well-known`.\n    location ^~ /.well-known {\n        # The rules in this block are an adaptation of the rules\n        # in `.htaccess` that concern `/.well-known`.\n\n        location = /.well-known/carddav { return 301 /remote.php/dav/; }\n        location = /.well-known/caldav  { return 301 /remote.php/dav/; }\n\n        location /.well-known/acme-challenge    { try_files $uri $uri/ =404; }\n        location /.well-known/pki-validation    { try_files $uri $uri/ =404; }\n\n        # Let Nextcloud's API for `/.well-known` URIs handle all other\n        # requests by passing them to the front-end controller.\n        return 301 /index.php$request_uri;\n    }\n\n    # Rules borrowed from `.htaccess` to hide certain paths from clients\n    location ~ ^/(?:build|tests|config|lib|3rdparty|templates|data)(?:$|/)  { return 404; }\n    location ~ ^/(?:\\.|autotest|occ|issue|indie|db_|console)                { return 404; }\n\n    # Ensure this block, which passes PHP files to the PHP process, is above the blocks\n    # which handle static assets (as seen below). If this block is not declared first,\n    # then Nginx will encounter an infinite rewriting loop when it prepends `/index.php`\n    # to the URI, resulting in a HTTP 500 error response.\n    location ~ \\.php(?:$|/) {\n        # Required for legacy support\n        rewrite ^/(?!index|remote|public|cron|core\\/ajax\\/update|status|ocs\\/v[12]|updater\\/.+|oc[ms]-provider\\/.+|.+\\/richdocumentscode\\/proxy) /index.php$request_uri;\n\n        fastcgi_split_path_info ^(.+?\\.php)(/.*)$;\n        set $path_info $fastcgi_path_info;\n\n        try_files $fastcgi_script_name =404;\n\n        include fastcgi_params;\n        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n        fastcgi_param PATH_INFO $path_info;\n        fastcgi_param HTTPS on;\n\n        fastcgi_param modHeadersAvailable true;         # Avoid sending the security headers twice\n        fastcgi_param front_controller_active true;     # Enable pretty urls\n        fastcgi_pass php-handler;\n\n        fastcgi_intercept_errors on;\n        fastcgi_request_buffering off;\n\n        fastcgi_max_temp_file_size 0;\n    }\n\n    location ~ \\.(?:css|js|svg|gif|png|jpg|ico|wasm|tflite|map)$ {\n        try_files $uri /index.php$request_uri;\n        add_header Cache-Control \"public, max-age=15778463, $asset_immutable\";\n        access_log off;     # Optional: Don't log access to assets\n\n        location ~ \\.wasm$ {\n            default_type application/wasm;\n        }\n    }\n\n    location ~ \\.woff2?$ {\n        try_files $uri /index.php$request_uri;\n        expires 7d;         # Cache-Control policy borrowed from `.htaccess`\n        access_log off;     # Optional: Don't log access to assets\n    }\n\n    # Rule borrowed from `.htaccess`\n    location /remote {\n        return 301 /remote.php$request_uri;\n    }\n\n    location / {\n        try_files $uri $uri/ /index.php$request_uri;\n    }\n}\n```\n\n## 常见问题\n\n1)  Can't write into config directory! This can usually be fixed by giving the webserver write access to the config directory.\n\n2)  Can't write into apps directory! This can usually be fixed by giving the webserver write access to the config directory.\n\n解决: 注意这两个位置的权限\n\nphp74-fpm应有下面两个目录的写权限\n\n``` /usr/share/nginx/nextcloud/config ``` \n``` /usr/share/nginx/nextcloud/apps ```\n\n\nchown -R php用户:php组  ``` /usr/share/nginx/nextcloud/config ```\nchown -R php用户:php组  ``` /usr/share/nginx/nextcloud/apps ```\n\n或者: \n\nchmod -R 777 ``` /usr/share/nginx/nextcloud/config ``` \nchmod -R 777 ``` /usr/share/nginx/nextcloud/apps ```","slug":"030.nextcloud","published":1,"updated":"2023-12-05T08:52:30.878Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzci002wijnrcth3crpa","content":"<h2 id=\"安装-php\"><a href=\"#安装-php\" class=\"headerlink\" title=\"安装 php\"></a>安装 php</h2><p><a href=\"https://blog.mdzz.wang/2022/11/22/029.install_php7.4.33/\">https://blog.mdzz.wang/2022/11/22/029.install_php7.4.33/</a></p>\n<h2 id=\"安装-nginx\"><a href=\"#安装-nginx\" class=\"headerlink\" title=\"安装 nginx\"></a>安装 nginx</h2><p><code>yum install nginx</code></p>\n<h2 id=\"安装-mariadb\"><a href=\"#安装-mariadb\" class=\"headerlink\" title=\"安装 mariadb\"></a>安装 mariadb</h2><p><code>yum install mariadb mariadb-server</code></p>\n<h2 id=\"安装-nextcloud\"><a href=\"#安装-nextcloud\" class=\"headerlink\" title=\"安装 nextcloud\"></a>安装 nextcloud</h2><ol>\n<li>下载nextcloud</li>\n</ol>\n<p><code>wget --no-check-certificate https://download.nextcloud.com/server/releases/nextcloud-25.0.0.zip</code></p>\n<ol start=\"2\">\n<li>解压 nextcloud</li>\n</ol>\n<p><code>unzip nextcloud-25.0.0.zip</code></p>\n<ol start=\"3\">\n<li>移动到 nginx的根目录</li>\n</ol>\n<p><code>mv nextcloud-25.0.0 /usr/share/nginx/nextcloud</code></p>\n<ol start=\"4\">\n<li>修改权限</li>\n</ol>\n<p><code>chown -R nginx:nginx /usr/share/nginx/nextcloud</code><br><code>chmod -R 777 /usr/share/nginx/nextcloud/config</code><br><code>chmod -R 777 /usr/share/nginx/nextcloud/apps</code></p>\n<ol start=\"5\">\n<li>nginx 配置文件</li>\n</ol>\n<p>nginx的配置文件有两种写法, 取决于你将解压后的nextcloud是否放到nginx的根目录<br>详见: <a href=\"https://docs.nextcloud.com/server/latest/admin_manual/installation/nginx.html\">https://docs.nextcloud.com/server/latest/admin_manual/installation/nginx.html</a></p>\n<p><strong>注意: line31的nextcloud的目录位置</strong></p>\n<p><code>vim /etc/nginx/conf.d/next.conf</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">upstream</span> <span class=\"string\">php-handler</span> &#123;</span><br><span class=\"line\">    <span class=\"string\">server</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">:9000;</span></span><br><span class=\"line\">    <span class=\"comment\">#server unix:/var/run/php/php7.4-fpm.sock;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Set the `immutable` cache control options only for assets with a cache busting `v` argument</span></span><br><span class=\"line\"><span class=\"string\">map</span> <span class=\"string\">$arg_v</span> <span class=\"string\">$asset_immutable</span> &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;</span> <span class=\"string\">&quot;&quot;</span><span class=\"string\">;</span></span><br><span class=\"line\">    <span class=\"string\">default</span> <span class=\"string\">&quot;immutable&quot;</span><span class=\"string\">;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># server &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#     listen 80;</span></span><br><span class=\"line\"><span class=\"comment\">#     listen [::]:80;</span></span><br><span class=\"line\"><span class=\"comment\">#     server_name cloud.example.com;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#     # Prevent nginx HTTP Server Detection</span></span><br><span class=\"line\"><span class=\"comment\">#     server_tokens off;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#     # Enforce HTTPS</span></span><br><span class=\"line\"><span class=\"comment\">#     return 301 https://$server_name$request_uri;</span></span><br><span class=\"line\"><span class=\"comment\"># &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">server</span> &#123;</span><br><span class=\"line\">    <span class=\"string\">listen</span> <span class=\"number\">8080</span><span class=\"string\">;</span></span><br><span class=\"line\">    <span class=\"comment\">#listen [::]:443 ssl http2;</span></span><br><span class=\"line\">    <span class=\"string\">server_name</span> <span class=\"string\">cloud.mdzz.wang;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Path to the root of your installation</span></span><br><span class=\"line\">    <span class=\"string\">root</span> <span class=\"string\">/usr/share/nginx/nextcloud;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Use Mozilla&#x27;s guidelines for SSL/TLS settings</span></span><br><span class=\"line\">    <span class=\"comment\"># https://mozilla.github.io/server-side-tls/ssl-config-generator/</span></span><br><span class=\"line\">    <span class=\"comment\">#ssl_certificate     /etc/ssl/nginx/cloud.example.com.crt;</span></span><br><span class=\"line\">    <span class=\"comment\">#ssl_certificate_key /etc/ssl/nginx/cloud.example.com.key;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Prevent nginx HTTP Server Detection</span></span><br><span class=\"line\">    <span class=\"string\">server_tokens</span> <span class=\"string\">off;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># HSTS settings</span></span><br><span class=\"line\">    <span class=\"comment\"># WARNING: Only add the preload option once you read about</span></span><br><span class=\"line\">    <span class=\"comment\"># the consequences in https://hstspreload.org/. This option</span></span><br><span class=\"line\">    <span class=\"comment\"># will add the domain to a hardcoded list that is shipped</span></span><br><span class=\"line\">    <span class=\"comment\"># in all major browsers and getting removed from this list</span></span><br><span class=\"line\">    <span class=\"comment\"># could take several months.</span></span><br><span class=\"line\">    <span class=\"comment\">#add_header Strict-Transport-Security &quot;max-age=15768000; includeSubDomains; preload&quot; always;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># set max upload size and increase upload timeout:</span></span><br><span class=\"line\">    <span class=\"string\">client_max_body_size</span> <span class=\"string\">512M;</span></span><br><span class=\"line\">    <span class=\"string\">client_body_timeout</span> <span class=\"string\">300s;</span></span><br><span class=\"line\">    <span class=\"string\">fastcgi_buffers</span> <span class=\"number\">64</span> <span class=\"string\">4K;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Enable gzip but do not remove ETag headers</span></span><br><span class=\"line\">    <span class=\"string\">gzip</span> <span class=\"string\">on;</span></span><br><span class=\"line\">    <span class=\"string\">gzip_vary</span> <span class=\"string\">on;</span></span><br><span class=\"line\">    <span class=\"string\">gzip_comp_level</span> <span class=\"number\">4</span><span class=\"string\">;</span></span><br><span class=\"line\">    <span class=\"string\">gzip_min_length</span> <span class=\"number\">256</span><span class=\"string\">;</span></span><br><span class=\"line\">    <span class=\"string\">gzip_proxied</span> <span class=\"string\">expired</span> <span class=\"literal\">no</span><span class=\"string\">-cache</span> <span class=\"literal\">no</span><span class=\"string\">-store</span> <span class=\"string\">private</span> <span class=\"string\">no_last_modified</span> <span class=\"string\">no_etag</span> <span class=\"string\">auth;</span></span><br><span class=\"line\">    <span class=\"string\">gzip_types</span> <span class=\"string\">application/atom+xml</span> <span class=\"string\">application/javascript</span> <span class=\"string\">application/json</span> <span class=\"string\">application/ld+json</span> <span class=\"string\">application/manifest+json</span> <span class=\"string\">application/rss+xml</span> <span class=\"string\">application/vnd.geo+json</span> <span class=\"string\">application/vnd.ms-fontobject</span> <span class=\"string\">application/wasm</span> <span class=\"string\">application/x-font-ttf</span> <span class=\"string\">application/x-web-app-manifest+json</span> <span class=\"string\">application/xhtml+xml</span> <span class=\"string\">application/xml</span> <span class=\"string\">font/opentype</span> <span class=\"string\">image/bmp</span> <span class=\"string\">image/svg+xml</span> <span class=\"string\">image/x-icon</span> <span class=\"string\">text/cache-manifest</span> <span class=\"string\">text/css</span> <span class=\"string\">text/plain</span> <span class=\"string\">text/vcard</span> <span class=\"string\">text/vnd.rim.location.xloc</span> <span class=\"string\">text/vtt</span> <span class=\"string\">text/x-component</span> <span class=\"string\">text/x-cross-domain-policy;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Pagespeed is not supported by Nextcloud, so if your server is built</span></span><br><span class=\"line\">    <span class=\"comment\"># with the `ngx_pagespeed` module, uncomment this line to disable it.</span></span><br><span class=\"line\">    <span class=\"comment\">#pagespeed off;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># The settings allows you to optimize the HTTP2 bandwitdth.</span></span><br><span class=\"line\">    <span class=\"comment\"># See https://blog.cloudflare.com/delivering-http-2-upload-speed-improvements/</span></span><br><span class=\"line\">    <span class=\"comment\"># for tunning hints</span></span><br><span class=\"line\">    <span class=\"string\">client_body_buffer_size</span> <span class=\"string\">512k;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># HTTP response headers borrowed from Nextcloud `.htaccess`</span></span><br><span class=\"line\">    <span class=\"string\">add_header</span> <span class=\"string\">Referrer-Policy</span>                      <span class=\"string\">&quot;no-referrer&quot;</span>   <span class=\"string\">always;</span></span><br><span class=\"line\">    <span class=\"string\">add_header</span> <span class=\"string\">X-Content-Type-Options</span>               <span class=\"string\">&quot;nosniff&quot;</span>       <span class=\"string\">always;</span></span><br><span class=\"line\">    <span class=\"string\">add_header</span> <span class=\"string\">X-Download-Options</span>                   <span class=\"string\">&quot;noopen&quot;</span>        <span class=\"string\">always;</span></span><br><span class=\"line\">    <span class=\"string\">add_header</span> <span class=\"string\">X-Frame-Options</span>                      <span class=\"string\">&quot;SAMEORIGIN&quot;</span>    <span class=\"string\">always;</span></span><br><span class=\"line\">    <span class=\"string\">add_header</span> <span class=\"string\">X-Permitted-Cross-Domain-Policies</span>    <span class=\"string\">&quot;none&quot;</span>          <span class=\"string\">always;</span></span><br><span class=\"line\">    <span class=\"string\">add_header</span> <span class=\"string\">X-Robots-Tag</span>                         <span class=\"string\">&quot;none&quot;</span>          <span class=\"string\">always;</span></span><br><span class=\"line\">    <span class=\"string\">add_header</span> <span class=\"string\">X-XSS-Protection</span>                     <span class=\"string\">&quot;1; mode=block&quot;</span> <span class=\"string\">always;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Remove X-Powered-By, which is an information leak</span></span><br><span class=\"line\">    <span class=\"string\">fastcgi_hide_header</span> <span class=\"string\">X-Powered-By;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Specify how to handle directories -- specifying `/index.php$request_uri`</span></span><br><span class=\"line\">    <span class=\"comment\"># here as the fallback means that Nginx always exhibits the desired behaviour</span></span><br><span class=\"line\">    <span class=\"comment\"># when a client requests a path that corresponds to a directory that exists</span></span><br><span class=\"line\">    <span class=\"comment\"># on the server. In particular, if that directory contains an index.php file,</span></span><br><span class=\"line\">    <span class=\"comment\"># that file is correctly served; if it doesn&#x27;t, then the request is passed to</span></span><br><span class=\"line\">    <span class=\"comment\"># the front-end controller. This consistent behaviour means that we don&#x27;t need</span></span><br><span class=\"line\">    <span class=\"comment\"># to specify custom rules for certain paths (e.g. images and other assets,</span></span><br><span class=\"line\">    <span class=\"comment\"># `/updater`, `/ocm-provider`, `/ocs-provider`), and thus</span></span><br><span class=\"line\">    <span class=\"comment\"># `try_files $uri $uri/ /index.php$request_uri`</span></span><br><span class=\"line\">    <span class=\"comment\"># always provides the desired behaviour.</span></span><br><span class=\"line\">    <span class=\"string\">index</span> <span class=\"string\">index.php</span> <span class=\"string\">index.html</span> <span class=\"string\">/index.php$request_uri;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Rule borrowed from `.htaccess` to handle Microsoft DAV clients</span></span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">=</span> <span class=\"string\">/</span> &#123;</span><br><span class=\"line\">        <span class=\"string\">if</span> <span class=\"string\">(</span> <span class=\"string\">$http_user_agent</span> <span class=\"string\">~</span> <span class=\"string\">^DavClnt</span> <span class=\"string\">)</span> &#123;</span><br><span class=\"line\">            <span class=\"string\">return</span> <span class=\"number\">302</span> <span class=\"string\">/remote.php/webdav/$is_args$args;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">=</span> <span class=\"string\">/robots.txt</span> &#123;</span><br><span class=\"line\">        <span class=\"string\">allow</span> <span class=\"string\">all;</span></span><br><span class=\"line\">        <span class=\"string\">log_not_found</span> <span class=\"string\">off;</span></span><br><span class=\"line\">        <span class=\"string\">access_log</span> <span class=\"string\">off;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Make a regex exception for `/.well-known` so that clients can still</span></span><br><span class=\"line\">    <span class=\"comment\"># access it despite the existence of the regex rule</span></span><br><span class=\"line\">    <span class=\"comment\"># `location ~ /(\\.|autotest|...)` which would otherwise handle requests</span></span><br><span class=\"line\">    <span class=\"comment\"># for `/.well-known`.</span></span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">^~</span> <span class=\"string\">/.well-known</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\"># The rules in this block are an adaptation of the rules</span></span><br><span class=\"line\">        <span class=\"comment\"># in `.htaccess` that concern `/.well-known`.</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"string\">location</span> <span class=\"string\">=</span> <span class=\"string\">/.well-known/carddav</span> &#123; <span class=\"string\">return</span> <span class=\"number\">301</span> <span class=\"string\">/remote.php/dav/;</span> &#125;</span><br><span class=\"line\">        <span class=\"string\">location</span> <span class=\"string\">=</span> <span class=\"string\">/.well-known/caldav</span>  &#123; <span class=\"string\">return</span> <span class=\"number\">301</span> <span class=\"string\">/remote.php/dav/;</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"string\">location</span> <span class=\"string\">/.well-known/acme-challenge</span>    &#123; <span class=\"string\">try_files</span> <span class=\"string\">$uri</span> <span class=\"string\">$uri/</span> <span class=\"string\">=404;</span> &#125;</span><br><span class=\"line\">        <span class=\"string\">location</span> <span class=\"string\">/.well-known/pki-validation</span>    &#123; <span class=\"string\">try_files</span> <span class=\"string\">$uri</span> <span class=\"string\">$uri/</span> <span class=\"string\">=404;</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># Let Nextcloud&#x27;s API for `/.well-known` URIs handle all other</span></span><br><span class=\"line\">        <span class=\"comment\"># requests by passing them to the front-end controller.</span></span><br><span class=\"line\">        <span class=\"string\">return</span> <span class=\"number\">301</span> <span class=\"string\">/index.php$request_uri;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Rules borrowed from `.htaccess` to hide certain paths from clients</span></span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">~</span> <span class=\"string\">^/(?:build|tests|config|lib|3rdparty|templates|data)(?:$|/)</span>  &#123; <span class=\"string\">return</span> <span class=\"number\">404</span><span class=\"string\">;</span> &#125;</span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">~</span> <span class=\"string\">^/(?:\\.|autotest|occ|issue|indie|db_|console)</span>                &#123; <span class=\"string\">return</span> <span class=\"number\">404</span><span class=\"string\">;</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Ensure this block, which passes PHP files to the PHP process, is above the blocks</span></span><br><span class=\"line\">    <span class=\"comment\"># which handle static assets (as seen below). If this block is not declared first,</span></span><br><span class=\"line\">    <span class=\"comment\"># then Nginx will encounter an infinite rewriting loop when it prepends `/index.php`</span></span><br><span class=\"line\">    <span class=\"comment\"># to the URI, resulting in a HTTP 500 error response.</span></span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">~</span> <span class=\"string\">\\.php(?:$|/)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\"># Required for legacy support</span></span><br><span class=\"line\">        <span class=\"string\">rewrite</span> <span class=\"string\">^/(?!index|remote|public|cron|core\\/ajax\\/update|status|ocs\\/v</span>[<span class=\"number\">12</span>]<span class=\"string\">|updater\\/.+|oc</span>[<span class=\"string\">ms</span>]<span class=\"string\">-provider\\/.+|.+\\/richdocumentscode\\/proxy)</span> <span class=\"string\">/index.php$request_uri;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"string\">fastcgi_split_path_info</span> <span class=\"string\">^(.+?\\.php)(/.*)$;</span></span><br><span class=\"line\">        <span class=\"string\">set</span> <span class=\"string\">$path_info</span> <span class=\"string\">$fastcgi_path_info;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"string\">try_files</span> <span class=\"string\">$fastcgi_script_name</span> <span class=\"string\">=404;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"string\">include</span> <span class=\"string\">fastcgi_params;</span></span><br><span class=\"line\">        <span class=\"string\">fastcgi_param</span> <span class=\"string\">SCRIPT_FILENAME</span> <span class=\"string\">$document_root$fastcgi_script_name;</span></span><br><span class=\"line\">        <span class=\"string\">fastcgi_param</span> <span class=\"string\">PATH_INFO</span> <span class=\"string\">$path_info;</span></span><br><span class=\"line\">        <span class=\"string\">fastcgi_param</span> <span class=\"string\">HTTPS</span> <span class=\"string\">on;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"string\">fastcgi_param</span> <span class=\"string\">modHeadersAvailable</span> <span class=\"literal\">true</span><span class=\"string\">;</span>         <span class=\"comment\"># Avoid sending the security headers twice</span></span><br><span class=\"line\">        <span class=\"string\">fastcgi_param</span> <span class=\"string\">front_controller_active</span> <span class=\"literal\">true</span><span class=\"string\">;</span>     <span class=\"comment\"># Enable pretty urls</span></span><br><span class=\"line\">        <span class=\"string\">fastcgi_pass</span> <span class=\"string\">php-handler;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"string\">fastcgi_intercept_errors</span> <span class=\"string\">on;</span></span><br><span class=\"line\">        <span class=\"string\">fastcgi_request_buffering</span> <span class=\"string\">off;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"string\">fastcgi_max_temp_file_size</span> <span class=\"number\">0</span><span class=\"string\">;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">~</span> <span class=\"string\">\\.(?:css|js|svg|gif|png|jpg|ico|wasm|tflite|map)$</span> &#123;</span><br><span class=\"line\">        <span class=\"string\">try_files</span> <span class=\"string\">$uri</span> <span class=\"string\">/index.php$request_uri;</span></span><br><span class=\"line\">        <span class=\"string\">add_header</span> <span class=\"string\">Cache-Control</span> <span class=\"string\">&quot;public, max-age=15778463, $asset_immutable&quot;</span><span class=\"string\">;</span></span><br><span class=\"line\">        <span class=\"string\">access_log</span> <span class=\"string\">off;</span>     <span class=\"comment\"># Optional: Don&#x27;t log access to assets</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"string\">location</span> <span class=\"string\">~</span> <span class=\"string\">\\.wasm$</span> &#123;</span><br><span class=\"line\">            <span class=\"string\">default_type</span> <span class=\"string\">application/wasm;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">~</span> <span class=\"string\">\\.woff2?$</span> &#123;</span><br><span class=\"line\">        <span class=\"string\">try_files</span> <span class=\"string\">$uri</span> <span class=\"string\">/index.php$request_uri;</span></span><br><span class=\"line\">        <span class=\"string\">expires</span> <span class=\"string\">7d;</span>         <span class=\"comment\"># Cache-Control policy borrowed from `.htaccess`</span></span><br><span class=\"line\">        <span class=\"string\">access_log</span> <span class=\"string\">off;</span>     <span class=\"comment\"># Optional: Don&#x27;t log access to assets</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Rule borrowed from `.htaccess`</span></span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">/remote</span> &#123;</span><br><span class=\"line\">        <span class=\"string\">return</span> <span class=\"number\">301</span> <span class=\"string\">/remote.php$request_uri;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">/</span> &#123;</span><br><span class=\"line\">        <span class=\"string\">try_files</span> <span class=\"string\">$uri</span> <span class=\"string\">$uri/</span> <span class=\"string\">/index.php$request_uri;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"常见问题\"><a href=\"#常见问题\" class=\"headerlink\" title=\"常见问题\"></a>常见问题</h2><ol>\n<li><p>Can’t write into config directory! This can usually be fixed by giving the webserver write access to the config directory.</p>\n</li>\n<li><p>Can’t write into apps directory! This can usually be fixed by giving the webserver write access to the config directory.</p>\n</li>\n</ol>\n<p>解决: 注意这两个位置的权限</p>\n<p>php74-fpm应有下面两个目录的写权限</p>\n<p><code>/usr/share/nginx/nextcloud/config</code><br><code>/usr/share/nginx/nextcloud/apps</code></p>\n<p>chown -R php用户:php组  <code>/usr/share/nginx/nextcloud/config</code><br>chown -R php用户:php组  <code>/usr/share/nginx/nextcloud/apps</code></p>\n<p>或者: </p>\n<p>chmod -R 777 <code>/usr/share/nginx/nextcloud/config</code><br>chmod -R 777 <code>/usr/share/nginx/nextcloud/apps</code></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"安装-php\"><a href=\"#安装-php\" class=\"headerlink\" title=\"安装 php\"></a>安装 php</h2><p><a href=\"https://blog.mdzz.wang/2022/11/22/029.install_php7.4.33/\">https://blog.mdzz.wang/2022/11/22/029.install_php7.4.33/</a></p>\n<h2 id=\"安装-nginx\"><a href=\"#安装-nginx\" class=\"headerlink\" title=\"安装 nginx\"></a>安装 nginx</h2><p><code>yum install nginx</code></p>\n<h2 id=\"安装-mariadb\"><a href=\"#安装-mariadb\" class=\"headerlink\" title=\"安装 mariadb\"></a>安装 mariadb</h2><p><code>yum install mariadb mariadb-server</code></p>\n<h2 id=\"安装-nextcloud\"><a href=\"#安装-nextcloud\" class=\"headerlink\" title=\"安装 nextcloud\"></a>安装 nextcloud</h2><ol>\n<li>下载nextcloud</li>\n</ol>\n<p><code>wget --no-check-certificate https://download.nextcloud.com/server/releases/nextcloud-25.0.0.zip</code></p>\n<ol start=\"2\">\n<li>解压 nextcloud</li>\n</ol>\n<p><code>unzip nextcloud-25.0.0.zip</code></p>\n<ol start=\"3\">\n<li>移动到 nginx的根目录</li>\n</ol>\n<p><code>mv nextcloud-25.0.0 /usr/share/nginx/nextcloud</code></p>\n<ol start=\"4\">\n<li>修改权限</li>\n</ol>\n<p><code>chown -R nginx:nginx /usr/share/nginx/nextcloud</code><br><code>chmod -R 777 /usr/share/nginx/nextcloud/config</code><br><code>chmod -R 777 /usr/share/nginx/nextcloud/apps</code></p>\n<ol start=\"5\">\n<li>nginx 配置文件</li>\n</ol>\n<p>nginx的配置文件有两种写法, 取决于你将解压后的nextcloud是否放到nginx的根目录<br>详见: <a href=\"https://docs.nextcloud.com/server/latest/admin_manual/installation/nginx.html\">https://docs.nextcloud.com/server/latest/admin_manual/installation/nginx.html</a></p>\n<p><strong>注意: line31的nextcloud的目录位置</strong></p>\n<p><code>vim /etc/nginx/conf.d/next.conf</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">upstream</span> <span class=\"string\">php-handler</span> &#123;</span><br><span class=\"line\">    <span class=\"string\">server</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"string\">:9000;</span></span><br><span class=\"line\">    <span class=\"comment\">#server unix:/var/run/php/php7.4-fpm.sock;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Set the `immutable` cache control options only for assets with a cache busting `v` argument</span></span><br><span class=\"line\"><span class=\"string\">map</span> <span class=\"string\">$arg_v</span> <span class=\"string\">$asset_immutable</span> &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;</span> <span class=\"string\">&quot;&quot;</span><span class=\"string\">;</span></span><br><span class=\"line\">    <span class=\"string\">default</span> <span class=\"string\">&quot;immutable&quot;</span><span class=\"string\">;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># server &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#     listen 80;</span></span><br><span class=\"line\"><span class=\"comment\">#     listen [::]:80;</span></span><br><span class=\"line\"><span class=\"comment\">#     server_name cloud.example.com;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#     # Prevent nginx HTTP Server Detection</span></span><br><span class=\"line\"><span class=\"comment\">#     server_tokens off;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#     # Enforce HTTPS</span></span><br><span class=\"line\"><span class=\"comment\">#     return 301 https://$server_name$request_uri;</span></span><br><span class=\"line\"><span class=\"comment\"># &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">server</span> &#123;</span><br><span class=\"line\">    <span class=\"string\">listen</span> <span class=\"number\">8080</span><span class=\"string\">;</span></span><br><span class=\"line\">    <span class=\"comment\">#listen [::]:443 ssl http2;</span></span><br><span class=\"line\">    <span class=\"string\">server_name</span> <span class=\"string\">cloud.mdzz.wang;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Path to the root of your installation</span></span><br><span class=\"line\">    <span class=\"string\">root</span> <span class=\"string\">/usr/share/nginx/nextcloud;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Use Mozilla&#x27;s guidelines for SSL/TLS settings</span></span><br><span class=\"line\">    <span class=\"comment\"># https://mozilla.github.io/server-side-tls/ssl-config-generator/</span></span><br><span class=\"line\">    <span class=\"comment\">#ssl_certificate     /etc/ssl/nginx/cloud.example.com.crt;</span></span><br><span class=\"line\">    <span class=\"comment\">#ssl_certificate_key /etc/ssl/nginx/cloud.example.com.key;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Prevent nginx HTTP Server Detection</span></span><br><span class=\"line\">    <span class=\"string\">server_tokens</span> <span class=\"string\">off;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># HSTS settings</span></span><br><span class=\"line\">    <span class=\"comment\"># WARNING: Only add the preload option once you read about</span></span><br><span class=\"line\">    <span class=\"comment\"># the consequences in https://hstspreload.org/. This option</span></span><br><span class=\"line\">    <span class=\"comment\"># will add the domain to a hardcoded list that is shipped</span></span><br><span class=\"line\">    <span class=\"comment\"># in all major browsers and getting removed from this list</span></span><br><span class=\"line\">    <span class=\"comment\"># could take several months.</span></span><br><span class=\"line\">    <span class=\"comment\">#add_header Strict-Transport-Security &quot;max-age=15768000; includeSubDomains; preload&quot; always;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># set max upload size and increase upload timeout:</span></span><br><span class=\"line\">    <span class=\"string\">client_max_body_size</span> <span class=\"string\">512M;</span></span><br><span class=\"line\">    <span class=\"string\">client_body_timeout</span> <span class=\"string\">300s;</span></span><br><span class=\"line\">    <span class=\"string\">fastcgi_buffers</span> <span class=\"number\">64</span> <span class=\"string\">4K;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Enable gzip but do not remove ETag headers</span></span><br><span class=\"line\">    <span class=\"string\">gzip</span> <span class=\"string\">on;</span></span><br><span class=\"line\">    <span class=\"string\">gzip_vary</span> <span class=\"string\">on;</span></span><br><span class=\"line\">    <span class=\"string\">gzip_comp_level</span> <span class=\"number\">4</span><span class=\"string\">;</span></span><br><span class=\"line\">    <span class=\"string\">gzip_min_length</span> <span class=\"number\">256</span><span class=\"string\">;</span></span><br><span class=\"line\">    <span class=\"string\">gzip_proxied</span> <span class=\"string\">expired</span> <span class=\"literal\">no</span><span class=\"string\">-cache</span> <span class=\"literal\">no</span><span class=\"string\">-store</span> <span class=\"string\">private</span> <span class=\"string\">no_last_modified</span> <span class=\"string\">no_etag</span> <span class=\"string\">auth;</span></span><br><span class=\"line\">    <span class=\"string\">gzip_types</span> <span class=\"string\">application/atom+xml</span> <span class=\"string\">application/javascript</span> <span class=\"string\">application/json</span> <span class=\"string\">application/ld+json</span> <span class=\"string\">application/manifest+json</span> <span class=\"string\">application/rss+xml</span> <span class=\"string\">application/vnd.geo+json</span> <span class=\"string\">application/vnd.ms-fontobject</span> <span class=\"string\">application/wasm</span> <span class=\"string\">application/x-font-ttf</span> <span class=\"string\">application/x-web-app-manifest+json</span> <span class=\"string\">application/xhtml+xml</span> <span class=\"string\">application/xml</span> <span class=\"string\">font/opentype</span> <span class=\"string\">image/bmp</span> <span class=\"string\">image/svg+xml</span> <span class=\"string\">image/x-icon</span> <span class=\"string\">text/cache-manifest</span> <span class=\"string\">text/css</span> <span class=\"string\">text/plain</span> <span class=\"string\">text/vcard</span> <span class=\"string\">text/vnd.rim.location.xloc</span> <span class=\"string\">text/vtt</span> <span class=\"string\">text/x-component</span> <span class=\"string\">text/x-cross-domain-policy;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Pagespeed is not supported by Nextcloud, so if your server is built</span></span><br><span class=\"line\">    <span class=\"comment\"># with the `ngx_pagespeed` module, uncomment this line to disable it.</span></span><br><span class=\"line\">    <span class=\"comment\">#pagespeed off;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># The settings allows you to optimize the HTTP2 bandwitdth.</span></span><br><span class=\"line\">    <span class=\"comment\"># See https://blog.cloudflare.com/delivering-http-2-upload-speed-improvements/</span></span><br><span class=\"line\">    <span class=\"comment\"># for tunning hints</span></span><br><span class=\"line\">    <span class=\"string\">client_body_buffer_size</span> <span class=\"string\">512k;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># HTTP response headers borrowed from Nextcloud `.htaccess`</span></span><br><span class=\"line\">    <span class=\"string\">add_header</span> <span class=\"string\">Referrer-Policy</span>                      <span class=\"string\">&quot;no-referrer&quot;</span>   <span class=\"string\">always;</span></span><br><span class=\"line\">    <span class=\"string\">add_header</span> <span class=\"string\">X-Content-Type-Options</span>               <span class=\"string\">&quot;nosniff&quot;</span>       <span class=\"string\">always;</span></span><br><span class=\"line\">    <span class=\"string\">add_header</span> <span class=\"string\">X-Download-Options</span>                   <span class=\"string\">&quot;noopen&quot;</span>        <span class=\"string\">always;</span></span><br><span class=\"line\">    <span class=\"string\">add_header</span> <span class=\"string\">X-Frame-Options</span>                      <span class=\"string\">&quot;SAMEORIGIN&quot;</span>    <span class=\"string\">always;</span></span><br><span class=\"line\">    <span class=\"string\">add_header</span> <span class=\"string\">X-Permitted-Cross-Domain-Policies</span>    <span class=\"string\">&quot;none&quot;</span>          <span class=\"string\">always;</span></span><br><span class=\"line\">    <span class=\"string\">add_header</span> <span class=\"string\">X-Robots-Tag</span>                         <span class=\"string\">&quot;none&quot;</span>          <span class=\"string\">always;</span></span><br><span class=\"line\">    <span class=\"string\">add_header</span> <span class=\"string\">X-XSS-Protection</span>                     <span class=\"string\">&quot;1; mode=block&quot;</span> <span class=\"string\">always;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Remove X-Powered-By, which is an information leak</span></span><br><span class=\"line\">    <span class=\"string\">fastcgi_hide_header</span> <span class=\"string\">X-Powered-By;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Specify how to handle directories -- specifying `/index.php$request_uri`</span></span><br><span class=\"line\">    <span class=\"comment\"># here as the fallback means that Nginx always exhibits the desired behaviour</span></span><br><span class=\"line\">    <span class=\"comment\"># when a client requests a path that corresponds to a directory that exists</span></span><br><span class=\"line\">    <span class=\"comment\"># on the server. In particular, if that directory contains an index.php file,</span></span><br><span class=\"line\">    <span class=\"comment\"># that file is correctly served; if it doesn&#x27;t, then the request is passed to</span></span><br><span class=\"line\">    <span class=\"comment\"># the front-end controller. This consistent behaviour means that we don&#x27;t need</span></span><br><span class=\"line\">    <span class=\"comment\"># to specify custom rules for certain paths (e.g. images and other assets,</span></span><br><span class=\"line\">    <span class=\"comment\"># `/updater`, `/ocm-provider`, `/ocs-provider`), and thus</span></span><br><span class=\"line\">    <span class=\"comment\"># `try_files $uri $uri/ /index.php$request_uri`</span></span><br><span class=\"line\">    <span class=\"comment\"># always provides the desired behaviour.</span></span><br><span class=\"line\">    <span class=\"string\">index</span> <span class=\"string\">index.php</span> <span class=\"string\">index.html</span> <span class=\"string\">/index.php$request_uri;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Rule borrowed from `.htaccess` to handle Microsoft DAV clients</span></span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">=</span> <span class=\"string\">/</span> &#123;</span><br><span class=\"line\">        <span class=\"string\">if</span> <span class=\"string\">(</span> <span class=\"string\">$http_user_agent</span> <span class=\"string\">~</span> <span class=\"string\">^DavClnt</span> <span class=\"string\">)</span> &#123;</span><br><span class=\"line\">            <span class=\"string\">return</span> <span class=\"number\">302</span> <span class=\"string\">/remote.php/webdav/$is_args$args;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">=</span> <span class=\"string\">/robots.txt</span> &#123;</span><br><span class=\"line\">        <span class=\"string\">allow</span> <span class=\"string\">all;</span></span><br><span class=\"line\">        <span class=\"string\">log_not_found</span> <span class=\"string\">off;</span></span><br><span class=\"line\">        <span class=\"string\">access_log</span> <span class=\"string\">off;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Make a regex exception for `/.well-known` so that clients can still</span></span><br><span class=\"line\">    <span class=\"comment\"># access it despite the existence of the regex rule</span></span><br><span class=\"line\">    <span class=\"comment\"># `location ~ /(\\.|autotest|...)` which would otherwise handle requests</span></span><br><span class=\"line\">    <span class=\"comment\"># for `/.well-known`.</span></span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">^~</span> <span class=\"string\">/.well-known</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\"># The rules in this block are an adaptation of the rules</span></span><br><span class=\"line\">        <span class=\"comment\"># in `.htaccess` that concern `/.well-known`.</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"string\">location</span> <span class=\"string\">=</span> <span class=\"string\">/.well-known/carddav</span> &#123; <span class=\"string\">return</span> <span class=\"number\">301</span> <span class=\"string\">/remote.php/dav/;</span> &#125;</span><br><span class=\"line\">        <span class=\"string\">location</span> <span class=\"string\">=</span> <span class=\"string\">/.well-known/caldav</span>  &#123; <span class=\"string\">return</span> <span class=\"number\">301</span> <span class=\"string\">/remote.php/dav/;</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"string\">location</span> <span class=\"string\">/.well-known/acme-challenge</span>    &#123; <span class=\"string\">try_files</span> <span class=\"string\">$uri</span> <span class=\"string\">$uri/</span> <span class=\"string\">=404;</span> &#125;</span><br><span class=\"line\">        <span class=\"string\">location</span> <span class=\"string\">/.well-known/pki-validation</span>    &#123; <span class=\"string\">try_files</span> <span class=\"string\">$uri</span> <span class=\"string\">$uri/</span> <span class=\"string\">=404;</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># Let Nextcloud&#x27;s API for `/.well-known` URIs handle all other</span></span><br><span class=\"line\">        <span class=\"comment\"># requests by passing them to the front-end controller.</span></span><br><span class=\"line\">        <span class=\"string\">return</span> <span class=\"number\">301</span> <span class=\"string\">/index.php$request_uri;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Rules borrowed from `.htaccess` to hide certain paths from clients</span></span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">~</span> <span class=\"string\">^/(?:build|tests|config|lib|3rdparty|templates|data)(?:$|/)</span>  &#123; <span class=\"string\">return</span> <span class=\"number\">404</span><span class=\"string\">;</span> &#125;</span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">~</span> <span class=\"string\">^/(?:\\.|autotest|occ|issue|indie|db_|console)</span>                &#123; <span class=\"string\">return</span> <span class=\"number\">404</span><span class=\"string\">;</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Ensure this block, which passes PHP files to the PHP process, is above the blocks</span></span><br><span class=\"line\">    <span class=\"comment\"># which handle static assets (as seen below). If this block is not declared first,</span></span><br><span class=\"line\">    <span class=\"comment\"># then Nginx will encounter an infinite rewriting loop when it prepends `/index.php`</span></span><br><span class=\"line\">    <span class=\"comment\"># to the URI, resulting in a HTTP 500 error response.</span></span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">~</span> <span class=\"string\">\\.php(?:$|/)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\"># Required for legacy support</span></span><br><span class=\"line\">        <span class=\"string\">rewrite</span> <span class=\"string\">^/(?!index|remote|public|cron|core\\/ajax\\/update|status|ocs\\/v</span>[<span class=\"number\">12</span>]<span class=\"string\">|updater\\/.+|oc</span>[<span class=\"string\">ms</span>]<span class=\"string\">-provider\\/.+|.+\\/richdocumentscode\\/proxy)</span> <span class=\"string\">/index.php$request_uri;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"string\">fastcgi_split_path_info</span> <span class=\"string\">^(.+?\\.php)(/.*)$;</span></span><br><span class=\"line\">        <span class=\"string\">set</span> <span class=\"string\">$path_info</span> <span class=\"string\">$fastcgi_path_info;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"string\">try_files</span> <span class=\"string\">$fastcgi_script_name</span> <span class=\"string\">=404;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"string\">include</span> <span class=\"string\">fastcgi_params;</span></span><br><span class=\"line\">        <span class=\"string\">fastcgi_param</span> <span class=\"string\">SCRIPT_FILENAME</span> <span class=\"string\">$document_root$fastcgi_script_name;</span></span><br><span class=\"line\">        <span class=\"string\">fastcgi_param</span> <span class=\"string\">PATH_INFO</span> <span class=\"string\">$path_info;</span></span><br><span class=\"line\">        <span class=\"string\">fastcgi_param</span> <span class=\"string\">HTTPS</span> <span class=\"string\">on;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"string\">fastcgi_param</span> <span class=\"string\">modHeadersAvailable</span> <span class=\"literal\">true</span><span class=\"string\">;</span>         <span class=\"comment\"># Avoid sending the security headers twice</span></span><br><span class=\"line\">        <span class=\"string\">fastcgi_param</span> <span class=\"string\">front_controller_active</span> <span class=\"literal\">true</span><span class=\"string\">;</span>     <span class=\"comment\"># Enable pretty urls</span></span><br><span class=\"line\">        <span class=\"string\">fastcgi_pass</span> <span class=\"string\">php-handler;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"string\">fastcgi_intercept_errors</span> <span class=\"string\">on;</span></span><br><span class=\"line\">        <span class=\"string\">fastcgi_request_buffering</span> <span class=\"string\">off;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"string\">fastcgi_max_temp_file_size</span> <span class=\"number\">0</span><span class=\"string\">;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">~</span> <span class=\"string\">\\.(?:css|js|svg|gif|png|jpg|ico|wasm|tflite|map)$</span> &#123;</span><br><span class=\"line\">        <span class=\"string\">try_files</span> <span class=\"string\">$uri</span> <span class=\"string\">/index.php$request_uri;</span></span><br><span class=\"line\">        <span class=\"string\">add_header</span> <span class=\"string\">Cache-Control</span> <span class=\"string\">&quot;public, max-age=15778463, $asset_immutable&quot;</span><span class=\"string\">;</span></span><br><span class=\"line\">        <span class=\"string\">access_log</span> <span class=\"string\">off;</span>     <span class=\"comment\"># Optional: Don&#x27;t log access to assets</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"string\">location</span> <span class=\"string\">~</span> <span class=\"string\">\\.wasm$</span> &#123;</span><br><span class=\"line\">            <span class=\"string\">default_type</span> <span class=\"string\">application/wasm;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">~</span> <span class=\"string\">\\.woff2?$</span> &#123;</span><br><span class=\"line\">        <span class=\"string\">try_files</span> <span class=\"string\">$uri</span> <span class=\"string\">/index.php$request_uri;</span></span><br><span class=\"line\">        <span class=\"string\">expires</span> <span class=\"string\">7d;</span>         <span class=\"comment\"># Cache-Control policy borrowed from `.htaccess`</span></span><br><span class=\"line\">        <span class=\"string\">access_log</span> <span class=\"string\">off;</span>     <span class=\"comment\"># Optional: Don&#x27;t log access to assets</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Rule borrowed from `.htaccess`</span></span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">/remote</span> &#123;</span><br><span class=\"line\">        <span class=\"string\">return</span> <span class=\"number\">301</span> <span class=\"string\">/remote.php$request_uri;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">/</span> &#123;</span><br><span class=\"line\">        <span class=\"string\">try_files</span> <span class=\"string\">$uri</span> <span class=\"string\">$uri/</span> <span class=\"string\">/index.php$request_uri;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"常见问题\"><a href=\"#常见问题\" class=\"headerlink\" title=\"常见问题\"></a>常见问题</h2><ol>\n<li><p>Can’t write into config directory! This can usually be fixed by giving the webserver write access to the config directory.</p>\n</li>\n<li><p>Can’t write into apps directory! This can usually be fixed by giving the webserver write access to the config directory.</p>\n</li>\n</ol>\n<p>解决: 注意这两个位置的权限</p>\n<p>php74-fpm应有下面两个目录的写权限</p>\n<p><code>/usr/share/nginx/nextcloud/config</code><br><code>/usr/share/nginx/nextcloud/apps</code></p>\n<p>chown -R php用户:php组  <code>/usr/share/nginx/nextcloud/config</code><br>chown -R php用户:php组  <code>/usr/share/nginx/nextcloud/apps</code></p>\n<p>或者: </p>\n<p>chmod -R 777 <code>/usr/share/nginx/nextcloud/config</code><br>chmod -R 777 <code>/usr/share/nginx/nextcloud/apps</code></p>\n"},{"title":"私有CA签署https证书","date":"2022-11-24T06:35:13.000Z","_content":"\n\n## 零、 生成 CA 私钥\n\n``` openssl genrsa -des3 -out root-ca.key 2048 ```\n\n**由于是根CA的私钥，这里系统要求一定要输入密码**\n**也有可能是des3算法的原因，没有具体测试**\n\n<img src=\"/images/031.ca.md.01.png\" width=100% height=100% />\n\n## 一、 生成 CA 证书\n\n### 1.1 非交互式回答CSR信息\n\n\n``` bash\nopenssl req -x509 -new -nodes -sha256 -days 7300  \\\n            -key root-ca.key \\\n            -out root-ca.crt \\\n            -subj \"/C=CN/ST=Zhejiang/L=Hangzhou/O=root/OU=root/CN=root\"\n```\n**参数含义**\n\n``` bash\nC  : Country Name                      # 国家\nST :State or Province Name             # 省/州\nL  :Locality Name                      # 城市\nO  :Organization Name                  # 组织名称\nOU :Organizational Unit Name           # 组织单位名称\nCN :Common Name                        # 名称\n``` \n\n### 1.2 交互式应答生成\n\n``` openssl req -x509 -new -nodes -sha256 -days 7300  -key root-ca.key -out root-ca.crt ```\n\n**交互式生成CSR要求留email地址**\n``` \n[root@localhost CA]# openssl req -x509 -new -nodes -sha256 -days 720 -key root-ca.key -out root-ca.crt \\\n> \nEnter pass phrase for root-ca.key:\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [XX]:CN\nState or Province Name (full name) []:Zhejiang\nLocality Name (eg, city) [Default City]:Hangzhou\nOrganization Name (eg, company) [Default Company Ltd]:root\nOrganizational Unit Name (eg, section) []:root\nCommon Name (eg, your name or your server's hostname) []:root\nEmail Address []:@root.com     \n[root@localhost CA]# \n```\n\n### 1.3 查看证书\n\n``` openssl x509 -in root-ca.crt -noout -text ```\n\n```\n[root@localhost CA]# openssl x509 -in root-ca.crt -noout -text\nCertificate:\n    Data:\n        Version: 3 (0x2)\n        Serial Number:\n            83:6d:15:68:11:48:42:af\n    Signature Algorithm: sha256WithRSAEncryption\n        Issuer: C=CN, ST=Zhejiang, L=Hangzhou, O=root, OU=root, CN=root\n        Validity\n            Not Before: Sep 21 17:46:03 2023 GMT\n            Not After : Sep 16 17:46:03 2043 GMT\n        Subject: C=CN, ST=Zhejiang, L=Hangzhou, O=root, OU=root, CN=root\n        Subject Public Key Info:\n            Public Key Algorithm: rsaEncryption\n                Public-Key: (2048 bit)\n                Modulus:\n                    00:d9:6c:a1:a7:2c:a4:d1:32:3a:c3:40:63:7f:5e:\n                    79:20:4f:cc:1e:99:e2:38:98:e8:e1:64:7c:39:7d:\n                    b9:ed:10:20:d5:06:7f:27:13:bf:b8:07:fc:9a:48:\n                    01:21:a0:6b:7b:ae:4e:be:8f:f2:43:02:8c:5e:14:\n                    56:cf:8b:fa:e0:6e:5f:1c:5c:4e:d7:3a:17:b2:f7:\n                    58:aa:ef:4c:6b:e4:cd:38:cf:92:7e:15:e5:52:66:\n                    c2:b1:47:4d:2e:74:49:a9:4a:bc:1e:60:c2:48:7d:\n                    6b:16:c5:34:46:23:2c:3c:dc:19:f0:d5:ba:a8:b7:\n                    43:3b:7f:a0:65:21:26:78:0d:de:96:60:c7:58:50:\n                    64:bd:7c:9d:8b:68:55:f7:d2:ed:40:ad:b7:f1:50:\n                    e2:9d:ac:e6:a3:b6:0e:4d:12:ab:50:54:5b:3e:62:\n                    68:ad:6f:dd:8f:50:b5:20:25:28:46:4d:24:42:99:\n                    c1:ae:60:08:42:c6:40:aa:e1:3c:fc:59:ce:17:39:\n                    a9:b2:54:6b:fb:62:f0:11:4e:91:45:e9:6a:90:b6:\n                    e6:ab:27:82:50:3b:b2:66:44:47:0e:73:1d:cd:65:\n                    4c:c8:c8:3c:f7:b1:2c:ff:2a:55:c7:90:be:14:17:\n                    24:2b:05:69:18:fd:51:23:28:39:6a:3c:7b:52:e9:\n                    cb:4b\n                Exponent: 65537 (0x10001)\n        X509v3 extensions:\n            X509v3 Subject Key Identifier: \n                A0:6F:B7:44:0F:E4:57:9C:B0:64:72:EE:00:BE:D1:D7:D6:BA:E2:F5\n            X509v3 Authority Key Identifier: \n                keyid:A0:6F:B7:44:0F:E4:57:9C:B0:64:72:EE:00:BE:D1:D7:D6:BA:E2:F5\n\n            X509v3 Basic Constraints: \n                CA:TRUE\n    Signature Algorithm: sha256WithRSAEncryption\n         0c:66:dc:ea:7d:ad:84:d2:a2:a2:1e:76:87:d3:14:62:85:1d:\n         63:f4:d0:2d:a7:5b:3c:42:24:45:21:85:d6:d1:29:02:aa:4d:\n         8b:21:1d:10:13:7a:dd:b6:c7:fd:2a:68:44:85:3a:62:86:2d:\n         db:31:34:64:d6:c2:44:a3:78:18:85:ba:24:fe:ce:ed:f1:9a:\n         25:90:76:da:f8:10:b1:67:f8:b0:35:47:a2:1d:5d:88:f5:d8:\n         5a:c7:34:36:06:bd:4d:eb:db:6c:39:4d:56:9c:7a:8f:0e:19:\n         e6:97:43:5d:87:ca:79:52:e8:be:eb:3e:08:a3:d6:17:22:b3:\n         d9:ff:67:ef:1f:43:28:b1:4c:c7:d1:7f:fa:0b:b5:2c:65:47:\n         ed:16:cd:07:f0:1d:15:64:5e:c6:74:9c:b8:78:59:a6:1f:07:\n         3a:ec:1c:54:d4:18:33:bc:00:b5:5b:f3:25:87:4d:63:d8:dd:\n         37:e6:88:a1:e8:9e:49:0f:88:cf:5e:d0:73:68:84:fe:8e:3c:\n         b6:05:fb:51:3b:e9:62:e8:43:2c:e4:ed:83:85:43:86:f7:ee:\n         f8:52:b7:26:ae:6a:58:ed:69:9a:78:a7:9c:0a:49:1d:7e:38:\n         31:e5:a0:21:ab:cb:2a:85:59:7a:97:29:7e:96:06:c9:93:75:\n         15:83:74:88\n[root@localhost CA]#\n```\n\n\n\n## 二、 生成 ssl 私钥\n\n``` openssl genrsa -out mdzz.wang.key 2048 ``` \n\n## 三、 生成 签名请求\n\n``` bash\nopenssl req -new -key mdzz.wang.key -out mdzz.wang.csr \n\t\t \t\t -subj \"/C=CN/ST=Zhejiang/L=Hangzhou/O=mdzz/OU=mdzz/CN=mdzz.wang\"\n```\n\n## 四、 域名附加配置文件\n\n``` vim cert.ext ```\n\n``` bash\nauthorityKeyIdentifier=keyid,issuer\nbasicConstraints=CA:FALSE\nkeyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment\nsubjectAltName = @alt_names\n\n[alt_names]\nDNS.1 = localhost\nIP.2 = 127.0.0.1\nDNS.3 = mdzz.com\nDNS.4 = *.mdzz.com\n```\n\n## 五、 CA 签署ssl证书\n\n``` bash\nopenssl x509 -req -in mdzz.wang.csr -out mdzz.wang.crt -days 365 \\\n             -CAcreateserial -CA root-ca.crt -CAkey root-ca.key \\\n             -CAserial serial -extfile cert.ext\n```\n\n### 5.1 查看证书\n\n<img src=\"/images/031.ca.md.02.png\" width=100% height=100% />\n\n\n## 总结\n\n1. **创建CA机构**\n    1.1 **创建CA密钥**\n    1.2 **生成CA证书**\n2. **为网站mdzz.wang创建https私钥**\n3. **为网站mdzz.wang生成CSR请求文件**\n4. **使用CA为mdzz.wang颁发证书**\n\n\n\n## 六、 快速构建https证书\n\n**某些情况只需要配置https证书, 不要受信任的CA签名的时候**\n\n### 6.1 生成私钥\n\n``` openssl genrsa -des3 -out test.key 2048 ```\n\n### 6.2 使用私钥自签证书\n\n``` bash\nopenssl req \\\n         -newkey rsa:2048 -nodes -keyout test.key \\\n         -x509 -days 365 -out test.crt \\\n         -subj \"/C=CN/ST=Zhejiang/L=Hangzhou/O=test/OU=test/CN=test\"\n```\n\n### 6.3 证书验证\n\n<img src=\"/images/031.ca.md.03.png\" width=100% height=100% />\n","source":"_posts/031.ca.md","raw":"---\ntitle: 私有CA签署https证书\ndate: 2022-11-24 14:35:13\ncategories: \n- [DevOps]\n- [CentOS]\ntags: \n- CA\n- openssl\n- https\n---\n\n\n## 零、 生成 CA 私钥\n\n``` openssl genrsa -des3 -out root-ca.key 2048 ```\n\n**由于是根CA的私钥，这里系统要求一定要输入密码**\n**也有可能是des3算法的原因，没有具体测试**\n\n<img src=\"/images/031.ca.md.01.png\" width=100% height=100% />\n\n## 一、 生成 CA 证书\n\n### 1.1 非交互式回答CSR信息\n\n\n``` bash\nopenssl req -x509 -new -nodes -sha256 -days 7300  \\\n            -key root-ca.key \\\n            -out root-ca.crt \\\n            -subj \"/C=CN/ST=Zhejiang/L=Hangzhou/O=root/OU=root/CN=root\"\n```\n**参数含义**\n\n``` bash\nC  : Country Name                      # 国家\nST :State or Province Name             # 省/州\nL  :Locality Name                      # 城市\nO  :Organization Name                  # 组织名称\nOU :Organizational Unit Name           # 组织单位名称\nCN :Common Name                        # 名称\n``` \n\n### 1.2 交互式应答生成\n\n``` openssl req -x509 -new -nodes -sha256 -days 7300  -key root-ca.key -out root-ca.crt ```\n\n**交互式生成CSR要求留email地址**\n``` \n[root@localhost CA]# openssl req -x509 -new -nodes -sha256 -days 720 -key root-ca.key -out root-ca.crt \\\n> \nEnter pass phrase for root-ca.key:\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [XX]:CN\nState or Province Name (full name) []:Zhejiang\nLocality Name (eg, city) [Default City]:Hangzhou\nOrganization Name (eg, company) [Default Company Ltd]:root\nOrganizational Unit Name (eg, section) []:root\nCommon Name (eg, your name or your server's hostname) []:root\nEmail Address []:@root.com     \n[root@localhost CA]# \n```\n\n### 1.3 查看证书\n\n``` openssl x509 -in root-ca.crt -noout -text ```\n\n```\n[root@localhost CA]# openssl x509 -in root-ca.crt -noout -text\nCertificate:\n    Data:\n        Version: 3 (0x2)\n        Serial Number:\n            83:6d:15:68:11:48:42:af\n    Signature Algorithm: sha256WithRSAEncryption\n        Issuer: C=CN, ST=Zhejiang, L=Hangzhou, O=root, OU=root, CN=root\n        Validity\n            Not Before: Sep 21 17:46:03 2023 GMT\n            Not After : Sep 16 17:46:03 2043 GMT\n        Subject: C=CN, ST=Zhejiang, L=Hangzhou, O=root, OU=root, CN=root\n        Subject Public Key Info:\n            Public Key Algorithm: rsaEncryption\n                Public-Key: (2048 bit)\n                Modulus:\n                    00:d9:6c:a1:a7:2c:a4:d1:32:3a:c3:40:63:7f:5e:\n                    79:20:4f:cc:1e:99:e2:38:98:e8:e1:64:7c:39:7d:\n                    b9:ed:10:20:d5:06:7f:27:13:bf:b8:07:fc:9a:48:\n                    01:21:a0:6b:7b:ae:4e:be:8f:f2:43:02:8c:5e:14:\n                    56:cf:8b:fa:e0:6e:5f:1c:5c:4e:d7:3a:17:b2:f7:\n                    58:aa:ef:4c:6b:e4:cd:38:cf:92:7e:15:e5:52:66:\n                    c2:b1:47:4d:2e:74:49:a9:4a:bc:1e:60:c2:48:7d:\n                    6b:16:c5:34:46:23:2c:3c:dc:19:f0:d5:ba:a8:b7:\n                    43:3b:7f:a0:65:21:26:78:0d:de:96:60:c7:58:50:\n                    64:bd:7c:9d:8b:68:55:f7:d2:ed:40:ad:b7:f1:50:\n                    e2:9d:ac:e6:a3:b6:0e:4d:12:ab:50:54:5b:3e:62:\n                    68:ad:6f:dd:8f:50:b5:20:25:28:46:4d:24:42:99:\n                    c1:ae:60:08:42:c6:40:aa:e1:3c:fc:59:ce:17:39:\n                    a9:b2:54:6b:fb:62:f0:11:4e:91:45:e9:6a:90:b6:\n                    e6:ab:27:82:50:3b:b2:66:44:47:0e:73:1d:cd:65:\n                    4c:c8:c8:3c:f7:b1:2c:ff:2a:55:c7:90:be:14:17:\n                    24:2b:05:69:18:fd:51:23:28:39:6a:3c:7b:52:e9:\n                    cb:4b\n                Exponent: 65537 (0x10001)\n        X509v3 extensions:\n            X509v3 Subject Key Identifier: \n                A0:6F:B7:44:0F:E4:57:9C:B0:64:72:EE:00:BE:D1:D7:D6:BA:E2:F5\n            X509v3 Authority Key Identifier: \n                keyid:A0:6F:B7:44:0F:E4:57:9C:B0:64:72:EE:00:BE:D1:D7:D6:BA:E2:F5\n\n            X509v3 Basic Constraints: \n                CA:TRUE\n    Signature Algorithm: sha256WithRSAEncryption\n         0c:66:dc:ea:7d:ad:84:d2:a2:a2:1e:76:87:d3:14:62:85:1d:\n         63:f4:d0:2d:a7:5b:3c:42:24:45:21:85:d6:d1:29:02:aa:4d:\n         8b:21:1d:10:13:7a:dd:b6:c7:fd:2a:68:44:85:3a:62:86:2d:\n         db:31:34:64:d6:c2:44:a3:78:18:85:ba:24:fe:ce:ed:f1:9a:\n         25:90:76:da:f8:10:b1:67:f8:b0:35:47:a2:1d:5d:88:f5:d8:\n         5a:c7:34:36:06:bd:4d:eb:db:6c:39:4d:56:9c:7a:8f:0e:19:\n         e6:97:43:5d:87:ca:79:52:e8:be:eb:3e:08:a3:d6:17:22:b3:\n         d9:ff:67:ef:1f:43:28:b1:4c:c7:d1:7f:fa:0b:b5:2c:65:47:\n         ed:16:cd:07:f0:1d:15:64:5e:c6:74:9c:b8:78:59:a6:1f:07:\n         3a:ec:1c:54:d4:18:33:bc:00:b5:5b:f3:25:87:4d:63:d8:dd:\n         37:e6:88:a1:e8:9e:49:0f:88:cf:5e:d0:73:68:84:fe:8e:3c:\n         b6:05:fb:51:3b:e9:62:e8:43:2c:e4:ed:83:85:43:86:f7:ee:\n         f8:52:b7:26:ae:6a:58:ed:69:9a:78:a7:9c:0a:49:1d:7e:38:\n         31:e5:a0:21:ab:cb:2a:85:59:7a:97:29:7e:96:06:c9:93:75:\n         15:83:74:88\n[root@localhost CA]#\n```\n\n\n\n## 二、 生成 ssl 私钥\n\n``` openssl genrsa -out mdzz.wang.key 2048 ``` \n\n## 三、 生成 签名请求\n\n``` bash\nopenssl req -new -key mdzz.wang.key -out mdzz.wang.csr \n\t\t \t\t -subj \"/C=CN/ST=Zhejiang/L=Hangzhou/O=mdzz/OU=mdzz/CN=mdzz.wang\"\n```\n\n## 四、 域名附加配置文件\n\n``` vim cert.ext ```\n\n``` bash\nauthorityKeyIdentifier=keyid,issuer\nbasicConstraints=CA:FALSE\nkeyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment\nsubjectAltName = @alt_names\n\n[alt_names]\nDNS.1 = localhost\nIP.2 = 127.0.0.1\nDNS.3 = mdzz.com\nDNS.4 = *.mdzz.com\n```\n\n## 五、 CA 签署ssl证书\n\n``` bash\nopenssl x509 -req -in mdzz.wang.csr -out mdzz.wang.crt -days 365 \\\n             -CAcreateserial -CA root-ca.crt -CAkey root-ca.key \\\n             -CAserial serial -extfile cert.ext\n```\n\n### 5.1 查看证书\n\n<img src=\"/images/031.ca.md.02.png\" width=100% height=100% />\n\n\n## 总结\n\n1. **创建CA机构**\n    1.1 **创建CA密钥**\n    1.2 **生成CA证书**\n2. **为网站mdzz.wang创建https私钥**\n3. **为网站mdzz.wang生成CSR请求文件**\n4. **使用CA为mdzz.wang颁发证书**\n\n\n\n## 六、 快速构建https证书\n\n**某些情况只需要配置https证书, 不要受信任的CA签名的时候**\n\n### 6.1 生成私钥\n\n``` openssl genrsa -des3 -out test.key 2048 ```\n\n### 6.2 使用私钥自签证书\n\n``` bash\nopenssl req \\\n         -newkey rsa:2048 -nodes -keyout test.key \\\n         -x509 -days 365 -out test.crt \\\n         -subj \"/C=CN/ST=Zhejiang/L=Hangzhou/O=test/OU=test/CN=test\"\n```\n\n### 6.3 证书验证\n\n<img src=\"/images/031.ca.md.03.png\" width=100% height=100% />\n","slug":"031.ca","published":1,"updated":"2023-12-05T08:52:30.878Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzck0030ijnr6vuj9035","content":"<h2 id=\"零、-生成-CA-私钥\"><a href=\"#零、-生成-CA-私钥\" class=\"headerlink\" title=\"零、 生成 CA 私钥\"></a>零、 生成 CA 私钥</h2><p><code>openssl genrsa -des3 -out root-ca.key 2048</code></p>\n<p><strong>由于是根CA的私钥，这里系统要求一定要输入密码</strong><br><strong>也有可能是des3算法的原因，没有具体测试</strong></p>\n<img src=\"/images/031.ca.md.01.png\" width=100% height=100% />\n\n<h2 id=\"一、-生成-CA-证书\"><a href=\"#一、-生成-CA-证书\" class=\"headerlink\" title=\"一、 生成 CA 证书\"></a>一、 生成 CA 证书</h2><h3 id=\"1-1-非交互式回答CSR信息\"><a href=\"#1-1-非交互式回答CSR信息\" class=\"headerlink\" title=\"1.1 非交互式回答CSR信息\"></a>1.1 非交互式回答CSR信息</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl req -x509 -new -nodes -sha256 -days 7300  \\</span><br><span class=\"line\">            -key root-ca.key \\</span><br><span class=\"line\">            -out root-ca.crt \\</span><br><span class=\"line\">            -subj <span class=\"string\">&quot;/C=CN/ST=Zhejiang/L=Hangzhou/O=root/OU=root/CN=root&quot;</span></span><br></pre></td></tr></table></figure>\n<p><strong>参数含义</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">C  : Country Name                      <span class=\"comment\"># 国家</span></span><br><span class=\"line\">ST :State or Province Name             <span class=\"comment\"># 省/州</span></span><br><span class=\"line\">L  :Locality Name                      <span class=\"comment\"># 城市</span></span><br><span class=\"line\">O  :Organization Name                  <span class=\"comment\"># 组织名称</span></span><br><span class=\"line\">OU :Organizational Unit Name           <span class=\"comment\"># 组织单位名称</span></span><br><span class=\"line\">CN :Common Name                        <span class=\"comment\"># 名称</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-2-交互式应答生成\"><a href=\"#1-2-交互式应答生成\" class=\"headerlink\" title=\"1.2 交互式应答生成\"></a>1.2 交互式应答生成</h3><p><code>openssl req -x509 -new -nodes -sha256 -days 7300  -key root-ca.key -out root-ca.crt</code></p>\n<p><strong>交互式生成CSR要求留email地址</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost CA]# openssl req -x509 -new -nodes -sha256 -days 720 -key root-ca.key -out root-ca.crt \\</span><br><span class=\"line\">&gt; </span><br><span class=\"line\">Enter pass phrase for root-ca.key:</span><br><span class=\"line\">You are about to be asked to enter information that will be incorporated</span><br><span class=\"line\">into your certificate request.</span><br><span class=\"line\">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class=\"line\">There are quite a few fields but you can leave some blank</span><br><span class=\"line\">For some fields there will be a default value,</span><br><span class=\"line\">If you enter &#x27;.&#x27;, the field will be left blank.</span><br><span class=\"line\">-----</span><br><span class=\"line\">Country Name (2 letter code) [XX]:CN</span><br><span class=\"line\">State or Province Name (full name) []:Zhejiang</span><br><span class=\"line\">Locality Name (eg, city) [Default City]:Hangzhou</span><br><span class=\"line\">Organization Name (eg, company) [Default Company Ltd]:root</span><br><span class=\"line\">Organizational Unit Name (eg, section) []:root</span><br><span class=\"line\">Common Name (eg, your name or your server&#x27;s hostname) []:root</span><br><span class=\"line\">Email Address []:@root.com     </span><br><span class=\"line\">[root@localhost CA]# </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-3-查看证书\"><a href=\"#1-3-查看证书\" class=\"headerlink\" title=\"1.3 查看证书\"></a>1.3 查看证书</h3><p><code>openssl x509 -in root-ca.crt -noout -text</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost CA]# openssl x509 -in root-ca.crt -noout -text</span><br><span class=\"line\">Certificate:</span><br><span class=\"line\">    Data:</span><br><span class=\"line\">        Version: 3 (0x2)</span><br><span class=\"line\">        Serial Number:</span><br><span class=\"line\">            83:6d:15:68:11:48:42:af</span><br><span class=\"line\">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class=\"line\">        Issuer: C=CN, ST=Zhejiang, L=Hangzhou, O=root, OU=root, CN=root</span><br><span class=\"line\">        Validity</span><br><span class=\"line\">            Not Before: Sep 21 17:46:03 2023 GMT</span><br><span class=\"line\">            Not After : Sep 16 17:46:03 2043 GMT</span><br><span class=\"line\">        Subject: C=CN, ST=Zhejiang, L=Hangzhou, O=root, OU=root, CN=root</span><br><span class=\"line\">        Subject Public Key Info:</span><br><span class=\"line\">            Public Key Algorithm: rsaEncryption</span><br><span class=\"line\">                Public-Key: (2048 bit)</span><br><span class=\"line\">                Modulus:</span><br><span class=\"line\">                    00:d9:6c:a1:a7:2c:a4:d1:32:3a:c3:40:63:7f:5e:</span><br><span class=\"line\">                    79:20:4f:cc:1e:99:e2:38:98:e8:e1:64:7c:39:7d:</span><br><span class=\"line\">                    b9:ed:10:20:d5:06:7f:27:13:bf:b8:07:fc:9a:48:</span><br><span class=\"line\">                    01:21:a0:6b:7b:ae:4e:be:8f:f2:43:02:8c:5e:14:</span><br><span class=\"line\">                    56:cf:8b:fa:e0:6e:5f:1c:5c:4e:d7:3a:17:b2:f7:</span><br><span class=\"line\">                    58:aa:ef:4c:6b:e4:cd:38:cf:92:7e:15:e5:52:66:</span><br><span class=\"line\">                    c2:b1:47:4d:2e:74:49:a9:4a:bc:1e:60:c2:48:7d:</span><br><span class=\"line\">                    6b:16:c5:34:46:23:2c:3c:dc:19:f0:d5:ba:a8:b7:</span><br><span class=\"line\">                    43:3b:7f:a0:65:21:26:78:0d:de:96:60:c7:58:50:</span><br><span class=\"line\">                    64:bd:7c:9d:8b:68:55:f7:d2:ed:40:ad:b7:f1:50:</span><br><span class=\"line\">                    e2:9d:ac:e6:a3:b6:0e:4d:12:ab:50:54:5b:3e:62:</span><br><span class=\"line\">                    68:ad:6f:dd:8f:50:b5:20:25:28:46:4d:24:42:99:</span><br><span class=\"line\">                    c1:ae:60:08:42:c6:40:aa:e1:3c:fc:59:ce:17:39:</span><br><span class=\"line\">                    a9:b2:54:6b:fb:62:f0:11:4e:91:45:e9:6a:90:b6:</span><br><span class=\"line\">                    e6:ab:27:82:50:3b:b2:66:44:47:0e:73:1d:cd:65:</span><br><span class=\"line\">                    4c:c8:c8:3c:f7:b1:2c:ff:2a:55:c7:90:be:14:17:</span><br><span class=\"line\">                    24:2b:05:69:18:fd:51:23:28:39:6a:3c:7b:52:e9:</span><br><span class=\"line\">                    cb:4b</span><br><span class=\"line\">                Exponent: 65537 (0x10001)</span><br><span class=\"line\">        X509v3 extensions:</span><br><span class=\"line\">            X509v3 Subject Key Identifier: </span><br><span class=\"line\">                A0:6F:B7:44:0F:E4:57:9C:B0:64:72:EE:00:BE:D1:D7:D6:BA:E2:F5</span><br><span class=\"line\">            X509v3 Authority Key Identifier: </span><br><span class=\"line\">                keyid:A0:6F:B7:44:0F:E4:57:9C:B0:64:72:EE:00:BE:D1:D7:D6:BA:E2:F5</span><br><span class=\"line\"></span><br><span class=\"line\">            X509v3 Basic Constraints: </span><br><span class=\"line\">                CA:TRUE</span><br><span class=\"line\">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class=\"line\">         0c:66:dc:ea:7d:ad:84:d2:a2:a2:1e:76:87:d3:14:62:85:1d:</span><br><span class=\"line\">         63:f4:d0:2d:a7:5b:3c:42:24:45:21:85:d6:d1:29:02:aa:4d:</span><br><span class=\"line\">         8b:21:1d:10:13:7a:dd:b6:c7:fd:2a:68:44:85:3a:62:86:2d:</span><br><span class=\"line\">         db:31:34:64:d6:c2:44:a3:78:18:85:ba:24:fe:ce:ed:f1:9a:</span><br><span class=\"line\">         25:90:76:da:f8:10:b1:67:f8:b0:35:47:a2:1d:5d:88:f5:d8:</span><br><span class=\"line\">         5a:c7:34:36:06:bd:4d:eb:db:6c:39:4d:56:9c:7a:8f:0e:19:</span><br><span class=\"line\">         e6:97:43:5d:87:ca:79:52:e8:be:eb:3e:08:a3:d6:17:22:b3:</span><br><span class=\"line\">         d9:ff:67:ef:1f:43:28:b1:4c:c7:d1:7f:fa:0b:b5:2c:65:47:</span><br><span class=\"line\">         ed:16:cd:07:f0:1d:15:64:5e:c6:74:9c:b8:78:59:a6:1f:07:</span><br><span class=\"line\">         3a:ec:1c:54:d4:18:33:bc:00:b5:5b:f3:25:87:4d:63:d8:dd:</span><br><span class=\"line\">         37:e6:88:a1:e8:9e:49:0f:88:cf:5e:d0:73:68:84:fe:8e:3c:</span><br><span class=\"line\">         b6:05:fb:51:3b:e9:62:e8:43:2c:e4:ed:83:85:43:86:f7:ee:</span><br><span class=\"line\">         f8:52:b7:26:ae:6a:58:ed:69:9a:78:a7:9c:0a:49:1d:7e:38:</span><br><span class=\"line\">         31:e5:a0:21:ab:cb:2a:85:59:7a:97:29:7e:96:06:c9:93:75:</span><br><span class=\"line\">         15:83:74:88</span><br><span class=\"line\">[root@localhost CA]#</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"二、-生成-ssl-私钥\"><a href=\"#二、-生成-ssl-私钥\" class=\"headerlink\" title=\"二、 生成 ssl 私钥\"></a>二、 生成 ssl 私钥</h2><p><code>openssl genrsa -out mdzz.wang.key 2048</code> </p>\n<h2 id=\"三、-生成-签名请求\"><a href=\"#三、-生成-签名请求\" class=\"headerlink\" title=\"三、 生成 签名请求\"></a>三、 生成 签名请求</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl req -new -key mdzz.wang.key -out mdzz.wang.csr </span><br><span class=\"line\">\t\t \t\t -subj <span class=\"string\">&quot;/C=CN/ST=Zhejiang/L=Hangzhou/O=mdzz/OU=mdzz/CN=mdzz.wang&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"四、-域名附加配置文件\"><a href=\"#四、-域名附加配置文件\" class=\"headerlink\" title=\"四、 域名附加配置文件\"></a>四、 域名附加配置文件</h2><p><code>vim cert.ext</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">authorityKeyIdentifier=keyid,issuer</span><br><span class=\"line\">basicConstraints=CA:FALSE</span><br><span class=\"line\">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span><br><span class=\"line\">subjectAltName = @alt_names</span><br><span class=\"line\"></span><br><span class=\"line\">[alt_names]</span><br><span class=\"line\">DNS.1 = localhost</span><br><span class=\"line\">IP.2 = 127.0.0.1</span><br><span class=\"line\">DNS.3 = mdzz.com</span><br><span class=\"line\">DNS.4 = *.mdzz.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"五、-CA-签署ssl证书\"><a href=\"#五、-CA-签署ssl证书\" class=\"headerlink\" title=\"五、 CA 签署ssl证书\"></a>五、 CA 签署ssl证书</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl x509 -req -<span class=\"keyword\">in</span> mdzz.wang.csr -out mdzz.wang.crt -days 365 \\</span><br><span class=\"line\">             -CAcreateserial -CA root-ca.crt -CAkey root-ca.key \\</span><br><span class=\"line\">             -CAserial serial -extfile cert.ext</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-1-查看证书\"><a href=\"#5-1-查看证书\" class=\"headerlink\" title=\"5.1 查看证书\"></a>5.1 查看证书</h3><img src=\"/images/031.ca.md.02.png\" width=100% height=100% />\n\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><ol>\n<li><strong>创建CA机构</strong><br> 1.1 <strong>创建CA密钥</strong><br> 1.2 <strong>生成CA证书</strong></li>\n<li><strong>为网站mdzz.wang创建https私钥</strong></li>\n<li><strong>为网站mdzz.wang生成CSR请求文件</strong></li>\n<li><strong>使用CA为mdzz.wang颁发证书</strong></li>\n</ol>\n<h2 id=\"六、-快速构建https证书\"><a href=\"#六、-快速构建https证书\" class=\"headerlink\" title=\"六、 快速构建https证书\"></a>六、 快速构建https证书</h2><p><strong>某些情况只需要配置https证书, 不要受信任的CA签名的时候</strong></p>\n<h3 id=\"6-1-生成私钥\"><a href=\"#6-1-生成私钥\" class=\"headerlink\" title=\"6.1 生成私钥\"></a>6.1 生成私钥</h3><p><code>openssl genrsa -des3 -out test.key 2048</code></p>\n<h3 id=\"6-2-使用私钥自签证书\"><a href=\"#6-2-使用私钥自签证书\" class=\"headerlink\" title=\"6.2 使用私钥自签证书\"></a>6.2 使用私钥自签证书</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl req \\</span><br><span class=\"line\">         -newkey rsa:2048 -nodes -keyout test.key \\</span><br><span class=\"line\">         -x509 -days 365 -out test.crt \\</span><br><span class=\"line\">         -subj <span class=\"string\">&quot;/C=CN/ST=Zhejiang/L=Hangzhou/O=test/OU=test/CN=test&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6-3-证书验证\"><a href=\"#6-3-证书验证\" class=\"headerlink\" title=\"6.3 证书验证\"></a>6.3 证书验证</h3><img src=\"/images/031.ca.md.03.png\" width=100% height=100% />\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"零、-生成-CA-私钥\"><a href=\"#零、-生成-CA-私钥\" class=\"headerlink\" title=\"零、 生成 CA 私钥\"></a>零、 生成 CA 私钥</h2><p><code>openssl genrsa -des3 -out root-ca.key 2048</code></p>\n<p><strong>由于是根CA的私钥，这里系统要求一定要输入密码</strong><br><strong>也有可能是des3算法的原因，没有具体测试</strong></p>\n<img src=\"/images/031.ca.md.01.png\" width=100% height=100% />\n\n<h2 id=\"一、-生成-CA-证书\"><a href=\"#一、-生成-CA-证书\" class=\"headerlink\" title=\"一、 生成 CA 证书\"></a>一、 生成 CA 证书</h2><h3 id=\"1-1-非交互式回答CSR信息\"><a href=\"#1-1-非交互式回答CSR信息\" class=\"headerlink\" title=\"1.1 非交互式回答CSR信息\"></a>1.1 非交互式回答CSR信息</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl req -x509 -new -nodes -sha256 -days 7300  \\</span><br><span class=\"line\">            -key root-ca.key \\</span><br><span class=\"line\">            -out root-ca.crt \\</span><br><span class=\"line\">            -subj <span class=\"string\">&quot;/C=CN/ST=Zhejiang/L=Hangzhou/O=root/OU=root/CN=root&quot;</span></span><br></pre></td></tr></table></figure>\n<p><strong>参数含义</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">C  : Country Name                      <span class=\"comment\"># 国家</span></span><br><span class=\"line\">ST :State or Province Name             <span class=\"comment\"># 省/州</span></span><br><span class=\"line\">L  :Locality Name                      <span class=\"comment\"># 城市</span></span><br><span class=\"line\">O  :Organization Name                  <span class=\"comment\"># 组织名称</span></span><br><span class=\"line\">OU :Organizational Unit Name           <span class=\"comment\"># 组织单位名称</span></span><br><span class=\"line\">CN :Common Name                        <span class=\"comment\"># 名称</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-2-交互式应答生成\"><a href=\"#1-2-交互式应答生成\" class=\"headerlink\" title=\"1.2 交互式应答生成\"></a>1.2 交互式应答生成</h3><p><code>openssl req -x509 -new -nodes -sha256 -days 7300  -key root-ca.key -out root-ca.crt</code></p>\n<p><strong>交互式生成CSR要求留email地址</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost CA]# openssl req -x509 -new -nodes -sha256 -days 720 -key root-ca.key -out root-ca.crt \\</span><br><span class=\"line\">&gt; </span><br><span class=\"line\">Enter pass phrase for root-ca.key:</span><br><span class=\"line\">You are about to be asked to enter information that will be incorporated</span><br><span class=\"line\">into your certificate request.</span><br><span class=\"line\">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class=\"line\">There are quite a few fields but you can leave some blank</span><br><span class=\"line\">For some fields there will be a default value,</span><br><span class=\"line\">If you enter &#x27;.&#x27;, the field will be left blank.</span><br><span class=\"line\">-----</span><br><span class=\"line\">Country Name (2 letter code) [XX]:CN</span><br><span class=\"line\">State or Province Name (full name) []:Zhejiang</span><br><span class=\"line\">Locality Name (eg, city) [Default City]:Hangzhou</span><br><span class=\"line\">Organization Name (eg, company) [Default Company Ltd]:root</span><br><span class=\"line\">Organizational Unit Name (eg, section) []:root</span><br><span class=\"line\">Common Name (eg, your name or your server&#x27;s hostname) []:root</span><br><span class=\"line\">Email Address []:@root.com     </span><br><span class=\"line\">[root@localhost CA]# </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-3-查看证书\"><a href=\"#1-3-查看证书\" class=\"headerlink\" title=\"1.3 查看证书\"></a>1.3 查看证书</h3><p><code>openssl x509 -in root-ca.crt -noout -text</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost CA]# openssl x509 -in root-ca.crt -noout -text</span><br><span class=\"line\">Certificate:</span><br><span class=\"line\">    Data:</span><br><span class=\"line\">        Version: 3 (0x2)</span><br><span class=\"line\">        Serial Number:</span><br><span class=\"line\">            83:6d:15:68:11:48:42:af</span><br><span class=\"line\">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class=\"line\">        Issuer: C=CN, ST=Zhejiang, L=Hangzhou, O=root, OU=root, CN=root</span><br><span class=\"line\">        Validity</span><br><span class=\"line\">            Not Before: Sep 21 17:46:03 2023 GMT</span><br><span class=\"line\">            Not After : Sep 16 17:46:03 2043 GMT</span><br><span class=\"line\">        Subject: C=CN, ST=Zhejiang, L=Hangzhou, O=root, OU=root, CN=root</span><br><span class=\"line\">        Subject Public Key Info:</span><br><span class=\"line\">            Public Key Algorithm: rsaEncryption</span><br><span class=\"line\">                Public-Key: (2048 bit)</span><br><span class=\"line\">                Modulus:</span><br><span class=\"line\">                    00:d9:6c:a1:a7:2c:a4:d1:32:3a:c3:40:63:7f:5e:</span><br><span class=\"line\">                    79:20:4f:cc:1e:99:e2:38:98:e8:e1:64:7c:39:7d:</span><br><span class=\"line\">                    b9:ed:10:20:d5:06:7f:27:13:bf:b8:07:fc:9a:48:</span><br><span class=\"line\">                    01:21:a0:6b:7b:ae:4e:be:8f:f2:43:02:8c:5e:14:</span><br><span class=\"line\">                    56:cf:8b:fa:e0:6e:5f:1c:5c:4e:d7:3a:17:b2:f7:</span><br><span class=\"line\">                    58:aa:ef:4c:6b:e4:cd:38:cf:92:7e:15:e5:52:66:</span><br><span class=\"line\">                    c2:b1:47:4d:2e:74:49:a9:4a:bc:1e:60:c2:48:7d:</span><br><span class=\"line\">                    6b:16:c5:34:46:23:2c:3c:dc:19:f0:d5:ba:a8:b7:</span><br><span class=\"line\">                    43:3b:7f:a0:65:21:26:78:0d:de:96:60:c7:58:50:</span><br><span class=\"line\">                    64:bd:7c:9d:8b:68:55:f7:d2:ed:40:ad:b7:f1:50:</span><br><span class=\"line\">                    e2:9d:ac:e6:a3:b6:0e:4d:12:ab:50:54:5b:3e:62:</span><br><span class=\"line\">                    68:ad:6f:dd:8f:50:b5:20:25:28:46:4d:24:42:99:</span><br><span class=\"line\">                    c1:ae:60:08:42:c6:40:aa:e1:3c:fc:59:ce:17:39:</span><br><span class=\"line\">                    a9:b2:54:6b:fb:62:f0:11:4e:91:45:e9:6a:90:b6:</span><br><span class=\"line\">                    e6:ab:27:82:50:3b:b2:66:44:47:0e:73:1d:cd:65:</span><br><span class=\"line\">                    4c:c8:c8:3c:f7:b1:2c:ff:2a:55:c7:90:be:14:17:</span><br><span class=\"line\">                    24:2b:05:69:18:fd:51:23:28:39:6a:3c:7b:52:e9:</span><br><span class=\"line\">                    cb:4b</span><br><span class=\"line\">                Exponent: 65537 (0x10001)</span><br><span class=\"line\">        X509v3 extensions:</span><br><span class=\"line\">            X509v3 Subject Key Identifier: </span><br><span class=\"line\">                A0:6F:B7:44:0F:E4:57:9C:B0:64:72:EE:00:BE:D1:D7:D6:BA:E2:F5</span><br><span class=\"line\">            X509v3 Authority Key Identifier: </span><br><span class=\"line\">                keyid:A0:6F:B7:44:0F:E4:57:9C:B0:64:72:EE:00:BE:D1:D7:D6:BA:E2:F5</span><br><span class=\"line\"></span><br><span class=\"line\">            X509v3 Basic Constraints: </span><br><span class=\"line\">                CA:TRUE</span><br><span class=\"line\">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class=\"line\">         0c:66:dc:ea:7d:ad:84:d2:a2:a2:1e:76:87:d3:14:62:85:1d:</span><br><span class=\"line\">         63:f4:d0:2d:a7:5b:3c:42:24:45:21:85:d6:d1:29:02:aa:4d:</span><br><span class=\"line\">         8b:21:1d:10:13:7a:dd:b6:c7:fd:2a:68:44:85:3a:62:86:2d:</span><br><span class=\"line\">         db:31:34:64:d6:c2:44:a3:78:18:85:ba:24:fe:ce:ed:f1:9a:</span><br><span class=\"line\">         25:90:76:da:f8:10:b1:67:f8:b0:35:47:a2:1d:5d:88:f5:d8:</span><br><span class=\"line\">         5a:c7:34:36:06:bd:4d:eb:db:6c:39:4d:56:9c:7a:8f:0e:19:</span><br><span class=\"line\">         e6:97:43:5d:87:ca:79:52:e8:be:eb:3e:08:a3:d6:17:22:b3:</span><br><span class=\"line\">         d9:ff:67:ef:1f:43:28:b1:4c:c7:d1:7f:fa:0b:b5:2c:65:47:</span><br><span class=\"line\">         ed:16:cd:07:f0:1d:15:64:5e:c6:74:9c:b8:78:59:a6:1f:07:</span><br><span class=\"line\">         3a:ec:1c:54:d4:18:33:bc:00:b5:5b:f3:25:87:4d:63:d8:dd:</span><br><span class=\"line\">         37:e6:88:a1:e8:9e:49:0f:88:cf:5e:d0:73:68:84:fe:8e:3c:</span><br><span class=\"line\">         b6:05:fb:51:3b:e9:62:e8:43:2c:e4:ed:83:85:43:86:f7:ee:</span><br><span class=\"line\">         f8:52:b7:26:ae:6a:58:ed:69:9a:78:a7:9c:0a:49:1d:7e:38:</span><br><span class=\"line\">         31:e5:a0:21:ab:cb:2a:85:59:7a:97:29:7e:96:06:c9:93:75:</span><br><span class=\"line\">         15:83:74:88</span><br><span class=\"line\">[root@localhost CA]#</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"二、-生成-ssl-私钥\"><a href=\"#二、-生成-ssl-私钥\" class=\"headerlink\" title=\"二、 生成 ssl 私钥\"></a>二、 生成 ssl 私钥</h2><p><code>openssl genrsa -out mdzz.wang.key 2048</code> </p>\n<h2 id=\"三、-生成-签名请求\"><a href=\"#三、-生成-签名请求\" class=\"headerlink\" title=\"三、 生成 签名请求\"></a>三、 生成 签名请求</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl req -new -key mdzz.wang.key -out mdzz.wang.csr </span><br><span class=\"line\">\t\t \t\t -subj <span class=\"string\">&quot;/C=CN/ST=Zhejiang/L=Hangzhou/O=mdzz/OU=mdzz/CN=mdzz.wang&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"四、-域名附加配置文件\"><a href=\"#四、-域名附加配置文件\" class=\"headerlink\" title=\"四、 域名附加配置文件\"></a>四、 域名附加配置文件</h2><p><code>vim cert.ext</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">authorityKeyIdentifier=keyid,issuer</span><br><span class=\"line\">basicConstraints=CA:FALSE</span><br><span class=\"line\">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span><br><span class=\"line\">subjectAltName = @alt_names</span><br><span class=\"line\"></span><br><span class=\"line\">[alt_names]</span><br><span class=\"line\">DNS.1 = localhost</span><br><span class=\"line\">IP.2 = 127.0.0.1</span><br><span class=\"line\">DNS.3 = mdzz.com</span><br><span class=\"line\">DNS.4 = *.mdzz.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"五、-CA-签署ssl证书\"><a href=\"#五、-CA-签署ssl证书\" class=\"headerlink\" title=\"五、 CA 签署ssl证书\"></a>五、 CA 签署ssl证书</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl x509 -req -<span class=\"keyword\">in</span> mdzz.wang.csr -out mdzz.wang.crt -days 365 \\</span><br><span class=\"line\">             -CAcreateserial -CA root-ca.crt -CAkey root-ca.key \\</span><br><span class=\"line\">             -CAserial serial -extfile cert.ext</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-1-查看证书\"><a href=\"#5-1-查看证书\" class=\"headerlink\" title=\"5.1 查看证书\"></a>5.1 查看证书</h3><img src=\"/images/031.ca.md.02.png\" width=100% height=100% />\n\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><ol>\n<li><strong>创建CA机构</strong><br> 1.1 <strong>创建CA密钥</strong><br> 1.2 <strong>生成CA证书</strong></li>\n<li><strong>为网站mdzz.wang创建https私钥</strong></li>\n<li><strong>为网站mdzz.wang生成CSR请求文件</strong></li>\n<li><strong>使用CA为mdzz.wang颁发证书</strong></li>\n</ol>\n<h2 id=\"六、-快速构建https证书\"><a href=\"#六、-快速构建https证书\" class=\"headerlink\" title=\"六、 快速构建https证书\"></a>六、 快速构建https证书</h2><p><strong>某些情况只需要配置https证书, 不要受信任的CA签名的时候</strong></p>\n<h3 id=\"6-1-生成私钥\"><a href=\"#6-1-生成私钥\" class=\"headerlink\" title=\"6.1 生成私钥\"></a>6.1 生成私钥</h3><p><code>openssl genrsa -des3 -out test.key 2048</code></p>\n<h3 id=\"6-2-使用私钥自签证书\"><a href=\"#6-2-使用私钥自签证书\" class=\"headerlink\" title=\"6.2 使用私钥自签证书\"></a>6.2 使用私钥自签证书</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl req \\</span><br><span class=\"line\">         -newkey rsa:2048 -nodes -keyout test.key \\</span><br><span class=\"line\">         -x509 -days 365 -out test.crt \\</span><br><span class=\"line\">         -subj <span class=\"string\">&quot;/C=CN/ST=Zhejiang/L=Hangzhou/O=test/OU=test/CN=test&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6-3-证书验证\"><a href=\"#6-3-证书验证\" class=\"headerlink\" title=\"6.3 证书验证\"></a>6.3 证书验证</h3><img src=\"/images/031.ca.md.03.png\" width=100% height=100% />\n"},{"title":"acme.sh","date":"2022-11-28T03:22:13.000Z","_content":"\n### 安装 acme.sh\n\n- ``` curl https://get.acme.sh | sh -s email=my@example.com ```\n\n### 获取KID 和KEY\n\n- 完成注册后在https://app.zerossl.com/developer选择EAB Credentials for ACME Clients下方的 generate 复制 ```EAB KID ``` 和 ```EAB HMAC Key```\n\n### 修改 CA\n\n- ``` acme.sh --set-default-ca --server zerossl ```\n\n### 配置\n\n- ``` acme.sh --register-account --server zerossl --eab-kid XXXX --eab-hmac-key XXXX ```\n\n\n### 一个简单的配置实例\n\n1) 生成证书\n\t``` acme.sh --issue -d example.com --webroot $PATH_TO_YOUR_WEBROOT ```\n\n2) 安装证书\n\t``` shell\n\tacme.sh --install-cert -d example.com \\\n\t--cert-file      /path/to/your/certfile/cert.pem  \\\n\t--key-file       /path/to/your/certfile/key.pem  \\\n\t--fullchain-file /path/to/your/certfile/certfilefullchain.pem \\\n\t```","source":"_posts/032.acme.sh.md","raw":"---\ntitle: acme.sh\ndate: 2022-11-28 11:22:13\ncategories: \n- [DevOps]\ntags: \n- ca\n- https\n- acme.sh\n---\n\n### 安装 acme.sh\n\n- ``` curl https://get.acme.sh | sh -s email=my@example.com ```\n\n### 获取KID 和KEY\n\n- 完成注册后在https://app.zerossl.com/developer选择EAB Credentials for ACME Clients下方的 generate 复制 ```EAB KID ``` 和 ```EAB HMAC Key```\n\n### 修改 CA\n\n- ``` acme.sh --set-default-ca --server zerossl ```\n\n### 配置\n\n- ``` acme.sh --register-account --server zerossl --eab-kid XXXX --eab-hmac-key XXXX ```\n\n\n### 一个简单的配置实例\n\n1) 生成证书\n\t``` acme.sh --issue -d example.com --webroot $PATH_TO_YOUR_WEBROOT ```\n\n2) 安装证书\n\t``` shell\n\tacme.sh --install-cert -d example.com \\\n\t--cert-file      /path/to/your/certfile/cert.pem  \\\n\t--key-file       /path/to/your/certfile/key.pem  \\\n\t--fullchain-file /path/to/your/certfile/certfilefullchain.pem \\\n\t```","slug":"032.acme.sh","published":1,"updated":"2023-12-05T08:52:30.878Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzcm0032ijnrflhg7bed","content":"<h3 id=\"安装-acme-sh\"><a href=\"#安装-acme-sh\" class=\"headerlink\" title=\"安装 acme.sh\"></a>安装 acme.sh</h3><ul>\n<li><code>curl https://get.acme.sh | sh -s email=my@example.com</code></li>\n</ul>\n<h3 id=\"获取KID-和KEY\"><a href=\"#获取KID-和KEY\" class=\"headerlink\" title=\"获取KID 和KEY\"></a>获取KID 和KEY</h3><ul>\n<li>完成注册后在<a href=\"https://app.zerossl.com/developer%E9%80%89%E6%8B%A9EAB\">https://app.zerossl.com/developer选择EAB</a> Credentials for ACME Clients下方的 generate 复制 <code>EAB KID </code> 和 <code>EAB HMAC Key</code></li>\n</ul>\n<h3 id=\"修改-CA\"><a href=\"#修改-CA\" class=\"headerlink\" title=\"修改 CA\"></a>修改 CA</h3><ul>\n<li><code>acme.sh --set-default-ca --server zerossl</code></li>\n</ul>\n<h3 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h3><ul>\n<li><code>acme.sh --register-account --server zerossl --eab-kid XXXX --eab-hmac-key XXXX</code></li>\n</ul>\n<h3 id=\"一个简单的配置实例\"><a href=\"#一个简单的配置实例\" class=\"headerlink\" title=\"一个简单的配置实例\"></a>一个简单的配置实例</h3><ol>\n<li><p>生成证书<br> <code>acme.sh --issue -d example.com --webroot $PATH_TO_YOUR_WEBROOT</code></p>\n</li>\n<li><p>安装证书</p>\n <figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">acme.sh --install-cert -d example.com \\</span><br><span class=\"line\">--cert-file      /path/to/your/certfile/cert.pem  \\</span><br><span class=\"line\">--key-file       /path/to/your/certfile/key.pem  \\</span><br><span class=\"line\">--fullchain-file /path/to/your/certfile/certfilefullchain.pem \\</span><br></pre></td></tr></table></figure></li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"安装-acme-sh\"><a href=\"#安装-acme-sh\" class=\"headerlink\" title=\"安装 acme.sh\"></a>安装 acme.sh</h3><ul>\n<li><code>curl https://get.acme.sh | sh -s email=my@example.com</code></li>\n</ul>\n<h3 id=\"获取KID-和KEY\"><a href=\"#获取KID-和KEY\" class=\"headerlink\" title=\"获取KID 和KEY\"></a>获取KID 和KEY</h3><ul>\n<li>完成注册后在<a href=\"https://app.zerossl.com/developer%E9%80%89%E6%8B%A9EAB\">https://app.zerossl.com/developer选择EAB</a> Credentials for ACME Clients下方的 generate 复制 <code>EAB KID </code> 和 <code>EAB HMAC Key</code></li>\n</ul>\n<h3 id=\"修改-CA\"><a href=\"#修改-CA\" class=\"headerlink\" title=\"修改 CA\"></a>修改 CA</h3><ul>\n<li><code>acme.sh --set-default-ca --server zerossl</code></li>\n</ul>\n<h3 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h3><ul>\n<li><code>acme.sh --register-account --server zerossl --eab-kid XXXX --eab-hmac-key XXXX</code></li>\n</ul>\n<h3 id=\"一个简单的配置实例\"><a href=\"#一个简单的配置实例\" class=\"headerlink\" title=\"一个简单的配置实例\"></a>一个简单的配置实例</h3><ol>\n<li><p>生成证书<br> <code>acme.sh --issue -d example.com --webroot $PATH_TO_YOUR_WEBROOT</code></p>\n</li>\n<li><p>安装证书</p>\n <figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">acme.sh --install-cert -d example.com \\</span><br><span class=\"line\">--cert-file      /path/to/your/certfile/cert.pem  \\</span><br><span class=\"line\">--key-file       /path/to/your/certfile/key.pem  \\</span><br><span class=\"line\">--fullchain-file /path/to/your/certfile/certfilefullchain.pem \\</span><br></pre></td></tr></table></figure></li>\n</ol>\n"},{"title":"tcpdump详解","date":"2022-11-29T09:26:13.000Z","_content":"\n\n\n## 简介\n>> tcpdump 是一个在命令行下执行的网络抓包工具。其主要功能是监听并捕获网络数据包，以便分析网络流量或排查网络故障。\ntcpdump 可以指定需要监听的网络接口、协议、过滤规则等参数，捕获到的数据包可以直接在终端上查看或保存到文件中以便后续分析。\n\n## 语法\n\n### 关键字\n\n``` port ``` :**端口**         如：```tcpdump port 443```\n``` host ``` :**主机**         如：```tcpdump host 192.168.1.1```\n``` net ```  :**网络**         如：```tcpdump net 192.168.1.0/24```\n```portrange```:**端口范围**   如: ```tcpdump portrange 20-80```\n```ether``` : **mac地址**      如: ``` tcpdump ether 00:11:22:33:44:55 ```\n### 方向\n\n```src```：**源地址**        如：src 10.1.110.110\n```dst```：**目的地址**      如：dst 10.1.110.110\n\n### 协议\n\n- TCP\n- UDP\n- ICMP\n- IP\n- HTTP（超文本传输协议）\n- FTP（文件传输协议）\n- Telnet\n- SSH（安全外壳协议）\n- DNS（域名系统）\n- SNMP（简单网络管理协议）\n- SMTP（简单邮件传输协议）\n- POP3（邮局协议版本3）\n- IMAP （Internet消息访问协议）\n- SSL/TLS（安全套接层/传输层安全协议）\n- ARP（地址解析协议）\n- DHCP（动态主机配置协议）\n等等\n\n### 表达式\n\n```and``` : 表示 且\n```or```  : 表示 或\n```not``` : 表示 非\n```!```   : \n```&&```\n```|| ```","source":"_posts/033.tcpdump_instances.md","raw":"---\ntitle: tcpdump详解\ndate: 2022-11-29 17:26:13\ncategories: \n- [DevOps]\ntags: \n- tcpdump\n- wireshark\n- 抓包\n---\n\n\n\n## 简介\n>> tcpdump 是一个在命令行下执行的网络抓包工具。其主要功能是监听并捕获网络数据包，以便分析网络流量或排查网络故障。\ntcpdump 可以指定需要监听的网络接口、协议、过滤规则等参数，捕获到的数据包可以直接在终端上查看或保存到文件中以便后续分析。\n\n## 语法\n\n### 关键字\n\n``` port ``` :**端口**         如：```tcpdump port 443```\n``` host ``` :**主机**         如：```tcpdump host 192.168.1.1```\n``` net ```  :**网络**         如：```tcpdump net 192.168.1.0/24```\n```portrange```:**端口范围**   如: ```tcpdump portrange 20-80```\n```ether``` : **mac地址**      如: ``` tcpdump ether 00:11:22:33:44:55 ```\n### 方向\n\n```src```：**源地址**        如：src 10.1.110.110\n```dst```：**目的地址**      如：dst 10.1.110.110\n\n### 协议\n\n- TCP\n- UDP\n- ICMP\n- IP\n- HTTP（超文本传输协议）\n- FTP（文件传输协议）\n- Telnet\n- SSH（安全外壳协议）\n- DNS（域名系统）\n- SNMP（简单网络管理协议）\n- SMTP（简单邮件传输协议）\n- POP3（邮局协议版本3）\n- IMAP （Internet消息访问协议）\n- SSL/TLS（安全套接层/传输层安全协议）\n- ARP（地址解析协议）\n- DHCP（动态主机配置协议）\n等等\n\n### 表达式\n\n```and``` : 表示 且\n```or```  : 表示 或\n```not``` : 表示 非\n```!```   : \n```&&```\n```|| ```","slug":"033.tcpdump_instances","published":1,"updated":"2023-12-05T08:52:30.878Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzco0036ijnr9e8c5rim","content":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><blockquote>\n<blockquote>\n<p>tcpdump 是一个在命令行下执行的网络抓包工具。其主要功能是监听并捕获网络数据包，以便分析网络流量或排查网络故障。<br>tcpdump 可以指定需要监听的网络接口、协议、过滤规则等参数，捕获到的数据包可以直接在终端上查看或保存到文件中以便后续分析。</p>\n</blockquote>\n</blockquote>\n<h2 id=\"语法\"><a href=\"#语法\" class=\"headerlink\" title=\"语法\"></a>语法</h2><h3 id=\"关键字\"><a href=\"#关键字\" class=\"headerlink\" title=\"关键字\"></a>关键字</h3><p><code>port</code> :<strong>端口</strong>         如：<code>tcpdump port 443</code><br><code>host</code> :<strong>主机</strong>         如：<code>tcpdump host 192.168.1.1</code><br><code>net</code>  :<strong>网络</strong>         如：<code>tcpdump net 192.168.1.0/24</code><br><code>portrange</code>:<strong>端口范围</strong>   如: <code>tcpdump portrange 20-80</code><br><code>ether</code> : <strong>mac地址</strong>      如: <code>tcpdump ether 00:11:22:33:44:55</code></p>\n<h3 id=\"方向\"><a href=\"#方向\" class=\"headerlink\" title=\"方向\"></a>方向</h3><p><code>src</code>：<strong>源地址</strong>        如：src 10.1.110.110<br><code>dst</code>：<strong>目的地址</strong>      如：dst 10.1.110.110</p>\n<h3 id=\"协议\"><a href=\"#协议\" class=\"headerlink\" title=\"协议\"></a>协议</h3><ul>\n<li>TCP</li>\n<li>UDP</li>\n<li>ICMP</li>\n<li>IP</li>\n<li>HTTP（超文本传输协议）</li>\n<li>FTP（文件传输协议）</li>\n<li>Telnet</li>\n<li>SSH（安全外壳协议）</li>\n<li>DNS（域名系统）</li>\n<li>SNMP（简单网络管理协议）</li>\n<li>SMTP（简单邮件传输协议）</li>\n<li>POP3（邮局协议版本3）</li>\n<li>IMAP （Internet消息访问协议）</li>\n<li>SSL&#x2F;TLS（安全套接层&#x2F;传输层安全协议）</li>\n<li>ARP（地址解析协议）</li>\n<li>DHCP（动态主机配置协议）<br>等等</li>\n</ul>\n<h3 id=\"表达式\"><a href=\"#表达式\" class=\"headerlink\" title=\"表达式\"></a>表达式</h3><p><code>and</code> : 表示 且<br><code>or</code>  : 表示 或<br><code>not</code> : 表示 非<br><code>!</code>   :<br><code>&amp;&amp;</code><br><code>|| </code></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><blockquote>\n<blockquote>\n<p>tcpdump 是一个在命令行下执行的网络抓包工具。其主要功能是监听并捕获网络数据包，以便分析网络流量或排查网络故障。<br>tcpdump 可以指定需要监听的网络接口、协议、过滤规则等参数，捕获到的数据包可以直接在终端上查看或保存到文件中以便后续分析。</p>\n</blockquote>\n</blockquote>\n<h2 id=\"语法\"><a href=\"#语法\" class=\"headerlink\" title=\"语法\"></a>语法</h2><h3 id=\"关键字\"><a href=\"#关键字\" class=\"headerlink\" title=\"关键字\"></a>关键字</h3><p><code>port</code> :<strong>端口</strong>         如：<code>tcpdump port 443</code><br><code>host</code> :<strong>主机</strong>         如：<code>tcpdump host 192.168.1.1</code><br><code>net</code>  :<strong>网络</strong>         如：<code>tcpdump net 192.168.1.0/24</code><br><code>portrange</code>:<strong>端口范围</strong>   如: <code>tcpdump portrange 20-80</code><br><code>ether</code> : <strong>mac地址</strong>      如: <code>tcpdump ether 00:11:22:33:44:55</code></p>\n<h3 id=\"方向\"><a href=\"#方向\" class=\"headerlink\" title=\"方向\"></a>方向</h3><p><code>src</code>：<strong>源地址</strong>        如：src 10.1.110.110<br><code>dst</code>：<strong>目的地址</strong>      如：dst 10.1.110.110</p>\n<h3 id=\"协议\"><a href=\"#协议\" class=\"headerlink\" title=\"协议\"></a>协议</h3><ul>\n<li>TCP</li>\n<li>UDP</li>\n<li>ICMP</li>\n<li>IP</li>\n<li>HTTP（超文本传输协议）</li>\n<li>FTP（文件传输协议）</li>\n<li>Telnet</li>\n<li>SSH（安全外壳协议）</li>\n<li>DNS（域名系统）</li>\n<li>SNMP（简单网络管理协议）</li>\n<li>SMTP（简单邮件传输协议）</li>\n<li>POP3（邮局协议版本3）</li>\n<li>IMAP （Internet消息访问协议）</li>\n<li>SSL&#x2F;TLS（安全套接层&#x2F;传输层安全协议）</li>\n<li>ARP（地址解析协议）</li>\n<li>DHCP（动态主机配置协议）<br>等等</li>\n</ul>\n<h3 id=\"表达式\"><a href=\"#表达式\" class=\"headerlink\" title=\"表达式\"></a>表达式</h3><p><code>and</code> : 表示 且<br><code>or</code>  : 表示 或<br><code>not</code> : 表示 非<br><code>!</code>   :<br><code>&amp;&amp;</code><br><code>|| </code></p>\n"},{"title":"redis","date":"2022-12-05T06:44:13.000Z","_content":"\n\n## 一、 下载\n``` get --no-check-certificate https://download.redis.io/redis-stable.tar.gz ```\n\n## 二、 解压\n``` tar -xzvf redis-stable.tar.gz```\n\n## 三、 编译安装\n``` cd redis-stable ```\n``` make PREFIX=/usr/local/redis install ```\n\n**报错:** ```zmalloc.h:50:31: fatal error: jemalloc/jemalloc.h: No such file or directory```\n**解决:**  ```make MALLOC=libc PREFIX=/usr/local/redis install```\n\n## 四、 修改配置\n``` cp /root/redis-stable/redis.conf /usr/local/redis/ ```\n\n``` line309: daemonize yes  # 以守护进程方式运行 ```\n\n## 五、 配置systemd\n\n``` shell\n# vim /usr/lib/systemd/system/redis.service\n[Unit]\nDescription=Redis persistent key-value database\nAfter=network.target\nAfter=network-online.target\nWants=network-online.target\n\n[Service]\nType=forking\nExecStart=/usr/local/redis/bin/redis-server /usr/local/redis/redis.conf\nExecReload=/usr/local/redis/bin/redis-server -s reload\nExecStop=/usr/local/redis/bin/redis-cli shutdown\n#Type=notify\n#User=redis\n#Group=redis\n#RuntimeDirectory=redis\n#RuntimeDirectoryMode=0755\n[Install]\nWantedBy=multi-user.target\n```\n\n``` systemctl daemon-reload ```\n``` systemctl enable redis ```\n``` systemctl start redis ```\n``` systemctl status redis ```\n\n## 关闭保护模式\n编辑配置文件: ``` vim /usr/local/redis/redis.conf ```\n111行左右:   ``` protected-mode no```\n\n\n## 配置密码\n编辑配置文件: ``` vim /usr/local/redis/redis.conf ```\n1036行左右:   ``` requirepass $YOURPASSWORD```\n## 验证配置的密码\n<img src=\"/images/034.redis.md.01.png\" width=50% height=60% />","source":"_posts/034.redis.md","raw":"---\ntitle: redis\ndate: 2022-12-05 14:44:13\ncategories: \n- [DevOps]\ntags: \n- redis\n---\n\n\n## 一、 下载\n``` get --no-check-certificate https://download.redis.io/redis-stable.tar.gz ```\n\n## 二、 解压\n``` tar -xzvf redis-stable.tar.gz```\n\n## 三、 编译安装\n``` cd redis-stable ```\n``` make PREFIX=/usr/local/redis install ```\n\n**报错:** ```zmalloc.h:50:31: fatal error: jemalloc/jemalloc.h: No such file or directory```\n**解决:**  ```make MALLOC=libc PREFIX=/usr/local/redis install```\n\n## 四、 修改配置\n``` cp /root/redis-stable/redis.conf /usr/local/redis/ ```\n\n``` line309: daemonize yes  # 以守护进程方式运行 ```\n\n## 五、 配置systemd\n\n``` shell\n# vim /usr/lib/systemd/system/redis.service\n[Unit]\nDescription=Redis persistent key-value database\nAfter=network.target\nAfter=network-online.target\nWants=network-online.target\n\n[Service]\nType=forking\nExecStart=/usr/local/redis/bin/redis-server /usr/local/redis/redis.conf\nExecReload=/usr/local/redis/bin/redis-server -s reload\nExecStop=/usr/local/redis/bin/redis-cli shutdown\n#Type=notify\n#User=redis\n#Group=redis\n#RuntimeDirectory=redis\n#RuntimeDirectoryMode=0755\n[Install]\nWantedBy=multi-user.target\n```\n\n``` systemctl daemon-reload ```\n``` systemctl enable redis ```\n``` systemctl start redis ```\n``` systemctl status redis ```\n\n## 关闭保护模式\n编辑配置文件: ``` vim /usr/local/redis/redis.conf ```\n111行左右:   ``` protected-mode no```\n\n\n## 配置密码\n编辑配置文件: ``` vim /usr/local/redis/redis.conf ```\n1036行左右:   ``` requirepass $YOURPASSWORD```\n## 验证配置的密码\n<img src=\"/images/034.redis.md.01.png\" width=50% height=60% />","slug":"034.redis","published":1,"updated":"2023-12-05T08:52:30.878Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzcq0038ijnraklvati5","content":"<h2 id=\"一、-下载\"><a href=\"#一、-下载\" class=\"headerlink\" title=\"一、 下载\"></a>一、 下载</h2><p><code>get --no-check-certificate https://download.redis.io/redis-stable.tar.gz</code></p>\n<h2 id=\"二、-解压\"><a href=\"#二、-解压\" class=\"headerlink\" title=\"二、 解压\"></a>二、 解压</h2><p><code> tar -xzvf redis-stable.tar.gz</code></p>\n<h2 id=\"三、-编译安装\"><a href=\"#三、-编译安装\" class=\"headerlink\" title=\"三、 编译安装\"></a>三、 编译安装</h2><p><code>cd redis-stable</code><br><code>make PREFIX=/usr/local/redis install</code></p>\n<p><strong>报错:</strong> <code>zmalloc.h:50:31: fatal error: jemalloc/jemalloc.h: No such file or directory</code><br><strong>解决:</strong>  <code>make MALLOC=libc PREFIX=/usr/local/redis install</code></p>\n<h2 id=\"四、-修改配置\"><a href=\"#四、-修改配置\" class=\"headerlink\" title=\"四、 修改配置\"></a>四、 修改配置</h2><p><code>cp /root/redis-stable/redis.conf /usr/local/redis/</code></p>\n<p><code>line309: daemonize yes  # 以守护进程方式运行</code></p>\n<h2 id=\"五、-配置systemd\"><a href=\"#五、-配置systemd\" class=\"headerlink\" title=\"五、 配置systemd\"></a>五、 配置systemd</h2><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">vim /usr/lib/systemd/system/redis.service</span></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Redis persistent key-value database</span><br><span class=\"line\">After=network.target</span><br><span class=\"line\">After=network-online.target</span><br><span class=\"line\">Wants=network-online.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=forking</span><br><span class=\"line\">ExecStart=/usr/local/redis/bin/redis-server /usr/local/redis/redis.conf</span><br><span class=\"line\">ExecReload=/usr/local/redis/bin/redis-server -s reload</span><br><span class=\"line\">ExecStop=/usr/local/redis/bin/redis-cli shutdown</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">Type=notify</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">User=redis</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">Group=redis</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">RuntimeDirectory=redis</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">RuntimeDirectoryMode=0755</span></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<p><code>systemctl daemon-reload</code><br><code>systemctl enable redis</code><br><code>systemctl start redis</code><br><code>systemctl status redis</code></p>\n<h2 id=\"关闭保护模式\"><a href=\"#关闭保护模式\" class=\"headerlink\" title=\"关闭保护模式\"></a>关闭保护模式</h2><p>编辑配置文件: <code>vim /usr/local/redis/redis.conf</code><br>111行左右:   <code> protected-mode no</code></p>\n<h2 id=\"配置密码\"><a href=\"#配置密码\" class=\"headerlink\" title=\"配置密码\"></a>配置密码</h2><p>编辑配置文件: <code>vim /usr/local/redis/redis.conf</code><br>1036行左右:   <code> requirepass $YOURPASSWORD</code></p>\n<h2 id=\"验证配置的密码\"><a href=\"#验证配置的密码\" class=\"headerlink\" title=\"验证配置的密码\"></a>验证配置的密码</h2><img src=\"/images/034.redis.md.01.png\" width=50% height=60% />","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、-下载\"><a href=\"#一、-下载\" class=\"headerlink\" title=\"一、 下载\"></a>一、 下载</h2><p><code>get --no-check-certificate https://download.redis.io/redis-stable.tar.gz</code></p>\n<h2 id=\"二、-解压\"><a href=\"#二、-解压\" class=\"headerlink\" title=\"二、 解压\"></a>二、 解压</h2><p><code> tar -xzvf redis-stable.tar.gz</code></p>\n<h2 id=\"三、-编译安装\"><a href=\"#三、-编译安装\" class=\"headerlink\" title=\"三、 编译安装\"></a>三、 编译安装</h2><p><code>cd redis-stable</code><br><code>make PREFIX=/usr/local/redis install</code></p>\n<p><strong>报错:</strong> <code>zmalloc.h:50:31: fatal error: jemalloc/jemalloc.h: No such file or directory</code><br><strong>解决:</strong>  <code>make MALLOC=libc PREFIX=/usr/local/redis install</code></p>\n<h2 id=\"四、-修改配置\"><a href=\"#四、-修改配置\" class=\"headerlink\" title=\"四、 修改配置\"></a>四、 修改配置</h2><p><code>cp /root/redis-stable/redis.conf /usr/local/redis/</code></p>\n<p><code>line309: daemonize yes  # 以守护进程方式运行</code></p>\n<h2 id=\"五、-配置systemd\"><a href=\"#五、-配置systemd\" class=\"headerlink\" title=\"五、 配置systemd\"></a>五、 配置systemd</h2><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">vim /usr/lib/systemd/system/redis.service</span></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Redis persistent key-value database</span><br><span class=\"line\">After=network.target</span><br><span class=\"line\">After=network-online.target</span><br><span class=\"line\">Wants=network-online.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=forking</span><br><span class=\"line\">ExecStart=/usr/local/redis/bin/redis-server /usr/local/redis/redis.conf</span><br><span class=\"line\">ExecReload=/usr/local/redis/bin/redis-server -s reload</span><br><span class=\"line\">ExecStop=/usr/local/redis/bin/redis-cli shutdown</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">Type=notify</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">User=redis</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">Group=redis</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">RuntimeDirectory=redis</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">RuntimeDirectoryMode=0755</span></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<p><code>systemctl daemon-reload</code><br><code>systemctl enable redis</code><br><code>systemctl start redis</code><br><code>systemctl status redis</code></p>\n<h2 id=\"关闭保护模式\"><a href=\"#关闭保护模式\" class=\"headerlink\" title=\"关闭保护模式\"></a>关闭保护模式</h2><p>编辑配置文件: <code>vim /usr/local/redis/redis.conf</code><br>111行左右:   <code> protected-mode no</code></p>\n<h2 id=\"配置密码\"><a href=\"#配置密码\" class=\"headerlink\" title=\"配置密码\"></a>配置密码</h2><p>编辑配置文件: <code>vim /usr/local/redis/redis.conf</code><br>1036行左右:   <code> requirepass $YOURPASSWORD</code></p>\n<h2 id=\"验证配置的密码\"><a href=\"#验证配置的密码\" class=\"headerlink\" title=\"验证配置的密码\"></a>验证配置的密码</h2><img src=\"/images/034.redis.md.01.png\" width=50% height=60% />"},{"title":"SSH免密登录","date":"2023-03-15T06:44:13.000Z","_content":"\n## 直接上例子\nServer A 192.168.1.1\nServer B 192.168.1.2\n\nServer A\n``` bash\nssh-keygen -t rsa -b4096\nssh-copy-id root@192.168.1.2\n```\n\nServer B\n``` shell\nssh-keygen -t rsa -b4096\nssh-copy-id root@192.168.1.1\n```\n\n## 生成SSH密钥和公钥\n\n``` ssh-keygen -t rsa -b 4096 ```\n``` -t ```: 指定加密算法\n``` -b ```: 指定密钥长度\n``` id_rsa ```: 私钥\n``` id_rsa.pub ```: 公钥\n``` authorized_keys ``` 已保存的公钥\n\n``` tree .ssh/ ```\n![png](/images/035.ssh_key.md.01.png)\n\n## 免密登录\n\n这里, 只需要将本地生成的``` id_rsa.pub ```导入需要被免密登录的服务器的 ``` authorized_keys ```中即可\n复制``` id_rsa.pub ```内容到``` authorized_keys ```也可以\n\n使用命令导入:  \n``` ssh-copy-id username@remote-server ```\n\n\n## 互相免密登录\n\n在另外一台服务器重复上面指令\n","source":"_posts/035.ssh_key.md","raw":"---\ntitle: SSH免密登录\ndate: 2023-3-15 14:44:13\ncategories: \n- [DevOps]\ntags: \n- SSH\n---\n\n## 直接上例子\nServer A 192.168.1.1\nServer B 192.168.1.2\n\nServer A\n``` bash\nssh-keygen -t rsa -b4096\nssh-copy-id root@192.168.1.2\n```\n\nServer B\n``` shell\nssh-keygen -t rsa -b4096\nssh-copy-id root@192.168.1.1\n```\n\n## 生成SSH密钥和公钥\n\n``` ssh-keygen -t rsa -b 4096 ```\n``` -t ```: 指定加密算法\n``` -b ```: 指定密钥长度\n``` id_rsa ```: 私钥\n``` id_rsa.pub ```: 公钥\n``` authorized_keys ``` 已保存的公钥\n\n``` tree .ssh/ ```\n![png](/images/035.ssh_key.md.01.png)\n\n## 免密登录\n\n这里, 只需要将本地生成的``` id_rsa.pub ```导入需要被免密登录的服务器的 ``` authorized_keys ```中即可\n复制``` id_rsa.pub ```内容到``` authorized_keys ```也可以\n\n使用命令导入:  \n``` ssh-copy-id username@remote-server ```\n\n\n## 互相免密登录\n\n在另外一台服务器重复上面指令\n","slug":"035.ssh_key","published":1,"updated":"2023-12-05T08:52:30.878Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzct003cijnrbaye3b8s","content":"<h2 id=\"直接上例子\"><a href=\"#直接上例子\" class=\"headerlink\" title=\"直接上例子\"></a>直接上例子</h2><p>Server A 192.168.1.1<br>Server B 192.168.1.2</p>\n<p>Server A</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -b4096</span><br><span class=\"line\">ssh-copy-id root@192.168.1.2</span><br></pre></td></tr></table></figure>\n\n<p>Server B</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -b4096</span><br><span class=\"line\">ssh-copy-id root@192.168.1.1</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"生成SSH密钥和公钥\"><a href=\"#生成SSH密钥和公钥\" class=\"headerlink\" title=\"生成SSH密钥和公钥\"></a>生成SSH密钥和公钥</h2><p><code>ssh-keygen -t rsa -b 4096</code><br><code>-t</code>: 指定加密算法<br><code>-b</code>: 指定密钥长度<br><code>id_rsa</code>: 私钥<br><code>id_rsa.pub</code>: 公钥<br><code>authorized_keys</code> 已保存的公钥</p>\n<p><code>tree .ssh/</code><br><img src=\"/images/035.ssh_key.md.01.png\" alt=\"png\"></p>\n<h2 id=\"免密登录\"><a href=\"#免密登录\" class=\"headerlink\" title=\"免密登录\"></a>免密登录</h2><p>这里, 只需要将本地生成的<code>id_rsa.pub</code>导入需要被免密登录的服务器的 <code>authorized_keys</code>中即可<br>复制<code>id_rsa.pub</code>内容到<code>authorized_keys</code>也可以</p>\n<p>使用命令导入:<br><code>ssh-copy-id username@remote-server</code></p>\n<h2 id=\"互相免密登录\"><a href=\"#互相免密登录\" class=\"headerlink\" title=\"互相免密登录\"></a>互相免密登录</h2><p>在另外一台服务器重复上面指令</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"直接上例子\"><a href=\"#直接上例子\" class=\"headerlink\" title=\"直接上例子\"></a>直接上例子</h2><p>Server A 192.168.1.1<br>Server B 192.168.1.2</p>\n<p>Server A</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -b4096</span><br><span class=\"line\">ssh-copy-id root@192.168.1.2</span><br></pre></td></tr></table></figure>\n\n<p>Server B</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -b4096</span><br><span class=\"line\">ssh-copy-id root@192.168.1.1</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"生成SSH密钥和公钥\"><a href=\"#生成SSH密钥和公钥\" class=\"headerlink\" title=\"生成SSH密钥和公钥\"></a>生成SSH密钥和公钥</h2><p><code>ssh-keygen -t rsa -b 4096</code><br><code>-t</code>: 指定加密算法<br><code>-b</code>: 指定密钥长度<br><code>id_rsa</code>: 私钥<br><code>id_rsa.pub</code>: 公钥<br><code>authorized_keys</code> 已保存的公钥</p>\n<p><code>tree .ssh/</code><br><img src=\"/images/035.ssh_key.md.01.png\" alt=\"png\"></p>\n<h2 id=\"免密登录\"><a href=\"#免密登录\" class=\"headerlink\" title=\"免密登录\"></a>免密登录</h2><p>这里, 只需要将本地生成的<code>id_rsa.pub</code>导入需要被免密登录的服务器的 <code>authorized_keys</code>中即可<br>复制<code>id_rsa.pub</code>内容到<code>authorized_keys</code>也可以</p>\n<p>使用命令导入:<br><code>ssh-copy-id username@remote-server</code></p>\n<h2 id=\"互相免密登录\"><a href=\"#互相免密登录\" class=\"headerlink\" title=\"互相免密登录\"></a>互相免密登录</h2><p>在另外一台服务器重复上面指令</p>\n"},{"title":"OpenWrt扩容","date":"2023-03-24T02:50:00.000Z","sitemap":true,"_content":"\n## 零、 前言\n\nopenwrt分区有很多方式, 可以直接ssh到openwrt上, 也可以将TF卡拔出来, 放到其他Linux上进行分区操作\n当时想着图简单, 将TF卡拔出来放到Ubuntu上使用Gparted分区, 但是总是在最后一步报错.\n使用命令行进行最后一步也是报错.\n``` resize2fs: Invalid argument While trying to add group #1 ```\n\n<img src=\"/images/036.openwrt_disk_expansion.md.01.png\" width=70% height=80% />\n\n<img src=\"/images/036.openwrt_disk_expansion.md.02.png\" width=70% height=80% />\n\n\n**查了相关资料后解决了分区问题.记录如下:**\n\n## 一、 查看当前分区详情\n\n```bash\nsda           8:0    1  14.8G  0 disk \n├─sda1        8:1    1    64M  0 part /media/wang/boot\n└─sda2        8:2    1     5G  0 part /media/wang/rootfs\n```\n\n## 二、 重新对/media/wang/rootfs进行分区 \n\n分区思路: **先删除```/media/wang/rootfs``` 再从原来的起点重新分区达到扩容的目的**\n\n### 2.0 进入交互模式: ``` fdisk /dev/sda ``` \n``` bash\nwang@ubuntu:~$ sudo fdisk /dev/sda\nWelcome to fdisk (util-linux 2.37.2).\nChanges will remain in memory only, until you decide to write them.\nBe careful before using the write command.\n\nThis disk is currently in use - repartitioning is probably a bad idea.\nIt's recommended to umount all file systems, and swapoff all swap\npartitions on this disk.\n```\n\n### 2.1 打印当前分区表: ``` p ``` \n**记住** ```/dev/sda2``` 开始的数值 ``` 147456 ```\n``` bash\nCommand (m for help): p\n\nDisk /dev/sda: 14.84 GiB, 15931539456 bytes, 31116288 sectors\nDisk model: Storage Device  \nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: dos\nDisk identifier: 0x4005cfed\n\nDevice     Boot  Start      End  Sectors  Size Id Type\n/dev/sda1  *      8192   139263   131072   64M  c W95 FAT32 (LBA)\n/dev/sda2       147456 21121023 20973568  10G 83 Linux\n```\n\n### 2.2 删除分区: ``` d ``` \n``` bash\nCommand (m for help): d\nPartition number (1,2, default 2): 2\nPartition 2 has been deleted.\n```\n\n### 2.3 创建新分区: ``` n ```\n``` bash\nCommand (m for help): n\nPartition type\n   p   primary (1 primary, 0 extended, 3 free)\n   e   extended (container for logical partitions)\nSelect (default p): p\nPartition number (2-4, default 2): 2\nFirst sector (2048-31116287, default 2048): 147456   ## 注意这里的First sector的数值是上面我们要记住的147456\nLast sector, +/-sectors or +/-size{K,M,G,T,P} (147456-31116287, default 31116287): +5g  ## 要扩容的大小\n\nCreated a new partition 2 of type 'Linux' and of size 5 GiB.\nPartition #2 contains a ext4 signature.\n\nDo you want to remove the signature? [Y]es/[N]o: n  ## 保留原有标识\n```\n\n### 2.4 保存分区信息: ```w ```\n``` bash\nCommand (m for help): w\nThe partition table has been altered.\nSyncing disks.\n```\n\n### 2.5 更新分区大小\n``` bash\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\nwang@ubuntu:~$ sudo resize2fs -p /dev/sda2 \nresize2fs 1.46.5 (30-Dec-2021)\nFilesystem at /dev/sda2 is mounted on /media/wang/rootfs; on-line resizing required\nold_desc_blocks = 1, new_desc_blocks = 1\nPerforming an on-line resize of /dev/sda2 to 1310720 (4k) blocks.\nresize2fs: Invalid argument While trying to add group #1\n```\n\n可以看到这里resize2fs 发生报错\n报错信息: ``` resize2fs: Invalid argument While trying to add group #1 ```\n\n\n## 三、 解决 resize2fs 报错\n\n### 3.1 查看当前循环设备\n``` losetup```\n``` bash\nwang@ubuntu:~$ losetup \nNAME        SIZELIMIT OFFSET AUTOCLEAR RO BACK-FILE                                                  DIO LOG-SEC\n/dev/loop1          0      0         1  1 /var/lib/snapd/snaps/core18_2708.snap                        0     512\n/dev/loop19         0      0         1  1 /var/lib/snapd/snaps/sublime-text_116.snap                   0     512\n/dev/loop17         0      0         1  1 /var/lib/snapd/snaps/snapd-desktop-integration_43.snap       0     512\n/dev/loop8          0      0         1  1 /var/lib/snapd/snaps/gnome-3-38-2004_119.snap                0     512\n/dev/loop15         0      0         1  1 /var/lib/snapd/snaps/snap-store_638.snap                     0     512\n/dev/loop6          0      0         1  1 /var/lib/snapd/snaps/gnome-3-38-2004_115.snap                0     512\n/dev/loop13         0      0         1  1 /var/lib/snapd/snaps/snap-store_599.snap                     0     512\n/dev/loop4          0      0         1  1 /var/lib/snapd/snaps/core18_2714.snap                        0     512\n/dev/loop21         0      0         1  1 /var/lib/snapd/snaps/snapd_18596.snap                        0     512\n/dev/loop11         0      0         1  1 /var/lib/snapd/snaps/hunspell-dictionaries-1-7-2004_2.snap   0     512\n/dev/loop2          0      0         1  1 /var/lib/snapd/snaps/firefox_2432.snap                       0     512\n/dev/loop0          0      0         1  1 /var/lib/snapd/snaps/bare_5.snap                             0     512\n/dev/loop18         0      0         1  1 /var/lib/snapd/snaps/core20_1828.snap                        0     512\n/dev/loop9          0      0         1  1 /var/lib/snapd/snaps/gtk-common-themes_1534.snap             0     512\n/dev/loop16         0      0         1  1 /var/lib/snapd/snaps/snapd-desktop-integration_49.snap       0     512\n/dev/loop7          0      0         1  1 /var/lib/snapd/snaps/core20_1852.snap                        0     512\n/dev/loop14         0      0         1  1 /var/lib/snapd/snaps/snapd_18357.snap                        0     512\n/dev/loop5          0      0         1  1 /var/lib/snapd/snaps/sublime-text_118.snap                   0     512\n/dev/loop12         0      0         1  1 /var/lib/snapd/snaps/firefox_2487.snap                       0     512\n/dev/loop3          0      0         1  1 /var/lib/snapd/snaps/core20_1822.snap (deleted)              0     512\n/dev/loop10         0      0         1  1 /var/lib/snapd/snaps/gtk-common-themes_1535.snap             0     512\nwang@ubuntu:~$ \n```\n\n\n### 3.2 将/dev/sda2 映射到循环设备后再更新分区\n\n``` sudo losetup /dev/loop100 /dev/sda2  ```\n``` sudo e2fsck -f /dev/loop100 ```\n\n``` bash\nwang@ubuntu:~$sudo losetup /dev/loop100 /dev/sda2 \nwang@ubuntu:~$ sudo resize2fs /dev/loop100 \nresize2fs 1.46.5 (30-Dec-2021)\nPlease run 'e2fsck -f /dev/loop100' first.\n\nwang@ubuntu:~$ sudo e2fsck -f /dev/loop100 \ne2fsck 1.46.5 (30-Dec-2021)\nPass 1: Checking inodes, blocks, and sizes\nPass 2: Checking directory structure\nPass 3: Checking directory connectivity\nPass 4: Checking reference counts\nPass 5: Checking group summary information\nPadding at end of inode bitmap is not set. Fix<y>? yes\n\nrootfs: ***** FILE SYSTEM WAS MODIFIED *****\nrootfs: 1421/6656 files (0.0% non-contiguous), 5486/32768 blocks\nwang@ubuntu:~$ \nwang@ubuntu:~$ sudo resize2fs /dev/loop100 \nresize2fs 1.46.5 (30-Dec-2021)\nResizing the filesystem on /dev/loop100 to 1310720 (4k) blocks.\nThe filesystem on /dev/loop100 is now 1310720 (4k) blocks long.\n\nwang@ubuntu:~$ \n\n```\n\n","source":"_posts/036.openwrt_disk_expansion.md","raw":"---\ntitle: OpenWrt扩容\ndate: 2023-3-24 10:50:00\nsitemap: true\ncategories: \n- [OpenWrt]\ntags: \n- OpenWrt\n---\n\n## 零、 前言\n\nopenwrt分区有很多方式, 可以直接ssh到openwrt上, 也可以将TF卡拔出来, 放到其他Linux上进行分区操作\n当时想着图简单, 将TF卡拔出来放到Ubuntu上使用Gparted分区, 但是总是在最后一步报错.\n使用命令行进行最后一步也是报错.\n``` resize2fs: Invalid argument While trying to add group #1 ```\n\n<img src=\"/images/036.openwrt_disk_expansion.md.01.png\" width=70% height=80% />\n\n<img src=\"/images/036.openwrt_disk_expansion.md.02.png\" width=70% height=80% />\n\n\n**查了相关资料后解决了分区问题.记录如下:**\n\n## 一、 查看当前分区详情\n\n```bash\nsda           8:0    1  14.8G  0 disk \n├─sda1        8:1    1    64M  0 part /media/wang/boot\n└─sda2        8:2    1     5G  0 part /media/wang/rootfs\n```\n\n## 二、 重新对/media/wang/rootfs进行分区 \n\n分区思路: **先删除```/media/wang/rootfs``` 再从原来的起点重新分区达到扩容的目的**\n\n### 2.0 进入交互模式: ``` fdisk /dev/sda ``` \n``` bash\nwang@ubuntu:~$ sudo fdisk /dev/sda\nWelcome to fdisk (util-linux 2.37.2).\nChanges will remain in memory only, until you decide to write them.\nBe careful before using the write command.\n\nThis disk is currently in use - repartitioning is probably a bad idea.\nIt's recommended to umount all file systems, and swapoff all swap\npartitions on this disk.\n```\n\n### 2.1 打印当前分区表: ``` p ``` \n**记住** ```/dev/sda2``` 开始的数值 ``` 147456 ```\n``` bash\nCommand (m for help): p\n\nDisk /dev/sda: 14.84 GiB, 15931539456 bytes, 31116288 sectors\nDisk model: Storage Device  \nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: dos\nDisk identifier: 0x4005cfed\n\nDevice     Boot  Start      End  Sectors  Size Id Type\n/dev/sda1  *      8192   139263   131072   64M  c W95 FAT32 (LBA)\n/dev/sda2       147456 21121023 20973568  10G 83 Linux\n```\n\n### 2.2 删除分区: ``` d ``` \n``` bash\nCommand (m for help): d\nPartition number (1,2, default 2): 2\nPartition 2 has been deleted.\n```\n\n### 2.3 创建新分区: ``` n ```\n``` bash\nCommand (m for help): n\nPartition type\n   p   primary (1 primary, 0 extended, 3 free)\n   e   extended (container for logical partitions)\nSelect (default p): p\nPartition number (2-4, default 2): 2\nFirst sector (2048-31116287, default 2048): 147456   ## 注意这里的First sector的数值是上面我们要记住的147456\nLast sector, +/-sectors or +/-size{K,M,G,T,P} (147456-31116287, default 31116287): +5g  ## 要扩容的大小\n\nCreated a new partition 2 of type 'Linux' and of size 5 GiB.\nPartition #2 contains a ext4 signature.\n\nDo you want to remove the signature? [Y]es/[N]o: n  ## 保留原有标识\n```\n\n### 2.4 保存分区信息: ```w ```\n``` bash\nCommand (m for help): w\nThe partition table has been altered.\nSyncing disks.\n```\n\n### 2.5 更新分区大小\n``` bash\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\nwang@ubuntu:~$ sudo resize2fs -p /dev/sda2 \nresize2fs 1.46.5 (30-Dec-2021)\nFilesystem at /dev/sda2 is mounted on /media/wang/rootfs; on-line resizing required\nold_desc_blocks = 1, new_desc_blocks = 1\nPerforming an on-line resize of /dev/sda2 to 1310720 (4k) blocks.\nresize2fs: Invalid argument While trying to add group #1\n```\n\n可以看到这里resize2fs 发生报错\n报错信息: ``` resize2fs: Invalid argument While trying to add group #1 ```\n\n\n## 三、 解决 resize2fs 报错\n\n### 3.1 查看当前循环设备\n``` losetup```\n``` bash\nwang@ubuntu:~$ losetup \nNAME        SIZELIMIT OFFSET AUTOCLEAR RO BACK-FILE                                                  DIO LOG-SEC\n/dev/loop1          0      0         1  1 /var/lib/snapd/snaps/core18_2708.snap                        0     512\n/dev/loop19         0      0         1  1 /var/lib/snapd/snaps/sublime-text_116.snap                   0     512\n/dev/loop17         0      0         1  1 /var/lib/snapd/snaps/snapd-desktop-integration_43.snap       0     512\n/dev/loop8          0      0         1  1 /var/lib/snapd/snaps/gnome-3-38-2004_119.snap                0     512\n/dev/loop15         0      0         1  1 /var/lib/snapd/snaps/snap-store_638.snap                     0     512\n/dev/loop6          0      0         1  1 /var/lib/snapd/snaps/gnome-3-38-2004_115.snap                0     512\n/dev/loop13         0      0         1  1 /var/lib/snapd/snaps/snap-store_599.snap                     0     512\n/dev/loop4          0      0         1  1 /var/lib/snapd/snaps/core18_2714.snap                        0     512\n/dev/loop21         0      0         1  1 /var/lib/snapd/snaps/snapd_18596.snap                        0     512\n/dev/loop11         0      0         1  1 /var/lib/snapd/snaps/hunspell-dictionaries-1-7-2004_2.snap   0     512\n/dev/loop2          0      0         1  1 /var/lib/snapd/snaps/firefox_2432.snap                       0     512\n/dev/loop0          0      0         1  1 /var/lib/snapd/snaps/bare_5.snap                             0     512\n/dev/loop18         0      0         1  1 /var/lib/snapd/snaps/core20_1828.snap                        0     512\n/dev/loop9          0      0         1  1 /var/lib/snapd/snaps/gtk-common-themes_1534.snap             0     512\n/dev/loop16         0      0         1  1 /var/lib/snapd/snaps/snapd-desktop-integration_49.snap       0     512\n/dev/loop7          0      0         1  1 /var/lib/snapd/snaps/core20_1852.snap                        0     512\n/dev/loop14         0      0         1  1 /var/lib/snapd/snaps/snapd_18357.snap                        0     512\n/dev/loop5          0      0         1  1 /var/lib/snapd/snaps/sublime-text_118.snap                   0     512\n/dev/loop12         0      0         1  1 /var/lib/snapd/snaps/firefox_2487.snap                       0     512\n/dev/loop3          0      0         1  1 /var/lib/snapd/snaps/core20_1822.snap (deleted)              0     512\n/dev/loop10         0      0         1  1 /var/lib/snapd/snaps/gtk-common-themes_1535.snap             0     512\nwang@ubuntu:~$ \n```\n\n\n### 3.2 将/dev/sda2 映射到循环设备后再更新分区\n\n``` sudo losetup /dev/loop100 /dev/sda2  ```\n``` sudo e2fsck -f /dev/loop100 ```\n\n``` bash\nwang@ubuntu:~$sudo losetup /dev/loop100 /dev/sda2 \nwang@ubuntu:~$ sudo resize2fs /dev/loop100 \nresize2fs 1.46.5 (30-Dec-2021)\nPlease run 'e2fsck -f /dev/loop100' first.\n\nwang@ubuntu:~$ sudo e2fsck -f /dev/loop100 \ne2fsck 1.46.5 (30-Dec-2021)\nPass 1: Checking inodes, blocks, and sizes\nPass 2: Checking directory structure\nPass 3: Checking directory connectivity\nPass 4: Checking reference counts\nPass 5: Checking group summary information\nPadding at end of inode bitmap is not set. Fix<y>? yes\n\nrootfs: ***** FILE SYSTEM WAS MODIFIED *****\nrootfs: 1421/6656 files (0.0% non-contiguous), 5486/32768 blocks\nwang@ubuntu:~$ \nwang@ubuntu:~$ sudo resize2fs /dev/loop100 \nresize2fs 1.46.5 (30-Dec-2021)\nResizing the filesystem on /dev/loop100 to 1310720 (4k) blocks.\nThe filesystem on /dev/loop100 is now 1310720 (4k) blocks long.\n\nwang@ubuntu:~$ \n\n```\n\n","slug":"036.openwrt_disk_expansion","published":1,"updated":"2023-12-05T08:52:30.878Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzcu003fijnra76h0gpn","content":"<h2 id=\"零、-前言\"><a href=\"#零、-前言\" class=\"headerlink\" title=\"零、 前言\"></a>零、 前言</h2><p>openwrt分区有很多方式, 可以直接ssh到openwrt上, 也可以将TF卡拔出来, 放到其他Linux上进行分区操作<br>当时想着图简单, 将TF卡拔出来放到Ubuntu上使用Gparted分区, 但是总是在最后一步报错.<br>使用命令行进行最后一步也是报错.<br><code>resize2fs: Invalid argument While trying to add group #1</code></p>\n<img src=\"/images/036.openwrt_disk_expansion.md.01.png\" width=70% height=80% />\n\n<img src=\"/images/036.openwrt_disk_expansion.md.02.png\" width=70% height=80% />\n\n\n<p><strong>查了相关资料后解决了分区问题.记录如下:</strong></p>\n<h2 id=\"一、-查看当前分区详情\"><a href=\"#一、-查看当前分区详情\" class=\"headerlink\" title=\"一、 查看当前分区详情\"></a>一、 查看当前分区详情</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sda           8:0    1  14.8G  0 disk </span><br><span class=\"line\">├─sda1        8:1    1    64M  0 part /media/wang/boot</span><br><span class=\"line\">└─sda2        8:2    1     5G  0 part /media/wang/rootfs</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"二、-重新对-media-wang-rootfs进行分区\"><a href=\"#二、-重新对-media-wang-rootfs进行分区\" class=\"headerlink\" title=\"二、 重新对&#x2F;media&#x2F;wang&#x2F;rootfs进行分区\"></a>二、 重新对&#x2F;media&#x2F;wang&#x2F;rootfs进行分区</h2><p>分区思路: <strong>先删除<code>/media/wang/rootfs</code> 再从原来的起点重新分区达到扩容的目的</strong></p>\n<h3 id=\"2-0-进入交互模式-fdisk-dev-sda\"><a href=\"#2-0-进入交互模式-fdisk-dev-sda\" class=\"headerlink\" title=\"2.0 进入交互模式: fdisk /dev/sda\"></a>2.0 进入交互模式: <code>fdisk /dev/sda</code></h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">wang@ubuntu:~$ sudo fdisk /dev/sda</span><br><span class=\"line\">Welcome to fdisk (util-linux 2.37.2).</span><br><span class=\"line\">Changes will remain <span class=\"keyword\">in</span> memory only, <span class=\"keyword\">until</span> you decide to write them.</span><br><span class=\"line\">Be careful before using the write <span class=\"built_in\">command</span>.</span><br><span class=\"line\"></span><br><span class=\"line\">This disk is currently <span class=\"keyword\">in</span> use - repartitioning is probably a bad idea.</span><br><span class=\"line\">It<span class=\"string\">&#x27;s recommended to umount all file systems, and swapoff all swap</span></span><br><span class=\"line\"><span class=\"string\">partitions on this disk.</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-打印当前分区表-p\"><a href=\"#2-1-打印当前分区表-p\" class=\"headerlink\" title=\"2.1 打印当前分区表: p\"></a>2.1 打印当前分区表: <code>p</code></h3><p><strong>记住</strong> <code>/dev/sda2</code> 开始的数值 <code>147456</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Command (m <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>): p</span><br><span class=\"line\"></span><br><span class=\"line\">Disk /dev/sda: 14.84 GiB, 15931539456 bytes, 31116288 sectors</span><br><span class=\"line\">Disk model: Storage Device  </span><br><span class=\"line\">Units: sectors of 1 * 512 = 512 bytes</span><br><span class=\"line\">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class=\"line\">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class=\"line\">Disklabel <span class=\"built_in\">type</span>: dos</span><br><span class=\"line\">Disk identifier: 0x4005cfed</span><br><span class=\"line\"></span><br><span class=\"line\">Device     Boot  Start      End  Sectors  Size Id Type</span><br><span class=\"line\">/dev/sda1  *      8192   139263   131072   64M  c W95 FAT32 (LBA)</span><br><span class=\"line\">/dev/sda2       147456 21121023 20973568  10G 83 Linux</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-删除分区-d\"><a href=\"#2-2-删除分区-d\" class=\"headerlink\" title=\"2.2 删除分区: d\"></a>2.2 删除分区: <code>d</code></h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Command (m <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>): d</span><br><span class=\"line\">Partition number (1,2, default 2): 2</span><br><span class=\"line\">Partition 2 has been deleted.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-3-创建新分区-n\"><a href=\"#2-3-创建新分区-n\" class=\"headerlink\" title=\"2.3 创建新分区: n\"></a>2.3 创建新分区: <code>n</code></h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Command (m <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>): n</span><br><span class=\"line\">Partition <span class=\"built_in\">type</span></span><br><span class=\"line\">   p   primary (1 primary, 0 extended, 3 free)</span><br><span class=\"line\">   e   extended (container <span class=\"keyword\">for</span> logical partitions)</span><br><span class=\"line\">Select (default p): p</span><br><span class=\"line\">Partition number (2-4, default 2): 2</span><br><span class=\"line\">First sector (2048-31116287, default 2048): 147456   <span class=\"comment\">## 注意这里的First sector的数值是上面我们要记住的147456</span></span><br><span class=\"line\">Last sector, +/-sectors or +/-size&#123;K,M,G,T,P&#125; (147456-31116287, default 31116287): +5g  <span class=\"comment\">## 要扩容的大小</span></span><br><span class=\"line\"></span><br><span class=\"line\">Created a new partition 2 of <span class=\"built_in\">type</span> <span class=\"string\">&#x27;Linux&#x27;</span> and of size 5 GiB.</span><br><span class=\"line\">Partition <span class=\"comment\">#2 contains a ext4 signature.</span></span><br><span class=\"line\"></span><br><span class=\"line\">Do you want to remove the signature? [Y]es/[N]o: n  <span class=\"comment\">## 保留原有标识</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-4-保存分区信息-w\"><a href=\"#2-4-保存分区信息-w\" class=\"headerlink\" title=\"2.4 保存分区信息: w \"></a>2.4 保存分区信息: <code>w </code></h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Command (m <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>): w</span><br><span class=\"line\">The partition table has been altered.</span><br><span class=\"line\">Syncing disks.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-5-更新分区大小\"><a href=\"#2-5-更新分区大小\" class=\"headerlink\" title=\"2.5 更新分区大小\"></a>2.5 更新分区大小</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">wang@ubuntu:~$ sudo resize2fs -p /dev/sda2 </span><br><span class=\"line\">resize2fs 1.46.5 (30-Dec-2021)</span><br><span class=\"line\">Filesystem at /dev/sda2 is mounted on /media/wang/rootfs; on-line resizing required</span><br><span class=\"line\">old_desc_blocks = 1, new_desc_blocks = 1</span><br><span class=\"line\">Performing an on-line resize of /dev/sda2 to 1310720 (4k) blocks.</span><br><span class=\"line\">resize2fs: Invalid argument While trying to add group <span class=\"comment\">#1</span></span><br></pre></td></tr></table></figure>\n\n<p>可以看到这里resize2fs 发生报错<br>报错信息: <code>resize2fs: Invalid argument While trying to add group #1</code></p>\n<h2 id=\"三、-解决-resize2fs-报错\"><a href=\"#三、-解决-resize2fs-报错\" class=\"headerlink\" title=\"三、 解决 resize2fs 报错\"></a>三、 解决 resize2fs 报错</h2><h3 id=\"3-1-查看当前循环设备\"><a href=\"#3-1-查看当前循环设备\" class=\"headerlink\" title=\"3.1 查看当前循环设备\"></a>3.1 查看当前循环设备</h3><p><code> losetup</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">wang@ubuntu:~$ losetup </span><br><span class=\"line\">NAME        SIZELIMIT OFFSET AUTOCLEAR RO BACK-FILE                                                  DIO LOG-SEC</span><br><span class=\"line\">/dev/loop1          0      0         1  1 /var/lib/snapd/snaps/core18_2708.snap                        0     512</span><br><span class=\"line\">/dev/loop19         0      0         1  1 /var/lib/snapd/snaps/sublime-text_116.snap                   0     512</span><br><span class=\"line\">/dev/loop17         0      0         1  1 /var/lib/snapd/snaps/snapd-desktop-integration_43.snap       0     512</span><br><span class=\"line\">/dev/loop8          0      0         1  1 /var/lib/snapd/snaps/gnome-3-38-2004_119.snap                0     512</span><br><span class=\"line\">/dev/loop15         0      0         1  1 /var/lib/snapd/snaps/snap-store_638.snap                     0     512</span><br><span class=\"line\">/dev/loop6          0      0         1  1 /var/lib/snapd/snaps/gnome-3-38-2004_115.snap                0     512</span><br><span class=\"line\">/dev/loop13         0      0         1  1 /var/lib/snapd/snaps/snap-store_599.snap                     0     512</span><br><span class=\"line\">/dev/loop4          0      0         1  1 /var/lib/snapd/snaps/core18_2714.snap                        0     512</span><br><span class=\"line\">/dev/loop21         0      0         1  1 /var/lib/snapd/snaps/snapd_18596.snap                        0     512</span><br><span class=\"line\">/dev/loop11         0      0         1  1 /var/lib/snapd/snaps/hunspell-dictionaries-1-7-2004_2.snap   0     512</span><br><span class=\"line\">/dev/loop2          0      0         1  1 /var/lib/snapd/snaps/firefox_2432.snap                       0     512</span><br><span class=\"line\">/dev/loop0          0      0         1  1 /var/lib/snapd/snaps/bare_5.snap                             0     512</span><br><span class=\"line\">/dev/loop18         0      0         1  1 /var/lib/snapd/snaps/core20_1828.snap                        0     512</span><br><span class=\"line\">/dev/loop9          0      0         1  1 /var/lib/snapd/snaps/gtk-common-themes_1534.snap             0     512</span><br><span class=\"line\">/dev/loop16         0      0         1  1 /var/lib/snapd/snaps/snapd-desktop-integration_49.snap       0     512</span><br><span class=\"line\">/dev/loop7          0      0         1  1 /var/lib/snapd/snaps/core20_1852.snap                        0     512</span><br><span class=\"line\">/dev/loop14         0      0         1  1 /var/lib/snapd/snaps/snapd_18357.snap                        0     512</span><br><span class=\"line\">/dev/loop5          0      0         1  1 /var/lib/snapd/snaps/sublime-text_118.snap                   0     512</span><br><span class=\"line\">/dev/loop12         0      0         1  1 /var/lib/snapd/snaps/firefox_2487.snap                       0     512</span><br><span class=\"line\">/dev/loop3          0      0         1  1 /var/lib/snapd/snaps/core20_1822.snap (deleted)              0     512</span><br><span class=\"line\">/dev/loop10         0      0         1  1 /var/lib/snapd/snaps/gtk-common-themes_1535.snap             0     512</span><br><span class=\"line\">wang@ubuntu:~$ </span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"3-2-将-dev-sda2-映射到循环设备后再更新分区\"><a href=\"#3-2-将-dev-sda2-映射到循环设备后再更新分区\" class=\"headerlink\" title=\"3.2 将&#x2F;dev&#x2F;sda2 映射到循环设备后再更新分区\"></a>3.2 将&#x2F;dev&#x2F;sda2 映射到循环设备后再更新分区</h3><p><code>sudo losetup /dev/loop100 /dev/sda2 </code><br><code>sudo e2fsck -f /dev/loop100</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">wang@ubuntu:~<span class=\"variable\">$sudo</span> losetup /dev/loop100 /dev/sda2 </span><br><span class=\"line\">wang@ubuntu:~$ sudo resize2fs /dev/loop100 </span><br><span class=\"line\">resize2fs 1.46.5 (30-Dec-2021)</span><br><span class=\"line\">Please run <span class=\"string\">&#x27;e2fsck -f /dev/loop100&#x27;</span> first.</span><br><span class=\"line\"></span><br><span class=\"line\">wang@ubuntu:~$ sudo e2fsck -f /dev/loop100 </span><br><span class=\"line\">e2fsck 1.46.5 (30-Dec-2021)</span><br><span class=\"line\">Pass 1: Checking inodes, blocks, and sizes</span><br><span class=\"line\">Pass 2: Checking directory structure</span><br><span class=\"line\">Pass 3: Checking directory connectivity</span><br><span class=\"line\">Pass 4: Checking reference counts</span><br><span class=\"line\">Pass 5: Checking group summary information</span><br><span class=\"line\">Padding at end of inode bitmap is not <span class=\"built_in\">set</span>. Fix&lt;y&gt;? <span class=\"built_in\">yes</span></span><br><span class=\"line\"></span><br><span class=\"line\">rootfs: ***** FILE SYSTEM WAS MODIFIED *****</span><br><span class=\"line\">rootfs: 1421/6656 files (0.0% non-contiguous), 5486/32768 blocks</span><br><span class=\"line\">wang@ubuntu:~$ </span><br><span class=\"line\">wang@ubuntu:~$ sudo resize2fs /dev/loop100 </span><br><span class=\"line\">resize2fs 1.46.5 (30-Dec-2021)</span><br><span class=\"line\">Resizing the filesystem on /dev/loop100 to 1310720 (4k) blocks.</span><br><span class=\"line\">The filesystem on /dev/loop100 is now 1310720 (4k) blocks long.</span><br><span class=\"line\"></span><br><span class=\"line\">wang@ubuntu:~$ </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"零、-前言\"><a href=\"#零、-前言\" class=\"headerlink\" title=\"零、 前言\"></a>零、 前言</h2><p>openwrt分区有很多方式, 可以直接ssh到openwrt上, 也可以将TF卡拔出来, 放到其他Linux上进行分区操作<br>当时想着图简单, 将TF卡拔出来放到Ubuntu上使用Gparted分区, 但是总是在最后一步报错.<br>使用命令行进行最后一步也是报错.<br><code>resize2fs: Invalid argument While trying to add group #1</code></p>\n<img src=\"/images/036.openwrt_disk_expansion.md.01.png\" width=70% height=80% />\n\n<img src=\"/images/036.openwrt_disk_expansion.md.02.png\" width=70% height=80% />\n\n\n<p><strong>查了相关资料后解决了分区问题.记录如下:</strong></p>\n<h2 id=\"一、-查看当前分区详情\"><a href=\"#一、-查看当前分区详情\" class=\"headerlink\" title=\"一、 查看当前分区详情\"></a>一、 查看当前分区详情</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sda           8:0    1  14.8G  0 disk </span><br><span class=\"line\">├─sda1        8:1    1    64M  0 part /media/wang/boot</span><br><span class=\"line\">└─sda2        8:2    1     5G  0 part /media/wang/rootfs</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"二、-重新对-media-wang-rootfs进行分区\"><a href=\"#二、-重新对-media-wang-rootfs进行分区\" class=\"headerlink\" title=\"二、 重新对&#x2F;media&#x2F;wang&#x2F;rootfs进行分区\"></a>二、 重新对&#x2F;media&#x2F;wang&#x2F;rootfs进行分区</h2><p>分区思路: <strong>先删除<code>/media/wang/rootfs</code> 再从原来的起点重新分区达到扩容的目的</strong></p>\n<h3 id=\"2-0-进入交互模式-fdisk-dev-sda\"><a href=\"#2-0-进入交互模式-fdisk-dev-sda\" class=\"headerlink\" title=\"2.0 进入交互模式: fdisk /dev/sda\"></a>2.0 进入交互模式: <code>fdisk /dev/sda</code></h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">wang@ubuntu:~$ sudo fdisk /dev/sda</span><br><span class=\"line\">Welcome to fdisk (util-linux 2.37.2).</span><br><span class=\"line\">Changes will remain <span class=\"keyword\">in</span> memory only, <span class=\"keyword\">until</span> you decide to write them.</span><br><span class=\"line\">Be careful before using the write <span class=\"built_in\">command</span>.</span><br><span class=\"line\"></span><br><span class=\"line\">This disk is currently <span class=\"keyword\">in</span> use - repartitioning is probably a bad idea.</span><br><span class=\"line\">It<span class=\"string\">&#x27;s recommended to umount all file systems, and swapoff all swap</span></span><br><span class=\"line\"><span class=\"string\">partitions on this disk.</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-打印当前分区表-p\"><a href=\"#2-1-打印当前分区表-p\" class=\"headerlink\" title=\"2.1 打印当前分区表: p\"></a>2.1 打印当前分区表: <code>p</code></h3><p><strong>记住</strong> <code>/dev/sda2</code> 开始的数值 <code>147456</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Command (m <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>): p</span><br><span class=\"line\"></span><br><span class=\"line\">Disk /dev/sda: 14.84 GiB, 15931539456 bytes, 31116288 sectors</span><br><span class=\"line\">Disk model: Storage Device  </span><br><span class=\"line\">Units: sectors of 1 * 512 = 512 bytes</span><br><span class=\"line\">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class=\"line\">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class=\"line\">Disklabel <span class=\"built_in\">type</span>: dos</span><br><span class=\"line\">Disk identifier: 0x4005cfed</span><br><span class=\"line\"></span><br><span class=\"line\">Device     Boot  Start      End  Sectors  Size Id Type</span><br><span class=\"line\">/dev/sda1  *      8192   139263   131072   64M  c W95 FAT32 (LBA)</span><br><span class=\"line\">/dev/sda2       147456 21121023 20973568  10G 83 Linux</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-删除分区-d\"><a href=\"#2-2-删除分区-d\" class=\"headerlink\" title=\"2.2 删除分区: d\"></a>2.2 删除分区: <code>d</code></h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Command (m <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>): d</span><br><span class=\"line\">Partition number (1,2, default 2): 2</span><br><span class=\"line\">Partition 2 has been deleted.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-3-创建新分区-n\"><a href=\"#2-3-创建新分区-n\" class=\"headerlink\" title=\"2.3 创建新分区: n\"></a>2.3 创建新分区: <code>n</code></h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Command (m <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>): n</span><br><span class=\"line\">Partition <span class=\"built_in\">type</span></span><br><span class=\"line\">   p   primary (1 primary, 0 extended, 3 free)</span><br><span class=\"line\">   e   extended (container <span class=\"keyword\">for</span> logical partitions)</span><br><span class=\"line\">Select (default p): p</span><br><span class=\"line\">Partition number (2-4, default 2): 2</span><br><span class=\"line\">First sector (2048-31116287, default 2048): 147456   <span class=\"comment\">## 注意这里的First sector的数值是上面我们要记住的147456</span></span><br><span class=\"line\">Last sector, +/-sectors or +/-size&#123;K,M,G,T,P&#125; (147456-31116287, default 31116287): +5g  <span class=\"comment\">## 要扩容的大小</span></span><br><span class=\"line\"></span><br><span class=\"line\">Created a new partition 2 of <span class=\"built_in\">type</span> <span class=\"string\">&#x27;Linux&#x27;</span> and of size 5 GiB.</span><br><span class=\"line\">Partition <span class=\"comment\">#2 contains a ext4 signature.</span></span><br><span class=\"line\"></span><br><span class=\"line\">Do you want to remove the signature? [Y]es/[N]o: n  <span class=\"comment\">## 保留原有标识</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-4-保存分区信息-w\"><a href=\"#2-4-保存分区信息-w\" class=\"headerlink\" title=\"2.4 保存分区信息: w \"></a>2.4 保存分区信息: <code>w </code></h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Command (m <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>): w</span><br><span class=\"line\">The partition table has been altered.</span><br><span class=\"line\">Syncing disks.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-5-更新分区大小\"><a href=\"#2-5-更新分区大小\" class=\"headerlink\" title=\"2.5 更新分区大小\"></a>2.5 更新分区大小</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">wang@ubuntu:~$ sudo resize2fs -p /dev/sda2 </span><br><span class=\"line\">resize2fs 1.46.5 (30-Dec-2021)</span><br><span class=\"line\">Filesystem at /dev/sda2 is mounted on /media/wang/rootfs; on-line resizing required</span><br><span class=\"line\">old_desc_blocks = 1, new_desc_blocks = 1</span><br><span class=\"line\">Performing an on-line resize of /dev/sda2 to 1310720 (4k) blocks.</span><br><span class=\"line\">resize2fs: Invalid argument While trying to add group <span class=\"comment\">#1</span></span><br></pre></td></tr></table></figure>\n\n<p>可以看到这里resize2fs 发生报错<br>报错信息: <code>resize2fs: Invalid argument While trying to add group #1</code></p>\n<h2 id=\"三、-解决-resize2fs-报错\"><a href=\"#三、-解决-resize2fs-报错\" class=\"headerlink\" title=\"三、 解决 resize2fs 报错\"></a>三、 解决 resize2fs 报错</h2><h3 id=\"3-1-查看当前循环设备\"><a href=\"#3-1-查看当前循环设备\" class=\"headerlink\" title=\"3.1 查看当前循环设备\"></a>3.1 查看当前循环设备</h3><p><code> losetup</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">wang@ubuntu:~$ losetup </span><br><span class=\"line\">NAME        SIZELIMIT OFFSET AUTOCLEAR RO BACK-FILE                                                  DIO LOG-SEC</span><br><span class=\"line\">/dev/loop1          0      0         1  1 /var/lib/snapd/snaps/core18_2708.snap                        0     512</span><br><span class=\"line\">/dev/loop19         0      0         1  1 /var/lib/snapd/snaps/sublime-text_116.snap                   0     512</span><br><span class=\"line\">/dev/loop17         0      0         1  1 /var/lib/snapd/snaps/snapd-desktop-integration_43.snap       0     512</span><br><span class=\"line\">/dev/loop8          0      0         1  1 /var/lib/snapd/snaps/gnome-3-38-2004_119.snap                0     512</span><br><span class=\"line\">/dev/loop15         0      0         1  1 /var/lib/snapd/snaps/snap-store_638.snap                     0     512</span><br><span class=\"line\">/dev/loop6          0      0         1  1 /var/lib/snapd/snaps/gnome-3-38-2004_115.snap                0     512</span><br><span class=\"line\">/dev/loop13         0      0         1  1 /var/lib/snapd/snaps/snap-store_599.snap                     0     512</span><br><span class=\"line\">/dev/loop4          0      0         1  1 /var/lib/snapd/snaps/core18_2714.snap                        0     512</span><br><span class=\"line\">/dev/loop21         0      0         1  1 /var/lib/snapd/snaps/snapd_18596.snap                        0     512</span><br><span class=\"line\">/dev/loop11         0      0         1  1 /var/lib/snapd/snaps/hunspell-dictionaries-1-7-2004_2.snap   0     512</span><br><span class=\"line\">/dev/loop2          0      0         1  1 /var/lib/snapd/snaps/firefox_2432.snap                       0     512</span><br><span class=\"line\">/dev/loop0          0      0         1  1 /var/lib/snapd/snaps/bare_5.snap                             0     512</span><br><span class=\"line\">/dev/loop18         0      0         1  1 /var/lib/snapd/snaps/core20_1828.snap                        0     512</span><br><span class=\"line\">/dev/loop9          0      0         1  1 /var/lib/snapd/snaps/gtk-common-themes_1534.snap             0     512</span><br><span class=\"line\">/dev/loop16         0      0         1  1 /var/lib/snapd/snaps/snapd-desktop-integration_49.snap       0     512</span><br><span class=\"line\">/dev/loop7          0      0         1  1 /var/lib/snapd/snaps/core20_1852.snap                        0     512</span><br><span class=\"line\">/dev/loop14         0      0         1  1 /var/lib/snapd/snaps/snapd_18357.snap                        0     512</span><br><span class=\"line\">/dev/loop5          0      0         1  1 /var/lib/snapd/snaps/sublime-text_118.snap                   0     512</span><br><span class=\"line\">/dev/loop12         0      0         1  1 /var/lib/snapd/snaps/firefox_2487.snap                       0     512</span><br><span class=\"line\">/dev/loop3          0      0         1  1 /var/lib/snapd/snaps/core20_1822.snap (deleted)              0     512</span><br><span class=\"line\">/dev/loop10         0      0         1  1 /var/lib/snapd/snaps/gtk-common-themes_1535.snap             0     512</span><br><span class=\"line\">wang@ubuntu:~$ </span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"3-2-将-dev-sda2-映射到循环设备后再更新分区\"><a href=\"#3-2-将-dev-sda2-映射到循环设备后再更新分区\" class=\"headerlink\" title=\"3.2 将&#x2F;dev&#x2F;sda2 映射到循环设备后再更新分区\"></a>3.2 将&#x2F;dev&#x2F;sda2 映射到循环设备后再更新分区</h3><p><code>sudo losetup /dev/loop100 /dev/sda2 </code><br><code>sudo e2fsck -f /dev/loop100</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">wang@ubuntu:~<span class=\"variable\">$sudo</span> losetup /dev/loop100 /dev/sda2 </span><br><span class=\"line\">wang@ubuntu:~$ sudo resize2fs /dev/loop100 </span><br><span class=\"line\">resize2fs 1.46.5 (30-Dec-2021)</span><br><span class=\"line\">Please run <span class=\"string\">&#x27;e2fsck -f /dev/loop100&#x27;</span> first.</span><br><span class=\"line\"></span><br><span class=\"line\">wang@ubuntu:~$ sudo e2fsck -f /dev/loop100 </span><br><span class=\"line\">e2fsck 1.46.5 (30-Dec-2021)</span><br><span class=\"line\">Pass 1: Checking inodes, blocks, and sizes</span><br><span class=\"line\">Pass 2: Checking directory structure</span><br><span class=\"line\">Pass 3: Checking directory connectivity</span><br><span class=\"line\">Pass 4: Checking reference counts</span><br><span class=\"line\">Pass 5: Checking group summary information</span><br><span class=\"line\">Padding at end of inode bitmap is not <span class=\"built_in\">set</span>. Fix&lt;y&gt;? <span class=\"built_in\">yes</span></span><br><span class=\"line\"></span><br><span class=\"line\">rootfs: ***** FILE SYSTEM WAS MODIFIED *****</span><br><span class=\"line\">rootfs: 1421/6656 files (0.0% non-contiguous), 5486/32768 blocks</span><br><span class=\"line\">wang@ubuntu:~$ </span><br><span class=\"line\">wang@ubuntu:~$ sudo resize2fs /dev/loop100 </span><br><span class=\"line\">resize2fs 1.46.5 (30-Dec-2021)</span><br><span class=\"line\">Resizing the filesystem on /dev/loop100 to 1310720 (4k) blocks.</span><br><span class=\"line\">The filesystem on /dev/loop100 is now 1310720 (4k) blocks long.</span><br><span class=\"line\"></span><br><span class=\"line\">wang@ubuntu:~$ </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n"},{"title":"KVM部署实列","date":"2023-03-30T02:50:00.000Z","sitemap":true,"_content":"\n\n## 零、 环境说明\n``` bash\nwang@ubuntu:~/Desktop$ sudo screenfetch\n                          ./+o+-       root@ubuntu\n                  yyyyy- -yyyyyy+      OS: Ubuntu 22.04 jammy\n               ://+//////-yyyyyyo      Kernel: x86_64 Linux 5.19.0-38-generic\n           .++ .:/++++++/-.+sss/`      Uptime: 2d 2h 14m\n         .:++o:  /++++++++/:--:/-      Packages: 2193\n        o:+o+:++.`..```.-/oo+++++/     Shell: sudo\n       .:+o:+o/.          `+sssoo+/    Resolution: 1920x1080\n  .++/+:+oo+o:`             /sssooo.   WM: Mutter\n /+++//+:`oo+o               /::--:.   WM Theme: Adwaita\n \\+/+o+++`o++o               ++////.   GTK Theme: Yaru [GTK3]\n  .++.o+++oo+:`             /dddhhh.   Disk: 31G / 234G (14%)\n       .+.o+oo:.          `oddhhhh+    CPU: Intel Core i7-6500U @ 4x 3.1GHz [54.0°C]\n        \\+.++o+o``-````.:ohdhhhhh+     GPU: Intel Corporation Skylake GT2 [HD Graphics 520] (rev 07)\n         `:o+++ `ohhhhhhhhyo++os:      RAM: 2305MiB / 7831MiB\n           .o:`.syhhhhhhh/.oo++o`     \n               /osyyyyyyo++ooo+++/    \n                   ````` +oo+++o\\:    \n                          `oo++.      \n```\n\n## 一、 安装依赖\n``` bash\nsudo apt install -y \\\n  qemu-kvm \\\n\tvirt-manager \\\n\tlibvirt-daemon-system \\\n\tvirtinst \\\n\tlibvirt-clients \\\n\tbridge-utils \n```\n\n|软件包                 |用途 |\n| ------               |  ------                         | \n|qemu-kvm              | 提供硬件仿真的开源仿真器和虚拟化包 |\n|virt-manager          | 通过 libvirt 守护进程，基于 QT 的图形界面的虚拟机管理工具 |\n|libvirt-daemon-system | 为运行 libvirt 进程提供必要配置文件的工具|\n|virtinst              | 一套为置备和修改虚拟机提供的命令行工具|\n|libvirt-clients       | 一组客户端的库和API，用于从命令行管理和控制虚拟机和管理程序|\n|bridge-utils          | 一套用于创建和管理桥接设备的工具|\n\n## 二、 启用虚拟化守护进程（libvirtd）\n\n``` bash\nsudo systemctl enable libvirtd --now\nsudo systemctl status libvirtd\n```\n\n## 三、 将当前用户加入kvm和libvirt用户组\n\n``` bash\nsudo usermod -aG kvm wang\nsudo usermod -aG libvirt wang\n``` \n\n## 四、 创建虚拟机\n\n### 4.1 图形管理工具 virt-manager 创建虚拟机\n图形化操作较为简单, 按照提下一步即可.\n![png](/images/037.kvm.md.02.png)\n\n### 4.2 使用 virt-install 创建虚拟机\n\nvirt-install 支持多种方式部署虚拟机, 详细参见[文档](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/virtualization_deployment_and_administration_guide/sect-guest_virtual_machine_installation_overview-creating_guests_with_virt_install).\n常见有如下几种:\n1. **iso/image固件**\n2. **网络安装**\n3. **从虚拟磁盘导入镜像**\n4. **PXE** \n5. **Kickstart** \n\n下面选择较为简单的通过iso固件部署虚拟机\n``` bash\nsudo virt-install \\ \n  --name vhost1 \\ \n  --memory 2048 \\ \n  --vcpus 2 \\ \n  --disk size=8 \\ \n  --cdrom /path/to/centos.iso \\ \n  --os-variant centos7 \n```\n![png](/images/037.kvm.md.04.png)\n\n\n## 五、 常见问题\n### 5.1 权限问题\n**may not be accessible by the hypervisor. You will need to grant the 'libvirt-qemu' user**\n![png](/images/037.kvm.md.03.png)\n\n解决: \n1. 确保将当前用户加入kvm和libvirt用户组\n2. 将镜像文件放置其他目录下.\n\n## 六、 虚拟机共享主机网络(vhost模式)\n如果希望{% label success@虚拟机共享物理机的网络%}, 需要创建网桥来实现.\n查看当前的网络情况\n![png](/images/037.kvm.md.01.png)\n\n\n创建网桥``` br0 ``` 接口为 ```wlp9s0```\n\n``` yaml\n#sudo vim /etc/netplan/br.yaml\n\nnetwork:\n  version: 2\n  renderer: networkd\n  ethernets:\n    wlp9s0:\n      dhcp4: false\n      dhcp6: false\n  bridges:\n    br0:\n      macaddress: aa:bb:cc:11:22:33\n      dhcp4: false\n      dhcp6: false\n      addresses:\n        - 192.168.110.157/24\n      routes:\n        - to: default\n          via: 192.168.110.1\n          metric: 100\n          on-link: true\n      nameservers:\n        addresses:\n          - 223.6.6.6\n      interfaces:\n          - wlp9s0\n      parameters:\n        stp: true\n        forward-delay: 4\n```\n\n\n","source":"_posts/037.kvm.md","raw":"---\ntitle: KVM部署实列\ndate: 2023-3-30 10:50:00\nsitemap: true\ncategories: \n- [KVM]\ntags: \n- kvm\n- qemu\n---\n\n\n## 零、 环境说明\n``` bash\nwang@ubuntu:~/Desktop$ sudo screenfetch\n                          ./+o+-       root@ubuntu\n                  yyyyy- -yyyyyy+      OS: Ubuntu 22.04 jammy\n               ://+//////-yyyyyyo      Kernel: x86_64 Linux 5.19.0-38-generic\n           .++ .:/++++++/-.+sss/`      Uptime: 2d 2h 14m\n         .:++o:  /++++++++/:--:/-      Packages: 2193\n        o:+o+:++.`..```.-/oo+++++/     Shell: sudo\n       .:+o:+o/.          `+sssoo+/    Resolution: 1920x1080\n  .++/+:+oo+o:`             /sssooo.   WM: Mutter\n /+++//+:`oo+o               /::--:.   WM Theme: Adwaita\n \\+/+o+++`o++o               ++////.   GTK Theme: Yaru [GTK3]\n  .++.o+++oo+:`             /dddhhh.   Disk: 31G / 234G (14%)\n       .+.o+oo:.          `oddhhhh+    CPU: Intel Core i7-6500U @ 4x 3.1GHz [54.0°C]\n        \\+.++o+o``-````.:ohdhhhhh+     GPU: Intel Corporation Skylake GT2 [HD Graphics 520] (rev 07)\n         `:o+++ `ohhhhhhhhyo++os:      RAM: 2305MiB / 7831MiB\n           .o:`.syhhhhhhh/.oo++o`     \n               /osyyyyyyo++ooo+++/    \n                   ````` +oo+++o\\:    \n                          `oo++.      \n```\n\n## 一、 安装依赖\n``` bash\nsudo apt install -y \\\n  qemu-kvm \\\n\tvirt-manager \\\n\tlibvirt-daemon-system \\\n\tvirtinst \\\n\tlibvirt-clients \\\n\tbridge-utils \n```\n\n|软件包                 |用途 |\n| ------               |  ------                         | \n|qemu-kvm              | 提供硬件仿真的开源仿真器和虚拟化包 |\n|virt-manager          | 通过 libvirt 守护进程，基于 QT 的图形界面的虚拟机管理工具 |\n|libvirt-daemon-system | 为运行 libvirt 进程提供必要配置文件的工具|\n|virtinst              | 一套为置备和修改虚拟机提供的命令行工具|\n|libvirt-clients       | 一组客户端的库和API，用于从命令行管理和控制虚拟机和管理程序|\n|bridge-utils          | 一套用于创建和管理桥接设备的工具|\n\n## 二、 启用虚拟化守护进程（libvirtd）\n\n``` bash\nsudo systemctl enable libvirtd --now\nsudo systemctl status libvirtd\n```\n\n## 三、 将当前用户加入kvm和libvirt用户组\n\n``` bash\nsudo usermod -aG kvm wang\nsudo usermod -aG libvirt wang\n``` \n\n## 四、 创建虚拟机\n\n### 4.1 图形管理工具 virt-manager 创建虚拟机\n图形化操作较为简单, 按照提下一步即可.\n![png](/images/037.kvm.md.02.png)\n\n### 4.2 使用 virt-install 创建虚拟机\n\nvirt-install 支持多种方式部署虚拟机, 详细参见[文档](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/virtualization_deployment_and_administration_guide/sect-guest_virtual_machine_installation_overview-creating_guests_with_virt_install).\n常见有如下几种:\n1. **iso/image固件**\n2. **网络安装**\n3. **从虚拟磁盘导入镜像**\n4. **PXE** \n5. **Kickstart** \n\n下面选择较为简单的通过iso固件部署虚拟机\n``` bash\nsudo virt-install \\ \n  --name vhost1 \\ \n  --memory 2048 \\ \n  --vcpus 2 \\ \n  --disk size=8 \\ \n  --cdrom /path/to/centos.iso \\ \n  --os-variant centos7 \n```\n![png](/images/037.kvm.md.04.png)\n\n\n## 五、 常见问题\n### 5.1 权限问题\n**may not be accessible by the hypervisor. You will need to grant the 'libvirt-qemu' user**\n![png](/images/037.kvm.md.03.png)\n\n解决: \n1. 确保将当前用户加入kvm和libvirt用户组\n2. 将镜像文件放置其他目录下.\n\n## 六、 虚拟机共享主机网络(vhost模式)\n如果希望{% label success@虚拟机共享物理机的网络%}, 需要创建网桥来实现.\n查看当前的网络情况\n![png](/images/037.kvm.md.01.png)\n\n\n创建网桥``` br0 ``` 接口为 ```wlp9s0```\n\n``` yaml\n#sudo vim /etc/netplan/br.yaml\n\nnetwork:\n  version: 2\n  renderer: networkd\n  ethernets:\n    wlp9s0:\n      dhcp4: false\n      dhcp6: false\n  bridges:\n    br0:\n      macaddress: aa:bb:cc:11:22:33\n      dhcp4: false\n      dhcp6: false\n      addresses:\n        - 192.168.110.157/24\n      routes:\n        - to: default\n          via: 192.168.110.1\n          metric: 100\n          on-link: true\n      nameservers:\n        addresses:\n          - 223.6.6.6\n      interfaces:\n          - wlp9s0\n      parameters:\n        stp: true\n        forward-delay: 4\n```\n\n\n","slug":"037.kvm","published":1,"updated":"2023-12-05T08:52:30.878Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzcx003kijnrep2j0h3a","content":"<h2 id=\"零、-环境说明\"><a href=\"#零、-环境说明\" class=\"headerlink\" title=\"零、 环境说明\"></a>零、 环境说明</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">wang@ubuntu:~/Desktop$ sudo screenfetch</span><br><span class=\"line\">                          ./+o+-       root@ubuntu</span><br><span class=\"line\">                  yyyyy- -yyyyyy+      OS: Ubuntu 22.04 jammy</span><br><span class=\"line\">               ://+//////-yyyyyyo      Kernel: x86_64 Linux 5.19.0-38-generic</span><br><span class=\"line\">           .++ .:/++++++/-.+sss/`      Uptime: 2d 2h 14m</span><br><span class=\"line\">         .:++o:  /++++++++/:--:/-      Packages: 2193</span><br><span class=\"line\">        o:+o+:++.`..```.-/oo+++++/     Shell: sudo</span><br><span class=\"line\">       .:+o:+o/.          `+sssoo+/    Resolution: 1920x1080</span><br><span class=\"line\">  .++/+:+oo+o:`             /sssooo.   WM: Mutter</span><br><span class=\"line\"> /+++//+:`oo+o               /::--:.   WM Theme: Adwaita</span><br><span class=\"line\"> \\+/+o+++`o++o               ++////.   GTK Theme: Yaru [GTK3]</span><br><span class=\"line\">  .++.o+++oo+:`             /dddhhh.   Disk: 31G / 234G (14%)</span><br><span class=\"line\">       .+.o+oo:.          `oddhhhh+    CPU: Intel Core i7-6500U @ 4x 3.1GHz [54.0°C]</span><br><span class=\"line\">        \\+.++o+o``-````.:ohdhhhhh+     GPU: Intel Corporation Skylake GT2 [HD Graphics 520] (rev 07)</span><br><span class=\"line\">         `:o+++ `ohhhhhhhhyo++os:      RAM: 2305MiB / 7831MiB</span><br><span class=\"line\">           .o:`.syhhhhhhh/.oo++o`     </span><br><span class=\"line\">               /osyyyyyyo++ooo+++/    </span><br><span class=\"line\">                   ````` +oo+++o\\:    </span><br><span class=\"line\">                          `oo++.      </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"一、-安装依赖\"><a href=\"#一、-安装依赖\" class=\"headerlink\" title=\"一、 安装依赖\"></a>一、 安装依赖</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo apt install -y \\</span><br><span class=\"line\">  qemu-kvm \\</span><br><span class=\"line\">\tvirt-manager \\</span><br><span class=\"line\">\tlibvirt-daemon-system \\</span><br><span class=\"line\">\tvirtinst \\</span><br><span class=\"line\">\tlibvirt-clients \\</span><br><span class=\"line\">\tbridge-utils </span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>软件包</th>\n<th>用途</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>qemu-kvm</td>\n<td>提供硬件仿真的开源仿真器和虚拟化包</td>\n</tr>\n<tr>\n<td>virt-manager</td>\n<td>通过 libvirt 守护进程，基于 QT 的图形界面的虚拟机管理工具</td>\n</tr>\n<tr>\n<td>libvirt-daemon-system</td>\n<td>为运行 libvirt 进程提供必要配置文件的工具</td>\n</tr>\n<tr>\n<td>virtinst</td>\n<td>一套为置备和修改虚拟机提供的命令行工具</td>\n</tr>\n<tr>\n<td>libvirt-clients</td>\n<td>一组客户端的库和API，用于从命令行管理和控制虚拟机和管理程序</td>\n</tr>\n<tr>\n<td>bridge-utils</td>\n<td>一套用于创建和管理桥接设备的工具</td>\n</tr>\n</tbody></table>\n<h2 id=\"二、-启用虚拟化守护进程（libvirtd）\"><a href=\"#二、-启用虚拟化守护进程（libvirtd）\" class=\"headerlink\" title=\"二、 启用虚拟化守护进程（libvirtd）\"></a>二、 启用虚拟化守护进程（libvirtd）</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo systemctl <span class=\"built_in\">enable</span> libvirtd --now</span><br><span class=\"line\">sudo systemctl status libvirtd</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"三、-将当前用户加入kvm和libvirt用户组\"><a href=\"#三、-将当前用户加入kvm和libvirt用户组\" class=\"headerlink\" title=\"三、 将当前用户加入kvm和libvirt用户组\"></a>三、 将当前用户加入kvm和libvirt用户组</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo usermod -aG kvm wang</span><br><span class=\"line\">sudo usermod -aG libvirt wang</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"四、-创建虚拟机\"><a href=\"#四、-创建虚拟机\" class=\"headerlink\" title=\"四、 创建虚拟机\"></a>四、 创建虚拟机</h2><h3 id=\"4-1-图形管理工具-virt-manager-创建虚拟机\"><a href=\"#4-1-图形管理工具-virt-manager-创建虚拟机\" class=\"headerlink\" title=\"4.1 图形管理工具 virt-manager 创建虚拟机\"></a>4.1 图形管理工具 virt-manager 创建虚拟机</h3><p>图形化操作较为简单, 按照提下一步即可.<br><img src=\"/images/037.kvm.md.02.png\" alt=\"png\"></p>\n<h3 id=\"4-2-使用-virt-install-创建虚拟机\"><a href=\"#4-2-使用-virt-install-创建虚拟机\" class=\"headerlink\" title=\"4.2 使用 virt-install 创建虚拟机\"></a>4.2 使用 virt-install 创建虚拟机</h3><p>virt-install 支持多种方式部署虚拟机, 详细参见<a href=\"https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/virtualization_deployment_and_administration_guide/sect-guest_virtual_machine_installation_overview-creating_guests_with_virt_install\">文档</a>.<br>常见有如下几种:</p>\n<ol>\n<li><strong>iso&#x2F;image固件</strong></li>\n<li><strong>网络安装</strong></li>\n<li><strong>从虚拟磁盘导入镜像</strong></li>\n<li><strong>PXE</strong> </li>\n<li><strong>Kickstart</strong></li>\n</ol>\n<p>下面选择较为简单的通过iso固件部署虚拟机</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo virt-install \\ </span><br><span class=\"line\">  --name vhost1 \\ </span><br><span class=\"line\">  --memory 2048 \\ </span><br><span class=\"line\">  --vcpus 2 \\ </span><br><span class=\"line\">  --disk size=8 \\ </span><br><span class=\"line\">  --cdrom /path/to/centos.iso \\ </span><br><span class=\"line\">  --os-variant centos7 </span><br></pre></td></tr></table></figure>\n<p><img src=\"/images/037.kvm.md.04.png\" alt=\"png\"></p>\n<h2 id=\"五、-常见问题\"><a href=\"#五、-常见问题\" class=\"headerlink\" title=\"五、 常见问题\"></a>五、 常见问题</h2><h3 id=\"5-1-权限问题\"><a href=\"#5-1-权限问题\" class=\"headerlink\" title=\"5.1 权限问题\"></a>5.1 权限问题</h3><p><strong>may not be accessible by the hypervisor. You will need to grant the ‘libvirt-qemu’ user</strong><br><img src=\"/images/037.kvm.md.03.png\" alt=\"png\"></p>\n<p>解决: </p>\n<ol>\n<li>确保将当前用户加入kvm和libvirt用户组</li>\n<li>将镜像文件放置其他目录下.</li>\n</ol>\n<h2 id=\"六、-虚拟机共享主机网络-vhost模式\"><a href=\"#六、-虚拟机共享主机网络-vhost模式\" class=\"headerlink\" title=\"六、 虚拟机共享主机网络(vhost模式)\"></a>六、 虚拟机共享主机网络(vhost模式)</h2><p>如果希望<mark class=\"label success\">虚拟机共享物理机的网络</mark>, 需要创建网桥来实现.<br>查看当前的网络情况<br><img src=\"/images/037.kvm.md.01.png\" alt=\"png\"></p>\n<p>创建网桥<code>br0</code> 接口为 <code>wlp9s0</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#sudo vim /etc/netplan/br.yaml</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">network:</span></span><br><span class=\"line\">  <span class=\"attr\">version:</span> <span class=\"number\">2</span></span><br><span class=\"line\">  <span class=\"attr\">renderer:</span> <span class=\"string\">networkd</span></span><br><span class=\"line\">  <span class=\"attr\">ethernets:</span></span><br><span class=\"line\">    <span class=\"attr\">wlp9s0:</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp4:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp6:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">bridges:</span></span><br><span class=\"line\">    <span class=\"attr\">br0:</span></span><br><span class=\"line\">      <span class=\"attr\">macaddress:</span> <span class=\"string\">aa:bb:cc:11:22:33</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp4:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp6:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">addresses:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"number\">192.168</span><span class=\"number\">.110</span><span class=\"number\">.157</span><span class=\"string\">/24</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">to:</span> <span class=\"string\">default</span></span><br><span class=\"line\">          <span class=\"attr\">via:</span> <span class=\"number\">192.168</span><span class=\"number\">.110</span><span class=\"number\">.1</span></span><br><span class=\"line\">          <span class=\"attr\">metric:</span> <span class=\"number\">100</span></span><br><span class=\"line\">          <span class=\"attr\">on-link:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">nameservers:</span></span><br><span class=\"line\">        <span class=\"attr\">addresses:</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"number\">223.6</span><span class=\"number\">.6</span><span class=\"number\">.6</span></span><br><span class=\"line\">      <span class=\"attr\">interfaces:</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"string\">wlp9s0</span></span><br><span class=\"line\">      <span class=\"attr\">parameters:</span></span><br><span class=\"line\">        <span class=\"attr\">stp:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">forward-delay:</span> <span class=\"number\">4</span></span><br></pre></td></tr></table></figure>\n\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"零、-环境说明\"><a href=\"#零、-环境说明\" class=\"headerlink\" title=\"零、 环境说明\"></a>零、 环境说明</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">wang@ubuntu:~/Desktop$ sudo screenfetch</span><br><span class=\"line\">                          ./+o+-       root@ubuntu</span><br><span class=\"line\">                  yyyyy- -yyyyyy+      OS: Ubuntu 22.04 jammy</span><br><span class=\"line\">               ://+//////-yyyyyyo      Kernel: x86_64 Linux 5.19.0-38-generic</span><br><span class=\"line\">           .++ .:/++++++/-.+sss/`      Uptime: 2d 2h 14m</span><br><span class=\"line\">         .:++o:  /++++++++/:--:/-      Packages: 2193</span><br><span class=\"line\">        o:+o+:++.`..```.-/oo+++++/     Shell: sudo</span><br><span class=\"line\">       .:+o:+o/.          `+sssoo+/    Resolution: 1920x1080</span><br><span class=\"line\">  .++/+:+oo+o:`             /sssooo.   WM: Mutter</span><br><span class=\"line\"> /+++//+:`oo+o               /::--:.   WM Theme: Adwaita</span><br><span class=\"line\"> \\+/+o+++`o++o               ++////.   GTK Theme: Yaru [GTK3]</span><br><span class=\"line\">  .++.o+++oo+:`             /dddhhh.   Disk: 31G / 234G (14%)</span><br><span class=\"line\">       .+.o+oo:.          `oddhhhh+    CPU: Intel Core i7-6500U @ 4x 3.1GHz [54.0°C]</span><br><span class=\"line\">        \\+.++o+o``-````.:ohdhhhhh+     GPU: Intel Corporation Skylake GT2 [HD Graphics 520] (rev 07)</span><br><span class=\"line\">         `:o+++ `ohhhhhhhhyo++os:      RAM: 2305MiB / 7831MiB</span><br><span class=\"line\">           .o:`.syhhhhhhh/.oo++o`     </span><br><span class=\"line\">               /osyyyyyyo++ooo+++/    </span><br><span class=\"line\">                   ````` +oo+++o\\:    </span><br><span class=\"line\">                          `oo++.      </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"一、-安装依赖\"><a href=\"#一、-安装依赖\" class=\"headerlink\" title=\"一、 安装依赖\"></a>一、 安装依赖</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo apt install -y \\</span><br><span class=\"line\">  qemu-kvm \\</span><br><span class=\"line\">\tvirt-manager \\</span><br><span class=\"line\">\tlibvirt-daemon-system \\</span><br><span class=\"line\">\tvirtinst \\</span><br><span class=\"line\">\tlibvirt-clients \\</span><br><span class=\"line\">\tbridge-utils </span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>软件包</th>\n<th>用途</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>qemu-kvm</td>\n<td>提供硬件仿真的开源仿真器和虚拟化包</td>\n</tr>\n<tr>\n<td>virt-manager</td>\n<td>通过 libvirt 守护进程，基于 QT 的图形界面的虚拟机管理工具</td>\n</tr>\n<tr>\n<td>libvirt-daemon-system</td>\n<td>为运行 libvirt 进程提供必要配置文件的工具</td>\n</tr>\n<tr>\n<td>virtinst</td>\n<td>一套为置备和修改虚拟机提供的命令行工具</td>\n</tr>\n<tr>\n<td>libvirt-clients</td>\n<td>一组客户端的库和API，用于从命令行管理和控制虚拟机和管理程序</td>\n</tr>\n<tr>\n<td>bridge-utils</td>\n<td>一套用于创建和管理桥接设备的工具</td>\n</tr>\n</tbody></table>\n<h2 id=\"二、-启用虚拟化守护进程（libvirtd）\"><a href=\"#二、-启用虚拟化守护进程（libvirtd）\" class=\"headerlink\" title=\"二、 启用虚拟化守护进程（libvirtd）\"></a>二、 启用虚拟化守护进程（libvirtd）</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo systemctl <span class=\"built_in\">enable</span> libvirtd --now</span><br><span class=\"line\">sudo systemctl status libvirtd</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"三、-将当前用户加入kvm和libvirt用户组\"><a href=\"#三、-将当前用户加入kvm和libvirt用户组\" class=\"headerlink\" title=\"三、 将当前用户加入kvm和libvirt用户组\"></a>三、 将当前用户加入kvm和libvirt用户组</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo usermod -aG kvm wang</span><br><span class=\"line\">sudo usermod -aG libvirt wang</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"四、-创建虚拟机\"><a href=\"#四、-创建虚拟机\" class=\"headerlink\" title=\"四、 创建虚拟机\"></a>四、 创建虚拟机</h2><h3 id=\"4-1-图形管理工具-virt-manager-创建虚拟机\"><a href=\"#4-1-图形管理工具-virt-manager-创建虚拟机\" class=\"headerlink\" title=\"4.1 图形管理工具 virt-manager 创建虚拟机\"></a>4.1 图形管理工具 virt-manager 创建虚拟机</h3><p>图形化操作较为简单, 按照提下一步即可.<br><img src=\"/images/037.kvm.md.02.png\" alt=\"png\"></p>\n<h3 id=\"4-2-使用-virt-install-创建虚拟机\"><a href=\"#4-2-使用-virt-install-创建虚拟机\" class=\"headerlink\" title=\"4.2 使用 virt-install 创建虚拟机\"></a>4.2 使用 virt-install 创建虚拟机</h3><p>virt-install 支持多种方式部署虚拟机, 详细参见<a href=\"https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/virtualization_deployment_and_administration_guide/sect-guest_virtual_machine_installation_overview-creating_guests_with_virt_install\">文档</a>.<br>常见有如下几种:</p>\n<ol>\n<li><strong>iso&#x2F;image固件</strong></li>\n<li><strong>网络安装</strong></li>\n<li><strong>从虚拟磁盘导入镜像</strong></li>\n<li><strong>PXE</strong> </li>\n<li><strong>Kickstart</strong></li>\n</ol>\n<p>下面选择较为简单的通过iso固件部署虚拟机</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo virt-install \\ </span><br><span class=\"line\">  --name vhost1 \\ </span><br><span class=\"line\">  --memory 2048 \\ </span><br><span class=\"line\">  --vcpus 2 \\ </span><br><span class=\"line\">  --disk size=8 \\ </span><br><span class=\"line\">  --cdrom /path/to/centos.iso \\ </span><br><span class=\"line\">  --os-variant centos7 </span><br></pre></td></tr></table></figure>\n<p><img src=\"/images/037.kvm.md.04.png\" alt=\"png\"></p>\n<h2 id=\"五、-常见问题\"><a href=\"#五、-常见问题\" class=\"headerlink\" title=\"五、 常见问题\"></a>五、 常见问题</h2><h3 id=\"5-1-权限问题\"><a href=\"#5-1-权限问题\" class=\"headerlink\" title=\"5.1 权限问题\"></a>5.1 权限问题</h3><p><strong>may not be accessible by the hypervisor. You will need to grant the ‘libvirt-qemu’ user</strong><br><img src=\"/images/037.kvm.md.03.png\" alt=\"png\"></p>\n<p>解决: </p>\n<ol>\n<li>确保将当前用户加入kvm和libvirt用户组</li>\n<li>将镜像文件放置其他目录下.</li>\n</ol>\n<h2 id=\"六、-虚拟机共享主机网络-vhost模式\"><a href=\"#六、-虚拟机共享主机网络-vhost模式\" class=\"headerlink\" title=\"六、 虚拟机共享主机网络(vhost模式)\"></a>六、 虚拟机共享主机网络(vhost模式)</h2><p>如果希望<mark class=\"label success\">虚拟机共享物理机的网络</mark>, 需要创建网桥来实现.<br>查看当前的网络情况<br><img src=\"/images/037.kvm.md.01.png\" alt=\"png\"></p>\n<p>创建网桥<code>br0</code> 接口为 <code>wlp9s0</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#sudo vim /etc/netplan/br.yaml</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">network:</span></span><br><span class=\"line\">  <span class=\"attr\">version:</span> <span class=\"number\">2</span></span><br><span class=\"line\">  <span class=\"attr\">renderer:</span> <span class=\"string\">networkd</span></span><br><span class=\"line\">  <span class=\"attr\">ethernets:</span></span><br><span class=\"line\">    <span class=\"attr\">wlp9s0:</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp4:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp6:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">bridges:</span></span><br><span class=\"line\">    <span class=\"attr\">br0:</span></span><br><span class=\"line\">      <span class=\"attr\">macaddress:</span> <span class=\"string\">aa:bb:cc:11:22:33</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp4:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp6:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">addresses:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"number\">192.168</span><span class=\"number\">.110</span><span class=\"number\">.157</span><span class=\"string\">/24</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">to:</span> <span class=\"string\">default</span></span><br><span class=\"line\">          <span class=\"attr\">via:</span> <span class=\"number\">192.168</span><span class=\"number\">.110</span><span class=\"number\">.1</span></span><br><span class=\"line\">          <span class=\"attr\">metric:</span> <span class=\"number\">100</span></span><br><span class=\"line\">          <span class=\"attr\">on-link:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">nameservers:</span></span><br><span class=\"line\">        <span class=\"attr\">addresses:</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"number\">223.6</span><span class=\"number\">.6</span><span class=\"number\">.6</span></span><br><span class=\"line\">      <span class=\"attr\">interfaces:</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"string\">wlp9s0</span></span><br><span class=\"line\">      <span class=\"attr\">parameters:</span></span><br><span class=\"line\">        <span class=\"attr\">stp:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">forward-delay:</span> <span class=\"number\">4</span></span><br></pre></td></tr></table></figure>\n\n\n"},{"title":"Ubuntu网络配置","date":"2023-03-30T02:50:00.000Z","sitemap":true,"_content":"\n适用于 ```Ubuntu 20.04``` 及以上使用 ```netplan``` 的版本\n\n**static**:\n\n``` yaml\nnetwork:\n  renderer: networkd\n  ethernets:\n    enp1s0:\n      addresses:\n        - 192.168.1.10/24\n      nameservers:\n        addresses: [192.168.1.1]\n      routes:\n        - to: default\n          via: 192.168.1.1\n  version: 2\n```\n\n**DHCP**: \n\n``` yaml\nnetwork:\n  ethernets:\n    enp1s0:\n      dhcp4: true\n      nameservers:\n        addresses: [223.6.6.6,223.5.5.5]\n  version: 2\n```\n\n**bridge**: \n\n``` yaml\nnetwork:\n  version: 2\n  renderer: networkd\n  ethernets:\n    enp1s0:\n      dhcp4: false\n      dhcp6: false\n  bridges:\n    br0:\n      macaddress: aa:bb:cc:11:22:33\n      dhcp4: false\n      dhcp6: false\n      addresses:\n        - 192.168.110.161/24\n      routes:\n        - to: default\n          via: 192.168.110.1\n          metric: 100\n          on-link: true\n      nameservers:\n        addresses:\n          - 223.6.6.6\n      interfaces:\n          - enp1s0\n      parameters:\n        stp: true\n        forward-delay: 4\n```\n\n\n\n","source":"_posts/038.ubuntu_network_config.md","raw":"---\ntitle: Ubuntu网络配置\ndate: 2023-3-30 10:50:00\nsitemap: true\ncategories: \n- [Linux]\n- [Network]\ntags: \n- Ubuntu\n- network\n---\n\n适用于 ```Ubuntu 20.04``` 及以上使用 ```netplan``` 的版本\n\n**static**:\n\n``` yaml\nnetwork:\n  renderer: networkd\n  ethernets:\n    enp1s0:\n      addresses:\n        - 192.168.1.10/24\n      nameservers:\n        addresses: [192.168.1.1]\n      routes:\n        - to: default\n          via: 192.168.1.1\n  version: 2\n```\n\n**DHCP**: \n\n``` yaml\nnetwork:\n  ethernets:\n    enp1s0:\n      dhcp4: true\n      nameservers:\n        addresses: [223.6.6.6,223.5.5.5]\n  version: 2\n```\n\n**bridge**: \n\n``` yaml\nnetwork:\n  version: 2\n  renderer: networkd\n  ethernets:\n    enp1s0:\n      dhcp4: false\n      dhcp6: false\n  bridges:\n    br0:\n      macaddress: aa:bb:cc:11:22:33\n      dhcp4: false\n      dhcp6: false\n      addresses:\n        - 192.168.110.161/24\n      routes:\n        - to: default\n          via: 192.168.110.1\n          metric: 100\n          on-link: true\n      nameservers:\n        addresses:\n          - 223.6.6.6\n      interfaces:\n          - enp1s0\n      parameters:\n        stp: true\n        forward-delay: 4\n```\n\n\n\n","slug":"038.ubuntu_network_config","published":1,"updated":"2023-12-05T08:52:30.878Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzcy003nijnr9vme5057","content":"<p>适用于 <code>Ubuntu 20.04</code> 及以上使用 <code>netplan</code> 的版本</p>\n<p><strong>static</strong>:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">network:</span></span><br><span class=\"line\">  <span class=\"attr\">renderer:</span> <span class=\"string\">networkd</span></span><br><span class=\"line\">  <span class=\"attr\">ethernets:</span></span><br><span class=\"line\">    <span class=\"attr\">enp1s0:</span></span><br><span class=\"line\">      <span class=\"attr\">addresses:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.10</span><span class=\"string\">/24</span></span><br><span class=\"line\">      <span class=\"attr\">nameservers:</span></span><br><span class=\"line\">        <span class=\"attr\">addresses:</span> [<span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.1</span>]</span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">to:</span> <span class=\"string\">default</span></span><br><span class=\"line\">          <span class=\"attr\">via:</span> <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.1</span></span><br><span class=\"line\">  <span class=\"attr\">version:</span> <span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>DHCP</strong>: </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">network:</span></span><br><span class=\"line\">  <span class=\"attr\">ethernets:</span></span><br><span class=\"line\">    <span class=\"attr\">enp1s0:</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp4:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">nameservers:</span></span><br><span class=\"line\">        <span class=\"attr\">addresses:</span> [<span class=\"number\">223.6</span><span class=\"number\">.6</span><span class=\"number\">.6</span>,<span class=\"number\">223.5</span><span class=\"number\">.5</span><span class=\"number\">.5</span>]</span><br><span class=\"line\">  <span class=\"attr\">version:</span> <span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>bridge</strong>: </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">network:</span></span><br><span class=\"line\">  <span class=\"attr\">version:</span> <span class=\"number\">2</span></span><br><span class=\"line\">  <span class=\"attr\">renderer:</span> <span class=\"string\">networkd</span></span><br><span class=\"line\">  <span class=\"attr\">ethernets:</span></span><br><span class=\"line\">    <span class=\"attr\">enp1s0:</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp4:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp6:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">bridges:</span></span><br><span class=\"line\">    <span class=\"attr\">br0:</span></span><br><span class=\"line\">      <span class=\"attr\">macaddress:</span> <span class=\"string\">aa:bb:cc:11:22:33</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp4:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp6:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">addresses:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"number\">192.168</span><span class=\"number\">.110</span><span class=\"number\">.161</span><span class=\"string\">/24</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">to:</span> <span class=\"string\">default</span></span><br><span class=\"line\">          <span class=\"attr\">via:</span> <span class=\"number\">192.168</span><span class=\"number\">.110</span><span class=\"number\">.1</span></span><br><span class=\"line\">          <span class=\"attr\">metric:</span> <span class=\"number\">100</span></span><br><span class=\"line\">          <span class=\"attr\">on-link:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">nameservers:</span></span><br><span class=\"line\">        <span class=\"attr\">addresses:</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"number\">223.6</span><span class=\"number\">.6</span><span class=\"number\">.6</span></span><br><span class=\"line\">      <span class=\"attr\">interfaces:</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"string\">enp1s0</span></span><br><span class=\"line\">      <span class=\"attr\">parameters:</span></span><br><span class=\"line\">        <span class=\"attr\">stp:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">forward-delay:</span> <span class=\"number\">4</span></span><br></pre></td></tr></table></figure>\n\n\n\n","site":{"data":{}},"excerpt":"","more":"<p>适用于 <code>Ubuntu 20.04</code> 及以上使用 <code>netplan</code> 的版本</p>\n<p><strong>static</strong>:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">network:</span></span><br><span class=\"line\">  <span class=\"attr\">renderer:</span> <span class=\"string\">networkd</span></span><br><span class=\"line\">  <span class=\"attr\">ethernets:</span></span><br><span class=\"line\">    <span class=\"attr\">enp1s0:</span></span><br><span class=\"line\">      <span class=\"attr\">addresses:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.10</span><span class=\"string\">/24</span></span><br><span class=\"line\">      <span class=\"attr\">nameservers:</span></span><br><span class=\"line\">        <span class=\"attr\">addresses:</span> [<span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.1</span>]</span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">to:</span> <span class=\"string\">default</span></span><br><span class=\"line\">          <span class=\"attr\">via:</span> <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.1</span></span><br><span class=\"line\">  <span class=\"attr\">version:</span> <span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>DHCP</strong>: </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">network:</span></span><br><span class=\"line\">  <span class=\"attr\">ethernets:</span></span><br><span class=\"line\">    <span class=\"attr\">enp1s0:</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp4:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">nameservers:</span></span><br><span class=\"line\">        <span class=\"attr\">addresses:</span> [<span class=\"number\">223.6</span><span class=\"number\">.6</span><span class=\"number\">.6</span>,<span class=\"number\">223.5</span><span class=\"number\">.5</span><span class=\"number\">.5</span>]</span><br><span class=\"line\">  <span class=\"attr\">version:</span> <span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>bridge</strong>: </p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">network:</span></span><br><span class=\"line\">  <span class=\"attr\">version:</span> <span class=\"number\">2</span></span><br><span class=\"line\">  <span class=\"attr\">renderer:</span> <span class=\"string\">networkd</span></span><br><span class=\"line\">  <span class=\"attr\">ethernets:</span></span><br><span class=\"line\">    <span class=\"attr\">enp1s0:</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp4:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp6:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">bridges:</span></span><br><span class=\"line\">    <span class=\"attr\">br0:</span></span><br><span class=\"line\">      <span class=\"attr\">macaddress:</span> <span class=\"string\">aa:bb:cc:11:22:33</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp4:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">dhcp6:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">addresses:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"number\">192.168</span><span class=\"number\">.110</span><span class=\"number\">.161</span><span class=\"string\">/24</span></span><br><span class=\"line\">      <span class=\"attr\">routes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">to:</span> <span class=\"string\">default</span></span><br><span class=\"line\">          <span class=\"attr\">via:</span> <span class=\"number\">192.168</span><span class=\"number\">.110</span><span class=\"number\">.1</span></span><br><span class=\"line\">          <span class=\"attr\">metric:</span> <span class=\"number\">100</span></span><br><span class=\"line\">          <span class=\"attr\">on-link:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">nameservers:</span></span><br><span class=\"line\">        <span class=\"attr\">addresses:</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"number\">223.6</span><span class=\"number\">.6</span><span class=\"number\">.6</span></span><br><span class=\"line\">      <span class=\"attr\">interfaces:</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"string\">enp1s0</span></span><br><span class=\"line\">      <span class=\"attr\">parameters:</span></span><br><span class=\"line\">        <span class=\"attr\">stp:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">forward-delay:</span> <span class=\"number\">4</span></span><br></pre></td></tr></table></figure>\n\n\n\n"},{"title":"OpenWrt安装passwall","date":"2023-04-23T06:50:13.000Z","_content":"\n## 一、 环境\n|主机名\t|OpenWrt|\n|---|---|\n|型号\t|Raspberry Pi 3 Model B Rev 1.2|\n|架构\t|ARMv8 Processor rev 4|\n|目标平台\t|bcm27xx/bcm2710|\n\n## 二、 开启文件上传\n``` opkg install openssh-sftp-server ```\n\n## 三、 下载软件包\n根据自己的硬件版本下载相应的包\n这里 树莓派3B 选择 ```aarch64_cortex-a53.zip```\nhttps://github.com/xiaorouji/openwrt-passwall/releases\n\n## 四、 解压上传\n\n<img src=\"/images/040.openwrt_install_passwall.md.01.png\" width=90% height=90% />\n\n## 五、 安装\n\n### 5.1 安装依赖\n``` opkg install *.ipk```\n<img src=\"/images/040.openwrt_install_passwall.md.02.png\" width=90% height=90% />\n\n### 5.2 安装passwall-luci\n``` opkg install luci-app-passwall_4.66-4_all.ipk```\n``` opkg install luci-i18n-passwall-zh-cn_4.66-4_all.ipk```\n\n## 六、 重启OpenWrt\n<img src=\"/images/040.openwrt_install_passwall.md.03.png\" width=90% height=90% />\n<img src=\"/images/040.openwrt_install_passwall.md.04.png\" width=90% height=90% />","source":"_posts/040.openwrt_install_passwall.md","raw":"---\ntitle: OpenWrt安装passwall\ndate: 2023-4-23 14:50:13\ncategories: \n- [OpenWrt]\ntags: \n- OpenWrt\n- passwall\n---\n\n## 一、 环境\n|主机名\t|OpenWrt|\n|---|---|\n|型号\t|Raspberry Pi 3 Model B Rev 1.2|\n|架构\t|ARMv8 Processor rev 4|\n|目标平台\t|bcm27xx/bcm2710|\n\n## 二、 开启文件上传\n``` opkg install openssh-sftp-server ```\n\n## 三、 下载软件包\n根据自己的硬件版本下载相应的包\n这里 树莓派3B 选择 ```aarch64_cortex-a53.zip```\nhttps://github.com/xiaorouji/openwrt-passwall/releases\n\n## 四、 解压上传\n\n<img src=\"/images/040.openwrt_install_passwall.md.01.png\" width=90% height=90% />\n\n## 五、 安装\n\n### 5.1 安装依赖\n``` opkg install *.ipk```\n<img src=\"/images/040.openwrt_install_passwall.md.02.png\" width=90% height=90% />\n\n### 5.2 安装passwall-luci\n``` opkg install luci-app-passwall_4.66-4_all.ipk```\n``` opkg install luci-i18n-passwall-zh-cn_4.66-4_all.ipk```\n\n## 六、 重启OpenWrt\n<img src=\"/images/040.openwrt_install_passwall.md.03.png\" width=90% height=90% />\n<img src=\"/images/040.openwrt_install_passwall.md.04.png\" width=90% height=90% />","slug":"040.openwrt_install_passwall","published":1,"updated":"2023-12-05T08:52:30.878Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzd0003rijnr4jbh2f5v","content":"<h2 id=\"一、-环境\"><a href=\"#一、-环境\" class=\"headerlink\" title=\"一、 环境\"></a>一、 环境</h2><table>\n<thead>\n<tr>\n<th>主机名</th>\n<th>OpenWrt</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>型号</td>\n<td>Raspberry Pi 3 Model B Rev 1.2</td>\n</tr>\n<tr>\n<td>架构</td>\n<td>ARMv8 Processor rev 4</td>\n</tr>\n<tr>\n<td>目标平台</td>\n<td>bcm27xx&#x2F;bcm2710</td>\n</tr>\n</tbody></table>\n<h2 id=\"二、-开启文件上传\"><a href=\"#二、-开启文件上传\" class=\"headerlink\" title=\"二、 开启文件上传\"></a>二、 开启文件上传</h2><p><code>opkg install openssh-sftp-server</code></p>\n<h2 id=\"三、-下载软件包\"><a href=\"#三、-下载软件包\" class=\"headerlink\" title=\"三、 下载软件包\"></a>三、 下载软件包</h2><p>根据自己的硬件版本下载相应的包<br>这里 树莓派3B 选择 <code>aarch64_cortex-a53.zip</code><br><a href=\"https://github.com/xiaorouji/openwrt-passwall/releases\">https://github.com/xiaorouji/openwrt-passwall/releases</a></p>\n<h2 id=\"四、-解压上传\"><a href=\"#四、-解压上传\" class=\"headerlink\" title=\"四、 解压上传\"></a>四、 解压上传</h2><img src=\"/images/040.openwrt_install_passwall.md.01.png\" width=90% height=90% />\n\n<h2 id=\"五、-安装\"><a href=\"#五、-安装\" class=\"headerlink\" title=\"五、 安装\"></a>五、 安装</h2><h3 id=\"5-1-安装依赖\"><a href=\"#5-1-安装依赖\" class=\"headerlink\" title=\"5.1 安装依赖\"></a>5.1 安装依赖</h3><p><code> opkg install *.ipk</code><br><img src=\"/images/040.openwrt_install_passwall.md.02.png\" width=90% height=90% /></p>\n<h3 id=\"5-2-安装passwall-luci\"><a href=\"#5-2-安装passwall-luci\" class=\"headerlink\" title=\"5.2 安装passwall-luci\"></a>5.2 安装passwall-luci</h3><p><code> opkg install luci-app-passwall_4.66-4_all.ipk</code><br><code> opkg install luci-i18n-passwall-zh-cn_4.66-4_all.ipk</code></p>\n<h2 id=\"六、-重启OpenWrt\"><a href=\"#六、-重启OpenWrt\" class=\"headerlink\" title=\"六、 重启OpenWrt\"></a>六、 重启OpenWrt</h2><img src=\"/images/040.openwrt_install_passwall.md.03.png\" width=90% height=90% />\n<img src=\"/images/040.openwrt_install_passwall.md.04.png\" width=90% height=90% />","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、-环境\"><a href=\"#一、-环境\" class=\"headerlink\" title=\"一、 环境\"></a>一、 环境</h2><table>\n<thead>\n<tr>\n<th>主机名</th>\n<th>OpenWrt</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>型号</td>\n<td>Raspberry Pi 3 Model B Rev 1.2</td>\n</tr>\n<tr>\n<td>架构</td>\n<td>ARMv8 Processor rev 4</td>\n</tr>\n<tr>\n<td>目标平台</td>\n<td>bcm27xx&#x2F;bcm2710</td>\n</tr>\n</tbody></table>\n<h2 id=\"二、-开启文件上传\"><a href=\"#二、-开启文件上传\" class=\"headerlink\" title=\"二、 开启文件上传\"></a>二、 开启文件上传</h2><p><code>opkg install openssh-sftp-server</code></p>\n<h2 id=\"三、-下载软件包\"><a href=\"#三、-下载软件包\" class=\"headerlink\" title=\"三、 下载软件包\"></a>三、 下载软件包</h2><p>根据自己的硬件版本下载相应的包<br>这里 树莓派3B 选择 <code>aarch64_cortex-a53.zip</code><br><a href=\"https://github.com/xiaorouji/openwrt-passwall/releases\">https://github.com/xiaorouji/openwrt-passwall/releases</a></p>\n<h2 id=\"四、-解压上传\"><a href=\"#四、-解压上传\" class=\"headerlink\" title=\"四、 解压上传\"></a>四、 解压上传</h2><img src=\"/images/040.openwrt_install_passwall.md.01.png\" width=90% height=90% />\n\n<h2 id=\"五、-安装\"><a href=\"#五、-安装\" class=\"headerlink\" title=\"五、 安装\"></a>五、 安装</h2><h3 id=\"5-1-安装依赖\"><a href=\"#5-1-安装依赖\" class=\"headerlink\" title=\"5.1 安装依赖\"></a>5.1 安装依赖</h3><p><code> opkg install *.ipk</code><br><img src=\"/images/040.openwrt_install_passwall.md.02.png\" width=90% height=90% /></p>\n<h3 id=\"5-2-安装passwall-luci\"><a href=\"#5-2-安装passwall-luci\" class=\"headerlink\" title=\"5.2 安装passwall-luci\"></a>5.2 安装passwall-luci</h3><p><code> opkg install luci-app-passwall_4.66-4_all.ipk</code><br><code> opkg install luci-i18n-passwall-zh-cn_4.66-4_all.ipk</code></p>\n<h2 id=\"六、-重启OpenWrt\"><a href=\"#六、-重启OpenWrt\" class=\"headerlink\" title=\"六、 重启OpenWrt\"></a>六、 重启OpenWrt</h2><img src=\"/images/040.openwrt_install_passwall.md.03.png\" width=90% height=90% />\n<img src=\"/images/040.openwrt_install_passwall.md.04.png\" width=90% height=90% />"},{"title":"OpenWrt开启文件上传","date":"2023-04-23T06:50:13.000Z","_content":"\n\nRaspberry Pi 3 model B V1.2 \nOpenWrt 22.03.5\n\nopkg install openssh-sftp-server","source":"_posts/040.openwrt_sftp.md","raw":"---\ntitle: OpenWrt开启文件上传\ndate: 2023-4-23 14:50:13\ncategories: \n- [OpenWrt]\ntags: \n- OpenWrt\n---\n\n\nRaspberry Pi 3 model B V1.2 \nOpenWrt 22.03.5\n\nopkg install openssh-sftp-server","slug":"040.openwrt_sftp","published":1,"updated":"2023-12-05T08:52:30.878Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzd1003tijnr3obo8dj2","content":"<p>Raspberry Pi 3 model B V1.2<br>OpenWrt 22.03.5</p>\n<p>opkg install openssh-sftp-server</p>\n","site":{"data":{}},"excerpt":"","more":"<p>Raspberry Pi 3 model B V1.2<br>OpenWrt 22.03.5</p>\n<p>opkg install openssh-sftp-server</p>\n"},{"title":"OpenWrt安装frpc","date":"2023-06-02T06:50:13.000Z","_content":"\n## 一、 安装\n\n系统 --> 软件包 --> 更新列表\n\n搜索 frpc 根据实际安装\n\n## 二、 luci界面报错\n``` \n/usr/lib/lua/luci/model/cbi/frp/basic.lua:2: module 'luci.model.ipkg' not found:\n\tno field package.preload['luci.model.ipkg']\n\tno file './luci/model/ipkg.lua'\n\tno file '/usr/share/lua/luci/model/ipkg.lua'\n\tno file '/usr/share/lua/luci/model/ipkg/init.lua'\n\tno file '/usr/lib/lua/luci/model/ipkg.lua'\n\tno file '/usr/lib/lua/luci/model/ipkg/init.lua'\n\tno file './luci/model/ipkg.so'\n\tno file '/usr/lib/lua/luci/model/ipkg.so'\n\tno file '/usr/lib/lua/loadall.so'\n\tno file './luci.so'\n\tno file '/usr/lib/lua/luci.so'\n\tno file '/usr/lib/lua/loadall.so'\nstack traceback:\n\t[C]: in function 'require'\n\t/usr/lib/lua/luci/model/cbi/frp/basic.lua:2: in function 'func'\n\t/usr/lib/lua/luci/cbi.lua:66: in function 'load'\n\t/usr/lib/lua/luci/dispatcher.lua:1385: in function '_cbi'\n\t/usr/lib/lua/luci/dispatcher.lua:1056: in function 'dispatch'\n\t/usr/lib/lua/luci/dispatcher.lua:483: in function </usr/lib/lua/luci/dispatcher.lua:482>\n```\n\n\n## 三、 问题解决\n\n编辑文件 ``` /usr/lib/lua/luci/model/cbi/frp/basic.lua ```\n\n注释  ``` require(\"luci.model.ipkg\") ```\n\n<img src=\"/images/041.openwrt_install_frpc.md.01.png\" width=100% height=100% />\n<img src=\"/images/041.openwrt_install_frpc.md.02.png\" width=100% height=100% />\n\n\n","source":"_posts/041.openwrt_install_frpc.md","raw":"---\ntitle: OpenWrt安装frpc\ndate: 2023-6-2 14:50:13\ncategories: \n- [OpenWrt]\ntags: \n- OpenWrt\n- frpc\n---\n\n## 一、 安装\n\n系统 --> 软件包 --> 更新列表\n\n搜索 frpc 根据实际安装\n\n## 二、 luci界面报错\n``` \n/usr/lib/lua/luci/model/cbi/frp/basic.lua:2: module 'luci.model.ipkg' not found:\n\tno field package.preload['luci.model.ipkg']\n\tno file './luci/model/ipkg.lua'\n\tno file '/usr/share/lua/luci/model/ipkg.lua'\n\tno file '/usr/share/lua/luci/model/ipkg/init.lua'\n\tno file '/usr/lib/lua/luci/model/ipkg.lua'\n\tno file '/usr/lib/lua/luci/model/ipkg/init.lua'\n\tno file './luci/model/ipkg.so'\n\tno file '/usr/lib/lua/luci/model/ipkg.so'\n\tno file '/usr/lib/lua/loadall.so'\n\tno file './luci.so'\n\tno file '/usr/lib/lua/luci.so'\n\tno file '/usr/lib/lua/loadall.so'\nstack traceback:\n\t[C]: in function 'require'\n\t/usr/lib/lua/luci/model/cbi/frp/basic.lua:2: in function 'func'\n\t/usr/lib/lua/luci/cbi.lua:66: in function 'load'\n\t/usr/lib/lua/luci/dispatcher.lua:1385: in function '_cbi'\n\t/usr/lib/lua/luci/dispatcher.lua:1056: in function 'dispatch'\n\t/usr/lib/lua/luci/dispatcher.lua:483: in function </usr/lib/lua/luci/dispatcher.lua:482>\n```\n\n\n## 三、 问题解决\n\n编辑文件 ``` /usr/lib/lua/luci/model/cbi/frp/basic.lua ```\n\n注释  ``` require(\"luci.model.ipkg\") ```\n\n<img src=\"/images/041.openwrt_install_frpc.md.01.png\" width=100% height=100% />\n<img src=\"/images/041.openwrt_install_frpc.md.02.png\" width=100% height=100% />\n\n\n","slug":"041.openwrt_install_frpc","published":1,"updated":"2023-12-05T08:52:30.878Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzd4003wijnr1w1u4h7p","content":"<h2 id=\"一、-安装\"><a href=\"#一、-安装\" class=\"headerlink\" title=\"一、 安装\"></a>一、 安装</h2><p>系统 –&gt; 软件包 –&gt; 更新列表</p>\n<p>搜索 frpc 根据实际安装</p>\n<h2 id=\"二、-luci界面报错\"><a href=\"#二、-luci界面报错\" class=\"headerlink\" title=\"二、 luci界面报错\"></a>二、 luci界面报错</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">/usr/lib/lua/luci/model/cbi/frp/basic.lua:2: module &#x27;luci.model.ipkg&#x27; not found:</span><br><span class=\"line\">\tno field package.preload[&#x27;luci.model.ipkg&#x27;]</span><br><span class=\"line\">\tno file &#x27;./luci/model/ipkg.lua&#x27;</span><br><span class=\"line\">\tno file &#x27;/usr/share/lua/luci/model/ipkg.lua&#x27;</span><br><span class=\"line\">\tno file &#x27;/usr/share/lua/luci/model/ipkg/init.lua&#x27;</span><br><span class=\"line\">\tno file &#x27;/usr/lib/lua/luci/model/ipkg.lua&#x27;</span><br><span class=\"line\">\tno file &#x27;/usr/lib/lua/luci/model/ipkg/init.lua&#x27;</span><br><span class=\"line\">\tno file &#x27;./luci/model/ipkg.so&#x27;</span><br><span class=\"line\">\tno file &#x27;/usr/lib/lua/luci/model/ipkg.so&#x27;</span><br><span class=\"line\">\tno file &#x27;/usr/lib/lua/loadall.so&#x27;</span><br><span class=\"line\">\tno file &#x27;./luci.so&#x27;</span><br><span class=\"line\">\tno file &#x27;/usr/lib/lua/luci.so&#x27;</span><br><span class=\"line\">\tno file &#x27;/usr/lib/lua/loadall.so&#x27;</span><br><span class=\"line\">stack traceback:</span><br><span class=\"line\">\t[C]: in function &#x27;require&#x27;</span><br><span class=\"line\">\t/usr/lib/lua/luci/model/cbi/frp/basic.lua:2: in function &#x27;func&#x27;</span><br><span class=\"line\">\t/usr/lib/lua/luci/cbi.lua:66: in function &#x27;load&#x27;</span><br><span class=\"line\">\t/usr/lib/lua/luci/dispatcher.lua:1385: in function &#x27;_cbi&#x27;</span><br><span class=\"line\">\t/usr/lib/lua/luci/dispatcher.lua:1056: in function &#x27;dispatch&#x27;</span><br><span class=\"line\">\t/usr/lib/lua/luci/dispatcher.lua:483: in function &lt;/usr/lib/lua/luci/dispatcher.lua:482&gt;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"三、-问题解决\"><a href=\"#三、-问题解决\" class=\"headerlink\" title=\"三、 问题解决\"></a>三、 问题解决</h2><p>编辑文件 <code>/usr/lib/lua/luci/model/cbi/frp/basic.lua</code></p>\n<p>注释  <code>require(&quot;luci.model.ipkg&quot;)</code></p>\n<img src=\"/images/041.openwrt_install_frpc.md.01.png\" width=100% height=100% />\n<img src=\"/images/041.openwrt_install_frpc.md.02.png\" width=100% height=100% />\n\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、-安装\"><a href=\"#一、-安装\" class=\"headerlink\" title=\"一、 安装\"></a>一、 安装</h2><p>系统 –&gt; 软件包 –&gt; 更新列表</p>\n<p>搜索 frpc 根据实际安装</p>\n<h2 id=\"二、-luci界面报错\"><a href=\"#二、-luci界面报错\" class=\"headerlink\" title=\"二、 luci界面报错\"></a>二、 luci界面报错</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">/usr/lib/lua/luci/model/cbi/frp/basic.lua:2: module &#x27;luci.model.ipkg&#x27; not found:</span><br><span class=\"line\">\tno field package.preload[&#x27;luci.model.ipkg&#x27;]</span><br><span class=\"line\">\tno file &#x27;./luci/model/ipkg.lua&#x27;</span><br><span class=\"line\">\tno file &#x27;/usr/share/lua/luci/model/ipkg.lua&#x27;</span><br><span class=\"line\">\tno file &#x27;/usr/share/lua/luci/model/ipkg/init.lua&#x27;</span><br><span class=\"line\">\tno file &#x27;/usr/lib/lua/luci/model/ipkg.lua&#x27;</span><br><span class=\"line\">\tno file &#x27;/usr/lib/lua/luci/model/ipkg/init.lua&#x27;</span><br><span class=\"line\">\tno file &#x27;./luci/model/ipkg.so&#x27;</span><br><span class=\"line\">\tno file &#x27;/usr/lib/lua/luci/model/ipkg.so&#x27;</span><br><span class=\"line\">\tno file &#x27;/usr/lib/lua/loadall.so&#x27;</span><br><span class=\"line\">\tno file &#x27;./luci.so&#x27;</span><br><span class=\"line\">\tno file &#x27;/usr/lib/lua/luci.so&#x27;</span><br><span class=\"line\">\tno file &#x27;/usr/lib/lua/loadall.so&#x27;</span><br><span class=\"line\">stack traceback:</span><br><span class=\"line\">\t[C]: in function &#x27;require&#x27;</span><br><span class=\"line\">\t/usr/lib/lua/luci/model/cbi/frp/basic.lua:2: in function &#x27;func&#x27;</span><br><span class=\"line\">\t/usr/lib/lua/luci/cbi.lua:66: in function &#x27;load&#x27;</span><br><span class=\"line\">\t/usr/lib/lua/luci/dispatcher.lua:1385: in function &#x27;_cbi&#x27;</span><br><span class=\"line\">\t/usr/lib/lua/luci/dispatcher.lua:1056: in function &#x27;dispatch&#x27;</span><br><span class=\"line\">\t/usr/lib/lua/luci/dispatcher.lua:483: in function &lt;/usr/lib/lua/luci/dispatcher.lua:482&gt;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"三、-问题解决\"><a href=\"#三、-问题解决\" class=\"headerlink\" title=\"三、 问题解决\"></a>三、 问题解决</h2><p>编辑文件 <code>/usr/lib/lua/luci/model/cbi/frp/basic.lua</code></p>\n<p>注释  <code>require(&quot;luci.model.ipkg&quot;)</code></p>\n<img src=\"/images/041.openwrt_install_frpc.md.01.png\" width=100% height=100% />\n<img src=\"/images/041.openwrt_install_frpc.md.02.png\" width=100% height=100% />\n\n\n"},{"title":"Greenbone Community 部署","date":"2023-06-06T06:50:13.000Z","_content":"\n## 一、Hardware Requirements\nMinimal:\n- CPU Cores: 2\n- andom-Access Memory: 4GB\n- Hard Disk: 20GB free\n\nRecommended:\n\n- CPU Cores: 4\n- Random-Access Memory: 8GB\n- Hard Disk: 60GB free\n\n## 二、 Prerequisites\n\n### install curl\n\n{% tabs tab,1 %} \n<!-- tab CentOS-->\n``` yum install curl -y ```\n<!-- endtab -->\n\n<!-- tab Ubuntu/Debian-->\n``` sudo apt install curl -y ```\n<!-- endtab -->\n{% endtabs %}\n\n\n### install docker\n\n{% tabs tt %} \n<!-- tab CentOS-->\n``` yum install -y yum-utils ``` \n``` yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo ```\n``` yum install docker-ce docker-ce-cli containerd.io ```\n<!-- endtab -->\n\n<!-- tab Ubuntu/Debian-->\n\n``` sudo apt-get install ca-certificates curl gnupg ```\n``` sudo install -m 0755 -d /etc/apt/keyrings ```\n``` curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg ```\n``` sudo chmod a+r /etc/apt/keyrings/docker.gpg ```\n``` bash \necho \\\n  \"deb [arch=\"$(dpkg --print-architecture)\" signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \\\n  \"$(. /etc/os-release && echo \"$VERSION_CODENAME\")\" stable\" | \\\n  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null\n```\n``` sudo apt install docker.io```\n<!-- endtab -->\n{% endtabs %}\n\n### install docker-compose\n\n{% tabs ttt %} \n<!-- tab CentOS-->\n``` yum install python3-pip -y ```\n``` python3 -m pip install --user docker-compose ```\n<!-- endtab -->\n\n<!-- tab Ubuntu/Debian-->\n``` sudo apt install python3 python3-pip -y ```\n``` python3 -m pip install --user docker-compose ```\n<!-- endtab -->\n{% endtabs %}\n\n\n## 三、 SET UP\n\n### Docker Compose File\n\n``` yaml\n\nservices:\n  vulnerability-tests:\n    image: greenbone/vulnerability-tests\n    environment:\n      STORAGE_PATH: /var/lib/openvas/22.04/vt-data/nasl\n    volumes:\n      - vt_data_vol:/mnt\n\n  notus-data:\n    image: greenbone/notus-data\n    volumes:\n      - notus_data_vol:/mnt\n\n  scap-data:\n    image: greenbone/scap-data\n    volumes:\n      - scap_data_vol:/mnt\n\n  cert-bund-data:\n    image: greenbone/cert-bund-data\n    volumes:\n      - cert_data_vol:/mnt\n\n  dfn-cert-data:\n    image: greenbone/dfn-cert-data\n    volumes:\n      - cert_data_vol:/mnt\n    depends_on:\n      - cert-bund-data\n\n  data-objects:\n    image: greenbone/data-objects\n    volumes:\n      - data_objects_vol:/mnt\n\n  report-formats:\n    image: greenbone/report-formats\n    volumes:\n      - data_objects_vol:/mnt\n    depends_on:\n      - data-objects\n\n  gpg-data:\n    image: greenbone/gpg-data\n    volumes:\n      - gpg_data_vol:/mnt\n\n  redis-server:\n    image: greenbone/redis-server\n    restart: on-failure\n    volumes:\n      - redis_socket_vol:/run/redis/\n\n  pg-gvm:\n    image: greenbone/pg-gvm:stable\n    restart: on-failure\n    volumes:\n      - psql_data_vol:/var/lib/postgresql\n      - psql_socket_vol:/var/run/postgresql\n\n  gvmd:\n    image: greenbone/gvmd:stable\n    restart: on-failure\n    volumes:\n      - gvmd_data_vol:/var/lib/gvm\n      - scap_data_vol:/var/lib/gvm/scap-data/\n      - cert_data_vol:/var/lib/gvm/cert-data\n      - data_objects_vol:/var/lib/gvm/data-objects/gvmd\n      - vt_data_vol:/var/lib/openvas/plugins\n      - psql_data_vol:/var/lib/postgresql\n      - gvmd_socket_vol:/run/gvmd\n      - ospd_openvas_socket_vol:/run/ospd\n      - psql_socket_vol:/var/run/postgresql\n    depends_on:\n      pg-gvm:\n        condition: service_started\n      scap-data:\n        condition: service_completed_successfully\n      cert-bund-data:\n        condition: service_completed_successfully\n      dfn-cert-data:\n        condition: service_completed_successfully\n      data-objects:\n        condition: service_completed_successfully\n      report-formats:\n        condition: service_completed_successfully\n\n  gsa:\n    image: greenbone/gsa:stable\n    restart: on-failure\n    ports:\n      - 9392:80\n    volumes:\n      - gvmd_socket_vol:/run/gvmd\n    depends_on:\n      - gvmd\n\n  ospd-openvas:\n    image: greenbone/ospd-openvas:stable\n    restart: on-failure\n    init: true\n    hostname: ospd-openvas.local\n    cap_add:\n      - NET_ADMIN # for capturing packages in promiscuous mode\n      - NET_RAW # for raw sockets e.g. used for the boreas alive detection\n    security_opt:\n      - seccomp=unconfined\n      - apparmor=unconfined\n    command:\n      [\n        \"ospd-openvas\",\n        \"-f\",\n        \"--config\",\n        \"/etc/gvm/ospd-openvas.conf\",\n        \"--mqtt-broker-address\",\n        \"mqtt-broker\",\n        \"--notus-feed-dir\",\n        \"/var/lib/notus/advisories\",\n        \"-m\",\n        \"666\"\n      ]\n    volumes:\n      - gpg_data_vol:/etc/openvas/gnupg\n      - vt_data_vol:/var/lib/openvas/plugins\n      - notus_data_vol:/var/lib/notus\n      - ospd_openvas_socket_vol:/run/ospd\n      - redis_socket_vol:/run/redis/\n    depends_on:\n      redis-server:\n        condition: service_started\n      gpg-data:\n        condition: service_completed_successfully\n      vulnerability-tests:\n        condition: service_completed_successfully\n\n  mqtt-broker:\n    restart: on-failure\n    image: greenbone/mqtt-broker\n    ports:\n      - 1883:1883\n    networks:\n      default:\n        aliases:\n          - mqtt-broker\n          - broker\n\n  notus-scanner:\n    restart: on-failure\n    image: greenbone/notus-scanner:stable\n    volumes:\n      - notus_data_vol:/var/lib/notus\n      - gpg_data_vol:/etc/openvas/gnupg\n    environment:\n      NOTUS_SCANNER_MQTT_BROKER_ADDRESS: mqtt-broker\n      NOTUS_SCANNER_PRODUCTS_DIRECTORY: /var/lib/notus/products\n    depends_on:\n      - mqtt-broker\n      - gpg-data\n      - vulnerability-tests\n\n  gvm-tools:\n    image: greenbone/gvm-tools\n    volumes:\n      - gvmd_socket_vol:/run/gvmd\n      - ospd_openvas_socket_vol:/run/ospd\n    depends_on:\n      - gvmd\n      - ospd-openvas\n\nvolumes:\n  gpg_data_vol:\n  scap_data_vol:\n  cert_data_vol:\n  data_objects_vol:\n  gvmd_data_vol:\n  psql_data_vol:\n  vt_data_vol:\n  notus_data_vol:\n  psql_socket_vol:\n  gvmd_socket_vol:\n  ospd_openvas_socket_vol:\n  redis_socket_vol:\n```\n\n### Downloading the Greenbone Community Containers\n\n``` docker-compose -f $DOWNLOAD_DIR/docker-compose.yml -p greenbone-community-edition pull ```\n\n### Starting the Greenbone Community Containers\n\n``` docker-compose -f $DOWNLOAD_DIR/docker-compose.yml -p greenbone-community-edition up -d ```\n\n### Show log messages of all services from the running containers\n\n``` docker-compose -f $DOWNLOAD_DIR/docker-compose.yml -p greenbone-community-edition logs -f ```\n","source":"_posts/042.Greenbone_Community_installation.md","raw":"---\ntitle: Greenbone Community 部署\ndate: 2023-6-6 14:50:13\ncategories: \n- [DevOps]\ntags: \n- DevOps\n---\n\n## 一、Hardware Requirements\nMinimal:\n- CPU Cores: 2\n- andom-Access Memory: 4GB\n- Hard Disk: 20GB free\n\nRecommended:\n\n- CPU Cores: 4\n- Random-Access Memory: 8GB\n- Hard Disk: 60GB free\n\n## 二、 Prerequisites\n\n### install curl\n\n{% tabs tab,1 %} \n<!-- tab CentOS-->\n``` yum install curl -y ```\n<!-- endtab -->\n\n<!-- tab Ubuntu/Debian-->\n``` sudo apt install curl -y ```\n<!-- endtab -->\n{% endtabs %}\n\n\n### install docker\n\n{% tabs tt %} \n<!-- tab CentOS-->\n``` yum install -y yum-utils ``` \n``` yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo ```\n``` yum install docker-ce docker-ce-cli containerd.io ```\n<!-- endtab -->\n\n<!-- tab Ubuntu/Debian-->\n\n``` sudo apt-get install ca-certificates curl gnupg ```\n``` sudo install -m 0755 -d /etc/apt/keyrings ```\n``` curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg ```\n``` sudo chmod a+r /etc/apt/keyrings/docker.gpg ```\n``` bash \necho \\\n  \"deb [arch=\"$(dpkg --print-architecture)\" signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \\\n  \"$(. /etc/os-release && echo \"$VERSION_CODENAME\")\" stable\" | \\\n  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null\n```\n``` sudo apt install docker.io```\n<!-- endtab -->\n{% endtabs %}\n\n### install docker-compose\n\n{% tabs ttt %} \n<!-- tab CentOS-->\n``` yum install python3-pip -y ```\n``` python3 -m pip install --user docker-compose ```\n<!-- endtab -->\n\n<!-- tab Ubuntu/Debian-->\n``` sudo apt install python3 python3-pip -y ```\n``` python3 -m pip install --user docker-compose ```\n<!-- endtab -->\n{% endtabs %}\n\n\n## 三、 SET UP\n\n### Docker Compose File\n\n``` yaml\n\nservices:\n  vulnerability-tests:\n    image: greenbone/vulnerability-tests\n    environment:\n      STORAGE_PATH: /var/lib/openvas/22.04/vt-data/nasl\n    volumes:\n      - vt_data_vol:/mnt\n\n  notus-data:\n    image: greenbone/notus-data\n    volumes:\n      - notus_data_vol:/mnt\n\n  scap-data:\n    image: greenbone/scap-data\n    volumes:\n      - scap_data_vol:/mnt\n\n  cert-bund-data:\n    image: greenbone/cert-bund-data\n    volumes:\n      - cert_data_vol:/mnt\n\n  dfn-cert-data:\n    image: greenbone/dfn-cert-data\n    volumes:\n      - cert_data_vol:/mnt\n    depends_on:\n      - cert-bund-data\n\n  data-objects:\n    image: greenbone/data-objects\n    volumes:\n      - data_objects_vol:/mnt\n\n  report-formats:\n    image: greenbone/report-formats\n    volumes:\n      - data_objects_vol:/mnt\n    depends_on:\n      - data-objects\n\n  gpg-data:\n    image: greenbone/gpg-data\n    volumes:\n      - gpg_data_vol:/mnt\n\n  redis-server:\n    image: greenbone/redis-server\n    restart: on-failure\n    volumes:\n      - redis_socket_vol:/run/redis/\n\n  pg-gvm:\n    image: greenbone/pg-gvm:stable\n    restart: on-failure\n    volumes:\n      - psql_data_vol:/var/lib/postgresql\n      - psql_socket_vol:/var/run/postgresql\n\n  gvmd:\n    image: greenbone/gvmd:stable\n    restart: on-failure\n    volumes:\n      - gvmd_data_vol:/var/lib/gvm\n      - scap_data_vol:/var/lib/gvm/scap-data/\n      - cert_data_vol:/var/lib/gvm/cert-data\n      - data_objects_vol:/var/lib/gvm/data-objects/gvmd\n      - vt_data_vol:/var/lib/openvas/plugins\n      - psql_data_vol:/var/lib/postgresql\n      - gvmd_socket_vol:/run/gvmd\n      - ospd_openvas_socket_vol:/run/ospd\n      - psql_socket_vol:/var/run/postgresql\n    depends_on:\n      pg-gvm:\n        condition: service_started\n      scap-data:\n        condition: service_completed_successfully\n      cert-bund-data:\n        condition: service_completed_successfully\n      dfn-cert-data:\n        condition: service_completed_successfully\n      data-objects:\n        condition: service_completed_successfully\n      report-formats:\n        condition: service_completed_successfully\n\n  gsa:\n    image: greenbone/gsa:stable\n    restart: on-failure\n    ports:\n      - 9392:80\n    volumes:\n      - gvmd_socket_vol:/run/gvmd\n    depends_on:\n      - gvmd\n\n  ospd-openvas:\n    image: greenbone/ospd-openvas:stable\n    restart: on-failure\n    init: true\n    hostname: ospd-openvas.local\n    cap_add:\n      - NET_ADMIN # for capturing packages in promiscuous mode\n      - NET_RAW # for raw sockets e.g. used for the boreas alive detection\n    security_opt:\n      - seccomp=unconfined\n      - apparmor=unconfined\n    command:\n      [\n        \"ospd-openvas\",\n        \"-f\",\n        \"--config\",\n        \"/etc/gvm/ospd-openvas.conf\",\n        \"--mqtt-broker-address\",\n        \"mqtt-broker\",\n        \"--notus-feed-dir\",\n        \"/var/lib/notus/advisories\",\n        \"-m\",\n        \"666\"\n      ]\n    volumes:\n      - gpg_data_vol:/etc/openvas/gnupg\n      - vt_data_vol:/var/lib/openvas/plugins\n      - notus_data_vol:/var/lib/notus\n      - ospd_openvas_socket_vol:/run/ospd\n      - redis_socket_vol:/run/redis/\n    depends_on:\n      redis-server:\n        condition: service_started\n      gpg-data:\n        condition: service_completed_successfully\n      vulnerability-tests:\n        condition: service_completed_successfully\n\n  mqtt-broker:\n    restart: on-failure\n    image: greenbone/mqtt-broker\n    ports:\n      - 1883:1883\n    networks:\n      default:\n        aliases:\n          - mqtt-broker\n          - broker\n\n  notus-scanner:\n    restart: on-failure\n    image: greenbone/notus-scanner:stable\n    volumes:\n      - notus_data_vol:/var/lib/notus\n      - gpg_data_vol:/etc/openvas/gnupg\n    environment:\n      NOTUS_SCANNER_MQTT_BROKER_ADDRESS: mqtt-broker\n      NOTUS_SCANNER_PRODUCTS_DIRECTORY: /var/lib/notus/products\n    depends_on:\n      - mqtt-broker\n      - gpg-data\n      - vulnerability-tests\n\n  gvm-tools:\n    image: greenbone/gvm-tools\n    volumes:\n      - gvmd_socket_vol:/run/gvmd\n      - ospd_openvas_socket_vol:/run/ospd\n    depends_on:\n      - gvmd\n      - ospd-openvas\n\nvolumes:\n  gpg_data_vol:\n  scap_data_vol:\n  cert_data_vol:\n  data_objects_vol:\n  gvmd_data_vol:\n  psql_data_vol:\n  vt_data_vol:\n  notus_data_vol:\n  psql_socket_vol:\n  gvmd_socket_vol:\n  ospd_openvas_socket_vol:\n  redis_socket_vol:\n```\n\n### Downloading the Greenbone Community Containers\n\n``` docker-compose -f $DOWNLOAD_DIR/docker-compose.yml -p greenbone-community-edition pull ```\n\n### Starting the Greenbone Community Containers\n\n``` docker-compose -f $DOWNLOAD_DIR/docker-compose.yml -p greenbone-community-edition up -d ```\n\n### Show log messages of all services from the running containers\n\n``` docker-compose -f $DOWNLOAD_DIR/docker-compose.yml -p greenbone-community-edition logs -f ```\n","slug":"042.Greenbone_Community_installation","published":1,"updated":"2023-12-05T08:52:30.878Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzd6003zijnr03freepu","content":"<h2 id=\"一、Hardware-Requirements\"><a href=\"#一、Hardware-Requirements\" class=\"headerlink\" title=\"一、Hardware Requirements\"></a>一、Hardware Requirements</h2><p>Minimal:</p>\n<ul>\n<li>CPU Cores: 2</li>\n<li>andom-Access Memory: 4GB</li>\n<li>Hard Disk: 20GB free</li>\n</ul>\n<p>Recommended:</p>\n<ul>\n<li>CPU Cores: 4</li>\n<li>Random-Access Memory: 8GB</li>\n<li>Hard Disk: 60GB free</li>\n</ul>\n<h2 id=\"二、-Prerequisites\"><a href=\"#二、-Prerequisites\" class=\"headerlink\" title=\"二、 Prerequisites\"></a>二、 Prerequisites</h2><h3 id=\"install-curl\"><a href=\"#install-curl\" class=\"headerlink\" title=\"install curl\"></a>install curl</h3><div class=\"tabs\" id=\"tab\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#tab-1\">CentOS</a></li><li class=\"tab\"><a href=\"#tab-2\">Ubuntu/Debian</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"tab-1\"><p><code>yum install curl -y</code></p></div><div class=\"tab-pane\" id=\"tab-2\"><p><code>sudo apt install curl -y</code></p></div></div></div>\n\n\n<h3 id=\"install-docker\"><a href=\"#install-docker\" class=\"headerlink\" title=\"install docker\"></a>install docker</h3><div class=\"tabs\" id=\"tt\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#tt-1\">CentOS</a></li><li class=\"tab\"><a href=\"#tt-2\">Ubuntu/Debian</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"tt-1\"><p><code>yum install -y yum-utils</code><br><code>yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</code><br><code>yum install docker-ce docker-ce-cli containerd.io</code></p></div><div class=\"tab-pane\" id=\"tt-2\"><p><code>sudo apt-get install ca-certificates curl gnupg</code><br><code>sudo install -m 0755 -d /etc/apt/keyrings</code><br><code>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg</code><br><code>sudo chmod a+r /etc/apt/keyrings/docker.gpg</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> \\</span><br><span class=\"line\">  <span class=\"string\">&quot;deb [arch=&quot;</span>$(dpkg --print-architecture)<span class=\"string\">&quot; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \\</span></span><br><span class=\"line\"><span class=\"string\">  &quot;</span>$(. /etc/os-release &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$VERSION_CODENAME</span>&quot;</span>)<span class=\"string\">&quot; stable&quot;</span> | \\</span><br><span class=\"line\">  sudo <span class=\"built_in\">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br></pre></td></tr></table></figure>\n<p><code> sudo apt install docker.io</code></p></div></div></div>\n\n<h3 id=\"install-docker-compose\"><a href=\"#install-docker-compose\" class=\"headerlink\" title=\"install docker-compose\"></a>install docker-compose</h3><div class=\"tabs\" id=\"ttt\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#ttt-1\">CentOS</a></li><li class=\"tab\"><a href=\"#ttt-2\">Ubuntu/Debian</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"ttt-1\"><p><code>yum install python3-pip -y</code><br><code>python3 -m pip install --user docker-compose</code></p></div><div class=\"tab-pane\" id=\"ttt-2\"><p><code>sudo apt install python3 python3-pip -y</code><br><code>python3 -m pip install --user docker-compose</code></p></div></div></div>\n\n\n<h2 id=\"三、-SET-UP\"><a href=\"#三、-SET-UP\" class=\"headerlink\" title=\"三、 SET UP\"></a>三、 SET UP</h2><h3 id=\"Docker-Compose-File\"><a href=\"#Docker-Compose-File\" class=\"headerlink\" title=\"Docker Compose File\"></a>Docker Compose File</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">vulnerability-tests:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/vulnerability-tests</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">STORAGE_PATH:</span> <span class=\"string\">/var/lib/openvas/22.04/vt-data/nasl</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">vt_data_vol:/mnt</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">notus-data:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/notus-data</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">notus_data_vol:/mnt</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">scap-data:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/scap-data</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">scap_data_vol:/mnt</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">cert-bund-data:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/cert-bund-data</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">cert_data_vol:/mnt</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">dfn-cert-data:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/dfn-cert-data</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">cert_data_vol:/mnt</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">cert-bund-data</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">data-objects:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/data-objects</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">data_objects_vol:/mnt</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">report-formats:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/report-formats</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">data_objects_vol:/mnt</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">data-objects</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">gpg-data:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/gpg-data</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gpg_data_vol:/mnt</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">redis-server:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/redis-server</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">on-failure</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">redis_socket_vol:/run/redis/</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">pg-gvm:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/pg-gvm:stable</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">on-failure</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">psql_data_vol:/var/lib/postgresql</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">psql_socket_vol:/var/run/postgresql</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">gvmd:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/gvmd:stable</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">on-failure</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gvmd_data_vol:/var/lib/gvm</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">scap_data_vol:/var/lib/gvm/scap-data/</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">cert_data_vol:/var/lib/gvm/cert-data</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">data_objects_vol:/var/lib/gvm/data-objects/gvmd</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">vt_data_vol:/var/lib/openvas/plugins</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">psql_data_vol:/var/lib/postgresql</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gvmd_socket_vol:/run/gvmd</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ospd_openvas_socket_vol:/run/ospd</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">psql_socket_vol:/var/run/postgresql</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"attr\">pg-gvm:</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_started</span></span><br><span class=\"line\">      <span class=\"attr\">scap-data:</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_completed_successfully</span></span><br><span class=\"line\">      <span class=\"attr\">cert-bund-data:</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_completed_successfully</span></span><br><span class=\"line\">      <span class=\"attr\">dfn-cert-data:</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_completed_successfully</span></span><br><span class=\"line\">      <span class=\"attr\">data-objects:</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_completed_successfully</span></span><br><span class=\"line\">      <span class=\"attr\">report-formats:</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_completed_successfully</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">gsa:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/gsa:stable</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">on-failure</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9392</span><span class=\"string\">:80</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gvmd_socket_vol:/run/gvmd</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gvmd</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">ospd-openvas:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/ospd-openvas:stable</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">on-failure</span></span><br><span class=\"line\">    <span class=\"attr\">init:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">ospd-openvas.local</span></span><br><span class=\"line\">    <span class=\"attr\">cap_add:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">NET_ADMIN</span> <span class=\"comment\"># for capturing packages in promiscuous mode</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">NET_RAW</span> <span class=\"comment\"># for raw sockets e.g. used for the boreas alive detection</span></span><br><span class=\"line\">    <span class=\"attr\">security_opt:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">seccomp=unconfined</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">apparmor=unconfined</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span></span><br><span class=\"line\">      [</span><br><span class=\"line\">        <span class=\"string\">&quot;ospd-openvas&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;-f&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;--config&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;/etc/gvm/ospd-openvas.conf&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;--mqtt-broker-address&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;mqtt-broker&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;--notus-feed-dir&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;/var/lib/notus/advisories&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;-m&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;666&quot;</span></span><br><span class=\"line\">      ]</span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gpg_data_vol:/etc/openvas/gnupg</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">vt_data_vol:/var/lib/openvas/plugins</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">notus_data_vol:/var/lib/notus</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ospd_openvas_socket_vol:/run/ospd</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">redis_socket_vol:/run/redis/</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"attr\">redis-server:</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_started</span></span><br><span class=\"line\">      <span class=\"attr\">gpg-data:</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_completed_successfully</span></span><br><span class=\"line\">      <span class=\"attr\">vulnerability-tests:</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_completed_successfully</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">mqtt-broker:</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">on-failure</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/mqtt-broker</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">1883</span><span class=\"string\">:1883</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">default:</span></span><br><span class=\"line\">        <span class=\"attr\">aliases:</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"string\">mqtt-broker</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"string\">broker</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">notus-scanner:</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">on-failure</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/notus-scanner:stable</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">notus_data_vol:/var/lib/notus</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gpg_data_vol:/etc/openvas/gnupg</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">NOTUS_SCANNER_MQTT_BROKER_ADDRESS:</span> <span class=\"string\">mqtt-broker</span></span><br><span class=\"line\">      <span class=\"attr\">NOTUS_SCANNER_PRODUCTS_DIRECTORY:</span> <span class=\"string\">/var/lib/notus/products</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">mqtt-broker</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gpg-data</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">vulnerability-tests</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">gvm-tools:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/gvm-tools</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gvmd_socket_vol:/run/gvmd</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ospd_openvas_socket_vol:/run/ospd</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gvmd</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ospd-openvas</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"attr\">gpg_data_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">scap_data_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">cert_data_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">data_objects_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">gvmd_data_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">psql_data_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">vt_data_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">notus_data_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">psql_socket_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">gvmd_socket_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">ospd_openvas_socket_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">redis_socket_vol:</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Downloading-the-Greenbone-Community-Containers\"><a href=\"#Downloading-the-Greenbone-Community-Containers\" class=\"headerlink\" title=\"Downloading the Greenbone Community Containers\"></a>Downloading the Greenbone Community Containers</h3><p><code>docker-compose -f $DOWNLOAD_DIR/docker-compose.yml -p greenbone-community-edition pull</code></p>\n<h3 id=\"Starting-the-Greenbone-Community-Containers\"><a href=\"#Starting-the-Greenbone-Community-Containers\" class=\"headerlink\" title=\"Starting the Greenbone Community Containers\"></a>Starting the Greenbone Community Containers</h3><p><code>docker-compose -f $DOWNLOAD_DIR/docker-compose.yml -p greenbone-community-edition up -d</code></p>\n<h3 id=\"Show-log-messages-of-all-services-from-the-running-containers\"><a href=\"#Show-log-messages-of-all-services-from-the-running-containers\" class=\"headerlink\" title=\"Show log messages of all services from the running containers\"></a>Show log messages of all services from the running containers</h3><p><code>docker-compose -f $DOWNLOAD_DIR/docker-compose.yml -p greenbone-community-edition logs -f</code></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、Hardware-Requirements\"><a href=\"#一、Hardware-Requirements\" class=\"headerlink\" title=\"一、Hardware Requirements\"></a>一、Hardware Requirements</h2><p>Minimal:</p>\n<ul>\n<li>CPU Cores: 2</li>\n<li>andom-Access Memory: 4GB</li>\n<li>Hard Disk: 20GB free</li>\n</ul>\n<p>Recommended:</p>\n<ul>\n<li>CPU Cores: 4</li>\n<li>Random-Access Memory: 8GB</li>\n<li>Hard Disk: 60GB free</li>\n</ul>\n<h2 id=\"二、-Prerequisites\"><a href=\"#二、-Prerequisites\" class=\"headerlink\" title=\"二、 Prerequisites\"></a>二、 Prerequisites</h2><h3 id=\"install-curl\"><a href=\"#install-curl\" class=\"headerlink\" title=\"install curl\"></a>install curl</h3><div class=\"tabs\" id=\"tab\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#tab-1\">CentOS</a></li><li class=\"tab\"><a href=\"#tab-2\">Ubuntu/Debian</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"tab-1\"><p><code>yum install curl -y</code></p></div><div class=\"tab-pane\" id=\"tab-2\"><p><code>sudo apt install curl -y</code></p></div></div></div>\n\n\n<h3 id=\"install-docker\"><a href=\"#install-docker\" class=\"headerlink\" title=\"install docker\"></a>install docker</h3><div class=\"tabs\" id=\"tt\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#tt-1\">CentOS</a></li><li class=\"tab\"><a href=\"#tt-2\">Ubuntu/Debian</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"tt-1\"><p><code>yum install -y yum-utils</code><br><code>yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</code><br><code>yum install docker-ce docker-ce-cli containerd.io</code></p></div><div class=\"tab-pane\" id=\"tt-2\"><p><code>sudo apt-get install ca-certificates curl gnupg</code><br><code>sudo install -m 0755 -d /etc/apt/keyrings</code><br><code>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg</code><br><code>sudo chmod a+r /etc/apt/keyrings/docker.gpg</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> \\</span><br><span class=\"line\">  <span class=\"string\">&quot;deb [arch=&quot;</span>$(dpkg --print-architecture)<span class=\"string\">&quot; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \\</span></span><br><span class=\"line\"><span class=\"string\">  &quot;</span>$(. /etc/os-release &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$VERSION_CODENAME</span>&quot;</span>)<span class=\"string\">&quot; stable&quot;</span> | \\</span><br><span class=\"line\">  sudo <span class=\"built_in\">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br></pre></td></tr></table></figure>\n<p><code> sudo apt install docker.io</code></p></div></div></div>\n\n<h3 id=\"install-docker-compose\"><a href=\"#install-docker-compose\" class=\"headerlink\" title=\"install docker-compose\"></a>install docker-compose</h3><div class=\"tabs\" id=\"ttt\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#ttt-1\">CentOS</a></li><li class=\"tab\"><a href=\"#ttt-2\">Ubuntu/Debian</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"ttt-1\"><p><code>yum install python3-pip -y</code><br><code>python3 -m pip install --user docker-compose</code></p></div><div class=\"tab-pane\" id=\"ttt-2\"><p><code>sudo apt install python3 python3-pip -y</code><br><code>python3 -m pip install --user docker-compose</code></p></div></div></div>\n\n\n<h2 id=\"三、-SET-UP\"><a href=\"#三、-SET-UP\" class=\"headerlink\" title=\"三、 SET UP\"></a>三、 SET UP</h2><h3 id=\"Docker-Compose-File\"><a href=\"#Docker-Compose-File\" class=\"headerlink\" title=\"Docker Compose File\"></a>Docker Compose File</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">vulnerability-tests:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/vulnerability-tests</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">STORAGE_PATH:</span> <span class=\"string\">/var/lib/openvas/22.04/vt-data/nasl</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">vt_data_vol:/mnt</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">notus-data:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/notus-data</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">notus_data_vol:/mnt</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">scap-data:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/scap-data</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">scap_data_vol:/mnt</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">cert-bund-data:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/cert-bund-data</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">cert_data_vol:/mnt</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">dfn-cert-data:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/dfn-cert-data</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">cert_data_vol:/mnt</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">cert-bund-data</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">data-objects:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/data-objects</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">data_objects_vol:/mnt</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">report-formats:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/report-formats</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">data_objects_vol:/mnt</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">data-objects</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">gpg-data:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/gpg-data</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gpg_data_vol:/mnt</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">redis-server:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/redis-server</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">on-failure</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">redis_socket_vol:/run/redis/</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">pg-gvm:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/pg-gvm:stable</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">on-failure</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">psql_data_vol:/var/lib/postgresql</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">psql_socket_vol:/var/run/postgresql</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">gvmd:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/gvmd:stable</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">on-failure</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gvmd_data_vol:/var/lib/gvm</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">scap_data_vol:/var/lib/gvm/scap-data/</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">cert_data_vol:/var/lib/gvm/cert-data</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">data_objects_vol:/var/lib/gvm/data-objects/gvmd</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">vt_data_vol:/var/lib/openvas/plugins</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">psql_data_vol:/var/lib/postgresql</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gvmd_socket_vol:/run/gvmd</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ospd_openvas_socket_vol:/run/ospd</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">psql_socket_vol:/var/run/postgresql</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"attr\">pg-gvm:</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_started</span></span><br><span class=\"line\">      <span class=\"attr\">scap-data:</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_completed_successfully</span></span><br><span class=\"line\">      <span class=\"attr\">cert-bund-data:</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_completed_successfully</span></span><br><span class=\"line\">      <span class=\"attr\">dfn-cert-data:</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_completed_successfully</span></span><br><span class=\"line\">      <span class=\"attr\">data-objects:</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_completed_successfully</span></span><br><span class=\"line\">      <span class=\"attr\">report-formats:</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_completed_successfully</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">gsa:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/gsa:stable</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">on-failure</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9392</span><span class=\"string\">:80</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gvmd_socket_vol:/run/gvmd</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gvmd</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">ospd-openvas:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/ospd-openvas:stable</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">on-failure</span></span><br><span class=\"line\">    <span class=\"attr\">init:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">ospd-openvas.local</span></span><br><span class=\"line\">    <span class=\"attr\">cap_add:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">NET_ADMIN</span> <span class=\"comment\"># for capturing packages in promiscuous mode</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">NET_RAW</span> <span class=\"comment\"># for raw sockets e.g. used for the boreas alive detection</span></span><br><span class=\"line\">    <span class=\"attr\">security_opt:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">seccomp=unconfined</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">apparmor=unconfined</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span></span><br><span class=\"line\">      [</span><br><span class=\"line\">        <span class=\"string\">&quot;ospd-openvas&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;-f&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;--config&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;/etc/gvm/ospd-openvas.conf&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;--mqtt-broker-address&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;mqtt-broker&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;--notus-feed-dir&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;/var/lib/notus/advisories&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;-m&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;666&quot;</span></span><br><span class=\"line\">      ]</span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gpg_data_vol:/etc/openvas/gnupg</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">vt_data_vol:/var/lib/openvas/plugins</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">notus_data_vol:/var/lib/notus</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ospd_openvas_socket_vol:/run/ospd</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">redis_socket_vol:/run/redis/</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"attr\">redis-server:</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_started</span></span><br><span class=\"line\">      <span class=\"attr\">gpg-data:</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_completed_successfully</span></span><br><span class=\"line\">      <span class=\"attr\">vulnerability-tests:</span></span><br><span class=\"line\">        <span class=\"attr\">condition:</span> <span class=\"string\">service_completed_successfully</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">mqtt-broker:</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">on-failure</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/mqtt-broker</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">1883</span><span class=\"string\">:1883</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">default:</span></span><br><span class=\"line\">        <span class=\"attr\">aliases:</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"string\">mqtt-broker</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"string\">broker</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">notus-scanner:</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">on-failure</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/notus-scanner:stable</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">notus_data_vol:/var/lib/notus</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gpg_data_vol:/etc/openvas/gnupg</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">NOTUS_SCANNER_MQTT_BROKER_ADDRESS:</span> <span class=\"string\">mqtt-broker</span></span><br><span class=\"line\">      <span class=\"attr\">NOTUS_SCANNER_PRODUCTS_DIRECTORY:</span> <span class=\"string\">/var/lib/notus/products</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">mqtt-broker</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gpg-data</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">vulnerability-tests</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">gvm-tools:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">greenbone/gvm-tools</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gvmd_socket_vol:/run/gvmd</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ospd_openvas_socket_vol:/run/ospd</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">gvmd</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ospd-openvas</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"attr\">gpg_data_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">scap_data_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">cert_data_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">data_objects_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">gvmd_data_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">psql_data_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">vt_data_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">notus_data_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">psql_socket_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">gvmd_socket_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">ospd_openvas_socket_vol:</span></span><br><span class=\"line\">  <span class=\"attr\">redis_socket_vol:</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Downloading-the-Greenbone-Community-Containers\"><a href=\"#Downloading-the-Greenbone-Community-Containers\" class=\"headerlink\" title=\"Downloading the Greenbone Community Containers\"></a>Downloading the Greenbone Community Containers</h3><p><code>docker-compose -f $DOWNLOAD_DIR/docker-compose.yml -p greenbone-community-edition pull</code></p>\n<h3 id=\"Starting-the-Greenbone-Community-Containers\"><a href=\"#Starting-the-Greenbone-Community-Containers\" class=\"headerlink\" title=\"Starting the Greenbone Community Containers\"></a>Starting the Greenbone Community Containers</h3><p><code>docker-compose -f $DOWNLOAD_DIR/docker-compose.yml -p greenbone-community-edition up -d</code></p>\n<h3 id=\"Show-log-messages-of-all-services-from-the-running-containers\"><a href=\"#Show-log-messages-of-all-services-from-the-running-containers\" class=\"headerlink\" title=\"Show log messages of all services from the running containers\"></a>Show log messages of all services from the running containers</h3><p><code>docker-compose -f $DOWNLOAD_DIR/docker-compose.yml -p greenbone-community-edition logs -f</code></p>\n"},{"title":"记录一次被挖矿","date":"2023-06-12T06:50:13.000Z","_content":"\n**公司服务器被挖矿，已经好几次了，之前htop找到进程号， 然后lsof找到相应的文件，kill进程删除文件即可。**\n**这次的病毒，有点不一样， 删除之后还会自启，最后发现是因为删除病毒后没有重启服务器，记录一下过程**\n\n\n## 服务器环境\n\nCentOS 7.5 on PVE  8C 12G\n\n\n## 一、 htop查看进程详情\n\nUSER： ```oracle```\nCOMMAND: ```/bin/bash/systemd```\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.01.png\" width=100% height=100% />\n\n\n## 二、 lsof 查看进程相关文件\n\n``` lsof -p $PID ```\n\nPATH: ```/var/tmp/x86_64```（deleted）\n外链： ``` 45.10.20.137 ``` （荷兰）\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.02.png\" width=100% height=100% />\n\n## 三、 netstat 查看外链详情\n\n``` netstat -antlp ```\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.03.png\" width=100% height=100% />\n\n## 四、 /proc 查看进程详情\n\n``` ls -ahl /proc/$PID ```\n- cwd 进程运行目录；\n- exe 执行程序的绝对路径；             ```/var/tmp/x86_64```(deleted)\n- cmdline 程序运行时输入的命令行命令；  ```/bin/bash/systemd```\n- environ 记录了进程运行时的环境变量；\n- fd 目录下是进程打开或使用的文件的符号连接 \n\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.07.png\" width=100% height=100% />\n\n**值得注意， 杀死进程又删除文件后还会自启，考虑PPID为1， 在清理完病毒之后重启服务器才彻底解决了问题。**\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.08.png\" width=100% height=100% />\n\n## 五、 老朋友 xmrig\n\n```/var/tmp/x86_64``` 之前删除过一次， 但是病毒还是复活了， 现在已经没有这个目录了。\n\n想到进程的用户是Oracle，那么到Oracle的家目录看下有没有收获。\n\n果然在Oracle家目录 ```/home/oracle```  发现了可以的隐藏目录。 看到 ```xmrig``` 基本上可以确认就这里了。\n>> XMrig 是一个开源的 CPU/GPU 挖矿软件，用于挖掘加密货币 Monero（XMR）以及其他基于 Cryptonight 算法的数字资产。它是一个跨平台的软件，可在多种操作系统上运行，包括 Windows、Linux 和 macOS。 balabalbal......\n\n\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.04.png\" width=100% height=100% />\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.05.png\" width=100% height=100% />\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.06.png\" width=100% height=100% />","source":"_posts/043.Cryptocurrency_Mining_Malware.md","raw":"---\ntitle: 记录一次被挖矿\ndate: 2023-6-12 14:50:13\ncategories: \n- [DevOps]\ntags: \n- 挖矿\n- xmrig\n- Cryptocurrency-Mining-Malware\n---\n\n**公司服务器被挖矿，已经好几次了，之前htop找到进程号， 然后lsof找到相应的文件，kill进程删除文件即可。**\n**这次的病毒，有点不一样， 删除之后还会自启，最后发现是因为删除病毒后没有重启服务器，记录一下过程**\n\n\n## 服务器环境\n\nCentOS 7.5 on PVE  8C 12G\n\n\n## 一、 htop查看进程详情\n\nUSER： ```oracle```\nCOMMAND: ```/bin/bash/systemd```\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.01.png\" width=100% height=100% />\n\n\n## 二、 lsof 查看进程相关文件\n\n``` lsof -p $PID ```\n\nPATH: ```/var/tmp/x86_64```（deleted）\n外链： ``` 45.10.20.137 ``` （荷兰）\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.02.png\" width=100% height=100% />\n\n## 三、 netstat 查看外链详情\n\n``` netstat -antlp ```\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.03.png\" width=100% height=100% />\n\n## 四、 /proc 查看进程详情\n\n``` ls -ahl /proc/$PID ```\n- cwd 进程运行目录；\n- exe 执行程序的绝对路径；             ```/var/tmp/x86_64```(deleted)\n- cmdline 程序运行时输入的命令行命令；  ```/bin/bash/systemd```\n- environ 记录了进程运行时的环境变量；\n- fd 目录下是进程打开或使用的文件的符号连接 \n\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.07.png\" width=100% height=100% />\n\n**值得注意， 杀死进程又删除文件后还会自启，考虑PPID为1， 在清理完病毒之后重启服务器才彻底解决了问题。**\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.08.png\" width=100% height=100% />\n\n## 五、 老朋友 xmrig\n\n```/var/tmp/x86_64``` 之前删除过一次， 但是病毒还是复活了， 现在已经没有这个目录了。\n\n想到进程的用户是Oracle，那么到Oracle的家目录看下有没有收获。\n\n果然在Oracle家目录 ```/home/oracle```  发现了可以的隐藏目录。 看到 ```xmrig``` 基本上可以确认就这里了。\n>> XMrig 是一个开源的 CPU/GPU 挖矿软件，用于挖掘加密货币 Monero（XMR）以及其他基于 Cryptonight 算法的数字资产。它是一个跨平台的软件，可在多种操作系统上运行，包括 Windows、Linux 和 macOS。 balabalbal......\n\n\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.04.png\" width=100% height=100% />\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.05.png\" width=100% height=100% />\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.06.png\" width=100% height=100% />","slug":"043.Cryptocurrency_Mining_Malware","published":1,"updated":"2023-12-05T08:52:30.879Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzdd0041ijnr3hwg18nh","content":"<p><strong>公司服务器被挖矿，已经好几次了，之前htop找到进程号， 然后lsof找到相应的文件，kill进程删除文件即可。</strong><br><strong>这次的病毒，有点不一样， 删除之后还会自启，最后发现是因为删除病毒后没有重启服务器，记录一下过程</strong></p>\n<h2 id=\"服务器环境\"><a href=\"#服务器环境\" class=\"headerlink\" title=\"服务器环境\"></a>服务器环境</h2><p>CentOS 7.5 on PVE  8C 12G</p>\n<h2 id=\"一、-htop查看进程详情\"><a href=\"#一、-htop查看进程详情\" class=\"headerlink\" title=\"一、 htop查看进程详情\"></a>一、 htop查看进程详情</h2><p>USER： <code>oracle</code><br>COMMAND: <code>/bin/bash/systemd</code><br><img src=\"/images/043.Cryptocurrency_Mining_Malware.md.01.png\" width=100% height=100% /></p>\n<h2 id=\"二、-lsof-查看进程相关文件\"><a href=\"#二、-lsof-查看进程相关文件\" class=\"headerlink\" title=\"二、 lsof 查看进程相关文件\"></a>二、 lsof 查看进程相关文件</h2><p><code>lsof -p $PID</code></p>\n<p>PATH: <code>/var/tmp/x86_64</code>（deleted）<br>外链： <code>45.10.20.137</code> （荷兰）<br><img src=\"/images/043.Cryptocurrency_Mining_Malware.md.02.png\" width=100% height=100% /></p>\n<h2 id=\"三、-netstat-查看外链详情\"><a href=\"#三、-netstat-查看外链详情\" class=\"headerlink\" title=\"三、 netstat 查看外链详情\"></a>三、 netstat 查看外链详情</h2><p><code>netstat -antlp</code><br><img src=\"/images/043.Cryptocurrency_Mining_Malware.md.03.png\" width=100% height=100% /></p>\n<h2 id=\"四、-proc-查看进程详情\"><a href=\"#四、-proc-查看进程详情\" class=\"headerlink\" title=\"四、 &#x2F;proc 查看进程详情\"></a>四、 &#x2F;proc 查看进程详情</h2><p><code>ls -ahl /proc/$PID</code></p>\n<ul>\n<li>cwd 进程运行目录；</li>\n<li>exe 执行程序的绝对路径；             <code>/var/tmp/x86_64</code>(deleted)</li>\n<li>cmdline 程序运行时输入的命令行命令；  <code>/bin/bash/systemd</code></li>\n<li>environ 记录了进程运行时的环境变量；</li>\n<li>fd 目录下是进程打开或使用的文件的符号连接</li>\n</ul>\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.07.png\" width=100% height=100% />\n\n<p><strong>值得注意， 杀死进程又删除文件后还会自启，考虑PPID为1， 在清理完病毒之后重启服务器才彻底解决了问题。</strong><br><img src=\"/images/043.Cryptocurrency_Mining_Malware.md.08.png\" width=100% height=100% /></p>\n<h2 id=\"五、-老朋友-xmrig\"><a href=\"#五、-老朋友-xmrig\" class=\"headerlink\" title=\"五、 老朋友 xmrig\"></a>五、 老朋友 xmrig</h2><p><code>/var/tmp/x86_64</code> 之前删除过一次， 但是病毒还是复活了， 现在已经没有这个目录了。</p>\n<p>想到进程的用户是Oracle，那么到Oracle的家目录看下有没有收获。</p>\n<p>果然在Oracle家目录 <code>/home/oracle</code>  发现了可以的隐藏目录。 看到 <code>xmrig</code> 基本上可以确认就这里了。</p>\n<blockquote>\n<blockquote>\n<p>XMrig 是一个开源的 CPU&#x2F;GPU 挖矿软件，用于挖掘加密货币 Monero（XMR）以及其他基于 Cryptonight 算法的数字资产。它是一个跨平台的软件，可在多种操作系统上运行，包括 Windows、Linux 和 macOS。 balabalbal……</p>\n</blockquote>\n</blockquote>\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.04.png\" width=100% height=100% />\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.05.png\" width=100% height=100% />\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.06.png\" width=100% height=100% />","site":{"data":{}},"excerpt":"","more":"<p><strong>公司服务器被挖矿，已经好几次了，之前htop找到进程号， 然后lsof找到相应的文件，kill进程删除文件即可。</strong><br><strong>这次的病毒，有点不一样， 删除之后还会自启，最后发现是因为删除病毒后没有重启服务器，记录一下过程</strong></p>\n<h2 id=\"服务器环境\"><a href=\"#服务器环境\" class=\"headerlink\" title=\"服务器环境\"></a>服务器环境</h2><p>CentOS 7.5 on PVE  8C 12G</p>\n<h2 id=\"一、-htop查看进程详情\"><a href=\"#一、-htop查看进程详情\" class=\"headerlink\" title=\"一、 htop查看进程详情\"></a>一、 htop查看进程详情</h2><p>USER： <code>oracle</code><br>COMMAND: <code>/bin/bash/systemd</code><br><img src=\"/images/043.Cryptocurrency_Mining_Malware.md.01.png\" width=100% height=100% /></p>\n<h2 id=\"二、-lsof-查看进程相关文件\"><a href=\"#二、-lsof-查看进程相关文件\" class=\"headerlink\" title=\"二、 lsof 查看进程相关文件\"></a>二、 lsof 查看进程相关文件</h2><p><code>lsof -p $PID</code></p>\n<p>PATH: <code>/var/tmp/x86_64</code>（deleted）<br>外链： <code>45.10.20.137</code> （荷兰）<br><img src=\"/images/043.Cryptocurrency_Mining_Malware.md.02.png\" width=100% height=100% /></p>\n<h2 id=\"三、-netstat-查看外链详情\"><a href=\"#三、-netstat-查看外链详情\" class=\"headerlink\" title=\"三、 netstat 查看外链详情\"></a>三、 netstat 查看外链详情</h2><p><code>netstat -antlp</code><br><img src=\"/images/043.Cryptocurrency_Mining_Malware.md.03.png\" width=100% height=100% /></p>\n<h2 id=\"四、-proc-查看进程详情\"><a href=\"#四、-proc-查看进程详情\" class=\"headerlink\" title=\"四、 &#x2F;proc 查看进程详情\"></a>四、 &#x2F;proc 查看进程详情</h2><p><code>ls -ahl /proc/$PID</code></p>\n<ul>\n<li>cwd 进程运行目录；</li>\n<li>exe 执行程序的绝对路径；             <code>/var/tmp/x86_64</code>(deleted)</li>\n<li>cmdline 程序运行时输入的命令行命令；  <code>/bin/bash/systemd</code></li>\n<li>environ 记录了进程运行时的环境变量；</li>\n<li>fd 目录下是进程打开或使用的文件的符号连接</li>\n</ul>\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.07.png\" width=100% height=100% />\n\n<p><strong>值得注意， 杀死进程又删除文件后还会自启，考虑PPID为1， 在清理完病毒之后重启服务器才彻底解决了问题。</strong><br><img src=\"/images/043.Cryptocurrency_Mining_Malware.md.08.png\" width=100% height=100% /></p>\n<h2 id=\"五、-老朋友-xmrig\"><a href=\"#五、-老朋友-xmrig\" class=\"headerlink\" title=\"五、 老朋友 xmrig\"></a>五、 老朋友 xmrig</h2><p><code>/var/tmp/x86_64</code> 之前删除过一次， 但是病毒还是复活了， 现在已经没有这个目录了。</p>\n<p>想到进程的用户是Oracle，那么到Oracle的家目录看下有没有收获。</p>\n<p>果然在Oracle家目录 <code>/home/oracle</code>  发现了可以的隐藏目录。 看到 <code>xmrig</code> 基本上可以确认就这里了。</p>\n<blockquote>\n<blockquote>\n<p>XMrig 是一个开源的 CPU&#x2F;GPU 挖矿软件，用于挖掘加密货币 Monero（XMR）以及其他基于 Cryptonight 算法的数字资产。它是一个跨平台的软件，可在多种操作系统上运行，包括 Windows、Linux 和 macOS。 balabalbal……</p>\n</blockquote>\n</blockquote>\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.04.png\" width=100% height=100% />\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.05.png\" width=100% height=100% />\n<img src=\"/images/043.Cryptocurrency_Mining_Malware.md.06.png\" width=100% height=100% />"},{"title":"进程相关","date":"2023-06-20T01:49:23.000Z","_content":"\n\n> linux 中有时候需要查看进程相关的文件情况，简单的情况下使用lsof -p $PID即可，但是某些情况下没有lsof这个命令。 这个时候我们可以在 /proc/$PID下面查看相关信息。\n\n\n## /proc 目录介绍\n\n> Linux 内核提供了一种通过 /proc 文件系统，在运行时访问内核内部数据结构、改变内核设置的机制。proc文件系统是一个伪文件系统，它只存在内存当中，而不占用外存空间。它以文件系统的方式为访问系统内核数据的操作提供接口。\n\n|PATH                 |说明                      |\n| ------              | ------                   |\n|/proc/cpuinfo        | cpu的信息                 |\n|/proc/stat           | 所有的CPU活动信息          |\n|/proc/devices        | 已经加载的设备并分类        |\n|/proc/filesystems    | 内核当前支持的文件系统类型   |\n|/proc/modules        | 所有加载到内核的模块列表     |\n|/proc/uptime         | 系统已经运行了多久          |\n|/proc/net            | 网卡设备信息               |","source":"_posts/044.about_process.md","raw":"---\ntitle: 进程相关\ndate: 2023-6-20 09:49:23\ncategories: \n- [Linux]\n- [DevOps]\ntags: \n- pid\n- progress\n---\n\n\n> linux 中有时候需要查看进程相关的文件情况，简单的情况下使用lsof -p $PID即可，但是某些情况下没有lsof这个命令。 这个时候我们可以在 /proc/$PID下面查看相关信息。\n\n\n## /proc 目录介绍\n\n> Linux 内核提供了一种通过 /proc 文件系统，在运行时访问内核内部数据结构、改变内核设置的机制。proc文件系统是一个伪文件系统，它只存在内存当中，而不占用外存空间。它以文件系统的方式为访问系统内核数据的操作提供接口。\n\n|PATH                 |说明                      |\n| ------              | ------                   |\n|/proc/cpuinfo        | cpu的信息                 |\n|/proc/stat           | 所有的CPU活动信息          |\n|/proc/devices        | 已经加载的设备并分类        |\n|/proc/filesystems    | 内核当前支持的文件系统类型   |\n|/proc/modules        | 所有加载到内核的模块列表     |\n|/proc/uptime         | 系统已经运行了多久          |\n|/proc/net            | 网卡设备信息               |","slug":"044.about_process","published":1,"updated":"2023-12-05T08:52:30.879Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzdg0046ijnr90kd8whh","content":"<blockquote>\n<p>linux 中有时候需要查看进程相关的文件情况，简单的情况下使用lsof -p $PID即可，但是某些情况下没有lsof这个命令。 这个时候我们可以在 &#x2F;proc&#x2F;$PID下面查看相关信息。</p>\n</blockquote>\n<h2 id=\"proc-目录介绍\"><a href=\"#proc-目录介绍\" class=\"headerlink\" title=\"&#x2F;proc 目录介绍\"></a>&#x2F;proc 目录介绍</h2><blockquote>\n<p>Linux 内核提供了一种通过 &#x2F;proc 文件系统，在运行时访问内核内部数据结构、改变内核设置的机制。proc文件系统是一个伪文件系统，它只存在内存当中，而不占用外存空间。它以文件系统的方式为访问系统内核数据的操作提供接口。</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>PATH</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>&#x2F;proc&#x2F;cpuinfo</td>\n<td>cpu的信息</td>\n</tr>\n<tr>\n<td>&#x2F;proc&#x2F;stat</td>\n<td>所有的CPU活动信息</td>\n</tr>\n<tr>\n<td>&#x2F;proc&#x2F;devices</td>\n<td>已经加载的设备并分类</td>\n</tr>\n<tr>\n<td>&#x2F;proc&#x2F;filesystems</td>\n<td>内核当前支持的文件系统类型</td>\n</tr>\n<tr>\n<td>&#x2F;proc&#x2F;modules</td>\n<td>所有加载到内核的模块列表</td>\n</tr>\n<tr>\n<td>&#x2F;proc&#x2F;uptime</td>\n<td>系统已经运行了多久</td>\n</tr>\n<tr>\n<td>&#x2F;proc&#x2F;net</td>\n<td>网卡设备信息</td>\n</tr>\n</tbody></table>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>linux 中有时候需要查看进程相关的文件情况，简单的情况下使用lsof -p $PID即可，但是某些情况下没有lsof这个命令。 这个时候我们可以在 &#x2F;proc&#x2F;$PID下面查看相关信息。</p>\n</blockquote>\n<h2 id=\"proc-目录介绍\"><a href=\"#proc-目录介绍\" class=\"headerlink\" title=\"&#x2F;proc 目录介绍\"></a>&#x2F;proc 目录介绍</h2><blockquote>\n<p>Linux 内核提供了一种通过 &#x2F;proc 文件系统，在运行时访问内核内部数据结构、改变内核设置的机制。proc文件系统是一个伪文件系统，它只存在内存当中，而不占用外存空间。它以文件系统的方式为访问系统内核数据的操作提供接口。</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>PATH</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>&#x2F;proc&#x2F;cpuinfo</td>\n<td>cpu的信息</td>\n</tr>\n<tr>\n<td>&#x2F;proc&#x2F;stat</td>\n<td>所有的CPU活动信息</td>\n</tr>\n<tr>\n<td>&#x2F;proc&#x2F;devices</td>\n<td>已经加载的设备并分类</td>\n</tr>\n<tr>\n<td>&#x2F;proc&#x2F;filesystems</td>\n<td>内核当前支持的文件系统类型</td>\n</tr>\n<tr>\n<td>&#x2F;proc&#x2F;modules</td>\n<td>所有加载到内核的模块列表</td>\n</tr>\n<tr>\n<td>&#x2F;proc&#x2F;uptime</td>\n<td>系统已经运行了多久</td>\n</tr>\n<tr>\n<td>&#x2F;proc&#x2F;net</td>\n<td>网卡设备信息</td>\n</tr>\n</tbody></table>\n"},{"title":"Xray + v2rayA","date":"2023-07-07T06:11:11.000Z","_content":"\n\n> ENV\nOS: Debian GNU/Linux 12 (bookworm) x86_64\n\n\n\n\n## 一、 xray-core 部署\n\n### 1.1 下载\n\nhttps://github.com/XTLS/Xray-core/releases\n根据自己的环境选择合适的版本\n\n### 1.2 安装\n\n注意： **本文xray安装的目录```不符合``` [FHS规范](https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard) 。**\n\n``` sudo mkdir /xray ```\n``` sudo unzip Xray-linux-64.zip -d /usr/local/xray```\n\n### 1.3 使用systemd管理\n\n``` bash\n# /etc/systemd/system/xray.service\n[Unit]\nDescription=Xray Service\nDocumentation=https://github.com/xtls\nAfter=network.target nss-lookup.target\n\n[Service]\nUser=root\nCapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE\nAmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE\nNoNewPrivileges=true\nExecStart=/usr/local/xray/xray run -config /usr/local/xray/config.json\nRestart=on-failure\nRestartPreventExitStatus=23\nLimitNPROC=10000\nLimitNOFILE=1000000\n\n[Install]\nWantedBy=multi-user.target\n\n```\n\n``` ln -s /usr/local/xray/xray.service /etc/systemd/system/ ```\n``` sudo systemctl daemon-reload ```\n\n### 1.4 使用脚本安装以符合FHS规范 \n\n```  bash -c \"$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)\" @ install ```\n\n**这个脚本在没有代理的情况下基本上无法实行，卡在下载过程，TMD这不是winrar.rar行为吗**\n<img src=\"/images/045.v2raya.md.00.png\" width=100% height=100% />\n\n\n### 手动使其符合FHS规范\n\n按照下面目录移动文件，没有就新建\n<img src=\"/images/045.v2raya.md.000.png\" width=100% height=100% />\n\n## 二、 V2RayA 部署\n\n### 2.1 软件源安装\n\n#### 添加 V2RayA 公钥\n\n``` wget -qO - https://apt.v2raya.org/key/public-key.asc | sudo tee /etc/apt/trusted.gpg.d/v2raya.asc ```\n\n#### 添加 V2RayA 源\n\n``` echo \"deb https://apt.v2raya.org/ v2raya main\" | sudo tee /etc/apt/sources.list.d/v2raya.list ```\n\n#### 安装 V2RayA \n\n``` sudo apt update && sudo apt install v2raya ```\n\n### 2.2 deb 包安装\n\n#### 下载\nhttps://github.com/v2rayA/v2rayA/releases\n\n#### 安装\n\n``` sudo apt install ./$PATH/istaller_debian_amd64_2.0.5.deb ```\n\n**两种安装方式效果相同**\n\n\n## 三、 V2RayA 配置相关\n\n\n确保V2RayA正常运行，xray可以不运行。\n<img src=\"/images/045.v2raya.md.01.png\" width=100% height=100% />\n<img src=\"/images/045.v2raya.md.02.png\" width=100% height=100% />\n\n\n\n\n\n报错： 检测到geosite.dat, geoip.dat文件或v2ray-core 可能未正确配置\n<img src=\"/images/045.v2raya.md.03.png\" width=100% height=100% />\n\n\n解决： **出现上述原因，大多数是因为 v2ray或xray没有按照 FHS的规范安装，导致 v2raya 找不到相关文件**\n","source":"_posts/045.v2raya.md","raw":"---\ntitle: Xray + v2rayA\ndate: 2023-7-7 14:11:11\ncategories: \n- [Linux]\n- [DevOps]\ntags: \n- v2ray\n- xray\n- v2rayA\n---\n\n\n> ENV\nOS: Debian GNU/Linux 12 (bookworm) x86_64\n\n\n\n\n## 一、 xray-core 部署\n\n### 1.1 下载\n\nhttps://github.com/XTLS/Xray-core/releases\n根据自己的环境选择合适的版本\n\n### 1.2 安装\n\n注意： **本文xray安装的目录```不符合``` [FHS规范](https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard) 。**\n\n``` sudo mkdir /xray ```\n``` sudo unzip Xray-linux-64.zip -d /usr/local/xray```\n\n### 1.3 使用systemd管理\n\n``` bash\n# /etc/systemd/system/xray.service\n[Unit]\nDescription=Xray Service\nDocumentation=https://github.com/xtls\nAfter=network.target nss-lookup.target\n\n[Service]\nUser=root\nCapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE\nAmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE\nNoNewPrivileges=true\nExecStart=/usr/local/xray/xray run -config /usr/local/xray/config.json\nRestart=on-failure\nRestartPreventExitStatus=23\nLimitNPROC=10000\nLimitNOFILE=1000000\n\n[Install]\nWantedBy=multi-user.target\n\n```\n\n``` ln -s /usr/local/xray/xray.service /etc/systemd/system/ ```\n``` sudo systemctl daemon-reload ```\n\n### 1.4 使用脚本安装以符合FHS规范 \n\n```  bash -c \"$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)\" @ install ```\n\n**这个脚本在没有代理的情况下基本上无法实行，卡在下载过程，TMD这不是winrar.rar行为吗**\n<img src=\"/images/045.v2raya.md.00.png\" width=100% height=100% />\n\n\n### 手动使其符合FHS规范\n\n按照下面目录移动文件，没有就新建\n<img src=\"/images/045.v2raya.md.000.png\" width=100% height=100% />\n\n## 二、 V2RayA 部署\n\n### 2.1 软件源安装\n\n#### 添加 V2RayA 公钥\n\n``` wget -qO - https://apt.v2raya.org/key/public-key.asc | sudo tee /etc/apt/trusted.gpg.d/v2raya.asc ```\n\n#### 添加 V2RayA 源\n\n``` echo \"deb https://apt.v2raya.org/ v2raya main\" | sudo tee /etc/apt/sources.list.d/v2raya.list ```\n\n#### 安装 V2RayA \n\n``` sudo apt update && sudo apt install v2raya ```\n\n### 2.2 deb 包安装\n\n#### 下载\nhttps://github.com/v2rayA/v2rayA/releases\n\n#### 安装\n\n``` sudo apt install ./$PATH/istaller_debian_amd64_2.0.5.deb ```\n\n**两种安装方式效果相同**\n\n\n## 三、 V2RayA 配置相关\n\n\n确保V2RayA正常运行，xray可以不运行。\n<img src=\"/images/045.v2raya.md.01.png\" width=100% height=100% />\n<img src=\"/images/045.v2raya.md.02.png\" width=100% height=100% />\n\n\n\n\n\n报错： 检测到geosite.dat, geoip.dat文件或v2ray-core 可能未正确配置\n<img src=\"/images/045.v2raya.md.03.png\" width=100% height=100% />\n\n\n解决： **出现上述原因，大多数是因为 v2ray或xray没有按照 FHS的规范安装，导致 v2raya 找不到相关文件**\n","slug":"045.v2raya","published":1,"updated":"2023-12-05T08:52:30.879Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzdi0049ijnr8lugeppq","content":"<blockquote>\n<p>ENV<br>OS: Debian GNU&#x2F;Linux 12 (bookworm) x86_64</p>\n</blockquote>\n<h2 id=\"一、-xray-core-部署\"><a href=\"#一、-xray-core-部署\" class=\"headerlink\" title=\"一、 xray-core 部署\"></a>一、 xray-core 部署</h2><h3 id=\"1-1-下载\"><a href=\"#1-1-下载\" class=\"headerlink\" title=\"1.1 下载\"></a>1.1 下载</h3><p><a href=\"https://github.com/XTLS/Xray-core/releases\">https://github.com/XTLS/Xray-core/releases</a><br>根据自己的环境选择合适的版本</p>\n<h3 id=\"1-2-安装\"><a href=\"#1-2-安装\" class=\"headerlink\" title=\"1.2 安装\"></a>1.2 安装</h3><p>注意： <strong>本文xray安装的目录<code>不符合</code> <a href=\"https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard\">FHS规范</a> 。</strong></p>\n<p><code>sudo mkdir /xray</code><br><code> sudo unzip Xray-linux-64.zip -d /usr/local/xray</code></p>\n<h3 id=\"1-3-使用systemd管理\"><a href=\"#1-3-使用systemd管理\" class=\"headerlink\" title=\"1.3 使用systemd管理\"></a>1.3 使用systemd管理</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /etc/systemd/system/xray.service</span></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Xray Service</span><br><span class=\"line\">Documentation=https://github.com/xtls</span><br><span class=\"line\">After=network.target nss-lookup.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">User=root</span><br><span class=\"line\">CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE</span><br><span class=\"line\">AmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE</span><br><span class=\"line\">NoNewPrivileges=<span class=\"literal\">true</span></span><br><span class=\"line\">ExecStart=/usr/local/xray/xray run -config /usr/local/xray/config.json</span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\">RestartPreventExitStatus=23</span><br><span class=\"line\">LimitNPROC=10000</span><br><span class=\"line\">LimitNOFILE=1000000</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>ln -s /usr/local/xray/xray.service /etc/systemd/system/</code><br><code>sudo systemctl daemon-reload</code></p>\n<h3 id=\"1-4-使用脚本安装以符合FHS规范\"><a href=\"#1-4-使用脚本安装以符合FHS规范\" class=\"headerlink\" title=\"1.4 使用脚本安装以符合FHS规范\"></a>1.4 使用脚本安装以符合FHS规范</h3><p><code> bash -c &quot;$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)&quot; @ install</code></p>\n<p><strong>这个脚本在没有代理的情况下基本上无法实行，卡在下载过程，TMD这不是winrar.rar行为吗</strong><br><img src=\"/images/045.v2raya.md.00.png\" width=100% height=100% /></p>\n<h3 id=\"手动使其符合FHS规范\"><a href=\"#手动使其符合FHS规范\" class=\"headerlink\" title=\"手动使其符合FHS规范\"></a>手动使其符合FHS规范</h3><p>按照下面目录移动文件，没有就新建<br><img src=\"/images/045.v2raya.md.000.png\" width=100% height=100% /></p>\n<h2 id=\"二、-V2RayA-部署\"><a href=\"#二、-V2RayA-部署\" class=\"headerlink\" title=\"二、 V2RayA 部署\"></a>二、 V2RayA 部署</h2><h3 id=\"2-1-软件源安装\"><a href=\"#2-1-软件源安装\" class=\"headerlink\" title=\"2.1 软件源安装\"></a>2.1 软件源安装</h3><h4 id=\"添加-V2RayA-公钥\"><a href=\"#添加-V2RayA-公钥\" class=\"headerlink\" title=\"添加 V2RayA 公钥\"></a>添加 V2RayA 公钥</h4><p><code>wget -qO - https://apt.v2raya.org/key/public-key.asc | sudo tee /etc/apt/trusted.gpg.d/v2raya.asc</code></p>\n<h4 id=\"添加-V2RayA-源\"><a href=\"#添加-V2RayA-源\" class=\"headerlink\" title=\"添加 V2RayA 源\"></a>添加 V2RayA 源</h4><p><code>echo &quot;deb https://apt.v2raya.org/ v2raya main&quot; | sudo tee /etc/apt/sources.list.d/v2raya.list</code></p>\n<h4 id=\"安装-V2RayA\"><a href=\"#安装-V2RayA\" class=\"headerlink\" title=\"安装 V2RayA\"></a>安装 V2RayA</h4><p><code>sudo apt update &amp;&amp; sudo apt install v2raya</code></p>\n<h3 id=\"2-2-deb-包安装\"><a href=\"#2-2-deb-包安装\" class=\"headerlink\" title=\"2.2 deb 包安装\"></a>2.2 deb 包安装</h3><h4 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h4><p><a href=\"https://github.com/v2rayA/v2rayA/releases\">https://github.com/v2rayA/v2rayA/releases</a></p>\n<h4 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h4><p><code>sudo apt install ./$PATH/istaller_debian_amd64_2.0.5.deb</code></p>\n<p><strong>两种安装方式效果相同</strong></p>\n<h2 id=\"三、-V2RayA-配置相关\"><a href=\"#三、-V2RayA-配置相关\" class=\"headerlink\" title=\"三、 V2RayA 配置相关\"></a>三、 V2RayA 配置相关</h2><p>确保V2RayA正常运行，xray可以不运行。<br><img src=\"/images/045.v2raya.md.01.png\" width=100% height=100% /><br><img src=\"/images/045.v2raya.md.02.png\" width=100% height=100% /></p>\n<p>报错： 检测到geosite.dat, geoip.dat文件或v2ray-core 可能未正确配置<br><img src=\"/images/045.v2raya.md.03.png\" width=100% height=100% /></p>\n<p>解决： <strong>出现上述原因，大多数是因为 v2ray或xray没有按照 FHS的规范安装，导致 v2raya 找不到相关文件</strong></p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>ENV<br>OS: Debian GNU&#x2F;Linux 12 (bookworm) x86_64</p>\n</blockquote>\n<h2 id=\"一、-xray-core-部署\"><a href=\"#一、-xray-core-部署\" class=\"headerlink\" title=\"一、 xray-core 部署\"></a>一、 xray-core 部署</h2><h3 id=\"1-1-下载\"><a href=\"#1-1-下载\" class=\"headerlink\" title=\"1.1 下载\"></a>1.1 下载</h3><p><a href=\"https://github.com/XTLS/Xray-core/releases\">https://github.com/XTLS/Xray-core/releases</a><br>根据自己的环境选择合适的版本</p>\n<h3 id=\"1-2-安装\"><a href=\"#1-2-安装\" class=\"headerlink\" title=\"1.2 安装\"></a>1.2 安装</h3><p>注意： <strong>本文xray安装的目录<code>不符合</code> <a href=\"https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard\">FHS规范</a> 。</strong></p>\n<p><code>sudo mkdir /xray</code><br><code> sudo unzip Xray-linux-64.zip -d /usr/local/xray</code></p>\n<h3 id=\"1-3-使用systemd管理\"><a href=\"#1-3-使用systemd管理\" class=\"headerlink\" title=\"1.3 使用systemd管理\"></a>1.3 使用systemd管理</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /etc/systemd/system/xray.service</span></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Xray Service</span><br><span class=\"line\">Documentation=https://github.com/xtls</span><br><span class=\"line\">After=network.target nss-lookup.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">User=root</span><br><span class=\"line\">CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE</span><br><span class=\"line\">AmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE</span><br><span class=\"line\">NoNewPrivileges=<span class=\"literal\">true</span></span><br><span class=\"line\">ExecStart=/usr/local/xray/xray run -config /usr/local/xray/config.json</span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\">RestartPreventExitStatus=23</span><br><span class=\"line\">LimitNPROC=10000</span><br><span class=\"line\">LimitNOFILE=1000000</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>ln -s /usr/local/xray/xray.service /etc/systemd/system/</code><br><code>sudo systemctl daemon-reload</code></p>\n<h3 id=\"1-4-使用脚本安装以符合FHS规范\"><a href=\"#1-4-使用脚本安装以符合FHS规范\" class=\"headerlink\" title=\"1.4 使用脚本安装以符合FHS规范\"></a>1.4 使用脚本安装以符合FHS规范</h3><p><code> bash -c &quot;$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)&quot; @ install</code></p>\n<p><strong>这个脚本在没有代理的情况下基本上无法实行，卡在下载过程，TMD这不是winrar.rar行为吗</strong><br><img src=\"/images/045.v2raya.md.00.png\" width=100% height=100% /></p>\n<h3 id=\"手动使其符合FHS规范\"><a href=\"#手动使其符合FHS规范\" class=\"headerlink\" title=\"手动使其符合FHS规范\"></a>手动使其符合FHS规范</h3><p>按照下面目录移动文件，没有就新建<br><img src=\"/images/045.v2raya.md.000.png\" width=100% height=100% /></p>\n<h2 id=\"二、-V2RayA-部署\"><a href=\"#二、-V2RayA-部署\" class=\"headerlink\" title=\"二、 V2RayA 部署\"></a>二、 V2RayA 部署</h2><h3 id=\"2-1-软件源安装\"><a href=\"#2-1-软件源安装\" class=\"headerlink\" title=\"2.1 软件源安装\"></a>2.1 软件源安装</h3><h4 id=\"添加-V2RayA-公钥\"><a href=\"#添加-V2RayA-公钥\" class=\"headerlink\" title=\"添加 V2RayA 公钥\"></a>添加 V2RayA 公钥</h4><p><code>wget -qO - https://apt.v2raya.org/key/public-key.asc | sudo tee /etc/apt/trusted.gpg.d/v2raya.asc</code></p>\n<h4 id=\"添加-V2RayA-源\"><a href=\"#添加-V2RayA-源\" class=\"headerlink\" title=\"添加 V2RayA 源\"></a>添加 V2RayA 源</h4><p><code>echo &quot;deb https://apt.v2raya.org/ v2raya main&quot; | sudo tee /etc/apt/sources.list.d/v2raya.list</code></p>\n<h4 id=\"安装-V2RayA\"><a href=\"#安装-V2RayA\" class=\"headerlink\" title=\"安装 V2RayA\"></a>安装 V2RayA</h4><p><code>sudo apt update &amp;&amp; sudo apt install v2raya</code></p>\n<h3 id=\"2-2-deb-包安装\"><a href=\"#2-2-deb-包安装\" class=\"headerlink\" title=\"2.2 deb 包安装\"></a>2.2 deb 包安装</h3><h4 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h4><p><a href=\"https://github.com/v2rayA/v2rayA/releases\">https://github.com/v2rayA/v2rayA/releases</a></p>\n<h4 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h4><p><code>sudo apt install ./$PATH/istaller_debian_amd64_2.0.5.deb</code></p>\n<p><strong>两种安装方式效果相同</strong></p>\n<h2 id=\"三、-V2RayA-配置相关\"><a href=\"#三、-V2RayA-配置相关\" class=\"headerlink\" title=\"三、 V2RayA 配置相关\"></a>三、 V2RayA 配置相关</h2><p>确保V2RayA正常运行，xray可以不运行。<br><img src=\"/images/045.v2raya.md.01.png\" width=100% height=100% /><br><img src=\"/images/045.v2raya.md.02.png\" width=100% height=100% /></p>\n<p>报错： 检测到geosite.dat, geoip.dat文件或v2ray-core 可能未正确配置<br><img src=\"/images/045.v2raya.md.03.png\" width=100% height=100% /></p>\n<p>解决： <strong>出现上述原因，大多数是因为 v2ray或xray没有按照 FHS的规范安装，导致 v2raya 找不到相关文件</strong></p>\n"},{"title":"手动安装 docker 并配置 sytemctl 管理","date":"2023-09-11T14:09:11.000Z","_content":"\n\n## 一、 下载 docker 二进制文件\n\n根据自己环境选择合适的版本：\nhttps://download.docker.com/linux/static/stable/x86_64/\n\n## 二、 解压到 /usr/local/docker\n\n创建docker用户及组\n\n``` groupadd docker```\n``` useradd -g docker docker```\n\n``` tar -xzvf docker-19.03.1.tgz ```\n``` mv docker /usr/local/ ```\n\n<img src=\"/images/046.docker_install_manual.md.01.png\" width=100% height=100% />\n\n## 三、 使用 systemctl 管理 docker 服务\n\n文件引用自：\nhttps://github.com/moby/moby/blob/master/contrib/init/systemd/docker.service\n\n**docker.service**\n```bash\n# vim /usr/local/docker/docker.service\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nAfter=network-online.target docker.socket firewalld.service\nWants=network-online.target \nRequires=docker.socket\n\n[Service]\nType=notify\n# the default is not to use systemd for cgroups because the delegate issues still\n# exists and systemd currently does not support the cgroup feature set required\n# for containers run by docker\nExecStart=/usr/local/docker/dockerd\n# ExecStart=/usr/local/docker/dockerd -H fd:// --containerd=/run/containerd/containerd.sock  ## 注意这种配置的写法，区别在后面会介绍\nExecReload=/bin/kill -s HUP $MAINPID\nTimeoutStartSec=0\nRestartSec=2\nRestart=always\n\n# Note that StartLimit* options were moved from \"Service\" to \"Unit\" in systemd 229.\n# Both the old, and new location are accepted by systemd 229 and up, so using the old location\n# to make them work for either version of systemd.\nStartLimitBurst=3\n\n# Note that StartLimitInterval was renamed to StartLimitIntervalSec in systemd 230.\n# Both the old, and new name are accepted by systemd 230 and up, so using the old name to make\n# this option work for either version of systemd.\nStartLimitInterval=60s\n\n# Having non-zero Limit*s causes performance problems due to accounting overhead\n# in the kernel. We recommend using cgroups to do container-local accounting.\nLimitNPROC=infinity\nLimitCORE=infinity\n\n# Comment TasksMax if your systemd version does not support it.\n# Only systemd 226 and above support this option.\nTasksMax=infinity\n\n# set delegate yes so that systemd does not reset the cgroups of docker containers\nDelegate=yes\n\n# kill only the docker process, not all processes in the cgroup\nKillMode=process\nOOMScoreAdjust=-500\n\n[Install]\nWantedBy=multi-user.target\n\n```\n\n**docker.socket**\n\n``` bash\n# vim /usr/local/docker/docker.socket\n[Unit]\nDescription=Docker Socket for the API\n\n[Socket]\n# If /var/run is not implemented as a symlink to /run, you may need to\n# specify ListenStream=/var/run/docker.sock instead.\nListenStream=/var/run/docker.sock\nSocketMode=0660\nSocketUser=root\nSocketGroup=docker\n\n[Install]\nWantedBy=sockets.target\n\n```\n\n### 3.1 配置 containerd 及相关环境\n\n``` ln -s /usr/local/docker/containerd /usr/bin/ ```\n``` ln -s /usr/local/docker/dockerd /usr/bin/ ```\n``` ln -s /usr/local/docker/docker-init /usr/bin/ ```\n``` ln -s /usr/local/docker/docker-proxy /usr/bin/ ```\n``` ln -s /usr/local/docker/runc /usr/bin/ ```\n\n\n### 3.2 重载 systemd\n\n``` systemctl daemon-reload ```\n\n### 3.3 确保 network-online.target 和 firewalld.service 正常\n\n``` systemctl status network-online.target```\n``` systemctl status firewalld.service```\n\n\n### 3.4 systemctl 配置 docker 并设置自启\n\n``` systemctl enable docker.socket --now```\n``` systemctl enable docker.service --now```\n\n### 3.5 方便后续操作将 docker 等软连接到 PATH\n\n``` ln -s /usr/local/docker/docker /usr/bin/ ```\n``` ln -s /usr/local/docker/dockerd /usr/bin/ ```\n\n## 四、 相关问题\n\n### 4.1 为什么是 /usr/local/docker \n\n**答：** 如果按照标准的FHS规范应该是/usr/bin等其他目录，选择/usr/local/docker目录的原因方便后续的升级。\n\n### 4.2 为什么要软连接containerd到/usr/bin\n**答：**\n<img src=\"/images/046.docker_install_manual.md.02.png\" width=100% height=100% />\n\n### 4.3 两种不同的 ExecStart 写法的区别\n\n第一种： ``` ExecStart=/usr/local/docker/dockerd -H fd:// --containerd=/run/containerd/containerd.sock ```\n1. ```-H fd```\n\t这个参数告诉 Docker 守护进程使用文件描述符 (fd) 监听 Docker 客户端的连接。\n\t这通常用于与 Docker 代理一起使用，以便在代理与 Docker 守护进程之间建立通信。\n2. ```--containerd=/run/containerd/containerd.sock```\n\t这个参数指定 Docker 守护进程应该使用的 containerd 服务的 Unix 套接字。\n\tContainerd 是一个用于管理容器的基础设施组件，Docker 守护进程通常会与它一起工作。\n\n\n第二种： ``` ExecStart=/usr/local/docker/dockerd ```  \n\t\t未指定参数意味着 Docker 守护进程将使用默认配置来运行，通常会监听 Unix 套接字 /var/run/docker.sock 来接收 Docker 客户端的请求。\n\t\t即我们在``` docker.socket``` 里配置的路径```ListenStream=/var/run/docker.sock```\n\n\n**注意：** 如果需要使用```ExecStart=/usr/local/docker/dockerd -H fd:// --containerd=/run/containerd/containerd.sock``` \n需要将```containerd```注册成系统服务\n并且在 ```After``` 和 ```Wants``` 需要引用 ```containerd.service``` \n\n\n### 4.4 systemctl 另外一种管理 docker 的配置写法\n请注意这种写法需要将 ```containerd``` 注册成系统服务\n\n**docker.service**\n``` bash\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nAfter=network-online.target docker.socket firewalld.service containerd.service time-set.target\nWants=network-online.target containerd.service\nRequires=docker.socket\n\n[Service]\nType=notify\nWorkingDirectory=/usr/local/docker/\nExecStart=/usr/local/docker/dockerd -H fd:// --containerd=/run/containerd/containerd.sock\nExecReload=/bin/kill -s HUP $MAINPID\nTimeoutStartSec=0\nRestartSec=2\nRestart=always\nStartLimitBurst=3\nStartLimitInterval=60s\nLimitNPROC=infinity\nLimitCORE=infinity\nTasksMax=infinity\nDelegate=yes\nKillMode=process\nOOMScoreAdjust=-500\n\n[Install]\nWantedBy=multi-user.target\n```\n\n**docker.socket**\n``` bash\n[Unit]\nDescription=Docker Socket for the API\n\n[Socket]\n# If /var/run is not implemented as a symlink to /run, you may need to\n# specify ListenStream=/var/run/docker.sock instead.\nListenStream=/var/run/docker.sock\nSocketMode=0660\nSocketUser=root\nSocketGroup=docker\n\n[Install]\nWantedBy=sockets.target\n\n\n```\n\n","source":"_posts/046.docker_install_manual.md","raw":"---\ntitle: 手动安装 docker 并配置 sytemctl 管理\ndate: 2023-9-11 22:09:11\ncategories: \n- [Linux]\n- [Docker]\ntags: \n- docker\n- systemd\n---\n\n\n## 一、 下载 docker 二进制文件\n\n根据自己环境选择合适的版本：\nhttps://download.docker.com/linux/static/stable/x86_64/\n\n## 二、 解压到 /usr/local/docker\n\n创建docker用户及组\n\n``` groupadd docker```\n``` useradd -g docker docker```\n\n``` tar -xzvf docker-19.03.1.tgz ```\n``` mv docker /usr/local/ ```\n\n<img src=\"/images/046.docker_install_manual.md.01.png\" width=100% height=100% />\n\n## 三、 使用 systemctl 管理 docker 服务\n\n文件引用自：\nhttps://github.com/moby/moby/blob/master/contrib/init/systemd/docker.service\n\n**docker.service**\n```bash\n# vim /usr/local/docker/docker.service\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nAfter=network-online.target docker.socket firewalld.service\nWants=network-online.target \nRequires=docker.socket\n\n[Service]\nType=notify\n# the default is not to use systemd for cgroups because the delegate issues still\n# exists and systemd currently does not support the cgroup feature set required\n# for containers run by docker\nExecStart=/usr/local/docker/dockerd\n# ExecStart=/usr/local/docker/dockerd -H fd:// --containerd=/run/containerd/containerd.sock  ## 注意这种配置的写法，区别在后面会介绍\nExecReload=/bin/kill -s HUP $MAINPID\nTimeoutStartSec=0\nRestartSec=2\nRestart=always\n\n# Note that StartLimit* options were moved from \"Service\" to \"Unit\" in systemd 229.\n# Both the old, and new location are accepted by systemd 229 and up, so using the old location\n# to make them work for either version of systemd.\nStartLimitBurst=3\n\n# Note that StartLimitInterval was renamed to StartLimitIntervalSec in systemd 230.\n# Both the old, and new name are accepted by systemd 230 and up, so using the old name to make\n# this option work for either version of systemd.\nStartLimitInterval=60s\n\n# Having non-zero Limit*s causes performance problems due to accounting overhead\n# in the kernel. We recommend using cgroups to do container-local accounting.\nLimitNPROC=infinity\nLimitCORE=infinity\n\n# Comment TasksMax if your systemd version does not support it.\n# Only systemd 226 and above support this option.\nTasksMax=infinity\n\n# set delegate yes so that systemd does not reset the cgroups of docker containers\nDelegate=yes\n\n# kill only the docker process, not all processes in the cgroup\nKillMode=process\nOOMScoreAdjust=-500\n\n[Install]\nWantedBy=multi-user.target\n\n```\n\n**docker.socket**\n\n``` bash\n# vim /usr/local/docker/docker.socket\n[Unit]\nDescription=Docker Socket for the API\n\n[Socket]\n# If /var/run is not implemented as a symlink to /run, you may need to\n# specify ListenStream=/var/run/docker.sock instead.\nListenStream=/var/run/docker.sock\nSocketMode=0660\nSocketUser=root\nSocketGroup=docker\n\n[Install]\nWantedBy=sockets.target\n\n```\n\n### 3.1 配置 containerd 及相关环境\n\n``` ln -s /usr/local/docker/containerd /usr/bin/ ```\n``` ln -s /usr/local/docker/dockerd /usr/bin/ ```\n``` ln -s /usr/local/docker/docker-init /usr/bin/ ```\n``` ln -s /usr/local/docker/docker-proxy /usr/bin/ ```\n``` ln -s /usr/local/docker/runc /usr/bin/ ```\n\n\n### 3.2 重载 systemd\n\n``` systemctl daemon-reload ```\n\n### 3.3 确保 network-online.target 和 firewalld.service 正常\n\n``` systemctl status network-online.target```\n``` systemctl status firewalld.service```\n\n\n### 3.4 systemctl 配置 docker 并设置自启\n\n``` systemctl enable docker.socket --now```\n``` systemctl enable docker.service --now```\n\n### 3.5 方便后续操作将 docker 等软连接到 PATH\n\n``` ln -s /usr/local/docker/docker /usr/bin/ ```\n``` ln -s /usr/local/docker/dockerd /usr/bin/ ```\n\n## 四、 相关问题\n\n### 4.1 为什么是 /usr/local/docker \n\n**答：** 如果按照标准的FHS规范应该是/usr/bin等其他目录，选择/usr/local/docker目录的原因方便后续的升级。\n\n### 4.2 为什么要软连接containerd到/usr/bin\n**答：**\n<img src=\"/images/046.docker_install_manual.md.02.png\" width=100% height=100% />\n\n### 4.3 两种不同的 ExecStart 写法的区别\n\n第一种： ``` ExecStart=/usr/local/docker/dockerd -H fd:// --containerd=/run/containerd/containerd.sock ```\n1. ```-H fd```\n\t这个参数告诉 Docker 守护进程使用文件描述符 (fd) 监听 Docker 客户端的连接。\n\t这通常用于与 Docker 代理一起使用，以便在代理与 Docker 守护进程之间建立通信。\n2. ```--containerd=/run/containerd/containerd.sock```\n\t这个参数指定 Docker 守护进程应该使用的 containerd 服务的 Unix 套接字。\n\tContainerd 是一个用于管理容器的基础设施组件，Docker 守护进程通常会与它一起工作。\n\n\n第二种： ``` ExecStart=/usr/local/docker/dockerd ```  \n\t\t未指定参数意味着 Docker 守护进程将使用默认配置来运行，通常会监听 Unix 套接字 /var/run/docker.sock 来接收 Docker 客户端的请求。\n\t\t即我们在``` docker.socket``` 里配置的路径```ListenStream=/var/run/docker.sock```\n\n\n**注意：** 如果需要使用```ExecStart=/usr/local/docker/dockerd -H fd:// --containerd=/run/containerd/containerd.sock``` \n需要将```containerd```注册成系统服务\n并且在 ```After``` 和 ```Wants``` 需要引用 ```containerd.service``` \n\n\n### 4.4 systemctl 另外一种管理 docker 的配置写法\n请注意这种写法需要将 ```containerd``` 注册成系统服务\n\n**docker.service**\n``` bash\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nAfter=network-online.target docker.socket firewalld.service containerd.service time-set.target\nWants=network-online.target containerd.service\nRequires=docker.socket\n\n[Service]\nType=notify\nWorkingDirectory=/usr/local/docker/\nExecStart=/usr/local/docker/dockerd -H fd:// --containerd=/run/containerd/containerd.sock\nExecReload=/bin/kill -s HUP $MAINPID\nTimeoutStartSec=0\nRestartSec=2\nRestart=always\nStartLimitBurst=3\nStartLimitInterval=60s\nLimitNPROC=infinity\nLimitCORE=infinity\nTasksMax=infinity\nDelegate=yes\nKillMode=process\nOOMScoreAdjust=-500\n\n[Install]\nWantedBy=multi-user.target\n```\n\n**docker.socket**\n``` bash\n[Unit]\nDescription=Docker Socket for the API\n\n[Socket]\n# If /var/run is not implemented as a symlink to /run, you may need to\n# specify ListenStream=/var/run/docker.sock instead.\nListenStream=/var/run/docker.sock\nSocketMode=0660\nSocketUser=root\nSocketGroup=docker\n\n[Install]\nWantedBy=sockets.target\n\n\n```\n\n","slug":"046.docker_install_manual","published":1,"updated":"2023-12-05T08:52:30.879Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzdn004dijnr05yrhn0m","content":"<h2 id=\"一、-下载-docker-二进制文件\"><a href=\"#一、-下载-docker-二进制文件\" class=\"headerlink\" title=\"一、 下载 docker 二进制文件\"></a>一、 下载 docker 二进制文件</h2><p>根据自己环境选择合适的版本：<br><a href=\"https://download.docker.com/linux/static/stable/x86_64/\">https://download.docker.com/linux/static/stable/x86_64/</a></p>\n<h2 id=\"二、-解压到-usr-local-docker\"><a href=\"#二、-解压到-usr-local-docker\" class=\"headerlink\" title=\"二、 解压到 &#x2F;usr&#x2F;local&#x2F;docker\"></a>二、 解压到 &#x2F;usr&#x2F;local&#x2F;docker</h2><p>创建docker用户及组</p>\n<p><code> groupadd docker</code><br><code> useradd -g docker docker</code></p>\n<p><code>tar -xzvf docker-19.03.1.tgz</code><br><code>mv docker /usr/local/</code></p>\n<img src=\"/images/046.docker_install_manual.md.01.png\" width=100% height=100% />\n\n<h2 id=\"三、-使用-systemctl-管理-docker-服务\"><a href=\"#三、-使用-systemctl-管理-docker-服务\" class=\"headerlink\" title=\"三、 使用 systemctl 管理 docker 服务\"></a>三、 使用 systemctl 管理 docker 服务</h2><p>文件引用自：<br><a href=\"https://github.com/moby/moby/blob/master/contrib/init/systemd/docker.service\">https://github.com/moby/moby/blob/master/contrib/init/systemd/docker.service</a></p>\n<p><strong>docker.service</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># vim /usr/local/docker/docker.service</span></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Docker Application Container Engine</span><br><span class=\"line\">Documentation=https://docs.docker.com</span><br><span class=\"line\">After=network-online.target docker.socket firewalld.service</span><br><span class=\"line\">Wants=network-online.target </span><br><span class=\"line\">Requires=docker.socket</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=notify</span><br><span class=\"line\"><span class=\"comment\"># the default is not to use systemd for cgroups because the delegate issues still</span></span><br><span class=\"line\"><span class=\"comment\"># exists and systemd currently does not support the cgroup feature set required</span></span><br><span class=\"line\"><span class=\"comment\"># for containers run by docker</span></span><br><span class=\"line\">ExecStart=/usr/local/docker/dockerd</span><br><span class=\"line\"><span class=\"comment\"># ExecStart=/usr/local/docker/dockerd -H fd:// --containerd=/run/containerd/containerd.sock  ## 注意这种配置的写法，区别在后面会介绍</span></span><br><span class=\"line\">ExecReload=/bin/kill -s HUP <span class=\"variable\">$MAINPID</span></span><br><span class=\"line\">TimeoutStartSec=0</span><br><span class=\"line\">RestartSec=2</span><br><span class=\"line\">Restart=always</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Note that StartLimit* options were moved from &quot;Service&quot; to &quot;Unit&quot; in systemd 229.</span></span><br><span class=\"line\"><span class=\"comment\"># Both the old, and new location are accepted by systemd 229 and up, so using the old location</span></span><br><span class=\"line\"><span class=\"comment\"># to make them work for either version of systemd.</span></span><br><span class=\"line\">StartLimitBurst=3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Note that StartLimitInterval was renamed to StartLimitIntervalSec in systemd 230.</span></span><br><span class=\"line\"><span class=\"comment\"># Both the old, and new name are accepted by systemd 230 and up, so using the old name to make</span></span><br><span class=\"line\"><span class=\"comment\"># this option work for either version of systemd.</span></span><br><span class=\"line\">StartLimitInterval=60s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Having non-zero Limit*s causes performance problems due to accounting overhead</span></span><br><span class=\"line\"><span class=\"comment\"># in the kernel. We recommend using cgroups to do container-local accounting.</span></span><br><span class=\"line\">LimitNPROC=infinity</span><br><span class=\"line\">LimitCORE=infinity</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Comment TasksMax if your systemd version does not support it.</span></span><br><span class=\"line\"><span class=\"comment\"># Only systemd 226 and above support this option.</span></span><br><span class=\"line\">TasksMax=infinity</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># set delegate yes so that systemd does not reset the cgroups of docker containers</span></span><br><span class=\"line\">Delegate=<span class=\"built_in\">yes</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># kill only the docker process, not all processes in the cgroup</span></span><br><span class=\"line\">KillMode=process</span><br><span class=\"line\">OOMScoreAdjust=-500</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>docker.socket</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># vim /usr/local/docker/docker.socket</span></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Docker Socket <span class=\"keyword\">for</span> the API</span><br><span class=\"line\"></span><br><span class=\"line\">[Socket]</span><br><span class=\"line\"><span class=\"comment\"># If /var/run is not implemented as a symlink to /run, you may need to</span></span><br><span class=\"line\"><span class=\"comment\"># specify ListenStream=/var/run/docker.sock instead.</span></span><br><span class=\"line\">ListenStream=/var/run/docker.sock</span><br><span class=\"line\">SocketMode=0660</span><br><span class=\"line\">SocketUser=root</span><br><span class=\"line\">SocketGroup=docker</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=sockets.target</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-1-配置-containerd-及相关环境\"><a href=\"#3-1-配置-containerd-及相关环境\" class=\"headerlink\" title=\"3.1 配置 containerd 及相关环境\"></a>3.1 配置 containerd 及相关环境</h3><p><code>ln -s /usr/local/docker/containerd /usr/bin/</code><br><code>ln -s /usr/local/docker/dockerd /usr/bin/</code><br><code>ln -s /usr/local/docker/docker-init /usr/bin/</code><br><code>ln -s /usr/local/docker/docker-proxy /usr/bin/</code><br><code>ln -s /usr/local/docker/runc /usr/bin/</code></p>\n<h3 id=\"3-2-重载-systemd\"><a href=\"#3-2-重载-systemd\" class=\"headerlink\" title=\"3.2 重载 systemd\"></a>3.2 重载 systemd</h3><p><code>systemctl daemon-reload</code></p>\n<h3 id=\"3-3-确保-network-online-target-和-firewalld-service-正常\"><a href=\"#3-3-确保-network-online-target-和-firewalld-service-正常\" class=\"headerlink\" title=\"3.3 确保 network-online.target 和 firewalld.service 正常\"></a>3.3 确保 network-online.target 和 firewalld.service 正常</h3><p><code> systemctl status network-online.target</code><br><code> systemctl status firewalld.service</code></p>\n<h3 id=\"3-4-systemctl-配置-docker-并设置自启\"><a href=\"#3-4-systemctl-配置-docker-并设置自启\" class=\"headerlink\" title=\"3.4 systemctl 配置 docker 并设置自启\"></a>3.4 systemctl 配置 docker 并设置自启</h3><p><code> systemctl enable docker.socket --now</code><br><code> systemctl enable docker.service --now</code></p>\n<h3 id=\"3-5-方便后续操作将-docker-等软连接到-PATH\"><a href=\"#3-5-方便后续操作将-docker-等软连接到-PATH\" class=\"headerlink\" title=\"3.5 方便后续操作将 docker 等软连接到 PATH\"></a>3.5 方便后续操作将 docker 等软连接到 PATH</h3><p><code>ln -s /usr/local/docker/docker /usr/bin/</code><br><code>ln -s /usr/local/docker/dockerd /usr/bin/</code></p>\n<h2 id=\"四、-相关问题\"><a href=\"#四、-相关问题\" class=\"headerlink\" title=\"四、 相关问题\"></a>四、 相关问题</h2><h3 id=\"4-1-为什么是-usr-local-docker\"><a href=\"#4-1-为什么是-usr-local-docker\" class=\"headerlink\" title=\"4.1 为什么是 &#x2F;usr&#x2F;local&#x2F;docker\"></a>4.1 为什么是 &#x2F;usr&#x2F;local&#x2F;docker</h3><p><strong>答：</strong> 如果按照标准的FHS规范应该是&#x2F;usr&#x2F;bin等其他目录，选择&#x2F;usr&#x2F;local&#x2F;docker目录的原因方便后续的升级。</p>\n<h3 id=\"4-2-为什么要软连接containerd到-usr-bin\"><a href=\"#4-2-为什么要软连接containerd到-usr-bin\" class=\"headerlink\" title=\"4.2 为什么要软连接containerd到&#x2F;usr&#x2F;bin\"></a>4.2 为什么要软连接containerd到&#x2F;usr&#x2F;bin</h3><p><strong>答：</strong><br><img src=\"/images/046.docker_install_manual.md.02.png\" width=100% height=100% /></p>\n<h3 id=\"4-3-两种不同的-ExecStart-写法的区别\"><a href=\"#4-3-两种不同的-ExecStart-写法的区别\" class=\"headerlink\" title=\"4.3 两种不同的 ExecStart 写法的区别\"></a>4.3 两种不同的 ExecStart 写法的区别</h3><p>第一种： <code>ExecStart=/usr/local/docker/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</code></p>\n<ol>\n<li><code>-H fd</code><br> 这个参数告诉 Docker 守护进程使用文件描述符 (fd) 监听 Docker 客户端的连接。<br> 这通常用于与 Docker 代理一起使用，以便在代理与 Docker 守护进程之间建立通信。</li>\n<li><code>--containerd=/run/containerd/containerd.sock</code><br> 这个参数指定 Docker 守护进程应该使用的 containerd 服务的 Unix 套接字。<br> Containerd 是一个用于管理容器的基础设施组件，Docker 守护进程通常会与它一起工作。</li>\n</ol>\n<p>第二种： <code>ExecStart=/usr/local/docker/dockerd</code><br>        未指定参数意味着 Docker 守护进程将使用默认配置来运行，通常会监听 Unix 套接字 &#x2F;var&#x2F;run&#x2F;docker.sock 来接收 Docker 客户端的请求。<br>        即我们在<code> docker.socket</code> 里配置的路径<code>ListenStream=/var/run/docker.sock</code></p>\n<p><strong>注意：</strong> 如果需要使用<code>ExecStart=/usr/local/docker/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</code><br>需要将<code>containerd</code>注册成系统服务<br>并且在 <code>After</code> 和 <code>Wants</code> 需要引用 <code>containerd.service</code> </p>\n<h3 id=\"4-4-systemctl-另外一种管理-docker-的配置写法\"><a href=\"#4-4-systemctl-另外一种管理-docker-的配置写法\" class=\"headerlink\" title=\"4.4 systemctl 另外一种管理 docker 的配置写法\"></a>4.4 systemctl 另外一种管理 docker 的配置写法</h3><p>请注意这种写法需要将 <code>containerd</code> 注册成系统服务</p>\n<p><strong>docker.service</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Docker Application Container Engine</span><br><span class=\"line\">Documentation=https://docs.docker.com</span><br><span class=\"line\">After=network-online.target docker.socket firewalld.service containerd.service time-set.target</span><br><span class=\"line\">Wants=network-online.target containerd.service</span><br><span class=\"line\">Requires=docker.socket</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=notify</span><br><span class=\"line\">WorkingDirectory=/usr/local/docker/</span><br><span class=\"line\">ExecStart=/usr/local/docker/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br><span class=\"line\">ExecReload=/bin/kill -s HUP <span class=\"variable\">$MAINPID</span></span><br><span class=\"line\">TimeoutStartSec=0</span><br><span class=\"line\">RestartSec=2</span><br><span class=\"line\">Restart=always</span><br><span class=\"line\">StartLimitBurst=3</span><br><span class=\"line\">StartLimitInterval=60s</span><br><span class=\"line\">LimitNPROC=infinity</span><br><span class=\"line\">LimitCORE=infinity</span><br><span class=\"line\">TasksMax=infinity</span><br><span class=\"line\">Delegate=<span class=\"built_in\">yes</span></span><br><span class=\"line\">KillMode=process</span><br><span class=\"line\">OOMScoreAdjust=-500</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<p><strong>docker.socket</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Docker Socket <span class=\"keyword\">for</span> the API</span><br><span class=\"line\"></span><br><span class=\"line\">[Socket]</span><br><span class=\"line\"><span class=\"comment\"># If /var/run is not implemented as a symlink to /run, you may need to</span></span><br><span class=\"line\"><span class=\"comment\"># specify ListenStream=/var/run/docker.sock instead.</span></span><br><span class=\"line\">ListenStream=/var/run/docker.sock</span><br><span class=\"line\">SocketMode=0660</span><br><span class=\"line\">SocketUser=root</span><br><span class=\"line\">SocketGroup=docker</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=sockets.target</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、-下载-docker-二进制文件\"><a href=\"#一、-下载-docker-二进制文件\" class=\"headerlink\" title=\"一、 下载 docker 二进制文件\"></a>一、 下载 docker 二进制文件</h2><p>根据自己环境选择合适的版本：<br><a href=\"https://download.docker.com/linux/static/stable/x86_64/\">https://download.docker.com/linux/static/stable/x86_64/</a></p>\n<h2 id=\"二、-解压到-usr-local-docker\"><a href=\"#二、-解压到-usr-local-docker\" class=\"headerlink\" title=\"二、 解压到 &#x2F;usr&#x2F;local&#x2F;docker\"></a>二、 解压到 &#x2F;usr&#x2F;local&#x2F;docker</h2><p>创建docker用户及组</p>\n<p><code> groupadd docker</code><br><code> useradd -g docker docker</code></p>\n<p><code>tar -xzvf docker-19.03.1.tgz</code><br><code>mv docker /usr/local/</code></p>\n<img src=\"/images/046.docker_install_manual.md.01.png\" width=100% height=100% />\n\n<h2 id=\"三、-使用-systemctl-管理-docker-服务\"><a href=\"#三、-使用-systemctl-管理-docker-服务\" class=\"headerlink\" title=\"三、 使用 systemctl 管理 docker 服务\"></a>三、 使用 systemctl 管理 docker 服务</h2><p>文件引用自：<br><a href=\"https://github.com/moby/moby/blob/master/contrib/init/systemd/docker.service\">https://github.com/moby/moby/blob/master/contrib/init/systemd/docker.service</a></p>\n<p><strong>docker.service</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># vim /usr/local/docker/docker.service</span></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Docker Application Container Engine</span><br><span class=\"line\">Documentation=https://docs.docker.com</span><br><span class=\"line\">After=network-online.target docker.socket firewalld.service</span><br><span class=\"line\">Wants=network-online.target </span><br><span class=\"line\">Requires=docker.socket</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=notify</span><br><span class=\"line\"><span class=\"comment\"># the default is not to use systemd for cgroups because the delegate issues still</span></span><br><span class=\"line\"><span class=\"comment\"># exists and systemd currently does not support the cgroup feature set required</span></span><br><span class=\"line\"><span class=\"comment\"># for containers run by docker</span></span><br><span class=\"line\">ExecStart=/usr/local/docker/dockerd</span><br><span class=\"line\"><span class=\"comment\"># ExecStart=/usr/local/docker/dockerd -H fd:// --containerd=/run/containerd/containerd.sock  ## 注意这种配置的写法，区别在后面会介绍</span></span><br><span class=\"line\">ExecReload=/bin/kill -s HUP <span class=\"variable\">$MAINPID</span></span><br><span class=\"line\">TimeoutStartSec=0</span><br><span class=\"line\">RestartSec=2</span><br><span class=\"line\">Restart=always</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Note that StartLimit* options were moved from &quot;Service&quot; to &quot;Unit&quot; in systemd 229.</span></span><br><span class=\"line\"><span class=\"comment\"># Both the old, and new location are accepted by systemd 229 and up, so using the old location</span></span><br><span class=\"line\"><span class=\"comment\"># to make them work for either version of systemd.</span></span><br><span class=\"line\">StartLimitBurst=3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Note that StartLimitInterval was renamed to StartLimitIntervalSec in systemd 230.</span></span><br><span class=\"line\"><span class=\"comment\"># Both the old, and new name are accepted by systemd 230 and up, so using the old name to make</span></span><br><span class=\"line\"><span class=\"comment\"># this option work for either version of systemd.</span></span><br><span class=\"line\">StartLimitInterval=60s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Having non-zero Limit*s causes performance problems due to accounting overhead</span></span><br><span class=\"line\"><span class=\"comment\"># in the kernel. We recommend using cgroups to do container-local accounting.</span></span><br><span class=\"line\">LimitNPROC=infinity</span><br><span class=\"line\">LimitCORE=infinity</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Comment TasksMax if your systemd version does not support it.</span></span><br><span class=\"line\"><span class=\"comment\"># Only systemd 226 and above support this option.</span></span><br><span class=\"line\">TasksMax=infinity</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># set delegate yes so that systemd does not reset the cgroups of docker containers</span></span><br><span class=\"line\">Delegate=<span class=\"built_in\">yes</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># kill only the docker process, not all processes in the cgroup</span></span><br><span class=\"line\">KillMode=process</span><br><span class=\"line\">OOMScoreAdjust=-500</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>docker.socket</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># vim /usr/local/docker/docker.socket</span></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Docker Socket <span class=\"keyword\">for</span> the API</span><br><span class=\"line\"></span><br><span class=\"line\">[Socket]</span><br><span class=\"line\"><span class=\"comment\"># If /var/run is not implemented as a symlink to /run, you may need to</span></span><br><span class=\"line\"><span class=\"comment\"># specify ListenStream=/var/run/docker.sock instead.</span></span><br><span class=\"line\">ListenStream=/var/run/docker.sock</span><br><span class=\"line\">SocketMode=0660</span><br><span class=\"line\">SocketUser=root</span><br><span class=\"line\">SocketGroup=docker</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=sockets.target</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-1-配置-containerd-及相关环境\"><a href=\"#3-1-配置-containerd-及相关环境\" class=\"headerlink\" title=\"3.1 配置 containerd 及相关环境\"></a>3.1 配置 containerd 及相关环境</h3><p><code>ln -s /usr/local/docker/containerd /usr/bin/</code><br><code>ln -s /usr/local/docker/dockerd /usr/bin/</code><br><code>ln -s /usr/local/docker/docker-init /usr/bin/</code><br><code>ln -s /usr/local/docker/docker-proxy /usr/bin/</code><br><code>ln -s /usr/local/docker/runc /usr/bin/</code></p>\n<h3 id=\"3-2-重载-systemd\"><a href=\"#3-2-重载-systemd\" class=\"headerlink\" title=\"3.2 重载 systemd\"></a>3.2 重载 systemd</h3><p><code>systemctl daemon-reload</code></p>\n<h3 id=\"3-3-确保-network-online-target-和-firewalld-service-正常\"><a href=\"#3-3-确保-network-online-target-和-firewalld-service-正常\" class=\"headerlink\" title=\"3.3 确保 network-online.target 和 firewalld.service 正常\"></a>3.3 确保 network-online.target 和 firewalld.service 正常</h3><p><code> systemctl status network-online.target</code><br><code> systemctl status firewalld.service</code></p>\n<h3 id=\"3-4-systemctl-配置-docker-并设置自启\"><a href=\"#3-4-systemctl-配置-docker-并设置自启\" class=\"headerlink\" title=\"3.4 systemctl 配置 docker 并设置自启\"></a>3.4 systemctl 配置 docker 并设置自启</h3><p><code> systemctl enable docker.socket --now</code><br><code> systemctl enable docker.service --now</code></p>\n<h3 id=\"3-5-方便后续操作将-docker-等软连接到-PATH\"><a href=\"#3-5-方便后续操作将-docker-等软连接到-PATH\" class=\"headerlink\" title=\"3.5 方便后续操作将 docker 等软连接到 PATH\"></a>3.5 方便后续操作将 docker 等软连接到 PATH</h3><p><code>ln -s /usr/local/docker/docker /usr/bin/</code><br><code>ln -s /usr/local/docker/dockerd /usr/bin/</code></p>\n<h2 id=\"四、-相关问题\"><a href=\"#四、-相关问题\" class=\"headerlink\" title=\"四、 相关问题\"></a>四、 相关问题</h2><h3 id=\"4-1-为什么是-usr-local-docker\"><a href=\"#4-1-为什么是-usr-local-docker\" class=\"headerlink\" title=\"4.1 为什么是 &#x2F;usr&#x2F;local&#x2F;docker\"></a>4.1 为什么是 &#x2F;usr&#x2F;local&#x2F;docker</h3><p><strong>答：</strong> 如果按照标准的FHS规范应该是&#x2F;usr&#x2F;bin等其他目录，选择&#x2F;usr&#x2F;local&#x2F;docker目录的原因方便后续的升级。</p>\n<h3 id=\"4-2-为什么要软连接containerd到-usr-bin\"><a href=\"#4-2-为什么要软连接containerd到-usr-bin\" class=\"headerlink\" title=\"4.2 为什么要软连接containerd到&#x2F;usr&#x2F;bin\"></a>4.2 为什么要软连接containerd到&#x2F;usr&#x2F;bin</h3><p><strong>答：</strong><br><img src=\"/images/046.docker_install_manual.md.02.png\" width=100% height=100% /></p>\n<h3 id=\"4-3-两种不同的-ExecStart-写法的区别\"><a href=\"#4-3-两种不同的-ExecStart-写法的区别\" class=\"headerlink\" title=\"4.3 两种不同的 ExecStart 写法的区别\"></a>4.3 两种不同的 ExecStart 写法的区别</h3><p>第一种： <code>ExecStart=/usr/local/docker/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</code></p>\n<ol>\n<li><code>-H fd</code><br> 这个参数告诉 Docker 守护进程使用文件描述符 (fd) 监听 Docker 客户端的连接。<br> 这通常用于与 Docker 代理一起使用，以便在代理与 Docker 守护进程之间建立通信。</li>\n<li><code>--containerd=/run/containerd/containerd.sock</code><br> 这个参数指定 Docker 守护进程应该使用的 containerd 服务的 Unix 套接字。<br> Containerd 是一个用于管理容器的基础设施组件，Docker 守护进程通常会与它一起工作。</li>\n</ol>\n<p>第二种： <code>ExecStart=/usr/local/docker/dockerd</code><br>        未指定参数意味着 Docker 守护进程将使用默认配置来运行，通常会监听 Unix 套接字 &#x2F;var&#x2F;run&#x2F;docker.sock 来接收 Docker 客户端的请求。<br>        即我们在<code> docker.socket</code> 里配置的路径<code>ListenStream=/var/run/docker.sock</code></p>\n<p><strong>注意：</strong> 如果需要使用<code>ExecStart=/usr/local/docker/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</code><br>需要将<code>containerd</code>注册成系统服务<br>并且在 <code>After</code> 和 <code>Wants</code> 需要引用 <code>containerd.service</code> </p>\n<h3 id=\"4-4-systemctl-另外一种管理-docker-的配置写法\"><a href=\"#4-4-systemctl-另外一种管理-docker-的配置写法\" class=\"headerlink\" title=\"4.4 systemctl 另外一种管理 docker 的配置写法\"></a>4.4 systemctl 另外一种管理 docker 的配置写法</h3><p>请注意这种写法需要将 <code>containerd</code> 注册成系统服务</p>\n<p><strong>docker.service</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Docker Application Container Engine</span><br><span class=\"line\">Documentation=https://docs.docker.com</span><br><span class=\"line\">After=network-online.target docker.socket firewalld.service containerd.service time-set.target</span><br><span class=\"line\">Wants=network-online.target containerd.service</span><br><span class=\"line\">Requires=docker.socket</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=notify</span><br><span class=\"line\">WorkingDirectory=/usr/local/docker/</span><br><span class=\"line\">ExecStart=/usr/local/docker/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br><span class=\"line\">ExecReload=/bin/kill -s HUP <span class=\"variable\">$MAINPID</span></span><br><span class=\"line\">TimeoutStartSec=0</span><br><span class=\"line\">RestartSec=2</span><br><span class=\"line\">Restart=always</span><br><span class=\"line\">StartLimitBurst=3</span><br><span class=\"line\">StartLimitInterval=60s</span><br><span class=\"line\">LimitNPROC=infinity</span><br><span class=\"line\">LimitCORE=infinity</span><br><span class=\"line\">TasksMax=infinity</span><br><span class=\"line\">Delegate=<span class=\"built_in\">yes</span></span><br><span class=\"line\">KillMode=process</span><br><span class=\"line\">OOMScoreAdjust=-500</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<p><strong>docker.socket</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Docker Socket <span class=\"keyword\">for</span> the API</span><br><span class=\"line\"></span><br><span class=\"line\">[Socket]</span><br><span class=\"line\"><span class=\"comment\"># If /var/run is not implemented as a symlink to /run, you may need to</span></span><br><span class=\"line\"><span class=\"comment\"># specify ListenStream=/var/run/docker.sock instead.</span></span><br><span class=\"line\">ListenStream=/var/run/docker.sock</span><br><span class=\"line\">SocketMode=0660</span><br><span class=\"line\">SocketUser=root</span><br><span class=\"line\">SocketGroup=docker</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=sockets.target</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n"},{"title":"基于centos7.9容器 构建 nginx、tomcat、redis容器镜像","date":"2023-09-12T11:09:11.000Z","_content":"\n\n## 零、 配置 docker 自动补齐\n\n### 1 安装 bash-completion\n\n``` yum install bash-completion bash-completion-extras.noarch```\n\n### 2 下载配置文件\n\n``` curl https://raw.githubusercontent.com/docker/docker-ce/master/components/cli/contrib/completion/bash/docker -o /etc/bash_completion.d/docker.sh ```\n\n### 3 source 生效\n``` source /etc/bash_completion.d/docker.sh ```\n\n## 一、 CentOS7.9 官方镜像\n\n``` docker pull centos:centos7.9.2009 ```\n\n## 二、 使用 docker 构建 nginx镜像\n\n### 2.1 Dockerfile \n\n``` yaml\nFROM centos:centos7.9.2009\n\nMAINTAINER zhuang\n\n# 更换centos7源\nRUN sed -e 's|^mirrorlist=|#mirrorlist=|g' \\\n        -e 's|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirror.nju.edu.cn/centos|g' \\\n        -i.bak \\\n        /etc/yum.repos.d/CentOS-*.repo\n\n# nginx编译依赖 \nRUN yum install -y gcc gcc-c++ make automake autoconf libtool pcre pcre-devel zlib openssl openssl-devel\n\nWORKDIR /usr/local\n\nRUN curl -O https://nginx.org/download/nginx-1.24.0.tar.gz && \\\n    tar -xzvf nginx-1.24.0.tar.gz -C /usr/local && \\\n    mv /usr/local/nginx-1.24.0 /usr/local/nginx-1.24.0-src && \\\n    cd nginx-1.24.0-src && \\\n    ./configure --prefix=/usr/local/nginx-1.24.0 && \\\n    make && make install\n\n# 暴露Nginx\nEXPOSE 80\n\n# 启动Nginx\nCMD [\"/usr/local/nginx-1.24.0/sbin/nginx\", \"-g\", \"daemon off;\"]\n```\n\n### 2.2 build\n\n``` docker build -t nginx1.24 . ```\n\n### 2.3 run \n\n``` docker run -d -p 80:80 nginx1.24 ```\n\n<img src=\"/images/047.docker_build_instances.md.01.png\" width=100% height=100% />\n\n## 三、 使用 docker 构建 redis\n\n### 3.1 Dockerfile\n\n``` yaml\nFROM centos:centos7.9.2009\n\nMAINTAINER zhuang\n\n# 更换centos7源\nRUN sed -e 's|^mirrorlist=|#mirrorlist=|g' \\\n        -e 's|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirror.nju.edu.cn/centos|g' \\\n        -i.bak \\\n        /etc/yum.repos.d/CentOS-*.repo\n\n# redis 编译依赖 \nRUN yum -y install cpp binutils glibc glibc-kernheaders glibc-common glibc-devel gcc make gcc-c++ libstdc++-devel tcl\n\nWORKDIR /usr/local\n\nCOPY ./redis-7.2.1.tar.gz /usr/local\n\nRUN tar -xzvf redis-7.2.1.tar.gz && \\\n    cd redis-7.2.1 && \\\n    make PREFIX=/usr/local/redis7.2.1 install && \\\n    cp ./redis.conf /usr/local/redis7.2.1/redis.conf\n\n# 暴露 Redis\nEXPOSE 6379\n\n# 启动 Redis\nENTRYPOINT /usr/local/redis7.2.1/bin/redis-server /usr/local/redis7.2.1/redis.conf\n```\n\n### 3.2 build\n\n``` docker build -t redis7.2.1 . ```\n\n### 3.3 run & verification\n\n``` docker run -d -p 6379:6379 ```\n``` docker exec -it peaceful_fermi /bin/sh ```\n\n<img src=\"/images/047.docker_build_instances.md.02.png\" width=100% height=100% />\n\n\n## 四、 使用 docker 构建tomcat\n\n### 4.1 Dockerfile\n\n``` yaml\nFROM centos:centos7.9.2009\n\nMAINTAINER zhuang\n\n# # 更换centos7源\n# RUN sed -e 's|^mirrorlist=|#mirrorlist=|g' \\\n#         -e 's|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirror.nju.edu.cn/centos|g' \\\n#         -i.bak \\\n#         /etc/yum.repos.d/CentOS-*.repo\n\nADD ./apache-tomcat-8.5.93.tar.gz /usr/local/\nADD ./jdk-8u202-linux-x64.tar.gz /usr/local/\n#ADD ./setenv.sh /usr/lcoal/\n\nENV MYPATH /usr/local/\nWORKDIR $MYPATH\n\n#RUN cp setenv.sh /usr/local/apache-tomcat-8.5.93/bin/\n\n# 配置java和tomcat的环境变量\nENV JAVA_HOME /usr/local/jdk1.8.0_202\nENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar\nENV CATALINE_HOME /usr/local/apache-tomcat-8.5.93\nENV CATALINE_BASE /usr/local/apache-tomcat-8.5.93\nENV PATH $PATH:$JAVA_HOME/bin:$CATALINE_HOME/lib:$CATALINE_HOME/bin\n\n# 暴露 tomcat\nEXPOSE 8080\n\n# 启动 tomcat\nCMD /usr/local/apache-tomcat-8.5.93/bin/startup.sh && tail -F /usr/local/apache-tomcat-8.5.93/logs/catalina.out\n```\n\n### 4.2 build\n\n``` docker build -t tomcat8.5.93 . ```\n\n### 4.3 run & verification\n\n``` docker run -d -p 8080:8080 tomcat8.5.93 ```\n\n<img src=\"/images/047.docker_build_instances.md.03.png\" width=100% height=100% />\n\n\n## 五、 常见问题\n\n### 5.1 docker build 过程 yum install 报错\n\n 确保 FROM 的镜像 和 Dockerfile 里 yum 源版本对应起来。\n","source":"_posts/047.docker_build_instances.md","raw":"---\ntitle: 基于centos7.9容器 构建 nginx、tomcat、redis容器镜像\ndate: 2023-9-12 19:09:11\ncategories: \n- [Linux]\n- [Docker]\ntags: \n- docker\n- Dockerfile\n- 容器\n---\n\n\n## 零、 配置 docker 自动补齐\n\n### 1 安装 bash-completion\n\n``` yum install bash-completion bash-completion-extras.noarch```\n\n### 2 下载配置文件\n\n``` curl https://raw.githubusercontent.com/docker/docker-ce/master/components/cli/contrib/completion/bash/docker -o /etc/bash_completion.d/docker.sh ```\n\n### 3 source 生效\n``` source /etc/bash_completion.d/docker.sh ```\n\n## 一、 CentOS7.9 官方镜像\n\n``` docker pull centos:centos7.9.2009 ```\n\n## 二、 使用 docker 构建 nginx镜像\n\n### 2.1 Dockerfile \n\n``` yaml\nFROM centos:centos7.9.2009\n\nMAINTAINER zhuang\n\n# 更换centos7源\nRUN sed -e 's|^mirrorlist=|#mirrorlist=|g' \\\n        -e 's|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirror.nju.edu.cn/centos|g' \\\n        -i.bak \\\n        /etc/yum.repos.d/CentOS-*.repo\n\n# nginx编译依赖 \nRUN yum install -y gcc gcc-c++ make automake autoconf libtool pcre pcre-devel zlib openssl openssl-devel\n\nWORKDIR /usr/local\n\nRUN curl -O https://nginx.org/download/nginx-1.24.0.tar.gz && \\\n    tar -xzvf nginx-1.24.0.tar.gz -C /usr/local && \\\n    mv /usr/local/nginx-1.24.0 /usr/local/nginx-1.24.0-src && \\\n    cd nginx-1.24.0-src && \\\n    ./configure --prefix=/usr/local/nginx-1.24.0 && \\\n    make && make install\n\n# 暴露Nginx\nEXPOSE 80\n\n# 启动Nginx\nCMD [\"/usr/local/nginx-1.24.0/sbin/nginx\", \"-g\", \"daemon off;\"]\n```\n\n### 2.2 build\n\n``` docker build -t nginx1.24 . ```\n\n### 2.3 run \n\n``` docker run -d -p 80:80 nginx1.24 ```\n\n<img src=\"/images/047.docker_build_instances.md.01.png\" width=100% height=100% />\n\n## 三、 使用 docker 构建 redis\n\n### 3.1 Dockerfile\n\n``` yaml\nFROM centos:centos7.9.2009\n\nMAINTAINER zhuang\n\n# 更换centos7源\nRUN sed -e 's|^mirrorlist=|#mirrorlist=|g' \\\n        -e 's|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirror.nju.edu.cn/centos|g' \\\n        -i.bak \\\n        /etc/yum.repos.d/CentOS-*.repo\n\n# redis 编译依赖 \nRUN yum -y install cpp binutils glibc glibc-kernheaders glibc-common glibc-devel gcc make gcc-c++ libstdc++-devel tcl\n\nWORKDIR /usr/local\n\nCOPY ./redis-7.2.1.tar.gz /usr/local\n\nRUN tar -xzvf redis-7.2.1.tar.gz && \\\n    cd redis-7.2.1 && \\\n    make PREFIX=/usr/local/redis7.2.1 install && \\\n    cp ./redis.conf /usr/local/redis7.2.1/redis.conf\n\n# 暴露 Redis\nEXPOSE 6379\n\n# 启动 Redis\nENTRYPOINT /usr/local/redis7.2.1/bin/redis-server /usr/local/redis7.2.1/redis.conf\n```\n\n### 3.2 build\n\n``` docker build -t redis7.2.1 . ```\n\n### 3.3 run & verification\n\n``` docker run -d -p 6379:6379 ```\n``` docker exec -it peaceful_fermi /bin/sh ```\n\n<img src=\"/images/047.docker_build_instances.md.02.png\" width=100% height=100% />\n\n\n## 四、 使用 docker 构建tomcat\n\n### 4.1 Dockerfile\n\n``` yaml\nFROM centos:centos7.9.2009\n\nMAINTAINER zhuang\n\n# # 更换centos7源\n# RUN sed -e 's|^mirrorlist=|#mirrorlist=|g' \\\n#         -e 's|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirror.nju.edu.cn/centos|g' \\\n#         -i.bak \\\n#         /etc/yum.repos.d/CentOS-*.repo\n\nADD ./apache-tomcat-8.5.93.tar.gz /usr/local/\nADD ./jdk-8u202-linux-x64.tar.gz /usr/local/\n#ADD ./setenv.sh /usr/lcoal/\n\nENV MYPATH /usr/local/\nWORKDIR $MYPATH\n\n#RUN cp setenv.sh /usr/local/apache-tomcat-8.5.93/bin/\n\n# 配置java和tomcat的环境变量\nENV JAVA_HOME /usr/local/jdk1.8.0_202\nENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar\nENV CATALINE_HOME /usr/local/apache-tomcat-8.5.93\nENV CATALINE_BASE /usr/local/apache-tomcat-8.5.93\nENV PATH $PATH:$JAVA_HOME/bin:$CATALINE_HOME/lib:$CATALINE_HOME/bin\n\n# 暴露 tomcat\nEXPOSE 8080\n\n# 启动 tomcat\nCMD /usr/local/apache-tomcat-8.5.93/bin/startup.sh && tail -F /usr/local/apache-tomcat-8.5.93/logs/catalina.out\n```\n\n### 4.2 build\n\n``` docker build -t tomcat8.5.93 . ```\n\n### 4.3 run & verification\n\n``` docker run -d -p 8080:8080 tomcat8.5.93 ```\n\n<img src=\"/images/047.docker_build_instances.md.03.png\" width=100% height=100% />\n\n\n## 五、 常见问题\n\n### 5.1 docker build 过程 yum install 报错\n\n 确保 FROM 的镜像 和 Dockerfile 里 yum 源版本对应起来。\n","slug":"047.docker_build_instances","published":1,"updated":"2023-12-05T08:52:30.879Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzdr004fijnrbwx57cr0","content":"<h2 id=\"零、-配置-docker-自动补齐\"><a href=\"#零、-配置-docker-自动补齐\" class=\"headerlink\" title=\"零、 配置 docker 自动补齐\"></a>零、 配置 docker 自动补齐</h2><h3 id=\"1-安装-bash-completion\"><a href=\"#1-安装-bash-completion\" class=\"headerlink\" title=\"1 安装 bash-completion\"></a>1 安装 bash-completion</h3><p><code> yum install bash-completion bash-completion-extras.noarch</code></p>\n<h3 id=\"2-下载配置文件\"><a href=\"#2-下载配置文件\" class=\"headerlink\" title=\"2 下载配置文件\"></a>2 下载配置文件</h3><p><code>curl https://raw.githubusercontent.com/docker/docker-ce/master/components/cli/contrib/completion/bash/docker -o /etc/bash_completion.d/docker.sh</code></p>\n<h3 id=\"3-source-生效\"><a href=\"#3-source-生效\" class=\"headerlink\" title=\"3 source 生效\"></a>3 source 生效</h3><p><code>source /etc/bash_completion.d/docker.sh</code></p>\n<h2 id=\"一、-CentOS7-9-官方镜像\"><a href=\"#一、-CentOS7-9-官方镜像\" class=\"headerlink\" title=\"一、 CentOS7.9 官方镜像\"></a>一、 CentOS7.9 官方镜像</h2><p><code>docker pull centos:centos7.9.2009</code></p>\n<h2 id=\"二、-使用-docker-构建-nginx镜像\"><a href=\"#二、-使用-docker-构建-nginx镜像\" class=\"headerlink\" title=\"二、 使用 docker 构建 nginx镜像\"></a>二、 使用 docker 构建 nginx镜像</h2><h3 id=\"2-1-Dockerfile\"><a href=\"#2-1-Dockerfile\" class=\"headerlink\" title=\"2.1 Dockerfile\"></a>2.1 Dockerfile</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">FROM</span> <span class=\"string\">centos:centos7.9.2009</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">MAINTAINER</span> <span class=\"string\">zhuang</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 更换centos7源</span></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">sed</span> <span class=\"string\">-e</span> <span class=\"string\">&#x27;s|^mirrorlist=|#mirrorlist=|g&#x27;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">        <span class=\"string\">-e</span> <span class=\"string\">&#x27;s|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirror.nju.edu.cn/centos|g&#x27;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">        <span class=\"string\">-i.bak</span> <span class=\"string\">\\</span></span><br><span class=\"line\">        <span class=\"string\">/etc/yum.repos.d/CentOS-*.repo</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># nginx编译依赖 </span></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">yum</span> <span class=\"string\">install</span> <span class=\"string\">-y</span> <span class=\"string\">gcc</span> <span class=\"string\">gcc-c++</span> <span class=\"string\">make</span> <span class=\"string\">automake</span> <span class=\"string\">autoconf</span> <span class=\"string\">libtool</span> <span class=\"string\">pcre</span> <span class=\"string\">pcre-devel</span> <span class=\"string\">zlib</span> <span class=\"string\">openssl</span> <span class=\"string\">openssl-devel</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">WORKDIR</span> <span class=\"string\">/usr/local</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">curl</span> <span class=\"string\">-O</span> <span class=\"string\">https://nginx.org/download/nginx-1.24.0.tar.gz</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">tar</span> <span class=\"string\">-xzvf</span> <span class=\"string\">nginx-1.24.0.tar.gz</span> <span class=\"string\">-C</span> <span class=\"string\">/usr/local</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">mv</span> <span class=\"string\">/usr/local/nginx-1.24.0</span> <span class=\"string\">/usr/local/nginx-1.24.0-src</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">cd</span> <span class=\"string\">nginx-1.24.0-src</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">./configure</span> <span class=\"string\">--prefix=/usr/local/nginx-1.24.0</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">make</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">make</span> <span class=\"string\">install</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 暴露Nginx</span></span><br><span class=\"line\"><span class=\"string\">EXPOSE</span> <span class=\"number\">80</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动Nginx</span></span><br><span class=\"line\"><span class=\"string\">CMD</span> [<span class=\"string\">&quot;/usr/local/nginx-1.24.0/sbin/nginx&quot;</span>, <span class=\"string\">&quot;-g&quot;</span>, <span class=\"string\">&quot;daemon off;&quot;</span>]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-build\"><a href=\"#2-2-build\" class=\"headerlink\" title=\"2.2 build\"></a>2.2 build</h3><p><code>docker build -t nginx1.24 .</code></p>\n<h3 id=\"2-3-run\"><a href=\"#2-3-run\" class=\"headerlink\" title=\"2.3 run\"></a>2.3 run</h3><p><code>docker run -d -p 80:80 nginx1.24</code></p>\n<img src=\"/images/047.docker_build_instances.md.01.png\" width=100% height=100% />\n\n<h2 id=\"三、-使用-docker-构建-redis\"><a href=\"#三、-使用-docker-构建-redis\" class=\"headerlink\" title=\"三、 使用 docker 构建 redis\"></a>三、 使用 docker 构建 redis</h2><h3 id=\"3-1-Dockerfile\"><a href=\"#3-1-Dockerfile\" class=\"headerlink\" title=\"3.1 Dockerfile\"></a>3.1 Dockerfile</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">FROM</span> <span class=\"string\">centos:centos7.9.2009</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">MAINTAINER</span> <span class=\"string\">zhuang</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 更换centos7源</span></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">sed</span> <span class=\"string\">-e</span> <span class=\"string\">&#x27;s|^mirrorlist=|#mirrorlist=|g&#x27;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">        <span class=\"string\">-e</span> <span class=\"string\">&#x27;s|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirror.nju.edu.cn/centos|g&#x27;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">        <span class=\"string\">-i.bak</span> <span class=\"string\">\\</span></span><br><span class=\"line\">        <span class=\"string\">/etc/yum.repos.d/CentOS-*.repo</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># redis 编译依赖 </span></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">yum</span> <span class=\"string\">-y</span> <span class=\"string\">install</span> <span class=\"string\">cpp</span> <span class=\"string\">binutils</span> <span class=\"string\">glibc</span> <span class=\"string\">glibc-kernheaders</span> <span class=\"string\">glibc-common</span> <span class=\"string\">glibc-devel</span> <span class=\"string\">gcc</span> <span class=\"string\">make</span> <span class=\"string\">gcc-c++</span> <span class=\"string\">libstdc++-devel</span> <span class=\"string\">tcl</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">WORKDIR</span> <span class=\"string\">/usr/local</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">COPY</span> <span class=\"string\">./redis-7.2.1.tar.gz</span> <span class=\"string\">/usr/local</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">tar</span> <span class=\"string\">-xzvf</span> <span class=\"string\">redis-7.2.1.tar.gz</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">cd</span> <span class=\"string\">redis-7.2.1</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">make</span> <span class=\"string\">PREFIX=/usr/local/redis7.2.1</span> <span class=\"string\">install</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">cp</span> <span class=\"string\">./redis.conf</span> <span class=\"string\">/usr/local/redis7.2.1/redis.conf</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 暴露 Redis</span></span><br><span class=\"line\"><span class=\"string\">EXPOSE</span> <span class=\"number\">6379</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动 Redis</span></span><br><span class=\"line\"><span class=\"string\">ENTRYPOINT</span> <span class=\"string\">/usr/local/redis7.2.1/bin/redis-server</span> <span class=\"string\">/usr/local/redis7.2.1/redis.conf</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-2-build\"><a href=\"#3-2-build\" class=\"headerlink\" title=\"3.2 build\"></a>3.2 build</h3><p><code>docker build -t redis7.2.1 .</code></p>\n<h3 id=\"3-3-run-verification\"><a href=\"#3-3-run-verification\" class=\"headerlink\" title=\"3.3 run &amp; verification\"></a>3.3 run &amp; verification</h3><p><code>docker run -d -p 6379:6379</code><br><code>docker exec -it peaceful_fermi /bin/sh</code></p>\n<img src=\"/images/047.docker_build_instances.md.02.png\" width=100% height=100% />\n\n\n<h2 id=\"四、-使用-docker-构建tomcat\"><a href=\"#四、-使用-docker-构建tomcat\" class=\"headerlink\" title=\"四、 使用 docker 构建tomcat\"></a>四、 使用 docker 构建tomcat</h2><h3 id=\"4-1-Dockerfile\"><a href=\"#4-1-Dockerfile\" class=\"headerlink\" title=\"4.1 Dockerfile\"></a>4.1 Dockerfile</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">FROM</span> <span class=\"string\">centos:centos7.9.2009</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">MAINTAINER</span> <span class=\"string\">zhuang</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># # 更换centos7源</span></span><br><span class=\"line\"><span class=\"comment\"># RUN sed -e &#x27;s|^mirrorlist=|#mirrorlist=|g&#x27; \\</span></span><br><span class=\"line\"><span class=\"comment\">#         -e &#x27;s|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirror.nju.edu.cn/centos|g&#x27; \\</span></span><br><span class=\"line\"><span class=\"comment\">#         -i.bak \\</span></span><br><span class=\"line\"><span class=\"comment\">#         /etc/yum.repos.d/CentOS-*.repo</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">ADD</span> <span class=\"string\">./apache-tomcat-8.5.93.tar.gz</span> <span class=\"string\">/usr/local/</span></span><br><span class=\"line\"><span class=\"string\">ADD</span> <span class=\"string\">./jdk-8u202-linux-x64.tar.gz</span> <span class=\"string\">/usr/local/</span></span><br><span class=\"line\"><span class=\"comment\">#ADD ./setenv.sh /usr/lcoal/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">ENV</span> <span class=\"string\">MYPATH</span> <span class=\"string\">/usr/local/</span></span><br><span class=\"line\"><span class=\"string\">WORKDIR</span> <span class=\"string\">$MYPATH</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#RUN cp setenv.sh /usr/local/apache-tomcat-8.5.93/bin/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 配置java和tomcat的环境变量</span></span><br><span class=\"line\"><span class=\"string\">ENV</span> <span class=\"string\">JAVA_HOME</span> <span class=\"string\">/usr/local/jdk1.8.0_202</span></span><br><span class=\"line\"><span class=\"string\">ENV</span> <span class=\"string\">CLASSPATH</span> <span class=\"string\">$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span></span><br><span class=\"line\"><span class=\"string\">ENV</span> <span class=\"string\">CATALINE_HOME</span> <span class=\"string\">/usr/local/apache-tomcat-8.5.93</span></span><br><span class=\"line\"><span class=\"string\">ENV</span> <span class=\"string\">CATALINE_BASE</span> <span class=\"string\">/usr/local/apache-tomcat-8.5.93</span></span><br><span class=\"line\"><span class=\"string\">ENV</span> <span class=\"string\">PATH</span> <span class=\"string\">$PATH:$JAVA_HOME/bin:$CATALINE_HOME/lib:$CATALINE_HOME/bin</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 暴露 tomcat</span></span><br><span class=\"line\"><span class=\"string\">EXPOSE</span> <span class=\"number\">8080</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动 tomcat</span></span><br><span class=\"line\"><span class=\"string\">CMD</span> <span class=\"string\">/usr/local/apache-tomcat-8.5.93/bin/startup.sh</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">tail</span> <span class=\"string\">-F</span> <span class=\"string\">/usr/local/apache-tomcat-8.5.93/logs/catalina.out</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-2-build\"><a href=\"#4-2-build\" class=\"headerlink\" title=\"4.2 build\"></a>4.2 build</h3><p><code>docker build -t tomcat8.5.93 .</code></p>\n<h3 id=\"4-3-run-verification\"><a href=\"#4-3-run-verification\" class=\"headerlink\" title=\"4.3 run &amp; verification\"></a>4.3 run &amp; verification</h3><p><code>docker run -d -p 8080:8080 tomcat8.5.93</code></p>\n<img src=\"/images/047.docker_build_instances.md.03.png\" width=100% height=100% />\n\n\n<h2 id=\"五、-常见问题\"><a href=\"#五、-常见问题\" class=\"headerlink\" title=\"五、 常见问题\"></a>五、 常见问题</h2><h3 id=\"5-1-docker-build-过程-yum-install-报错\"><a href=\"#5-1-docker-build-过程-yum-install-报错\" class=\"headerlink\" title=\"5.1 docker build 过程 yum install 报错\"></a>5.1 docker build 过程 yum install 报错</h3><p> 确保 FROM 的镜像 和 Dockerfile 里 yum 源版本对应起来。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"零、-配置-docker-自动补齐\"><a href=\"#零、-配置-docker-自动补齐\" class=\"headerlink\" title=\"零、 配置 docker 自动补齐\"></a>零、 配置 docker 自动补齐</h2><h3 id=\"1-安装-bash-completion\"><a href=\"#1-安装-bash-completion\" class=\"headerlink\" title=\"1 安装 bash-completion\"></a>1 安装 bash-completion</h3><p><code> yum install bash-completion bash-completion-extras.noarch</code></p>\n<h3 id=\"2-下载配置文件\"><a href=\"#2-下载配置文件\" class=\"headerlink\" title=\"2 下载配置文件\"></a>2 下载配置文件</h3><p><code>curl https://raw.githubusercontent.com/docker/docker-ce/master/components/cli/contrib/completion/bash/docker -o /etc/bash_completion.d/docker.sh</code></p>\n<h3 id=\"3-source-生效\"><a href=\"#3-source-生效\" class=\"headerlink\" title=\"3 source 生效\"></a>3 source 生效</h3><p><code>source /etc/bash_completion.d/docker.sh</code></p>\n<h2 id=\"一、-CentOS7-9-官方镜像\"><a href=\"#一、-CentOS7-9-官方镜像\" class=\"headerlink\" title=\"一、 CentOS7.9 官方镜像\"></a>一、 CentOS7.9 官方镜像</h2><p><code>docker pull centos:centos7.9.2009</code></p>\n<h2 id=\"二、-使用-docker-构建-nginx镜像\"><a href=\"#二、-使用-docker-构建-nginx镜像\" class=\"headerlink\" title=\"二、 使用 docker 构建 nginx镜像\"></a>二、 使用 docker 构建 nginx镜像</h2><h3 id=\"2-1-Dockerfile\"><a href=\"#2-1-Dockerfile\" class=\"headerlink\" title=\"2.1 Dockerfile\"></a>2.1 Dockerfile</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">FROM</span> <span class=\"string\">centos:centos7.9.2009</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">MAINTAINER</span> <span class=\"string\">zhuang</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 更换centos7源</span></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">sed</span> <span class=\"string\">-e</span> <span class=\"string\">&#x27;s|^mirrorlist=|#mirrorlist=|g&#x27;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">        <span class=\"string\">-e</span> <span class=\"string\">&#x27;s|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirror.nju.edu.cn/centos|g&#x27;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">        <span class=\"string\">-i.bak</span> <span class=\"string\">\\</span></span><br><span class=\"line\">        <span class=\"string\">/etc/yum.repos.d/CentOS-*.repo</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># nginx编译依赖 </span></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">yum</span> <span class=\"string\">install</span> <span class=\"string\">-y</span> <span class=\"string\">gcc</span> <span class=\"string\">gcc-c++</span> <span class=\"string\">make</span> <span class=\"string\">automake</span> <span class=\"string\">autoconf</span> <span class=\"string\">libtool</span> <span class=\"string\">pcre</span> <span class=\"string\">pcre-devel</span> <span class=\"string\">zlib</span> <span class=\"string\">openssl</span> <span class=\"string\">openssl-devel</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">WORKDIR</span> <span class=\"string\">/usr/local</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">curl</span> <span class=\"string\">-O</span> <span class=\"string\">https://nginx.org/download/nginx-1.24.0.tar.gz</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">tar</span> <span class=\"string\">-xzvf</span> <span class=\"string\">nginx-1.24.0.tar.gz</span> <span class=\"string\">-C</span> <span class=\"string\">/usr/local</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">mv</span> <span class=\"string\">/usr/local/nginx-1.24.0</span> <span class=\"string\">/usr/local/nginx-1.24.0-src</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">cd</span> <span class=\"string\">nginx-1.24.0-src</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">./configure</span> <span class=\"string\">--prefix=/usr/local/nginx-1.24.0</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">make</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">make</span> <span class=\"string\">install</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 暴露Nginx</span></span><br><span class=\"line\"><span class=\"string\">EXPOSE</span> <span class=\"number\">80</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动Nginx</span></span><br><span class=\"line\"><span class=\"string\">CMD</span> [<span class=\"string\">&quot;/usr/local/nginx-1.24.0/sbin/nginx&quot;</span>, <span class=\"string\">&quot;-g&quot;</span>, <span class=\"string\">&quot;daemon off;&quot;</span>]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-build\"><a href=\"#2-2-build\" class=\"headerlink\" title=\"2.2 build\"></a>2.2 build</h3><p><code>docker build -t nginx1.24 .</code></p>\n<h3 id=\"2-3-run\"><a href=\"#2-3-run\" class=\"headerlink\" title=\"2.3 run\"></a>2.3 run</h3><p><code>docker run -d -p 80:80 nginx1.24</code></p>\n<img src=\"/images/047.docker_build_instances.md.01.png\" width=100% height=100% />\n\n<h2 id=\"三、-使用-docker-构建-redis\"><a href=\"#三、-使用-docker-构建-redis\" class=\"headerlink\" title=\"三、 使用 docker 构建 redis\"></a>三、 使用 docker 构建 redis</h2><h3 id=\"3-1-Dockerfile\"><a href=\"#3-1-Dockerfile\" class=\"headerlink\" title=\"3.1 Dockerfile\"></a>3.1 Dockerfile</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">FROM</span> <span class=\"string\">centos:centos7.9.2009</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">MAINTAINER</span> <span class=\"string\">zhuang</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 更换centos7源</span></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">sed</span> <span class=\"string\">-e</span> <span class=\"string\">&#x27;s|^mirrorlist=|#mirrorlist=|g&#x27;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">        <span class=\"string\">-e</span> <span class=\"string\">&#x27;s|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirror.nju.edu.cn/centos|g&#x27;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">        <span class=\"string\">-i.bak</span> <span class=\"string\">\\</span></span><br><span class=\"line\">        <span class=\"string\">/etc/yum.repos.d/CentOS-*.repo</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># redis 编译依赖 </span></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">yum</span> <span class=\"string\">-y</span> <span class=\"string\">install</span> <span class=\"string\">cpp</span> <span class=\"string\">binutils</span> <span class=\"string\">glibc</span> <span class=\"string\">glibc-kernheaders</span> <span class=\"string\">glibc-common</span> <span class=\"string\">glibc-devel</span> <span class=\"string\">gcc</span> <span class=\"string\">make</span> <span class=\"string\">gcc-c++</span> <span class=\"string\">libstdc++-devel</span> <span class=\"string\">tcl</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">WORKDIR</span> <span class=\"string\">/usr/local</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">COPY</span> <span class=\"string\">./redis-7.2.1.tar.gz</span> <span class=\"string\">/usr/local</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">tar</span> <span class=\"string\">-xzvf</span> <span class=\"string\">redis-7.2.1.tar.gz</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">cd</span> <span class=\"string\">redis-7.2.1</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">make</span> <span class=\"string\">PREFIX=/usr/local/redis7.2.1</span> <span class=\"string\">install</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">cp</span> <span class=\"string\">./redis.conf</span> <span class=\"string\">/usr/local/redis7.2.1/redis.conf</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 暴露 Redis</span></span><br><span class=\"line\"><span class=\"string\">EXPOSE</span> <span class=\"number\">6379</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动 Redis</span></span><br><span class=\"line\"><span class=\"string\">ENTRYPOINT</span> <span class=\"string\">/usr/local/redis7.2.1/bin/redis-server</span> <span class=\"string\">/usr/local/redis7.2.1/redis.conf</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-2-build\"><a href=\"#3-2-build\" class=\"headerlink\" title=\"3.2 build\"></a>3.2 build</h3><p><code>docker build -t redis7.2.1 .</code></p>\n<h3 id=\"3-3-run-verification\"><a href=\"#3-3-run-verification\" class=\"headerlink\" title=\"3.3 run &amp; verification\"></a>3.3 run &amp; verification</h3><p><code>docker run -d -p 6379:6379</code><br><code>docker exec -it peaceful_fermi /bin/sh</code></p>\n<img src=\"/images/047.docker_build_instances.md.02.png\" width=100% height=100% />\n\n\n<h2 id=\"四、-使用-docker-构建tomcat\"><a href=\"#四、-使用-docker-构建tomcat\" class=\"headerlink\" title=\"四、 使用 docker 构建tomcat\"></a>四、 使用 docker 构建tomcat</h2><h3 id=\"4-1-Dockerfile\"><a href=\"#4-1-Dockerfile\" class=\"headerlink\" title=\"4.1 Dockerfile\"></a>4.1 Dockerfile</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">FROM</span> <span class=\"string\">centos:centos7.9.2009</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">MAINTAINER</span> <span class=\"string\">zhuang</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># # 更换centos7源</span></span><br><span class=\"line\"><span class=\"comment\"># RUN sed -e &#x27;s|^mirrorlist=|#mirrorlist=|g&#x27; \\</span></span><br><span class=\"line\"><span class=\"comment\">#         -e &#x27;s|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirror.nju.edu.cn/centos|g&#x27; \\</span></span><br><span class=\"line\"><span class=\"comment\">#         -i.bak \\</span></span><br><span class=\"line\"><span class=\"comment\">#         /etc/yum.repos.d/CentOS-*.repo</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">ADD</span> <span class=\"string\">./apache-tomcat-8.5.93.tar.gz</span> <span class=\"string\">/usr/local/</span></span><br><span class=\"line\"><span class=\"string\">ADD</span> <span class=\"string\">./jdk-8u202-linux-x64.tar.gz</span> <span class=\"string\">/usr/local/</span></span><br><span class=\"line\"><span class=\"comment\">#ADD ./setenv.sh /usr/lcoal/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">ENV</span> <span class=\"string\">MYPATH</span> <span class=\"string\">/usr/local/</span></span><br><span class=\"line\"><span class=\"string\">WORKDIR</span> <span class=\"string\">$MYPATH</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#RUN cp setenv.sh /usr/local/apache-tomcat-8.5.93/bin/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 配置java和tomcat的环境变量</span></span><br><span class=\"line\"><span class=\"string\">ENV</span> <span class=\"string\">JAVA_HOME</span> <span class=\"string\">/usr/local/jdk1.8.0_202</span></span><br><span class=\"line\"><span class=\"string\">ENV</span> <span class=\"string\">CLASSPATH</span> <span class=\"string\">$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span></span><br><span class=\"line\"><span class=\"string\">ENV</span> <span class=\"string\">CATALINE_HOME</span> <span class=\"string\">/usr/local/apache-tomcat-8.5.93</span></span><br><span class=\"line\"><span class=\"string\">ENV</span> <span class=\"string\">CATALINE_BASE</span> <span class=\"string\">/usr/local/apache-tomcat-8.5.93</span></span><br><span class=\"line\"><span class=\"string\">ENV</span> <span class=\"string\">PATH</span> <span class=\"string\">$PATH:$JAVA_HOME/bin:$CATALINE_HOME/lib:$CATALINE_HOME/bin</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 暴露 tomcat</span></span><br><span class=\"line\"><span class=\"string\">EXPOSE</span> <span class=\"number\">8080</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动 tomcat</span></span><br><span class=\"line\"><span class=\"string\">CMD</span> <span class=\"string\">/usr/local/apache-tomcat-8.5.93/bin/startup.sh</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">tail</span> <span class=\"string\">-F</span> <span class=\"string\">/usr/local/apache-tomcat-8.5.93/logs/catalina.out</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-2-build\"><a href=\"#4-2-build\" class=\"headerlink\" title=\"4.2 build\"></a>4.2 build</h3><p><code>docker build -t tomcat8.5.93 .</code></p>\n<h3 id=\"4-3-run-verification\"><a href=\"#4-3-run-verification\" class=\"headerlink\" title=\"4.3 run &amp; verification\"></a>4.3 run &amp; verification</h3><p><code>docker run -d -p 8080:8080 tomcat8.5.93</code></p>\n<img src=\"/images/047.docker_build_instances.md.03.png\" width=100% height=100% />\n\n\n<h2 id=\"五、-常见问题\"><a href=\"#五、-常见问题\" class=\"headerlink\" title=\"五、 常见问题\"></a>五、 常见问题</h2><h3 id=\"5-1-docker-build-过程-yum-install-报错\"><a href=\"#5-1-docker-build-过程-yum-install-报错\" class=\"headerlink\" title=\"5.1 docker build 过程 yum install 报错\"></a>5.1 docker build 过程 yum install 报错</h3><p> 确保 FROM 的镜像 和 Dockerfile 里 yum 源版本对应起来。</p>\n"},{"title":"CentOS7.9 降级 7.2","date":"2023-09-15T09:06:55.000Z","_content":"\n一开始我以为会有很多有依赖问题，先做了DVD挂载然后制作离线yum源， 结果就这两个包降级了就行了。\n\n``` yum downgrade initscripts-9.49.30-1.el7.x86_64 centos-release-7-2.1511.el7.centos.2.10.x86_64 ```\n\n\n\n\n## 离线源制作\n\n### 1. 挂载镜像文件\n\n<img src=\"/images/049.centos_downgrade.md.01.png\" width=100% height=100% />\n\n### 2. centos 里将镜像挂载到指定目录\n\n``` ls /dev/cdrom ```\n``` mount -t iso9660 -o loop /dev/cdrom /mnt/cdrom/ ```\n\n如果你想开机自动挂载\n```vim /etc/fstab```\n``` /dev/cdrom /mnt/cdrom iso9660 defaults 0 0```\n\n\n### 3. yum 源编写\n\n``` vim /etc/yum.repos.d/centos7.2-old.repo```\n\n``` shell\n# vim centos7.2-old.repo\n[centos7.2-old]\nname=centos7.2-old\nbaseurl=file:///mnt/cdrom\nenable=1\ngpgcheck=0\n```\n\n```yum makecache ```\n\n### 4. 查看源里的软件包信息\n\n```yum repo-pkgs centos7.2-old list | grep \"centos-release\"```\n\n```yum --disablerepo \"*\" --enablerepo centos7.2-old list | grep \"centos-release\"```","source":"_posts/049.centos_downgrade.md","raw":"---\ntitle: CentOS7.9 降级 7.2\ndate: 2023-9-15 17:06:55\ncategories: \n- [Linux]\ntags: \n- centos\n- downgrade\n---\n\n一开始我以为会有很多有依赖问题，先做了DVD挂载然后制作离线yum源， 结果就这两个包降级了就行了。\n\n``` yum downgrade initscripts-9.49.30-1.el7.x86_64 centos-release-7-2.1511.el7.centos.2.10.x86_64 ```\n\n\n\n\n## 离线源制作\n\n### 1. 挂载镜像文件\n\n<img src=\"/images/049.centos_downgrade.md.01.png\" width=100% height=100% />\n\n### 2. centos 里将镜像挂载到指定目录\n\n``` ls /dev/cdrom ```\n``` mount -t iso9660 -o loop /dev/cdrom /mnt/cdrom/ ```\n\n如果你想开机自动挂载\n```vim /etc/fstab```\n``` /dev/cdrom /mnt/cdrom iso9660 defaults 0 0```\n\n\n### 3. yum 源编写\n\n``` vim /etc/yum.repos.d/centos7.2-old.repo```\n\n``` shell\n# vim centos7.2-old.repo\n[centos7.2-old]\nname=centos7.2-old\nbaseurl=file:///mnt/cdrom\nenable=1\ngpgcheck=0\n```\n\n```yum makecache ```\n\n### 4. 查看源里的软件包信息\n\n```yum repo-pkgs centos7.2-old list | grep \"centos-release\"```\n\n```yum --disablerepo \"*\" --enablerepo centos7.2-old list | grep \"centos-release\"```","slug":"049.centos_downgrade","published":1,"updated":"2023-12-05T08:52:30.879Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzdv004iijnrewh7aqvb","content":"<p>一开始我以为会有很多有依赖问题，先做了DVD挂载然后制作离线yum源， 结果就这两个包降级了就行了。</p>\n<p><code>yum downgrade initscripts-9.49.30-1.el7.x86_64 centos-release-7-2.1511.el7.centos.2.10.x86_64</code></p>\n<h2 id=\"离线源制作\"><a href=\"#离线源制作\" class=\"headerlink\" title=\"离线源制作\"></a>离线源制作</h2><h3 id=\"1-挂载镜像文件\"><a href=\"#1-挂载镜像文件\" class=\"headerlink\" title=\"1. 挂载镜像文件\"></a>1. 挂载镜像文件</h3><img src=\"/images/049.centos_downgrade.md.01.png\" width=100% height=100% />\n\n<h3 id=\"2-centos-里将镜像挂载到指定目录\"><a href=\"#2-centos-里将镜像挂载到指定目录\" class=\"headerlink\" title=\"2. centos 里将镜像挂载到指定目录\"></a>2. centos 里将镜像挂载到指定目录</h3><p><code>ls /dev/cdrom</code><br><code>mount -t iso9660 -o loop /dev/cdrom /mnt/cdrom/</code></p>\n<p>如果你想开机自动挂载<br><code>vim /etc/fstab</code><br><code> /dev/cdrom /mnt/cdrom iso9660 defaults 0 0</code></p>\n<h3 id=\"3-yum-源编写\"><a href=\"#3-yum-源编写\" class=\"headerlink\" title=\"3. yum 源编写\"></a>3. yum 源编写</h3><p><code> vim /etc/yum.repos.d/centos7.2-old.repo</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">vim centos7.2-old.repo</span></span><br><span class=\"line\">[centos7.2-old]</span><br><span class=\"line\">name=centos7.2-old</span><br><span class=\"line\">baseurl=file:///mnt/cdrom</span><br><span class=\"line\">enable=1</span><br><span class=\"line\">gpgcheck=0</span><br></pre></td></tr></table></figure>\n\n<p><code>yum makecache </code></p>\n<h3 id=\"4-查看源里的软件包信息\"><a href=\"#4-查看源里的软件包信息\" class=\"headerlink\" title=\"4. 查看源里的软件包信息\"></a>4. 查看源里的软件包信息</h3><p><code>yum repo-pkgs centos7.2-old list | grep &quot;centos-release&quot;</code></p>\n<p><code>yum --disablerepo &quot;*&quot; --enablerepo centos7.2-old list | grep &quot;centos-release&quot;</code></p>\n","site":{"data":{}},"excerpt":"","more":"<p>一开始我以为会有很多有依赖问题，先做了DVD挂载然后制作离线yum源， 结果就这两个包降级了就行了。</p>\n<p><code>yum downgrade initscripts-9.49.30-1.el7.x86_64 centos-release-7-2.1511.el7.centos.2.10.x86_64</code></p>\n<h2 id=\"离线源制作\"><a href=\"#离线源制作\" class=\"headerlink\" title=\"离线源制作\"></a>离线源制作</h2><h3 id=\"1-挂载镜像文件\"><a href=\"#1-挂载镜像文件\" class=\"headerlink\" title=\"1. 挂载镜像文件\"></a>1. 挂载镜像文件</h3><img src=\"/images/049.centos_downgrade.md.01.png\" width=100% height=100% />\n\n<h3 id=\"2-centos-里将镜像挂载到指定目录\"><a href=\"#2-centos-里将镜像挂载到指定目录\" class=\"headerlink\" title=\"2. centos 里将镜像挂载到指定目录\"></a>2. centos 里将镜像挂载到指定目录</h3><p><code>ls /dev/cdrom</code><br><code>mount -t iso9660 -o loop /dev/cdrom /mnt/cdrom/</code></p>\n<p>如果你想开机自动挂载<br><code>vim /etc/fstab</code><br><code> /dev/cdrom /mnt/cdrom iso9660 defaults 0 0</code></p>\n<h3 id=\"3-yum-源编写\"><a href=\"#3-yum-源编写\" class=\"headerlink\" title=\"3. yum 源编写\"></a>3. yum 源编写</h3><p><code> vim /etc/yum.repos.d/centos7.2-old.repo</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">vim centos7.2-old.repo</span></span><br><span class=\"line\">[centos7.2-old]</span><br><span class=\"line\">name=centos7.2-old</span><br><span class=\"line\">baseurl=file:///mnt/cdrom</span><br><span class=\"line\">enable=1</span><br><span class=\"line\">gpgcheck=0</span><br></pre></td></tr></table></figure>\n\n<p><code>yum makecache </code></p>\n<h3 id=\"4-查看源里的软件包信息\"><a href=\"#4-查看源里的软件包信息\" class=\"headerlink\" title=\"4. 查看源里的软件包信息\"></a>4. 查看源里的软件包信息</h3><p><code>yum repo-pkgs centos7.2-old list | grep &quot;centos-release&quot;</code></p>\n<p><code>yum --disablerepo &quot;*&quot; --enablerepo centos7.2-old list | grep &quot;centos-release&quot;</code></p>\n"},{"title":"Docker registry私有仓库搭建(https)","date":"2023-09-20T08:04:56.000Z","_content":"\n\n## 一、 registry 配置文件\n\nPATH: ```/etc/docker/registry/config.yml```\n``` yaml\nversion: 0.1\nlog:\n  accesslog:\n    disabled: true\n  level: debug\n  formatter: text\n  fields:\n    service: registry\n    environment: staging\nstorage:\n  delete:\n    enabled: true\n  cache:\n    blobdescriptor: inmemory\n  filesystem:\n    rootdirectory: /var/lib/registry\nauth:\n  htpasswd:\n    realm: basic-realm\n    path: /etc/docker/registry/auth/nginx.htpasswd   ## 密码文件\nhttp:\n  addr: :5000                                        ## 端口\n  host: https://docker.domain.com                    ## 域名  \n  headers:\n    X-Content-Type-Options: [nosniff]\n  http2:\n    disabled: false\n  tls:\n    certificate: /etc/docker/registry/ssl/docker.domain.com.crt  ## 公钥\n    key: /etc/docker/registry/ssl/docker.domain.com.key          ## 私钥\nhealth:\n  storagedriver:\n    enabled: true\n    interval: 10s\nthreshold: 3\n```\n\n\n## 二、 registry docker-compose配置\n\nPATH: ```/usr/local/docker/docker-compose/registry.yaml ```\n``` yaml\nversion: \"3\"\nservices: \n    registry:\n        image: registry:latest\n        ports:\n            - \"443:5000\"\n        container_name: registry\n        restart: always\n        volumes:\n            - /etc/docker/registry:/etc/docker/registry\n            - /var/lib/registry:/var/lib/registry    \n        networks:\n            - \"my-network\"\nnetworks:\n    my-network:\n        driver: bridge\n```\n\n\n## 三、配置 http 认证文件\n\n``` bash\ndocker run --rm \\\n    --entrypoint htpasswd \\\n    httpd:alpine \\\n    -Bbn $USERNAME $PASSWORD > /etc/docker/registry/auth/nginx.htpasswd\n```\n\n\n## 四、 https证书文件\n\n**自签https证书， 推荐ZeroSSL申请免费证书**\n\n<img src=\"/images/050.registry_setup.md.01.png\" width=100% height=100% />\n\n公钥： ```/etc/docker/registry/ssl/docker.domain.com.crt```\n私钥： ```/etc/docker/registry/ssl/docker.domain.com.key```   \n请求： ```/etc/docker/registry/ssl/docker.domain.com.csr```\n\n\n## 五、 完成部署\n\n### 5.1 启动 registry\n\n``` docker-compose -f /usr/local/docker/docker-compose/registry.yaml up -d ```\n\n### 5.2 修改 hosts \n\n``` vim /etc/hosts ```\n``` 127.0.0.1 docker.domain.com```\n\n\n### 5.3 测试 register\n\n浏览器访问或者curl  https://docker.domain.com\n\n\n### 5.4 登录\n<img src=\"/images/050.registry_setup.md.02.png\" width=100% height=100% />\n","source":"_posts/050.registry_setup.md","raw":"---\ntitle: Docker registry私有仓库搭建(https)\ndate: 2023-9-20 16:04:56\ncategories: \n- [Docker]\ntags: \n- docker\n- registry\n---\n\n\n## 一、 registry 配置文件\n\nPATH: ```/etc/docker/registry/config.yml```\n``` yaml\nversion: 0.1\nlog:\n  accesslog:\n    disabled: true\n  level: debug\n  formatter: text\n  fields:\n    service: registry\n    environment: staging\nstorage:\n  delete:\n    enabled: true\n  cache:\n    blobdescriptor: inmemory\n  filesystem:\n    rootdirectory: /var/lib/registry\nauth:\n  htpasswd:\n    realm: basic-realm\n    path: /etc/docker/registry/auth/nginx.htpasswd   ## 密码文件\nhttp:\n  addr: :5000                                        ## 端口\n  host: https://docker.domain.com                    ## 域名  \n  headers:\n    X-Content-Type-Options: [nosniff]\n  http2:\n    disabled: false\n  tls:\n    certificate: /etc/docker/registry/ssl/docker.domain.com.crt  ## 公钥\n    key: /etc/docker/registry/ssl/docker.domain.com.key          ## 私钥\nhealth:\n  storagedriver:\n    enabled: true\n    interval: 10s\nthreshold: 3\n```\n\n\n## 二、 registry docker-compose配置\n\nPATH: ```/usr/local/docker/docker-compose/registry.yaml ```\n``` yaml\nversion: \"3\"\nservices: \n    registry:\n        image: registry:latest\n        ports:\n            - \"443:5000\"\n        container_name: registry\n        restart: always\n        volumes:\n            - /etc/docker/registry:/etc/docker/registry\n            - /var/lib/registry:/var/lib/registry    \n        networks:\n            - \"my-network\"\nnetworks:\n    my-network:\n        driver: bridge\n```\n\n\n## 三、配置 http 认证文件\n\n``` bash\ndocker run --rm \\\n    --entrypoint htpasswd \\\n    httpd:alpine \\\n    -Bbn $USERNAME $PASSWORD > /etc/docker/registry/auth/nginx.htpasswd\n```\n\n\n## 四、 https证书文件\n\n**自签https证书， 推荐ZeroSSL申请免费证书**\n\n<img src=\"/images/050.registry_setup.md.01.png\" width=100% height=100% />\n\n公钥： ```/etc/docker/registry/ssl/docker.domain.com.crt```\n私钥： ```/etc/docker/registry/ssl/docker.domain.com.key```   \n请求： ```/etc/docker/registry/ssl/docker.domain.com.csr```\n\n\n## 五、 完成部署\n\n### 5.1 启动 registry\n\n``` docker-compose -f /usr/local/docker/docker-compose/registry.yaml up -d ```\n\n### 5.2 修改 hosts \n\n``` vim /etc/hosts ```\n``` 127.0.0.1 docker.domain.com```\n\n\n### 5.3 测试 register\n\n浏览器访问或者curl  https://docker.domain.com\n\n\n### 5.4 登录\n<img src=\"/images/050.registry_setup.md.02.png\" width=100% height=100% />\n","slug":"050.registry_setup","published":1,"updated":"2023-12-05T08:52:30.879Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzdy004lijnr94ohczsz","content":"<h2 id=\"一、-registry-配置文件\"><a href=\"#一、-registry-配置文件\" class=\"headerlink\" title=\"一、 registry 配置文件\"></a>一、 registry 配置文件</h2><p>PATH: <code>/etc/docker/registry/config.yml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"number\">0.1</span></span><br><span class=\"line\"><span class=\"attr\">log:</span></span><br><span class=\"line\">  <span class=\"attr\">accesslog:</span></span><br><span class=\"line\">    <span class=\"attr\">disabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">level:</span> <span class=\"string\">debug</span></span><br><span class=\"line\">  <span class=\"attr\">formatter:</span> <span class=\"string\">text</span></span><br><span class=\"line\">  <span class=\"attr\">fields:</span></span><br><span class=\"line\">    <span class=\"attr\">service:</span> <span class=\"string\">registry</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span> <span class=\"string\">staging</span></span><br><span class=\"line\"><span class=\"attr\">storage:</span></span><br><span class=\"line\">  <span class=\"attr\">delete:</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">cache:</span></span><br><span class=\"line\">    <span class=\"attr\">blobdescriptor:</span> <span class=\"string\">inmemory</span></span><br><span class=\"line\">  <span class=\"attr\">filesystem:</span></span><br><span class=\"line\">    <span class=\"attr\">rootdirectory:</span> <span class=\"string\">/var/lib/registry</span></span><br><span class=\"line\"><span class=\"attr\">auth:</span></span><br><span class=\"line\">  <span class=\"attr\">htpasswd:</span></span><br><span class=\"line\">    <span class=\"attr\">realm:</span> <span class=\"string\">basic-realm</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">/etc/docker/registry/auth/nginx.htpasswd</span>   <span class=\"comment\">## 密码文件</span></span><br><span class=\"line\"><span class=\"attr\">http:</span></span><br><span class=\"line\">  <span class=\"attr\">addr:</span> <span class=\"string\">:5000</span>                                        <span class=\"comment\">## 端口</span></span><br><span class=\"line\">  <span class=\"attr\">host:</span> <span class=\"string\">https://docker.domain.com</span>                    <span class=\"comment\">## 域名  </span></span><br><span class=\"line\">  <span class=\"attr\">headers:</span></span><br><span class=\"line\">    <span class=\"attr\">X-Content-Type-Options:</span> [<span class=\"string\">nosniff</span>]</span><br><span class=\"line\">  <span class=\"attr\">http2:</span></span><br><span class=\"line\">    <span class=\"attr\">disabled:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">tls:</span></span><br><span class=\"line\">    <span class=\"attr\">certificate:</span> <span class=\"string\">/etc/docker/registry/ssl/docker.domain.com.crt</span>  <span class=\"comment\">## 公钥</span></span><br><span class=\"line\">    <span class=\"attr\">key:</span> <span class=\"string\">/etc/docker/registry/ssl/docker.domain.com.key</span>          <span class=\"comment\">## 私钥</span></span><br><span class=\"line\"><span class=\"attr\">health:</span></span><br><span class=\"line\">  <span class=\"attr\">storagedriver:</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">interval:</span> <span class=\"string\">10s</span></span><br><span class=\"line\"><span class=\"attr\">threshold:</span> <span class=\"number\">3</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"二、-registry-docker-compose配置\"><a href=\"#二、-registry-docker-compose配置\" class=\"headerlink\" title=\"二、 registry docker-compose配置\"></a>二、 registry docker-compose配置</h2><p>PATH: <code>/usr/local/docker/docker-compose/registry.yaml </code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span> </span><br><span class=\"line\">    <span class=\"attr\">registry:</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">registry:latest</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;443:5000&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">container_name:</span> <span class=\"string\">registry</span></span><br><span class=\"line\">        <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">        <span class=\"attr\">volumes:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">/etc/docker/registry:/etc/docker/registry</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">/var/lib/registry:/var/lib/registry</span>    </span><br><span class=\"line\">        <span class=\"attr\">networks:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;my-network&quot;</span></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">    <span class=\"attr\">my-network:</span></span><br><span class=\"line\">        <span class=\"attr\">driver:</span> <span class=\"string\">bridge</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"三、配置-http-认证文件\"><a href=\"#三、配置-http-认证文件\" class=\"headerlink\" title=\"三、配置 http 认证文件\"></a>三、配置 http 认证文件</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker run --<span class=\"built_in\">rm</span> \\</span><br><span class=\"line\">    --entrypoint htpasswd \\</span><br><span class=\"line\">    httpd:alpine \\</span><br><span class=\"line\">    -Bbn <span class=\"variable\">$USERNAME</span> <span class=\"variable\">$PASSWORD</span> &gt; /etc/docker/registry/auth/nginx.htpasswd</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"四、-https证书文件\"><a href=\"#四、-https证书文件\" class=\"headerlink\" title=\"四、 https证书文件\"></a>四、 https证书文件</h2><p><strong>自签https证书， 推荐ZeroSSL申请免费证书</strong></p>\n<img src=\"/images/050.registry_setup.md.01.png\" width=100% height=100% />\n\n<p>公钥： <code>/etc/docker/registry/ssl/docker.domain.com.crt</code><br>私钥： <code>/etc/docker/registry/ssl/docker.domain.com.key</code><br>请求： <code>/etc/docker/registry/ssl/docker.domain.com.csr</code></p>\n<h2 id=\"五、-完成部署\"><a href=\"#五、-完成部署\" class=\"headerlink\" title=\"五、 完成部署\"></a>五、 完成部署</h2><h3 id=\"5-1-启动-registry\"><a href=\"#5-1-启动-registry\" class=\"headerlink\" title=\"5.1 启动 registry\"></a>5.1 启动 registry</h3><p><code>docker-compose -f /usr/local/docker/docker-compose/registry.yaml up -d</code></p>\n<h3 id=\"5-2-修改-hosts\"><a href=\"#5-2-修改-hosts\" class=\"headerlink\" title=\"5.2 修改 hosts\"></a>5.2 修改 hosts</h3><p><code>vim /etc/hosts</code><br><code> 127.0.0.1 docker.domain.com</code></p>\n<h3 id=\"5-3-测试-register\"><a href=\"#5-3-测试-register\" class=\"headerlink\" title=\"5.3 测试 register\"></a>5.3 测试 register</h3><p>浏览器访问或者curl  <a href=\"https://docker.domain.com/\">https://docker.domain.com</a></p>\n<h3 id=\"5-4-登录\"><a href=\"#5-4-登录\" class=\"headerlink\" title=\"5.4 登录\"></a>5.4 登录</h3><img src=\"/images/050.registry_setup.md.02.png\" width=100% height=100% />\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、-registry-配置文件\"><a href=\"#一、-registry-配置文件\" class=\"headerlink\" title=\"一、 registry 配置文件\"></a>一、 registry 配置文件</h2><p>PATH: <code>/etc/docker/registry/config.yml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"number\">0.1</span></span><br><span class=\"line\"><span class=\"attr\">log:</span></span><br><span class=\"line\">  <span class=\"attr\">accesslog:</span></span><br><span class=\"line\">    <span class=\"attr\">disabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">level:</span> <span class=\"string\">debug</span></span><br><span class=\"line\">  <span class=\"attr\">formatter:</span> <span class=\"string\">text</span></span><br><span class=\"line\">  <span class=\"attr\">fields:</span></span><br><span class=\"line\">    <span class=\"attr\">service:</span> <span class=\"string\">registry</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span> <span class=\"string\">staging</span></span><br><span class=\"line\"><span class=\"attr\">storage:</span></span><br><span class=\"line\">  <span class=\"attr\">delete:</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">cache:</span></span><br><span class=\"line\">    <span class=\"attr\">blobdescriptor:</span> <span class=\"string\">inmemory</span></span><br><span class=\"line\">  <span class=\"attr\">filesystem:</span></span><br><span class=\"line\">    <span class=\"attr\">rootdirectory:</span> <span class=\"string\">/var/lib/registry</span></span><br><span class=\"line\"><span class=\"attr\">auth:</span></span><br><span class=\"line\">  <span class=\"attr\">htpasswd:</span></span><br><span class=\"line\">    <span class=\"attr\">realm:</span> <span class=\"string\">basic-realm</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">/etc/docker/registry/auth/nginx.htpasswd</span>   <span class=\"comment\">## 密码文件</span></span><br><span class=\"line\"><span class=\"attr\">http:</span></span><br><span class=\"line\">  <span class=\"attr\">addr:</span> <span class=\"string\">:5000</span>                                        <span class=\"comment\">## 端口</span></span><br><span class=\"line\">  <span class=\"attr\">host:</span> <span class=\"string\">https://docker.domain.com</span>                    <span class=\"comment\">## 域名  </span></span><br><span class=\"line\">  <span class=\"attr\">headers:</span></span><br><span class=\"line\">    <span class=\"attr\">X-Content-Type-Options:</span> [<span class=\"string\">nosniff</span>]</span><br><span class=\"line\">  <span class=\"attr\">http2:</span></span><br><span class=\"line\">    <span class=\"attr\">disabled:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">tls:</span></span><br><span class=\"line\">    <span class=\"attr\">certificate:</span> <span class=\"string\">/etc/docker/registry/ssl/docker.domain.com.crt</span>  <span class=\"comment\">## 公钥</span></span><br><span class=\"line\">    <span class=\"attr\">key:</span> <span class=\"string\">/etc/docker/registry/ssl/docker.domain.com.key</span>          <span class=\"comment\">## 私钥</span></span><br><span class=\"line\"><span class=\"attr\">health:</span></span><br><span class=\"line\">  <span class=\"attr\">storagedriver:</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">interval:</span> <span class=\"string\">10s</span></span><br><span class=\"line\"><span class=\"attr\">threshold:</span> <span class=\"number\">3</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"二、-registry-docker-compose配置\"><a href=\"#二、-registry-docker-compose配置\" class=\"headerlink\" title=\"二、 registry docker-compose配置\"></a>二、 registry docker-compose配置</h2><p>PATH: <code>/usr/local/docker/docker-compose/registry.yaml </code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span> </span><br><span class=\"line\">    <span class=\"attr\">registry:</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">registry:latest</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;443:5000&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">container_name:</span> <span class=\"string\">registry</span></span><br><span class=\"line\">        <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">        <span class=\"attr\">volumes:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">/etc/docker/registry:/etc/docker/registry</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">/var/lib/registry:/var/lib/registry</span>    </span><br><span class=\"line\">        <span class=\"attr\">networks:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;my-network&quot;</span></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">    <span class=\"attr\">my-network:</span></span><br><span class=\"line\">        <span class=\"attr\">driver:</span> <span class=\"string\">bridge</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"三、配置-http-认证文件\"><a href=\"#三、配置-http-认证文件\" class=\"headerlink\" title=\"三、配置 http 认证文件\"></a>三、配置 http 认证文件</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker run --<span class=\"built_in\">rm</span> \\</span><br><span class=\"line\">    --entrypoint htpasswd \\</span><br><span class=\"line\">    httpd:alpine \\</span><br><span class=\"line\">    -Bbn <span class=\"variable\">$USERNAME</span> <span class=\"variable\">$PASSWORD</span> &gt; /etc/docker/registry/auth/nginx.htpasswd</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"四、-https证书文件\"><a href=\"#四、-https证书文件\" class=\"headerlink\" title=\"四、 https证书文件\"></a>四、 https证书文件</h2><p><strong>自签https证书， 推荐ZeroSSL申请免费证书</strong></p>\n<img src=\"/images/050.registry_setup.md.01.png\" width=100% height=100% />\n\n<p>公钥： <code>/etc/docker/registry/ssl/docker.domain.com.crt</code><br>私钥： <code>/etc/docker/registry/ssl/docker.domain.com.key</code><br>请求： <code>/etc/docker/registry/ssl/docker.domain.com.csr</code></p>\n<h2 id=\"五、-完成部署\"><a href=\"#五、-完成部署\" class=\"headerlink\" title=\"五、 完成部署\"></a>五、 完成部署</h2><h3 id=\"5-1-启动-registry\"><a href=\"#5-1-启动-registry\" class=\"headerlink\" title=\"5.1 启动 registry\"></a>5.1 启动 registry</h3><p><code>docker-compose -f /usr/local/docker/docker-compose/registry.yaml up -d</code></p>\n<h3 id=\"5-2-修改-hosts\"><a href=\"#5-2-修改-hosts\" class=\"headerlink\" title=\"5.2 修改 hosts\"></a>5.2 修改 hosts</h3><p><code>vim /etc/hosts</code><br><code> 127.0.0.1 docker.domain.com</code></p>\n<h3 id=\"5-3-测试-register\"><a href=\"#5-3-测试-register\" class=\"headerlink\" title=\"5.3 测试 register\"></a>5.3 测试 register</h3><p>浏览器访问或者curl  <a href=\"https://docker.domain.com/\">https://docker.domain.com</a></p>\n<h3 id=\"5-4-登录\"><a href=\"#5-4-登录\" class=\"headerlink\" title=\"5.4 登录\"></a>5.4 登录</h3><img src=\"/images/050.registry_setup.md.02.png\" width=100% height=100% />\n"},{"title":"docker-compose 容器编排","date":"2023-09-14T14:09:11.000Z","_content":"\n\n\n### nginx\n\n```yaml\nversion: \"3\"\nservices: # 服务\n    nginx:\n        image: ngin124:latest\n        ports: # 将本机的 8080 端口映射到容器的80端口\n            - \"8080:80\"            \n        container_name: nginx-yaml\n        restart: always\n        volumes: # 映射本机 F:/nginx.conf 文件到 容器的 /etc/nginx/nginx.conf:ro 文件\n            - /usr/local/nginx1.24/html:/usr/local/nginx-1.24/html\n            - /usr/local/nginx1.24/conf/nginx.conf:/usr/local/nginx-1.24/conf/nginx.conf\n        networks: \n            - \"my-network\"\nnetworks: # 网络\n    my-network: # 网络名称\n        driver: bridge\n```\n\n### redis\n\n```yaml\nversion: \"3\"\nservices: # 服务\n    redis:\n        image: redis7.2.1:latest\n        ports: \n            - \"6379:6379\"            \n        container_name: redis-yaml\n        restart: always\n        volumes: \n            - /etc/redis.conf:/usr/local/redis7.2.1/conf\n        networks: \n            - \"my-network\"\nnetworks:\n    my-network: \n        driver: bridge\n```\n\n### tomcat\n\n```yaml\nversion: \"3\"\nservices: # 服务\n    tomcat:\n        image: tomcat8.5.93:latest\n        ports: \n            - \"9090:8080\"            \n        container_name: tomcat-yaml\n        restart: always\n        volumes: \n            - /usr/local/tomcat-8.5.93/conf/server.xml:/usr/local/apache-tomcat-8.5.93/conf/server.xml\n        networks: \n            - \"my-network\"\nnetworks:\n    my-network: \n        driver: bridge\n```","source":"_posts/048.docker-compose_instance.md","raw":"---\ntitle: docker-compose 容器编排\ndate: 2023-9-14 22:09:11\ncategories: \n- [Linux]\n- [Docker]\ntags: \n- docker\n- docker-compose\n---\n\n\n\n### nginx\n\n```yaml\nversion: \"3\"\nservices: # 服务\n    nginx:\n        image: ngin124:latest\n        ports: # 将本机的 8080 端口映射到容器的80端口\n            - \"8080:80\"            \n        container_name: nginx-yaml\n        restart: always\n        volumes: # 映射本机 F:/nginx.conf 文件到 容器的 /etc/nginx/nginx.conf:ro 文件\n            - /usr/local/nginx1.24/html:/usr/local/nginx-1.24/html\n            - /usr/local/nginx1.24/conf/nginx.conf:/usr/local/nginx-1.24/conf/nginx.conf\n        networks: \n            - \"my-network\"\nnetworks: # 网络\n    my-network: # 网络名称\n        driver: bridge\n```\n\n### redis\n\n```yaml\nversion: \"3\"\nservices: # 服务\n    redis:\n        image: redis7.2.1:latest\n        ports: \n            - \"6379:6379\"            \n        container_name: redis-yaml\n        restart: always\n        volumes: \n            - /etc/redis.conf:/usr/local/redis7.2.1/conf\n        networks: \n            - \"my-network\"\nnetworks:\n    my-network: \n        driver: bridge\n```\n\n### tomcat\n\n```yaml\nversion: \"3\"\nservices: # 服务\n    tomcat:\n        image: tomcat8.5.93:latest\n        ports: \n            - \"9090:8080\"            \n        container_name: tomcat-yaml\n        restart: always\n        volumes: \n            - /usr/local/tomcat-8.5.93/conf/server.xml:/usr/local/apache-tomcat-8.5.93/conf/server.xml\n        networks: \n            - \"my-network\"\nnetworks:\n    my-network: \n        driver: bridge\n```","slug":"048.docker-compose_instance","published":1,"updated":"2023-12-05T08:52:30.879Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzea004pijnrb46ldvvo","content":"<h3 id=\"nginx\"><a href=\"#nginx\" class=\"headerlink\" title=\"nginx\"></a>nginx</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span> <span class=\"comment\"># 服务</span></span><br><span class=\"line\">    <span class=\"attr\">nginx:</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">ngin124:latest</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span> <span class=\"comment\"># 将本机的 8080 端口映射到容器的80端口</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;8080:80&quot;</span>            </span><br><span class=\"line\">        <span class=\"attr\">container_name:</span> <span class=\"string\">nginx-yaml</span></span><br><span class=\"line\">        <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">        <span class=\"attr\">volumes:</span> <span class=\"comment\"># 映射本机 F:/nginx.conf 文件到 容器的 /etc/nginx/nginx.conf:ro 文件</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/nginx1.24/html:/usr/local/nginx-1.24/html</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/nginx1.24/conf/nginx.conf:/usr/local/nginx-1.24/conf/nginx.conf</span></span><br><span class=\"line\">        <span class=\"attr\">networks:</span> </span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;my-network&quot;</span></span><br><span class=\"line\"><span class=\"attr\">networks:</span> <span class=\"comment\"># 网络</span></span><br><span class=\"line\">    <span class=\"attr\">my-network:</span> <span class=\"comment\"># 网络名称</span></span><br><span class=\"line\">        <span class=\"attr\">driver:</span> <span class=\"string\">bridge</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"redis\"><a href=\"#redis\" class=\"headerlink\" title=\"redis\"></a>redis</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span> <span class=\"comment\"># 服务</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">redis7.2.1:latest</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span> </span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;6379:6379&quot;</span>            </span><br><span class=\"line\">        <span class=\"attr\">container_name:</span> <span class=\"string\">redis-yaml</span></span><br><span class=\"line\">        <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">        <span class=\"attr\">volumes:</span> </span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">/etc/redis.conf:/usr/local/redis7.2.1/conf</span></span><br><span class=\"line\">        <span class=\"attr\">networks:</span> </span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;my-network&quot;</span></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">    <span class=\"attr\">my-network:</span> </span><br><span class=\"line\">        <span class=\"attr\">driver:</span> <span class=\"string\">bridge</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"tomcat\"><a href=\"#tomcat\" class=\"headerlink\" title=\"tomcat\"></a>tomcat</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span> <span class=\"comment\"># 服务</span></span><br><span class=\"line\">    <span class=\"attr\">tomcat:</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">tomcat8.5.93:latest</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span> </span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;9090:8080&quot;</span>            </span><br><span class=\"line\">        <span class=\"attr\">container_name:</span> <span class=\"string\">tomcat-yaml</span></span><br><span class=\"line\">        <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">        <span class=\"attr\">volumes:</span> </span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/tomcat-8.5.93/conf/server.xml:/usr/local/apache-tomcat-8.5.93/conf/server.xml</span></span><br><span class=\"line\">        <span class=\"attr\">networks:</span> </span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;my-network&quot;</span></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">    <span class=\"attr\">my-network:</span> </span><br><span class=\"line\">        <span class=\"attr\">driver:</span> <span class=\"string\">bridge</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h3 id=\"nginx\"><a href=\"#nginx\" class=\"headerlink\" title=\"nginx\"></a>nginx</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span> <span class=\"comment\"># 服务</span></span><br><span class=\"line\">    <span class=\"attr\">nginx:</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">ngin124:latest</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span> <span class=\"comment\"># 将本机的 8080 端口映射到容器的80端口</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;8080:80&quot;</span>            </span><br><span class=\"line\">        <span class=\"attr\">container_name:</span> <span class=\"string\">nginx-yaml</span></span><br><span class=\"line\">        <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">        <span class=\"attr\">volumes:</span> <span class=\"comment\"># 映射本机 F:/nginx.conf 文件到 容器的 /etc/nginx/nginx.conf:ro 文件</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/nginx1.24/html:/usr/local/nginx-1.24/html</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/nginx1.24/conf/nginx.conf:/usr/local/nginx-1.24/conf/nginx.conf</span></span><br><span class=\"line\">        <span class=\"attr\">networks:</span> </span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;my-network&quot;</span></span><br><span class=\"line\"><span class=\"attr\">networks:</span> <span class=\"comment\"># 网络</span></span><br><span class=\"line\">    <span class=\"attr\">my-network:</span> <span class=\"comment\"># 网络名称</span></span><br><span class=\"line\">        <span class=\"attr\">driver:</span> <span class=\"string\">bridge</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"redis\"><a href=\"#redis\" class=\"headerlink\" title=\"redis\"></a>redis</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span> <span class=\"comment\"># 服务</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">redis7.2.1:latest</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span> </span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;6379:6379&quot;</span>            </span><br><span class=\"line\">        <span class=\"attr\">container_name:</span> <span class=\"string\">redis-yaml</span></span><br><span class=\"line\">        <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">        <span class=\"attr\">volumes:</span> </span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">/etc/redis.conf:/usr/local/redis7.2.1/conf</span></span><br><span class=\"line\">        <span class=\"attr\">networks:</span> </span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;my-network&quot;</span></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">    <span class=\"attr\">my-network:</span> </span><br><span class=\"line\">        <span class=\"attr\">driver:</span> <span class=\"string\">bridge</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"tomcat\"><a href=\"#tomcat\" class=\"headerlink\" title=\"tomcat\"></a>tomcat</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span> <span class=\"comment\"># 服务</span></span><br><span class=\"line\">    <span class=\"attr\">tomcat:</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">tomcat8.5.93:latest</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span> </span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;9090:8080&quot;</span>            </span><br><span class=\"line\">        <span class=\"attr\">container_name:</span> <span class=\"string\">tomcat-yaml</span></span><br><span class=\"line\">        <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">        <span class=\"attr\">volumes:</span> </span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/tomcat-8.5.93/conf/server.xml:/usr/local/apache-tomcat-8.5.93/conf/server.xml</span></span><br><span class=\"line\">        <span class=\"attr\">networks:</span> </span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;my-network&quot;</span></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">    <span class=\"attr\">my-network:</span> </span><br><span class=\"line\">        <span class=\"attr\">driver:</span> <span class=\"string\">bridge</span></span><br></pre></td></tr></table></figure>"},{"title":"MySQL二进制安装","date":"2023-09-25T08:45:00.000Z","_content":"\n\n## 零、 环境\n\n\n- vmware centos7.2 4c8g\n- mysql release: 5.7.34\n- mysql installation path: /usr/local/mysql\n- mysql datadir: /data/mysql\n- mysql cnf: /etc/my.cnf\n\n\n## 一、安装前准备\n\n### 1.1 下载\n\n[下载地址](https://dev.mysql.com/downloads/mysql/5.7.html)\n\n<img src=\"/images/051.MySQL_Install_Using_Generic_Binaries.md.01.png\" width=100% height=100% />\n\n### 1.2 解压到指定目录\n\n```tar -xzvf mysql-5.7.43-linux-glibc2.12-x86_64.tar.gz```\n\n```cp -Rf ./mysql-5.7.43-linux-glibc2.12-x86_64 /usr/local/mysql```\n\n### 1.3 创建相关目录和用户及组\n\n``` groupadd mysql```\n``` useradd -g mysql mysql```\n``` mkdir -p /data/mysql```\n``` chown -R mysql:mysql /data/mysql```\n``` chmod -R 750 /data/mysql```\n\n### 1.4 为MySQL实例创建配置文件\n\n``` vim /etc/my.cnf ```\n\n``` yaml\n[mysqld]\n\n# 数据目录\ndatadir=/data/mysql/\n# socket 目录\nsocket=/data/mysql/mysql.sock\n# 日志\nlog-error=/data/mysql/mysql-err.log\n#端口\nport=3306\n# 实例ID\nserver-id=1\ninnodb_buffer_pool_size = 50G\nlower_case_table_names=0\n# 缓存目录\ntmpdir=/data/mysql/tmp/\n# MySQL二进制文件基目录不是默认目录时，需要配置lc_messages_dir=/usr/local/mysql/share传递它的路径.否则，MySQL 将无法启动。\nlc_messages_dir=/usr/local/mysql/share\n```\n\n## 二、 安装\n\n### 2.1 初始化实例\n\n``` yaml\n/usr/local/mysql/bin/mysqld --no-defaults --initialize-insecure --user=mysql --datadir=/data/mysql/ --lower_case_table_names=0 \n```\n\n >To initialize the data directory, invoke mysqld with the ```--initialize ``` or ``` --initialize-insecure ``` option, depending on whether you want the server to generate a random initial password for the ```'root'@'localhost'``` account, or to create that account with no password:\n>>Use ``` --initialize ``` for “secure by default” installation (that is, including generation of a random initial root password). In this case, the password is marked as expired and you must choose a new one.\n\n>>With ``` --initialize-insecure ``` , no root password is generated. This is insecure; it is assumed that you intend to assign a password to the account in a timely fashion before putting the server into production use. \n\n可以使用 ``` grep \"password\" /path to you mysql-err.log ``` 找到使用``` --initialize ```生成的随机密码\n\n**补充**:\n- 创建目录 ``` mkdir -p /data/mysql/tmp ``` 的步骤一定要在初始化实例之前\n- 初始化的时候检测到数据目录 /data/mysql下存在其他文件或者文件夹的时候会报错.\n\n<img src=\"/images/051.MySQL_Install_Using_Generic_Binaries.md.02.png\" width=100% height=100% />\n\n\n\n## 三、 使用 systemd 管理\n\n``` yaml\n# /usr/lib/systemd/system/mysql.service\n# Copyright (c) 2016, 2021, Oracle and/or its affiliates.\n#\n# This program is free software; you can redistribute it and/or modify\n# it under the terms of the GNU General Public License, version 2.0,\n# as published by the Free Software Foundation.\n#\n# This program is also distributed with certain software (including\n# but not limited to OpenSSL) that is licensed under separate terms,\n# as designated in a particular file or component or in included license\n# documentation.  The authors of MySQL hereby grant you an additional\n# permission to link the program and your derivative works with the\n# separately licensed software that they have included with MySQL.\n#\n# This program is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License, version 2.0, for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with this program; if not, write to the Free Software\n# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA\n#\n# systemd service file for MySQL forking server\n#\n \n[Unit]\nDescription=MySQL Server\nDocumentation=man:mysqld(8)\nDocumentation=http://dev.mysql.com/doc/refman/en/using-systemd.html\nAfter=network.target\nAfter=syslog.target\n \n[Install]\nWantedBy=multi-user.target\n[Service]\nUser=mysql\nGroup=mysql\nType=forking\nPIDFile=/data/mysql/mysqld.pid\n# Disable service start and stop timeout logic of systemd for mysqld service.\nTimeoutSec=0\n# Execute pre and post scripts as root\nPermissionsStartOnly=true\n# Needed to create system tables\n# ExecStartPre=/usr/bin/mysqld_pre_systemd %I\n# Start main service\nExecStart=/usr/local/mysql/bin/mysqld --defaults-file=/etc/my.cnf  --daemonize --pid-file=/data/mysql/mysqld.pid $MYSQLD_OPTS\n \n# Use this to switch malloc implementation\nEnvironmentFile=-/etc/sysconfig/mysql\n# Sets open_files_limit\nLimitNOFILE = 65536\nRestart=on-failure\nRestartPreventExitStatus=1\nEnvironment=MYSQLD_PARENT_PID=1\nPrivateTmp=false\n\n```\n\n### 3.1 启动MySQL\n\n``` systemctl daemon-reload ```\n``` systemctl enable mysql --now ```\n``` systemctl status mysql ```\n\n\n## 四、 MySQL 配置文件参数优化\n\n仅供参考:\n\n``` yaml\n[client]                                        #客户端配置\nport= 3306                                        #监听端口\nsocket= /tmp/mysql.sock                            #socket通信文件\ndefault-character-set = utf8                    #客户端字符编码\n\n[mysql]                                            #终端管理\nprompt=\"MySQL [\\d]> \"                            #prompt=\"\\\\u@\\\\h:\\\\d>\"   终端连接后显示后用户、主机、当前数据库\nno-auto-rehash                                    #auto-rehash   命令行自动补全功能\n\n[mysqld]                                        #服务器配置\nport = 3306                                        #端口\nsocket = /tmp/mysql.sock                        #套接字\ndatadir = /data/mysql               #数据库文件所在目录\nbasedir = /usr/local/mysql                        #基准路径，其它路径都相对于此路径\npid-file = /usr/local/mysql/mysql.pid            #pid文件\nuser = mysql                                    #管理用户\nserver-id=1                                        #本机序列号\ninit-connect = 'SET NAMES utf8'                    #当一个连接进来时，做一些操作，此处为连接创建时设置字符编码\ncharacter_set_server=utf8                        #服务器默认字符集\n#skip-networking                                #开启则彻底关闭mysql的TCP/IP连接方式\nback_log = 300                                    #并发是等待的数量\nopen_files_limit = 65535                        #打开的文件描述符限制\nbinlog_cache_size = 1M                            #事务未提交时会记录到cache，等到事务提交，则把日志持久化到磁盘，默认32k,如果事务比此值大，会使用磁盘临时文件替代\nmax_heap_table_size = 8M                        #用户创建的内存表最大值，为防止意外超大的内存表耗尽内存资源\ntmp_table_size = 128M                            #内存中临时表的大小，如果超过此值，则转换为基于磁盘的表，默认32M\nft_min_word_len = 4                                #全文索引最小长度，\nlog_bin = mysql-bin                                #二进制文件\nbinlog_format = mixed                            #二进制日志格式，默认statement，建议mixed                    \nexpire_logs_days = 7                            #指定二进制日志的有效时间\nlog_error = /usr/local/mysql/mysql-error.log    #错误日志\nslow_query_log = 1                                #默认不开启,on|off\nlong_query_time = 1                                #超过多少秒的查询就写入日志\nslow_query_log_file = /usr/local/mysql/mysql-slow.log    #慢查询日志文件，mysqldumpslow  -h自带的查询慢日志工具。实例mysqldumpslow -s c -t 20 host-slow.log\nperformance_schema = 0                            #用于收集数据库服务器性能参数\nexplicit_defaults_for_timestamp                    #自动填补timestamp字段的值\nlower_case_table_names = 1                        #0存储和比较都是大小写敏感，1存储时转换为小写，比较时不区分大小写。2存储时区分大小写，比较时转换为小写\nskip-external-locking                            #跳过外部锁定，即多台服务器使用同一个数据目录，那么每台必须开启external-locking\n\n##network setting\nskip-name-resolve                                #禁止mysql对外部连接DNS解析。如果打开，则所有远程主机授权都要使用IP方式，否则无法处理请求\nbind-address = 0.0.0.0                            #服务监听地址\nmax_connections = 1024                            #指定Mysql允许的最大连接进程数,可以过'conn%'通配符查看当前状态的连接数量，以定夺该值的大小。\nmax_connect_errors = 102400                        #对于同一主机，如果超过该值的中断错误连接，则该主机被禁止连接。解禁FLUSH HOST\nmax_allowed_packet = 32M                        #接受的数据包大小，增加该值十分的安全，这是因为只有当需要时才会分配额外的内存。去较小值是预防偶尔使用大信息而导致内存溢出\ninteractive_timeout = 28800                        #默认28800,8小时。服务器关闭交互连接前等待活动的描述\nwait_timeout = 28800                            #默认28800，服务器关闭非交互连接之前等待活动的秒数\n\n##innodb setting\ndefault_storage_engine = InnoDB                    #默认存储引擎\ninnodb_file_per_table = 1                        #独享表空间，关闭即可\ninnodb_open_files = 500                            #默认300，限制Innodb能打开表的数据\ninnodb_buffer_pool_size = 1024M                    #数据和索引的缓冲池，典型值5-6G（8G内存），20-25GB(32GB内存)，100-120GB(128GB内存)。\ninnodb_write_io_threads = 4                        #写入磁盘IO\ninnodb_read_io_threads = 4                        #读取磁盘IO\ninnodb_thread_concurrency = 0                    #你的服务器CPU有几个就设置为几,建议用默认一般为8\ninnodb_purge_threads = 1                        #最大值32，控制做purge(净化)操作的后台线程数\ninnodb_flush_log_at_trx_commit = 2                #为2表示事务日志在提交时写入日志，但日志文件每次刷新到磁盘一次    \ninnodb_log_buffer_size = 2M                        #指定日志文件所用内存大小，1-8之间\ninnodb_log_file_size = 32M                        #指定日志文件大小\ninnodb_log_files_in_group = 3                    #默认2，推荐3.mysql以循环方式将日志文件写入多个文件\ninnodb_max_dirty_pages_pct = 90                    #默认75\ninnodb_lock_wait_timeout = 120                    #默认50秒，\n\n##cache setting\nkey_buffer_size = 32M                            #索引缓冲区大小，增加它可以得到更好的处理性能。对于4G左右服务器来说，该参数可设为256MB或384MB\ntable_open_cache = 512                            #这个参数在5.1.3之后的版本中叫做table_open_cache，用于设置table高速缓存的数量。由于每个客户端连接都会至少访问一个表，\nsort_buffer_size = 2M                            #查询排序时所能使用的缓冲区大小，是一个connection级参数，即500个链接会占用500*8=4G内存\njoin_buffer_size = 2M                            #联合查询所能使用的缓冲区大小，该参数分配的内存也是每个链接独享，默认2M\nread_buffer_size = 2M                            #用于对myisam表全表扫描时使用缓冲区大小，读查询所能使用的缓冲区大小，该参数分配的内存也是每个链接独享\nread_rnd_buffer_size = 8M                        #当需要时线程分配，当在排序后，从一个已经分配好的序列中读取行时，行数据从这个缓冲区读取防止磁盘寻道\nthread_cache_size = 64                            #服务器线程缓存，连接断开时放入缓存，线程重新被请求从缓存读取。设置规则：1GB内存配置8,2G内存配置18,3G内存32,4G或更高可配置更大                    \nquery_cache_type = 1                            #是否开启查询缓存，默认0不开启，1缓存所有结果，2仅缓存select语句中通过SQL_CACHE指定的查询\nquery_cache_size = 64M                            #指定查询缓冲区大小    ,一个select工作后，db会把该语句缓冲，当同一个SQL再次来到，DB未检查到该表发生变化时，会直接把结果返给client    \nquery_cache_limit = 2M                            #指定单个查询缓存所能使用的缓冲区大小\nbulk_insert_buffer_size = 8M                    #默认8M，批量插入数据缓存大小，可以提高插入效率\n\nmyisam_sort_buffer_size = 64M                    #myisam表发生变化时，重新排序所需的缓冲，默认8M\nmyisam_max_sort_file_size = 10G                    #mysql重建索引时允许的临时文件大小\n\n#event_scheduler =ON\n#skip-external-locking\n#sql_mode ='STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'\n\n[mysqldump]\nquick                                            #备份方式\nmax_allowed_packet = 500M                        #服务器发送和接受的最大包长度\n\n[myisamchk]\nkey_buffer_size = 256M                            #key缓冲\nsort_buffer_size = 8M                            #排序缓冲\nread_buffer = 4M                                #读取缓冲\nwrite_buffer = 4M                                #写入缓冲\n```","source":"_posts/051.MySQL_Install_Using_Generic_Binaries.md","raw":"---\ntitle: MySQL二进制安装\ndate: 2023-9-25 16:45:00\ncategories: \n- [Database]\ntags: \n- MySQL\n---\n\n\n## 零、 环境\n\n\n- vmware centos7.2 4c8g\n- mysql release: 5.7.34\n- mysql installation path: /usr/local/mysql\n- mysql datadir: /data/mysql\n- mysql cnf: /etc/my.cnf\n\n\n## 一、安装前准备\n\n### 1.1 下载\n\n[下载地址](https://dev.mysql.com/downloads/mysql/5.7.html)\n\n<img src=\"/images/051.MySQL_Install_Using_Generic_Binaries.md.01.png\" width=100% height=100% />\n\n### 1.2 解压到指定目录\n\n```tar -xzvf mysql-5.7.43-linux-glibc2.12-x86_64.tar.gz```\n\n```cp -Rf ./mysql-5.7.43-linux-glibc2.12-x86_64 /usr/local/mysql```\n\n### 1.3 创建相关目录和用户及组\n\n``` groupadd mysql```\n``` useradd -g mysql mysql```\n``` mkdir -p /data/mysql```\n``` chown -R mysql:mysql /data/mysql```\n``` chmod -R 750 /data/mysql```\n\n### 1.4 为MySQL实例创建配置文件\n\n``` vim /etc/my.cnf ```\n\n``` yaml\n[mysqld]\n\n# 数据目录\ndatadir=/data/mysql/\n# socket 目录\nsocket=/data/mysql/mysql.sock\n# 日志\nlog-error=/data/mysql/mysql-err.log\n#端口\nport=3306\n# 实例ID\nserver-id=1\ninnodb_buffer_pool_size = 50G\nlower_case_table_names=0\n# 缓存目录\ntmpdir=/data/mysql/tmp/\n# MySQL二进制文件基目录不是默认目录时，需要配置lc_messages_dir=/usr/local/mysql/share传递它的路径.否则，MySQL 将无法启动。\nlc_messages_dir=/usr/local/mysql/share\n```\n\n## 二、 安装\n\n### 2.1 初始化实例\n\n``` yaml\n/usr/local/mysql/bin/mysqld --no-defaults --initialize-insecure --user=mysql --datadir=/data/mysql/ --lower_case_table_names=0 \n```\n\n >To initialize the data directory, invoke mysqld with the ```--initialize ``` or ``` --initialize-insecure ``` option, depending on whether you want the server to generate a random initial password for the ```'root'@'localhost'``` account, or to create that account with no password:\n>>Use ``` --initialize ``` for “secure by default” installation (that is, including generation of a random initial root password). In this case, the password is marked as expired and you must choose a new one.\n\n>>With ``` --initialize-insecure ``` , no root password is generated. This is insecure; it is assumed that you intend to assign a password to the account in a timely fashion before putting the server into production use. \n\n可以使用 ``` grep \"password\" /path to you mysql-err.log ``` 找到使用``` --initialize ```生成的随机密码\n\n**补充**:\n- 创建目录 ``` mkdir -p /data/mysql/tmp ``` 的步骤一定要在初始化实例之前\n- 初始化的时候检测到数据目录 /data/mysql下存在其他文件或者文件夹的时候会报错.\n\n<img src=\"/images/051.MySQL_Install_Using_Generic_Binaries.md.02.png\" width=100% height=100% />\n\n\n\n## 三、 使用 systemd 管理\n\n``` yaml\n# /usr/lib/systemd/system/mysql.service\n# Copyright (c) 2016, 2021, Oracle and/or its affiliates.\n#\n# This program is free software; you can redistribute it and/or modify\n# it under the terms of the GNU General Public License, version 2.0,\n# as published by the Free Software Foundation.\n#\n# This program is also distributed with certain software (including\n# but not limited to OpenSSL) that is licensed under separate terms,\n# as designated in a particular file or component or in included license\n# documentation.  The authors of MySQL hereby grant you an additional\n# permission to link the program and your derivative works with the\n# separately licensed software that they have included with MySQL.\n#\n# This program is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License, version 2.0, for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with this program; if not, write to the Free Software\n# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA\n#\n# systemd service file for MySQL forking server\n#\n \n[Unit]\nDescription=MySQL Server\nDocumentation=man:mysqld(8)\nDocumentation=http://dev.mysql.com/doc/refman/en/using-systemd.html\nAfter=network.target\nAfter=syslog.target\n \n[Install]\nWantedBy=multi-user.target\n[Service]\nUser=mysql\nGroup=mysql\nType=forking\nPIDFile=/data/mysql/mysqld.pid\n# Disable service start and stop timeout logic of systemd for mysqld service.\nTimeoutSec=0\n# Execute pre and post scripts as root\nPermissionsStartOnly=true\n# Needed to create system tables\n# ExecStartPre=/usr/bin/mysqld_pre_systemd %I\n# Start main service\nExecStart=/usr/local/mysql/bin/mysqld --defaults-file=/etc/my.cnf  --daemonize --pid-file=/data/mysql/mysqld.pid $MYSQLD_OPTS\n \n# Use this to switch malloc implementation\nEnvironmentFile=-/etc/sysconfig/mysql\n# Sets open_files_limit\nLimitNOFILE = 65536\nRestart=on-failure\nRestartPreventExitStatus=1\nEnvironment=MYSQLD_PARENT_PID=1\nPrivateTmp=false\n\n```\n\n### 3.1 启动MySQL\n\n``` systemctl daemon-reload ```\n``` systemctl enable mysql --now ```\n``` systemctl status mysql ```\n\n\n## 四、 MySQL 配置文件参数优化\n\n仅供参考:\n\n``` yaml\n[client]                                        #客户端配置\nport= 3306                                        #监听端口\nsocket= /tmp/mysql.sock                            #socket通信文件\ndefault-character-set = utf8                    #客户端字符编码\n\n[mysql]                                            #终端管理\nprompt=\"MySQL [\\d]> \"                            #prompt=\"\\\\u@\\\\h:\\\\d>\"   终端连接后显示后用户、主机、当前数据库\nno-auto-rehash                                    #auto-rehash   命令行自动补全功能\n\n[mysqld]                                        #服务器配置\nport = 3306                                        #端口\nsocket = /tmp/mysql.sock                        #套接字\ndatadir = /data/mysql               #数据库文件所在目录\nbasedir = /usr/local/mysql                        #基准路径，其它路径都相对于此路径\npid-file = /usr/local/mysql/mysql.pid            #pid文件\nuser = mysql                                    #管理用户\nserver-id=1                                        #本机序列号\ninit-connect = 'SET NAMES utf8'                    #当一个连接进来时，做一些操作，此处为连接创建时设置字符编码\ncharacter_set_server=utf8                        #服务器默认字符集\n#skip-networking                                #开启则彻底关闭mysql的TCP/IP连接方式\nback_log = 300                                    #并发是等待的数量\nopen_files_limit = 65535                        #打开的文件描述符限制\nbinlog_cache_size = 1M                            #事务未提交时会记录到cache，等到事务提交，则把日志持久化到磁盘，默认32k,如果事务比此值大，会使用磁盘临时文件替代\nmax_heap_table_size = 8M                        #用户创建的内存表最大值，为防止意外超大的内存表耗尽内存资源\ntmp_table_size = 128M                            #内存中临时表的大小，如果超过此值，则转换为基于磁盘的表，默认32M\nft_min_word_len = 4                                #全文索引最小长度，\nlog_bin = mysql-bin                                #二进制文件\nbinlog_format = mixed                            #二进制日志格式，默认statement，建议mixed                    \nexpire_logs_days = 7                            #指定二进制日志的有效时间\nlog_error = /usr/local/mysql/mysql-error.log    #错误日志\nslow_query_log = 1                                #默认不开启,on|off\nlong_query_time = 1                                #超过多少秒的查询就写入日志\nslow_query_log_file = /usr/local/mysql/mysql-slow.log    #慢查询日志文件，mysqldumpslow  -h自带的查询慢日志工具。实例mysqldumpslow -s c -t 20 host-slow.log\nperformance_schema = 0                            #用于收集数据库服务器性能参数\nexplicit_defaults_for_timestamp                    #自动填补timestamp字段的值\nlower_case_table_names = 1                        #0存储和比较都是大小写敏感，1存储时转换为小写，比较时不区分大小写。2存储时区分大小写，比较时转换为小写\nskip-external-locking                            #跳过外部锁定，即多台服务器使用同一个数据目录，那么每台必须开启external-locking\n\n##network setting\nskip-name-resolve                                #禁止mysql对外部连接DNS解析。如果打开，则所有远程主机授权都要使用IP方式，否则无法处理请求\nbind-address = 0.0.0.0                            #服务监听地址\nmax_connections = 1024                            #指定Mysql允许的最大连接进程数,可以过'conn%'通配符查看当前状态的连接数量，以定夺该值的大小。\nmax_connect_errors = 102400                        #对于同一主机，如果超过该值的中断错误连接，则该主机被禁止连接。解禁FLUSH HOST\nmax_allowed_packet = 32M                        #接受的数据包大小，增加该值十分的安全，这是因为只有当需要时才会分配额外的内存。去较小值是预防偶尔使用大信息而导致内存溢出\ninteractive_timeout = 28800                        #默认28800,8小时。服务器关闭交互连接前等待活动的描述\nwait_timeout = 28800                            #默认28800，服务器关闭非交互连接之前等待活动的秒数\n\n##innodb setting\ndefault_storage_engine = InnoDB                    #默认存储引擎\ninnodb_file_per_table = 1                        #独享表空间，关闭即可\ninnodb_open_files = 500                            #默认300，限制Innodb能打开表的数据\ninnodb_buffer_pool_size = 1024M                    #数据和索引的缓冲池，典型值5-6G（8G内存），20-25GB(32GB内存)，100-120GB(128GB内存)。\ninnodb_write_io_threads = 4                        #写入磁盘IO\ninnodb_read_io_threads = 4                        #读取磁盘IO\ninnodb_thread_concurrency = 0                    #你的服务器CPU有几个就设置为几,建议用默认一般为8\ninnodb_purge_threads = 1                        #最大值32，控制做purge(净化)操作的后台线程数\ninnodb_flush_log_at_trx_commit = 2                #为2表示事务日志在提交时写入日志，但日志文件每次刷新到磁盘一次    \ninnodb_log_buffer_size = 2M                        #指定日志文件所用内存大小，1-8之间\ninnodb_log_file_size = 32M                        #指定日志文件大小\ninnodb_log_files_in_group = 3                    #默认2，推荐3.mysql以循环方式将日志文件写入多个文件\ninnodb_max_dirty_pages_pct = 90                    #默认75\ninnodb_lock_wait_timeout = 120                    #默认50秒，\n\n##cache setting\nkey_buffer_size = 32M                            #索引缓冲区大小，增加它可以得到更好的处理性能。对于4G左右服务器来说，该参数可设为256MB或384MB\ntable_open_cache = 512                            #这个参数在5.1.3之后的版本中叫做table_open_cache，用于设置table高速缓存的数量。由于每个客户端连接都会至少访问一个表，\nsort_buffer_size = 2M                            #查询排序时所能使用的缓冲区大小，是一个connection级参数，即500个链接会占用500*8=4G内存\njoin_buffer_size = 2M                            #联合查询所能使用的缓冲区大小，该参数分配的内存也是每个链接独享，默认2M\nread_buffer_size = 2M                            #用于对myisam表全表扫描时使用缓冲区大小，读查询所能使用的缓冲区大小，该参数分配的内存也是每个链接独享\nread_rnd_buffer_size = 8M                        #当需要时线程分配，当在排序后，从一个已经分配好的序列中读取行时，行数据从这个缓冲区读取防止磁盘寻道\nthread_cache_size = 64                            #服务器线程缓存，连接断开时放入缓存，线程重新被请求从缓存读取。设置规则：1GB内存配置8,2G内存配置18,3G内存32,4G或更高可配置更大                    \nquery_cache_type = 1                            #是否开启查询缓存，默认0不开启，1缓存所有结果，2仅缓存select语句中通过SQL_CACHE指定的查询\nquery_cache_size = 64M                            #指定查询缓冲区大小    ,一个select工作后，db会把该语句缓冲，当同一个SQL再次来到，DB未检查到该表发生变化时，会直接把结果返给client    \nquery_cache_limit = 2M                            #指定单个查询缓存所能使用的缓冲区大小\nbulk_insert_buffer_size = 8M                    #默认8M，批量插入数据缓存大小，可以提高插入效率\n\nmyisam_sort_buffer_size = 64M                    #myisam表发生变化时，重新排序所需的缓冲，默认8M\nmyisam_max_sort_file_size = 10G                    #mysql重建索引时允许的临时文件大小\n\n#event_scheduler =ON\n#skip-external-locking\n#sql_mode ='STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'\n\n[mysqldump]\nquick                                            #备份方式\nmax_allowed_packet = 500M                        #服务器发送和接受的最大包长度\n\n[myisamchk]\nkey_buffer_size = 256M                            #key缓冲\nsort_buffer_size = 8M                            #排序缓冲\nread_buffer = 4M                                #读取缓冲\nwrite_buffer = 4M                                #写入缓冲\n```","slug":"051.MySQL_Install_Using_Generic_Binaries","published":1,"updated":"2023-12-05T08:52:30.879Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzeb004rijnrdfm13ky4","content":"<h2 id=\"零、-环境\"><a href=\"#零、-环境\" class=\"headerlink\" title=\"零、 环境\"></a>零、 环境</h2><ul>\n<li>vmware centos7.2 4c8g</li>\n<li>mysql release: 5.7.34</li>\n<li>mysql installation path: &#x2F;usr&#x2F;local&#x2F;mysql</li>\n<li>mysql datadir: &#x2F;data&#x2F;mysql</li>\n<li>mysql cnf: &#x2F;etc&#x2F;my.cnf</li>\n</ul>\n<h2 id=\"一、安装前准备\"><a href=\"#一、安装前准备\" class=\"headerlink\" title=\"一、安装前准备\"></a>一、安装前准备</h2><h3 id=\"1-1-下载\"><a href=\"#1-1-下载\" class=\"headerlink\" title=\"1.1 下载\"></a>1.1 下载</h3><p><a href=\"https://dev.mysql.com/downloads/mysql/5.7.html\">下载地址</a></p>\n<img src=\"/images/051.MySQL_Install_Using_Generic_Binaries.md.01.png\" width=100% height=100% />\n\n<h3 id=\"1-2-解压到指定目录\"><a href=\"#1-2-解压到指定目录\" class=\"headerlink\" title=\"1.2 解压到指定目录\"></a>1.2 解压到指定目录</h3><p><code>tar -xzvf mysql-5.7.43-linux-glibc2.12-x86_64.tar.gz</code></p>\n<p><code>cp -Rf ./mysql-5.7.43-linux-glibc2.12-x86_64 /usr/local/mysql</code></p>\n<h3 id=\"1-3-创建相关目录和用户及组\"><a href=\"#1-3-创建相关目录和用户及组\" class=\"headerlink\" title=\"1.3 创建相关目录和用户及组\"></a>1.3 创建相关目录和用户及组</h3><p><code> groupadd mysql</code><br><code> useradd -g mysql mysql</code><br><code> mkdir -p /data/mysql</code><br><code> chown -R mysql:mysql /data/mysql</code><br><code> chmod -R 750 /data/mysql</code></p>\n<h3 id=\"1-4-为MySQL实例创建配置文件\"><a href=\"#1-4-为MySQL实例创建配置文件\" class=\"headerlink\" title=\"1.4 为MySQL实例创建配置文件\"></a>1.4 为MySQL实例创建配置文件</h3><p><code>vim /etc/my.cnf</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">mysqld</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 数据目录</span></span><br><span class=\"line\"><span class=\"string\">datadir=/data/mysql/</span></span><br><span class=\"line\"><span class=\"comment\"># socket 目录</span></span><br><span class=\"line\"><span class=\"string\">socket=/data/mysql/mysql.sock</span></span><br><span class=\"line\"><span class=\"comment\"># 日志</span></span><br><span class=\"line\"><span class=\"string\">log-error=/data/mysql/mysql-err.log</span></span><br><span class=\"line\"><span class=\"comment\">#端口</span></span><br><span class=\"line\"><span class=\"string\">port=3306</span></span><br><span class=\"line\"><span class=\"comment\"># 实例ID</span></span><br><span class=\"line\"><span class=\"string\">server-id=1</span></span><br><span class=\"line\"><span class=\"string\">innodb_buffer_pool_size</span> <span class=\"string\">=</span> <span class=\"string\">50G</span></span><br><span class=\"line\"><span class=\"string\">lower_case_table_names=0</span></span><br><span class=\"line\"><span class=\"comment\"># 缓存目录</span></span><br><span class=\"line\"><span class=\"string\">tmpdir=/data/mysql/tmp/</span></span><br><span class=\"line\"><span class=\"comment\"># MySQL二进制文件基目录不是默认目录时，需要配置lc_messages_dir=/usr/local/mysql/share传递它的路径.否则，MySQL 将无法启动。</span></span><br><span class=\"line\"><span class=\"string\">lc_messages_dir=/usr/local/mysql/share</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"二、-安装\"><a href=\"#二、-安装\" class=\"headerlink\" title=\"二、 安装\"></a>二、 安装</h2><h3 id=\"2-1-初始化实例\"><a href=\"#2-1-初始化实例\" class=\"headerlink\" title=\"2.1 初始化实例\"></a>2.1 初始化实例</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">/usr/local/mysql/bin/mysqld</span> <span class=\"string\">--no-defaults</span> <span class=\"string\">--initialize-insecure</span> <span class=\"string\">--user=mysql</span> <span class=\"string\">--datadir=/data/mysql/</span> <span class=\"string\">--lower_case_table_names=0</span> </span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>To initialize the data directory, invoke mysqld with the <code>--initialize </code> or <code>--initialize-insecure</code> option, depending on whether you want the server to generate a random initial password for the <code>&#39;root&#39;@&#39;localhost&#39;</code> account, or to create that account with no password:</p>\n<blockquote>\n<p>Use <code>--initialize</code> for “secure by default” installation (that is, including generation of a random initial root password). In this case, the password is marked as expired and you must choose a new one.</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>With <code>--initialize-insecure</code> , no root password is generated. This is insecure; it is assumed that you intend to assign a password to the account in a timely fashion before putting the server into production use. </p>\n</blockquote>\n</blockquote>\n<p>可以使用 <code>grep &quot;password&quot; /path to you mysql-err.log</code> 找到使用<code>--initialize</code>生成的随机密码</p>\n<p><strong>补充</strong>:</p>\n<ul>\n<li>创建目录 <code>mkdir -p /data/mysql/tmp</code> 的步骤一定要在初始化实例之前</li>\n<li>初始化的时候检测到数据目录 &#x2F;data&#x2F;mysql下存在其他文件或者文件夹的时候会报错.</li>\n</ul>\n<img src=\"/images/051.MySQL_Install_Using_Generic_Binaries.md.02.png\" width=100% height=100% />\n\n\n\n<h2 id=\"三、-使用-systemd-管理\"><a href=\"#三、-使用-systemd-管理\" class=\"headerlink\" title=\"三、 使用 systemd 管理\"></a>三、 使用 systemd 管理</h2><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /usr/lib/systemd/system/mysql.service</span></span><br><span class=\"line\"><span class=\"comment\"># Copyright (c) 2016, 2021, Oracle and/or its affiliates.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># This program is free software; you can redistribute it and/or modify</span></span><br><span class=\"line\"><span class=\"comment\"># it under the terms of the GNU General Public License, version 2.0,</span></span><br><span class=\"line\"><span class=\"comment\"># as published by the Free Software Foundation.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># This program is also distributed with certain software (including</span></span><br><span class=\"line\"><span class=\"comment\"># but not limited to OpenSSL) that is licensed under separate terms,</span></span><br><span class=\"line\"><span class=\"comment\"># as designated in a particular file or component or in included license</span></span><br><span class=\"line\"><span class=\"comment\"># documentation.  The authors of MySQL hereby grant you an additional</span></span><br><span class=\"line\"><span class=\"comment\"># permission to link the program and your derivative works with the</span></span><br><span class=\"line\"><span class=\"comment\"># separately licensed software that they have included with MySQL.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># This program is distributed in the hope that it will be useful,</span></span><br><span class=\"line\"><span class=\"comment\"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span><br><span class=\"line\"><span class=\"comment\"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></span><br><span class=\"line\"><span class=\"comment\"># GNU General Public License, version 2.0, for more details.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># You should have received a copy of the GNU General Public License</span></span><br><span class=\"line\"><span class=\"comment\"># along with this program; if not, write to the Free Software</span></span><br><span class=\"line\"><span class=\"comment\"># Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># systemd service file for MySQL forking server</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"> </span><br><span class=\"line\">[<span class=\"string\">Unit</span>]</span><br><span class=\"line\"><span class=\"string\">Description=MySQL</span> <span class=\"string\">Server</span></span><br><span class=\"line\"><span class=\"string\">Documentation=man:mysqld(8)</span></span><br><span class=\"line\"><span class=\"string\">Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html</span></span><br><span class=\"line\"><span class=\"string\">After=network.target</span></span><br><span class=\"line\"><span class=\"string\">After=syslog.target</span></span><br><span class=\"line\"> </span><br><span class=\"line\">[<span class=\"string\">Install</span>]</span><br><span class=\"line\"><span class=\"string\">WantedBy=multi-user.target</span></span><br><span class=\"line\">[<span class=\"string\">Service</span>]</span><br><span class=\"line\"><span class=\"string\">User=mysql</span></span><br><span class=\"line\"><span class=\"string\">Group=mysql</span></span><br><span class=\"line\"><span class=\"string\">Type=forking</span></span><br><span class=\"line\"><span class=\"string\">PIDFile=/data/mysql/mysqld.pid</span></span><br><span class=\"line\"><span class=\"comment\"># Disable service start and stop timeout logic of systemd for mysqld service.</span></span><br><span class=\"line\"><span class=\"string\">TimeoutSec=0</span></span><br><span class=\"line\"><span class=\"comment\"># Execute pre and post scripts as root</span></span><br><span class=\"line\"><span class=\"string\">PermissionsStartOnly=true</span></span><br><span class=\"line\"><span class=\"comment\"># Needed to create system tables</span></span><br><span class=\"line\"><span class=\"comment\"># ExecStartPre=/usr/bin/mysqld_pre_systemd %I</span></span><br><span class=\"line\"><span class=\"comment\"># Start main service</span></span><br><span class=\"line\"><span class=\"string\">ExecStart=/usr/local/mysql/bin/mysqld</span> <span class=\"string\">--defaults-file=/etc/my.cnf</span>  <span class=\"string\">--daemonize</span> <span class=\"string\">--pid-file=/data/mysql/mysqld.pid</span> <span class=\"string\">$MYSQLD_OPTS</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># Use this to switch malloc implementation</span></span><br><span class=\"line\"><span class=\"string\">EnvironmentFile=-/etc/sysconfig/mysql</span></span><br><span class=\"line\"><span class=\"comment\"># Sets open_files_limit</span></span><br><span class=\"line\"><span class=\"string\">LimitNOFILE</span> <span class=\"string\">=</span> <span class=\"number\">65536</span></span><br><span class=\"line\"><span class=\"string\">Restart=on-failure</span></span><br><span class=\"line\"><span class=\"string\">RestartPreventExitStatus=1</span></span><br><span class=\"line\"><span class=\"string\">Environment=MYSQLD_PARENT_PID=1</span></span><br><span class=\"line\"><span class=\"string\">PrivateTmp=false</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-1-启动MySQL\"><a href=\"#3-1-启动MySQL\" class=\"headerlink\" title=\"3.1 启动MySQL\"></a>3.1 启动MySQL</h3><p><code>systemctl daemon-reload</code><br><code>systemctl enable mysql --now</code><br><code>systemctl status mysql</code></p>\n<h2 id=\"四、-MySQL-配置文件参数优化\"><a href=\"#四、-MySQL-配置文件参数优化\" class=\"headerlink\" title=\"四、 MySQL 配置文件参数优化\"></a>四、 MySQL 配置文件参数优化</h2><p>仅供参考:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">client</span>]                                        <span class=\"comment\">#客户端配置</span></span><br><span class=\"line\"><span class=\"string\">port=</span> <span class=\"number\">3306</span>                                        <span class=\"comment\">#监听端口</span></span><br><span class=\"line\"><span class=\"string\">socket=</span> <span class=\"string\">/tmp/mysql.sock</span>                            <span class=\"comment\">#socket通信文件</span></span><br><span class=\"line\"><span class=\"string\">default-character-set</span> <span class=\"string\">=</span> <span class=\"string\">utf8</span>                    <span class=\"comment\">#客户端字符编码</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"string\">mysql</span>]                                            <span class=\"comment\">#终端管理</span></span><br><span class=\"line\"><span class=\"string\">prompt=&quot;MySQL</span> [<span class=\"string\">\\d</span>]<span class=\"string\">&gt;</span> <span class=\"string\">&quot;                            #prompt=&quot;</span><span class=\"string\">\\\\u@\\\\h:\\\\d&gt;&quot;</span>   <span class=\"string\">终端连接后显示后用户、主机、当前数据库</span></span><br><span class=\"line\"><span class=\"literal\">no</span><span class=\"string\">-auto-rehash</span>                                    <span class=\"comment\">#auto-rehash   命令行自动补全功能</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"string\">mysqld</span>]                                        <span class=\"comment\">#服务器配置</span></span><br><span class=\"line\"><span class=\"string\">port</span> <span class=\"string\">=</span> <span class=\"number\">3306</span>                                        <span class=\"comment\">#端口</span></span><br><span class=\"line\"><span class=\"string\">socket</span> <span class=\"string\">=</span> <span class=\"string\">/tmp/mysql.sock</span>                        <span class=\"comment\">#套接字</span></span><br><span class=\"line\"><span class=\"string\">datadir</span> <span class=\"string\">=</span> <span class=\"string\">/data/mysql</span>               <span class=\"comment\">#数据库文件所在目录</span></span><br><span class=\"line\"><span class=\"string\">basedir</span> <span class=\"string\">=</span> <span class=\"string\">/usr/local/mysql</span>                        <span class=\"comment\">#基准路径，其它路径都相对于此路径</span></span><br><span class=\"line\"><span class=\"string\">pid-file</span> <span class=\"string\">=</span> <span class=\"string\">/usr/local/mysql/mysql.pid</span>            <span class=\"comment\">#pid文件</span></span><br><span class=\"line\"><span class=\"string\">user</span> <span class=\"string\">=</span> <span class=\"string\">mysql</span>                                    <span class=\"comment\">#管理用户</span></span><br><span class=\"line\"><span class=\"string\">server-id=1</span>                                        <span class=\"comment\">#本机序列号</span></span><br><span class=\"line\"><span class=\"string\">init-connect</span> <span class=\"string\">=</span> <span class=\"string\">&#x27;SET NAMES utf8&#x27;</span>                    <span class=\"comment\">#当一个连接进来时，做一些操作，此处为连接创建时设置字符编码</span></span><br><span class=\"line\"><span class=\"string\">character_set_server=utf8</span>                        <span class=\"comment\">#服务器默认字符集</span></span><br><span class=\"line\"><span class=\"comment\">#skip-networking                                #开启则彻底关闭mysql的TCP/IP连接方式</span></span><br><span class=\"line\"><span class=\"string\">back_log</span> <span class=\"string\">=</span> <span class=\"number\">300</span>                                    <span class=\"comment\">#并发是等待的数量</span></span><br><span class=\"line\"><span class=\"string\">open_files_limit</span> <span class=\"string\">=</span> <span class=\"number\">65535</span>                        <span class=\"comment\">#打开的文件描述符限制</span></span><br><span class=\"line\"><span class=\"string\">binlog_cache_size</span> <span class=\"string\">=</span> <span class=\"string\">1M</span>                            <span class=\"comment\">#事务未提交时会记录到cache，等到事务提交，则把日志持久化到磁盘，默认32k,如果事务比此值大，会使用磁盘临时文件替代</span></span><br><span class=\"line\"><span class=\"string\">max_heap_table_size</span> <span class=\"string\">=</span> <span class=\"string\">8M</span>                        <span class=\"comment\">#用户创建的内存表最大值，为防止意外超大的内存表耗尽内存资源</span></span><br><span class=\"line\"><span class=\"string\">tmp_table_size</span> <span class=\"string\">=</span> <span class=\"string\">128M</span>                            <span class=\"comment\">#内存中临时表的大小，如果超过此值，则转换为基于磁盘的表，默认32M</span></span><br><span class=\"line\"><span class=\"string\">ft_min_word_len</span> <span class=\"string\">=</span> <span class=\"number\">4</span>                                <span class=\"comment\">#全文索引最小长度，</span></span><br><span class=\"line\"><span class=\"string\">log_bin</span> <span class=\"string\">=</span> <span class=\"string\">mysql-bin</span>                                <span class=\"comment\">#二进制文件</span></span><br><span class=\"line\"><span class=\"string\">binlog_format</span> <span class=\"string\">=</span> <span class=\"string\">mixed</span>                            <span class=\"comment\">#二进制日志格式，默认statement，建议mixed                    </span></span><br><span class=\"line\"><span class=\"string\">expire_logs_days</span> <span class=\"string\">=</span> <span class=\"number\">7</span>                            <span class=\"comment\">#指定二进制日志的有效时间</span></span><br><span class=\"line\"><span class=\"string\">log_error</span> <span class=\"string\">=</span> <span class=\"string\">/usr/local/mysql/mysql-error.log</span>    <span class=\"comment\">#错误日志</span></span><br><span class=\"line\"><span class=\"string\">slow_query_log</span> <span class=\"string\">=</span> <span class=\"number\">1</span>                                <span class=\"comment\">#默认不开启,on|off</span></span><br><span class=\"line\"><span class=\"string\">long_query_time</span> <span class=\"string\">=</span> <span class=\"number\">1</span>                                <span class=\"comment\">#超过多少秒的查询就写入日志</span></span><br><span class=\"line\"><span class=\"string\">slow_query_log_file</span> <span class=\"string\">=</span> <span class=\"string\">/usr/local/mysql/mysql-slow.log</span>    <span class=\"comment\">#慢查询日志文件，mysqldumpslow  -h自带的查询慢日志工具。实例mysqldumpslow -s c -t 20 host-slow.log</span></span><br><span class=\"line\"><span class=\"string\">performance_schema</span> <span class=\"string\">=</span> <span class=\"number\">0</span>                            <span class=\"comment\">#用于收集数据库服务器性能参数</span></span><br><span class=\"line\"><span class=\"string\">explicit_defaults_for_timestamp</span>                    <span class=\"comment\">#自动填补timestamp字段的值</span></span><br><span class=\"line\"><span class=\"string\">lower_case_table_names</span> <span class=\"string\">=</span> <span class=\"number\">1</span>                        <span class=\"comment\">#0存储和比较都是大小写敏感，1存储时转换为小写，比较时不区分大小写。2存储时区分大小写，比较时转换为小写</span></span><br><span class=\"line\"><span class=\"string\">skip-external-locking</span>                            <span class=\"comment\">#跳过外部锁定，即多台服务器使用同一个数据目录，那么每台必须开启external-locking</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##network setting</span></span><br><span class=\"line\"><span class=\"string\">skip-name-resolve</span>                                <span class=\"comment\">#禁止mysql对外部连接DNS解析。如果打开，则所有远程主机授权都要使用IP方式，否则无法处理请求</span></span><br><span class=\"line\"><span class=\"string\">bind-address</span> <span class=\"string\">=</span> <span class=\"number\">0.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span>                            <span class=\"comment\">#服务监听地址</span></span><br><span class=\"line\"><span class=\"string\">max_connections</span> <span class=\"string\">=</span> <span class=\"number\">1024</span>                            <span class=\"comment\">#指定Mysql允许的最大连接进程数,可以过&#x27;conn%&#x27;通配符查看当前状态的连接数量，以定夺该值的大小。</span></span><br><span class=\"line\"><span class=\"string\">max_connect_errors</span> <span class=\"string\">=</span> <span class=\"number\">102400</span>                        <span class=\"comment\">#对于同一主机，如果超过该值的中断错误连接，则该主机被禁止连接。解禁FLUSH HOST</span></span><br><span class=\"line\"><span class=\"string\">max_allowed_packet</span> <span class=\"string\">=</span> <span class=\"string\">32M</span>                        <span class=\"comment\">#接受的数据包大小，增加该值十分的安全，这是因为只有当需要时才会分配额外的内存。去较小值是预防偶尔使用大信息而导致内存溢出</span></span><br><span class=\"line\"><span class=\"string\">interactive_timeout</span> <span class=\"string\">=</span> <span class=\"number\">28800</span>                        <span class=\"comment\">#默认28800,8小时。服务器关闭交互连接前等待活动的描述</span></span><br><span class=\"line\"><span class=\"string\">wait_timeout</span> <span class=\"string\">=</span> <span class=\"number\">28800</span>                            <span class=\"comment\">#默认28800，服务器关闭非交互连接之前等待活动的秒数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##innodb setting</span></span><br><span class=\"line\"><span class=\"string\">default_storage_engine</span> <span class=\"string\">=</span> <span class=\"string\">InnoDB</span>                    <span class=\"comment\">#默认存储引擎</span></span><br><span class=\"line\"><span class=\"string\">innodb_file_per_table</span> <span class=\"string\">=</span> <span class=\"number\">1</span>                        <span class=\"comment\">#独享表空间，关闭即可</span></span><br><span class=\"line\"><span class=\"string\">innodb_open_files</span> <span class=\"string\">=</span> <span class=\"number\">500</span>                            <span class=\"comment\">#默认300，限制Innodb能打开表的数据</span></span><br><span class=\"line\"><span class=\"string\">innodb_buffer_pool_size</span> <span class=\"string\">=</span> <span class=\"string\">1024M</span>                    <span class=\"comment\">#数据和索引的缓冲池，典型值5-6G（8G内存），20-25GB(32GB内存)，100-120GB(128GB内存)。</span></span><br><span class=\"line\"><span class=\"string\">innodb_write_io_threads</span> <span class=\"string\">=</span> <span class=\"number\">4</span>                        <span class=\"comment\">#写入磁盘IO</span></span><br><span class=\"line\"><span class=\"string\">innodb_read_io_threads</span> <span class=\"string\">=</span> <span class=\"number\">4</span>                        <span class=\"comment\">#读取磁盘IO</span></span><br><span class=\"line\"><span class=\"string\">innodb_thread_concurrency</span> <span class=\"string\">=</span> <span class=\"number\">0</span>                    <span class=\"comment\">#你的服务器CPU有几个就设置为几,建议用默认一般为8</span></span><br><span class=\"line\"><span class=\"string\">innodb_purge_threads</span> <span class=\"string\">=</span> <span class=\"number\">1</span>                        <span class=\"comment\">#最大值32，控制做purge(净化)操作的后台线程数</span></span><br><span class=\"line\"><span class=\"string\">innodb_flush_log_at_trx_commit</span> <span class=\"string\">=</span> <span class=\"number\">2</span>                <span class=\"comment\">#为2表示事务日志在提交时写入日志，但日志文件每次刷新到磁盘一次    </span></span><br><span class=\"line\"><span class=\"string\">innodb_log_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">2M</span>                        <span class=\"comment\">#指定日志文件所用内存大小，1-8之间</span></span><br><span class=\"line\"><span class=\"string\">innodb_log_file_size</span> <span class=\"string\">=</span> <span class=\"string\">32M</span>                        <span class=\"comment\">#指定日志文件大小</span></span><br><span class=\"line\"><span class=\"string\">innodb_log_files_in_group</span> <span class=\"string\">=</span> <span class=\"number\">3</span>                    <span class=\"comment\">#默认2，推荐3.mysql以循环方式将日志文件写入多个文件</span></span><br><span class=\"line\"><span class=\"string\">innodb_max_dirty_pages_pct</span> <span class=\"string\">=</span> <span class=\"number\">90</span>                    <span class=\"comment\">#默认75</span></span><br><span class=\"line\"><span class=\"string\">innodb_lock_wait_timeout</span> <span class=\"string\">=</span> <span class=\"number\">120</span>                    <span class=\"comment\">#默认50秒，</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##cache setting</span></span><br><span class=\"line\"><span class=\"string\">key_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">32M</span>                            <span class=\"comment\">#索引缓冲区大小，增加它可以得到更好的处理性能。对于4G左右服务器来说，该参数可设为256MB或384MB</span></span><br><span class=\"line\"><span class=\"string\">table_open_cache</span> <span class=\"string\">=</span> <span class=\"number\">512</span>                            <span class=\"comment\">#这个参数在5.1.3之后的版本中叫做table_open_cache，用于设置table高速缓存的数量。由于每个客户端连接都会至少访问一个表，</span></span><br><span class=\"line\"><span class=\"string\">sort_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">2M</span>                            <span class=\"comment\">#查询排序时所能使用的缓冲区大小，是一个connection级参数，即500个链接会占用500*8=4G内存</span></span><br><span class=\"line\"><span class=\"string\">join_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">2M</span>                            <span class=\"comment\">#联合查询所能使用的缓冲区大小，该参数分配的内存也是每个链接独享，默认2M</span></span><br><span class=\"line\"><span class=\"string\">read_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">2M</span>                            <span class=\"comment\">#用于对myisam表全表扫描时使用缓冲区大小，读查询所能使用的缓冲区大小，该参数分配的内存也是每个链接独享</span></span><br><span class=\"line\"><span class=\"string\">read_rnd_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">8M</span>                        <span class=\"comment\">#当需要时线程分配，当在排序后，从一个已经分配好的序列中读取行时，行数据从这个缓冲区读取防止磁盘寻道</span></span><br><span class=\"line\"><span class=\"string\">thread_cache_size</span> <span class=\"string\">=</span> <span class=\"number\">64</span>                            <span class=\"comment\">#服务器线程缓存，连接断开时放入缓存，线程重新被请求从缓存读取。设置规则：1GB内存配置8,2G内存配置18,3G内存32,4G或更高可配置更大                    </span></span><br><span class=\"line\"><span class=\"string\">query_cache_type</span> <span class=\"string\">=</span> <span class=\"number\">1</span>                            <span class=\"comment\">#是否开启查询缓存，默认0不开启，1缓存所有结果，2仅缓存select语句中通过SQL_CACHE指定的查询</span></span><br><span class=\"line\"><span class=\"string\">query_cache_size</span> <span class=\"string\">=</span> <span class=\"string\">64M</span>                            <span class=\"comment\">#指定查询缓冲区大小    ,一个select工作后，db会把该语句缓冲，当同一个SQL再次来到，DB未检查到该表发生变化时，会直接把结果返给client    </span></span><br><span class=\"line\"><span class=\"string\">query_cache_limit</span> <span class=\"string\">=</span> <span class=\"string\">2M</span>                            <span class=\"comment\">#指定单个查询缓存所能使用的缓冲区大小</span></span><br><span class=\"line\"><span class=\"string\">bulk_insert_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">8M</span>                    <span class=\"comment\">#默认8M，批量插入数据缓存大小，可以提高插入效率</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">myisam_sort_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">64M</span>                    <span class=\"comment\">#myisam表发生变化时，重新排序所需的缓冲，默认8M</span></span><br><span class=\"line\"><span class=\"string\">myisam_max_sort_file_size</span> <span class=\"string\">=</span> <span class=\"string\">10G</span>                    <span class=\"comment\">#mysql重建索引时允许的临时文件大小</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#event_scheduler =ON</span></span><br><span class=\"line\"><span class=\"comment\">#skip-external-locking</span></span><br><span class=\"line\"><span class=\"comment\">#sql_mode =&#x27;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"string\">mysqldump</span>]</span><br><span class=\"line\"><span class=\"string\">quick</span>                                            <span class=\"comment\">#备份方式</span></span><br><span class=\"line\"><span class=\"string\">max_allowed_packet</span> <span class=\"string\">=</span> <span class=\"string\">500M</span>                        <span class=\"comment\">#服务器发送和接受的最大包长度</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"string\">myisamchk</span>]</span><br><span class=\"line\"><span class=\"string\">key_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">256M</span>                            <span class=\"comment\">#key缓冲</span></span><br><span class=\"line\"><span class=\"string\">sort_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">8M</span>                            <span class=\"comment\">#排序缓冲</span></span><br><span class=\"line\"><span class=\"string\">read_buffer</span> <span class=\"string\">=</span> <span class=\"string\">4M</span>                                <span class=\"comment\">#读取缓冲</span></span><br><span class=\"line\"><span class=\"string\">write_buffer</span> <span class=\"string\">=</span> <span class=\"string\">4M</span>                                <span class=\"comment\">#写入缓冲</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"零、-环境\"><a href=\"#零、-环境\" class=\"headerlink\" title=\"零、 环境\"></a>零、 环境</h2><ul>\n<li>vmware centos7.2 4c8g</li>\n<li>mysql release: 5.7.34</li>\n<li>mysql installation path: &#x2F;usr&#x2F;local&#x2F;mysql</li>\n<li>mysql datadir: &#x2F;data&#x2F;mysql</li>\n<li>mysql cnf: &#x2F;etc&#x2F;my.cnf</li>\n</ul>\n<h2 id=\"一、安装前准备\"><a href=\"#一、安装前准备\" class=\"headerlink\" title=\"一、安装前准备\"></a>一、安装前准备</h2><h3 id=\"1-1-下载\"><a href=\"#1-1-下载\" class=\"headerlink\" title=\"1.1 下载\"></a>1.1 下载</h3><p><a href=\"https://dev.mysql.com/downloads/mysql/5.7.html\">下载地址</a></p>\n<img src=\"/images/051.MySQL_Install_Using_Generic_Binaries.md.01.png\" width=100% height=100% />\n\n<h3 id=\"1-2-解压到指定目录\"><a href=\"#1-2-解压到指定目录\" class=\"headerlink\" title=\"1.2 解压到指定目录\"></a>1.2 解压到指定目录</h3><p><code>tar -xzvf mysql-5.7.43-linux-glibc2.12-x86_64.tar.gz</code></p>\n<p><code>cp -Rf ./mysql-5.7.43-linux-glibc2.12-x86_64 /usr/local/mysql</code></p>\n<h3 id=\"1-3-创建相关目录和用户及组\"><a href=\"#1-3-创建相关目录和用户及组\" class=\"headerlink\" title=\"1.3 创建相关目录和用户及组\"></a>1.3 创建相关目录和用户及组</h3><p><code> groupadd mysql</code><br><code> useradd -g mysql mysql</code><br><code> mkdir -p /data/mysql</code><br><code> chown -R mysql:mysql /data/mysql</code><br><code> chmod -R 750 /data/mysql</code></p>\n<h3 id=\"1-4-为MySQL实例创建配置文件\"><a href=\"#1-4-为MySQL实例创建配置文件\" class=\"headerlink\" title=\"1.4 为MySQL实例创建配置文件\"></a>1.4 为MySQL实例创建配置文件</h3><p><code>vim /etc/my.cnf</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">mysqld</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 数据目录</span></span><br><span class=\"line\"><span class=\"string\">datadir=/data/mysql/</span></span><br><span class=\"line\"><span class=\"comment\"># socket 目录</span></span><br><span class=\"line\"><span class=\"string\">socket=/data/mysql/mysql.sock</span></span><br><span class=\"line\"><span class=\"comment\"># 日志</span></span><br><span class=\"line\"><span class=\"string\">log-error=/data/mysql/mysql-err.log</span></span><br><span class=\"line\"><span class=\"comment\">#端口</span></span><br><span class=\"line\"><span class=\"string\">port=3306</span></span><br><span class=\"line\"><span class=\"comment\"># 实例ID</span></span><br><span class=\"line\"><span class=\"string\">server-id=1</span></span><br><span class=\"line\"><span class=\"string\">innodb_buffer_pool_size</span> <span class=\"string\">=</span> <span class=\"string\">50G</span></span><br><span class=\"line\"><span class=\"string\">lower_case_table_names=0</span></span><br><span class=\"line\"><span class=\"comment\"># 缓存目录</span></span><br><span class=\"line\"><span class=\"string\">tmpdir=/data/mysql/tmp/</span></span><br><span class=\"line\"><span class=\"comment\"># MySQL二进制文件基目录不是默认目录时，需要配置lc_messages_dir=/usr/local/mysql/share传递它的路径.否则，MySQL 将无法启动。</span></span><br><span class=\"line\"><span class=\"string\">lc_messages_dir=/usr/local/mysql/share</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"二、-安装\"><a href=\"#二、-安装\" class=\"headerlink\" title=\"二、 安装\"></a>二、 安装</h2><h3 id=\"2-1-初始化实例\"><a href=\"#2-1-初始化实例\" class=\"headerlink\" title=\"2.1 初始化实例\"></a>2.1 初始化实例</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">/usr/local/mysql/bin/mysqld</span> <span class=\"string\">--no-defaults</span> <span class=\"string\">--initialize-insecure</span> <span class=\"string\">--user=mysql</span> <span class=\"string\">--datadir=/data/mysql/</span> <span class=\"string\">--lower_case_table_names=0</span> </span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>To initialize the data directory, invoke mysqld with the <code>--initialize </code> or <code>--initialize-insecure</code> option, depending on whether you want the server to generate a random initial password for the <code>&#39;root&#39;@&#39;localhost&#39;</code> account, or to create that account with no password:</p>\n<blockquote>\n<p>Use <code>--initialize</code> for “secure by default” installation (that is, including generation of a random initial root password). In this case, the password is marked as expired and you must choose a new one.</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>With <code>--initialize-insecure</code> , no root password is generated. This is insecure; it is assumed that you intend to assign a password to the account in a timely fashion before putting the server into production use. </p>\n</blockquote>\n</blockquote>\n<p>可以使用 <code>grep &quot;password&quot; /path to you mysql-err.log</code> 找到使用<code>--initialize</code>生成的随机密码</p>\n<p><strong>补充</strong>:</p>\n<ul>\n<li>创建目录 <code>mkdir -p /data/mysql/tmp</code> 的步骤一定要在初始化实例之前</li>\n<li>初始化的时候检测到数据目录 &#x2F;data&#x2F;mysql下存在其他文件或者文件夹的时候会报错.</li>\n</ul>\n<img src=\"/images/051.MySQL_Install_Using_Generic_Binaries.md.02.png\" width=100% height=100% />\n\n\n\n<h2 id=\"三、-使用-systemd-管理\"><a href=\"#三、-使用-systemd-管理\" class=\"headerlink\" title=\"三、 使用 systemd 管理\"></a>三、 使用 systemd 管理</h2><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /usr/lib/systemd/system/mysql.service</span></span><br><span class=\"line\"><span class=\"comment\"># Copyright (c) 2016, 2021, Oracle and/or its affiliates.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># This program is free software; you can redistribute it and/or modify</span></span><br><span class=\"line\"><span class=\"comment\"># it under the terms of the GNU General Public License, version 2.0,</span></span><br><span class=\"line\"><span class=\"comment\"># as published by the Free Software Foundation.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># This program is also distributed with certain software (including</span></span><br><span class=\"line\"><span class=\"comment\"># but not limited to OpenSSL) that is licensed under separate terms,</span></span><br><span class=\"line\"><span class=\"comment\"># as designated in a particular file or component or in included license</span></span><br><span class=\"line\"><span class=\"comment\"># documentation.  The authors of MySQL hereby grant you an additional</span></span><br><span class=\"line\"><span class=\"comment\"># permission to link the program and your derivative works with the</span></span><br><span class=\"line\"><span class=\"comment\"># separately licensed software that they have included with MySQL.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># This program is distributed in the hope that it will be useful,</span></span><br><span class=\"line\"><span class=\"comment\"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span><br><span class=\"line\"><span class=\"comment\"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></span><br><span class=\"line\"><span class=\"comment\"># GNU General Public License, version 2.0, for more details.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># You should have received a copy of the GNU General Public License</span></span><br><span class=\"line\"><span class=\"comment\"># along with this program; if not, write to the Free Software</span></span><br><span class=\"line\"><span class=\"comment\"># Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># systemd service file for MySQL forking server</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"> </span><br><span class=\"line\">[<span class=\"string\">Unit</span>]</span><br><span class=\"line\"><span class=\"string\">Description=MySQL</span> <span class=\"string\">Server</span></span><br><span class=\"line\"><span class=\"string\">Documentation=man:mysqld(8)</span></span><br><span class=\"line\"><span class=\"string\">Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html</span></span><br><span class=\"line\"><span class=\"string\">After=network.target</span></span><br><span class=\"line\"><span class=\"string\">After=syslog.target</span></span><br><span class=\"line\"> </span><br><span class=\"line\">[<span class=\"string\">Install</span>]</span><br><span class=\"line\"><span class=\"string\">WantedBy=multi-user.target</span></span><br><span class=\"line\">[<span class=\"string\">Service</span>]</span><br><span class=\"line\"><span class=\"string\">User=mysql</span></span><br><span class=\"line\"><span class=\"string\">Group=mysql</span></span><br><span class=\"line\"><span class=\"string\">Type=forking</span></span><br><span class=\"line\"><span class=\"string\">PIDFile=/data/mysql/mysqld.pid</span></span><br><span class=\"line\"><span class=\"comment\"># Disable service start and stop timeout logic of systemd for mysqld service.</span></span><br><span class=\"line\"><span class=\"string\">TimeoutSec=0</span></span><br><span class=\"line\"><span class=\"comment\"># Execute pre and post scripts as root</span></span><br><span class=\"line\"><span class=\"string\">PermissionsStartOnly=true</span></span><br><span class=\"line\"><span class=\"comment\"># Needed to create system tables</span></span><br><span class=\"line\"><span class=\"comment\"># ExecStartPre=/usr/bin/mysqld_pre_systemd %I</span></span><br><span class=\"line\"><span class=\"comment\"># Start main service</span></span><br><span class=\"line\"><span class=\"string\">ExecStart=/usr/local/mysql/bin/mysqld</span> <span class=\"string\">--defaults-file=/etc/my.cnf</span>  <span class=\"string\">--daemonize</span> <span class=\"string\">--pid-file=/data/mysql/mysqld.pid</span> <span class=\"string\">$MYSQLD_OPTS</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># Use this to switch malloc implementation</span></span><br><span class=\"line\"><span class=\"string\">EnvironmentFile=-/etc/sysconfig/mysql</span></span><br><span class=\"line\"><span class=\"comment\"># Sets open_files_limit</span></span><br><span class=\"line\"><span class=\"string\">LimitNOFILE</span> <span class=\"string\">=</span> <span class=\"number\">65536</span></span><br><span class=\"line\"><span class=\"string\">Restart=on-failure</span></span><br><span class=\"line\"><span class=\"string\">RestartPreventExitStatus=1</span></span><br><span class=\"line\"><span class=\"string\">Environment=MYSQLD_PARENT_PID=1</span></span><br><span class=\"line\"><span class=\"string\">PrivateTmp=false</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-1-启动MySQL\"><a href=\"#3-1-启动MySQL\" class=\"headerlink\" title=\"3.1 启动MySQL\"></a>3.1 启动MySQL</h3><p><code>systemctl daemon-reload</code><br><code>systemctl enable mysql --now</code><br><code>systemctl status mysql</code></p>\n<h2 id=\"四、-MySQL-配置文件参数优化\"><a href=\"#四、-MySQL-配置文件参数优化\" class=\"headerlink\" title=\"四、 MySQL 配置文件参数优化\"></a>四、 MySQL 配置文件参数优化</h2><p>仅供参考:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">client</span>]                                        <span class=\"comment\">#客户端配置</span></span><br><span class=\"line\"><span class=\"string\">port=</span> <span class=\"number\">3306</span>                                        <span class=\"comment\">#监听端口</span></span><br><span class=\"line\"><span class=\"string\">socket=</span> <span class=\"string\">/tmp/mysql.sock</span>                            <span class=\"comment\">#socket通信文件</span></span><br><span class=\"line\"><span class=\"string\">default-character-set</span> <span class=\"string\">=</span> <span class=\"string\">utf8</span>                    <span class=\"comment\">#客户端字符编码</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"string\">mysql</span>]                                            <span class=\"comment\">#终端管理</span></span><br><span class=\"line\"><span class=\"string\">prompt=&quot;MySQL</span> [<span class=\"string\">\\d</span>]<span class=\"string\">&gt;</span> <span class=\"string\">&quot;                            #prompt=&quot;</span><span class=\"string\">\\\\u@\\\\h:\\\\d&gt;&quot;</span>   <span class=\"string\">终端连接后显示后用户、主机、当前数据库</span></span><br><span class=\"line\"><span class=\"literal\">no</span><span class=\"string\">-auto-rehash</span>                                    <span class=\"comment\">#auto-rehash   命令行自动补全功能</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"string\">mysqld</span>]                                        <span class=\"comment\">#服务器配置</span></span><br><span class=\"line\"><span class=\"string\">port</span> <span class=\"string\">=</span> <span class=\"number\">3306</span>                                        <span class=\"comment\">#端口</span></span><br><span class=\"line\"><span class=\"string\">socket</span> <span class=\"string\">=</span> <span class=\"string\">/tmp/mysql.sock</span>                        <span class=\"comment\">#套接字</span></span><br><span class=\"line\"><span class=\"string\">datadir</span> <span class=\"string\">=</span> <span class=\"string\">/data/mysql</span>               <span class=\"comment\">#数据库文件所在目录</span></span><br><span class=\"line\"><span class=\"string\">basedir</span> <span class=\"string\">=</span> <span class=\"string\">/usr/local/mysql</span>                        <span class=\"comment\">#基准路径，其它路径都相对于此路径</span></span><br><span class=\"line\"><span class=\"string\">pid-file</span> <span class=\"string\">=</span> <span class=\"string\">/usr/local/mysql/mysql.pid</span>            <span class=\"comment\">#pid文件</span></span><br><span class=\"line\"><span class=\"string\">user</span> <span class=\"string\">=</span> <span class=\"string\">mysql</span>                                    <span class=\"comment\">#管理用户</span></span><br><span class=\"line\"><span class=\"string\">server-id=1</span>                                        <span class=\"comment\">#本机序列号</span></span><br><span class=\"line\"><span class=\"string\">init-connect</span> <span class=\"string\">=</span> <span class=\"string\">&#x27;SET NAMES utf8&#x27;</span>                    <span class=\"comment\">#当一个连接进来时，做一些操作，此处为连接创建时设置字符编码</span></span><br><span class=\"line\"><span class=\"string\">character_set_server=utf8</span>                        <span class=\"comment\">#服务器默认字符集</span></span><br><span class=\"line\"><span class=\"comment\">#skip-networking                                #开启则彻底关闭mysql的TCP/IP连接方式</span></span><br><span class=\"line\"><span class=\"string\">back_log</span> <span class=\"string\">=</span> <span class=\"number\">300</span>                                    <span class=\"comment\">#并发是等待的数量</span></span><br><span class=\"line\"><span class=\"string\">open_files_limit</span> <span class=\"string\">=</span> <span class=\"number\">65535</span>                        <span class=\"comment\">#打开的文件描述符限制</span></span><br><span class=\"line\"><span class=\"string\">binlog_cache_size</span> <span class=\"string\">=</span> <span class=\"string\">1M</span>                            <span class=\"comment\">#事务未提交时会记录到cache，等到事务提交，则把日志持久化到磁盘，默认32k,如果事务比此值大，会使用磁盘临时文件替代</span></span><br><span class=\"line\"><span class=\"string\">max_heap_table_size</span> <span class=\"string\">=</span> <span class=\"string\">8M</span>                        <span class=\"comment\">#用户创建的内存表最大值，为防止意外超大的内存表耗尽内存资源</span></span><br><span class=\"line\"><span class=\"string\">tmp_table_size</span> <span class=\"string\">=</span> <span class=\"string\">128M</span>                            <span class=\"comment\">#内存中临时表的大小，如果超过此值，则转换为基于磁盘的表，默认32M</span></span><br><span class=\"line\"><span class=\"string\">ft_min_word_len</span> <span class=\"string\">=</span> <span class=\"number\">4</span>                                <span class=\"comment\">#全文索引最小长度，</span></span><br><span class=\"line\"><span class=\"string\">log_bin</span> <span class=\"string\">=</span> <span class=\"string\">mysql-bin</span>                                <span class=\"comment\">#二进制文件</span></span><br><span class=\"line\"><span class=\"string\">binlog_format</span> <span class=\"string\">=</span> <span class=\"string\">mixed</span>                            <span class=\"comment\">#二进制日志格式，默认statement，建议mixed                    </span></span><br><span class=\"line\"><span class=\"string\">expire_logs_days</span> <span class=\"string\">=</span> <span class=\"number\">7</span>                            <span class=\"comment\">#指定二进制日志的有效时间</span></span><br><span class=\"line\"><span class=\"string\">log_error</span> <span class=\"string\">=</span> <span class=\"string\">/usr/local/mysql/mysql-error.log</span>    <span class=\"comment\">#错误日志</span></span><br><span class=\"line\"><span class=\"string\">slow_query_log</span> <span class=\"string\">=</span> <span class=\"number\">1</span>                                <span class=\"comment\">#默认不开启,on|off</span></span><br><span class=\"line\"><span class=\"string\">long_query_time</span> <span class=\"string\">=</span> <span class=\"number\">1</span>                                <span class=\"comment\">#超过多少秒的查询就写入日志</span></span><br><span class=\"line\"><span class=\"string\">slow_query_log_file</span> <span class=\"string\">=</span> <span class=\"string\">/usr/local/mysql/mysql-slow.log</span>    <span class=\"comment\">#慢查询日志文件，mysqldumpslow  -h自带的查询慢日志工具。实例mysqldumpslow -s c -t 20 host-slow.log</span></span><br><span class=\"line\"><span class=\"string\">performance_schema</span> <span class=\"string\">=</span> <span class=\"number\">0</span>                            <span class=\"comment\">#用于收集数据库服务器性能参数</span></span><br><span class=\"line\"><span class=\"string\">explicit_defaults_for_timestamp</span>                    <span class=\"comment\">#自动填补timestamp字段的值</span></span><br><span class=\"line\"><span class=\"string\">lower_case_table_names</span> <span class=\"string\">=</span> <span class=\"number\">1</span>                        <span class=\"comment\">#0存储和比较都是大小写敏感，1存储时转换为小写，比较时不区分大小写。2存储时区分大小写，比较时转换为小写</span></span><br><span class=\"line\"><span class=\"string\">skip-external-locking</span>                            <span class=\"comment\">#跳过外部锁定，即多台服务器使用同一个数据目录，那么每台必须开启external-locking</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##network setting</span></span><br><span class=\"line\"><span class=\"string\">skip-name-resolve</span>                                <span class=\"comment\">#禁止mysql对外部连接DNS解析。如果打开，则所有远程主机授权都要使用IP方式，否则无法处理请求</span></span><br><span class=\"line\"><span class=\"string\">bind-address</span> <span class=\"string\">=</span> <span class=\"number\">0.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span>                            <span class=\"comment\">#服务监听地址</span></span><br><span class=\"line\"><span class=\"string\">max_connections</span> <span class=\"string\">=</span> <span class=\"number\">1024</span>                            <span class=\"comment\">#指定Mysql允许的最大连接进程数,可以过&#x27;conn%&#x27;通配符查看当前状态的连接数量，以定夺该值的大小。</span></span><br><span class=\"line\"><span class=\"string\">max_connect_errors</span> <span class=\"string\">=</span> <span class=\"number\">102400</span>                        <span class=\"comment\">#对于同一主机，如果超过该值的中断错误连接，则该主机被禁止连接。解禁FLUSH HOST</span></span><br><span class=\"line\"><span class=\"string\">max_allowed_packet</span> <span class=\"string\">=</span> <span class=\"string\">32M</span>                        <span class=\"comment\">#接受的数据包大小，增加该值十分的安全，这是因为只有当需要时才会分配额外的内存。去较小值是预防偶尔使用大信息而导致内存溢出</span></span><br><span class=\"line\"><span class=\"string\">interactive_timeout</span> <span class=\"string\">=</span> <span class=\"number\">28800</span>                        <span class=\"comment\">#默认28800,8小时。服务器关闭交互连接前等待活动的描述</span></span><br><span class=\"line\"><span class=\"string\">wait_timeout</span> <span class=\"string\">=</span> <span class=\"number\">28800</span>                            <span class=\"comment\">#默认28800，服务器关闭非交互连接之前等待活动的秒数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##innodb setting</span></span><br><span class=\"line\"><span class=\"string\">default_storage_engine</span> <span class=\"string\">=</span> <span class=\"string\">InnoDB</span>                    <span class=\"comment\">#默认存储引擎</span></span><br><span class=\"line\"><span class=\"string\">innodb_file_per_table</span> <span class=\"string\">=</span> <span class=\"number\">1</span>                        <span class=\"comment\">#独享表空间，关闭即可</span></span><br><span class=\"line\"><span class=\"string\">innodb_open_files</span> <span class=\"string\">=</span> <span class=\"number\">500</span>                            <span class=\"comment\">#默认300，限制Innodb能打开表的数据</span></span><br><span class=\"line\"><span class=\"string\">innodb_buffer_pool_size</span> <span class=\"string\">=</span> <span class=\"string\">1024M</span>                    <span class=\"comment\">#数据和索引的缓冲池，典型值5-6G（8G内存），20-25GB(32GB内存)，100-120GB(128GB内存)。</span></span><br><span class=\"line\"><span class=\"string\">innodb_write_io_threads</span> <span class=\"string\">=</span> <span class=\"number\">4</span>                        <span class=\"comment\">#写入磁盘IO</span></span><br><span class=\"line\"><span class=\"string\">innodb_read_io_threads</span> <span class=\"string\">=</span> <span class=\"number\">4</span>                        <span class=\"comment\">#读取磁盘IO</span></span><br><span class=\"line\"><span class=\"string\">innodb_thread_concurrency</span> <span class=\"string\">=</span> <span class=\"number\">0</span>                    <span class=\"comment\">#你的服务器CPU有几个就设置为几,建议用默认一般为8</span></span><br><span class=\"line\"><span class=\"string\">innodb_purge_threads</span> <span class=\"string\">=</span> <span class=\"number\">1</span>                        <span class=\"comment\">#最大值32，控制做purge(净化)操作的后台线程数</span></span><br><span class=\"line\"><span class=\"string\">innodb_flush_log_at_trx_commit</span> <span class=\"string\">=</span> <span class=\"number\">2</span>                <span class=\"comment\">#为2表示事务日志在提交时写入日志，但日志文件每次刷新到磁盘一次    </span></span><br><span class=\"line\"><span class=\"string\">innodb_log_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">2M</span>                        <span class=\"comment\">#指定日志文件所用内存大小，1-8之间</span></span><br><span class=\"line\"><span class=\"string\">innodb_log_file_size</span> <span class=\"string\">=</span> <span class=\"string\">32M</span>                        <span class=\"comment\">#指定日志文件大小</span></span><br><span class=\"line\"><span class=\"string\">innodb_log_files_in_group</span> <span class=\"string\">=</span> <span class=\"number\">3</span>                    <span class=\"comment\">#默认2，推荐3.mysql以循环方式将日志文件写入多个文件</span></span><br><span class=\"line\"><span class=\"string\">innodb_max_dirty_pages_pct</span> <span class=\"string\">=</span> <span class=\"number\">90</span>                    <span class=\"comment\">#默认75</span></span><br><span class=\"line\"><span class=\"string\">innodb_lock_wait_timeout</span> <span class=\"string\">=</span> <span class=\"number\">120</span>                    <span class=\"comment\">#默认50秒，</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##cache setting</span></span><br><span class=\"line\"><span class=\"string\">key_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">32M</span>                            <span class=\"comment\">#索引缓冲区大小，增加它可以得到更好的处理性能。对于4G左右服务器来说，该参数可设为256MB或384MB</span></span><br><span class=\"line\"><span class=\"string\">table_open_cache</span> <span class=\"string\">=</span> <span class=\"number\">512</span>                            <span class=\"comment\">#这个参数在5.1.3之后的版本中叫做table_open_cache，用于设置table高速缓存的数量。由于每个客户端连接都会至少访问一个表，</span></span><br><span class=\"line\"><span class=\"string\">sort_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">2M</span>                            <span class=\"comment\">#查询排序时所能使用的缓冲区大小，是一个connection级参数，即500个链接会占用500*8=4G内存</span></span><br><span class=\"line\"><span class=\"string\">join_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">2M</span>                            <span class=\"comment\">#联合查询所能使用的缓冲区大小，该参数分配的内存也是每个链接独享，默认2M</span></span><br><span class=\"line\"><span class=\"string\">read_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">2M</span>                            <span class=\"comment\">#用于对myisam表全表扫描时使用缓冲区大小，读查询所能使用的缓冲区大小，该参数分配的内存也是每个链接独享</span></span><br><span class=\"line\"><span class=\"string\">read_rnd_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">8M</span>                        <span class=\"comment\">#当需要时线程分配，当在排序后，从一个已经分配好的序列中读取行时，行数据从这个缓冲区读取防止磁盘寻道</span></span><br><span class=\"line\"><span class=\"string\">thread_cache_size</span> <span class=\"string\">=</span> <span class=\"number\">64</span>                            <span class=\"comment\">#服务器线程缓存，连接断开时放入缓存，线程重新被请求从缓存读取。设置规则：1GB内存配置8,2G内存配置18,3G内存32,4G或更高可配置更大                    </span></span><br><span class=\"line\"><span class=\"string\">query_cache_type</span> <span class=\"string\">=</span> <span class=\"number\">1</span>                            <span class=\"comment\">#是否开启查询缓存，默认0不开启，1缓存所有结果，2仅缓存select语句中通过SQL_CACHE指定的查询</span></span><br><span class=\"line\"><span class=\"string\">query_cache_size</span> <span class=\"string\">=</span> <span class=\"string\">64M</span>                            <span class=\"comment\">#指定查询缓冲区大小    ,一个select工作后，db会把该语句缓冲，当同一个SQL再次来到，DB未检查到该表发生变化时，会直接把结果返给client    </span></span><br><span class=\"line\"><span class=\"string\">query_cache_limit</span> <span class=\"string\">=</span> <span class=\"string\">2M</span>                            <span class=\"comment\">#指定单个查询缓存所能使用的缓冲区大小</span></span><br><span class=\"line\"><span class=\"string\">bulk_insert_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">8M</span>                    <span class=\"comment\">#默认8M，批量插入数据缓存大小，可以提高插入效率</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">myisam_sort_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">64M</span>                    <span class=\"comment\">#myisam表发生变化时，重新排序所需的缓冲，默认8M</span></span><br><span class=\"line\"><span class=\"string\">myisam_max_sort_file_size</span> <span class=\"string\">=</span> <span class=\"string\">10G</span>                    <span class=\"comment\">#mysql重建索引时允许的临时文件大小</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#event_scheduler =ON</span></span><br><span class=\"line\"><span class=\"comment\">#skip-external-locking</span></span><br><span class=\"line\"><span class=\"comment\">#sql_mode =&#x27;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"string\">mysqldump</span>]</span><br><span class=\"line\"><span class=\"string\">quick</span>                                            <span class=\"comment\">#备份方式</span></span><br><span class=\"line\"><span class=\"string\">max_allowed_packet</span> <span class=\"string\">=</span> <span class=\"string\">500M</span>                        <span class=\"comment\">#服务器发送和接受的最大包长度</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"string\">myisamchk</span>]</span><br><span class=\"line\"><span class=\"string\">key_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">256M</span>                            <span class=\"comment\">#key缓冲</span></span><br><span class=\"line\"><span class=\"string\">sort_buffer_size</span> <span class=\"string\">=</span> <span class=\"string\">8M</span>                            <span class=\"comment\">#排序缓冲</span></span><br><span class=\"line\"><span class=\"string\">read_buffer</span> <span class=\"string\">=</span> <span class=\"string\">4M</span>                                <span class=\"comment\">#读取缓冲</span></span><br><span class=\"line\"><span class=\"string\">write_buffer</span> <span class=\"string\">=</span> <span class=\"string\">4M</span>                                <span class=\"comment\">#写入缓冲</span></span><br></pre></td></tr></table></figure>"},{"title":"自动化监控运维(一)Prometheus 构建","date":"2023-09-26T07:29:47.000Z","_content":"\n## 零、 说明\n\n- 两种部署方式\n  - 二进制包部署+systemd管理\n  - docker 部署\n\n\n## 一、 二进制方式部署\n\n### 1.1 下载\n\n[下载连接](https://prometheus.io/download/) \n\n\n### 1.2 解压\n\n``` tar -xzvf prometheus-2.47.0.linux-amd64.tar.gz ```\n``` cp -r prometheus-2.47.0.linux-amd64 /usr/local/prometheus ``` \n\n### 1.3 运行测试\n\n``` cd /usr/local/prometheus ```\n``` ./prometheus --config.file=./prometheus.yml ```\n\n默认数据目录: ``` ./data  ```\n \n### 1.4 访问测试\n\n``` curl http://192.168.128.203:9090/metrics ```\n\n有数据返回一般就没什么问题了.\n\n### 1.5 使用 systemd 管理\n\n``` yaml\n# /usr/local/prometheus-2.47/prometheus.service\n[Unit]\nDescription=Prometheus Server\nDocumentation=https://prometheus.io/docs/introduction/overview/\nAfter=network-online.target\n\n[Service]\nType=simple\nUser=root\nRestart=on-failure\nExecReload=/bin/kill -HUP $MAINPID\nExecStart=/usr/local/prometheus-2.47/prometheus \\\n  --config.file=/usr/local/prometheus-2.47/prometheus.yml \\\n  --storage.tsdb.path /usr/local/prometheus-2.47/data \\\n  --storage.tsdb.retention=15d\n\n[Install]\nWantedBy=multi-user.target\n\n```\n\n``` systemctl daemon-reload ```\n``` systemctl enable prometheus --now ```\n\n\n## 二、 使用 docker 构建\n\n### 2.1 基于centos7.9镜像构建\n\n``` docker build -network=host -t prometheus-2.47.0 .```\n- ``` -network=host ```可以有效避免yum install的报错\n- ``` -t prometheus-2.47.0 ``` 指定构建后的镜像名称\n\nDockerfile: ``` vim Dockerfile```\n``` yaml\nFROM centos:centos7\n\n# Define Prometheus home and its version\nARG PROMETHEUS_HOME=/opt/prometheus\nARG PROMETHEUS_VERSION=2.47.0\n\n# Define TAR & folder names, as well as download URL for easier use\nARG PROMETHEUS_TAR_MAYOR=prometheus-${PROMETHEUS_VERSION}.linux-amd64\nARG PROMETHEUS_TAR_FULLNAME=${PROMETHEUS_TAR_MAYOR}.tar.gz\nARG PROMETHEUS_URL=https://github.com/prometheus/prometheus/releases/download/v${PROMETHEUS_VERSION}/${PROMETHEUS_TAR_FULLNAME}\n\n# Install wget; download Prometheus\nRUN yum install -y wget && \\\n    wget ${PROMETHEUS_URL}\n\n# Untar the file and rename it to \"prometheus\"\nRUN tar xvfz ${PROMETHEUS_TAR_FULLNAME} -C /opt && \\\n    mv /opt/${PROMETHEUS_TAR_MAYOR} /opt/prometheus && \\\n    rm -rf /opt/prometheus/prometheus.yml\n\nRUN groupadd -r prometheus && \\\n    useradd -g prometheus -s /bin/bash -c \"Prometheus user\" prometheus && \\\n    chown -R prometheus:prometheus /opt/prometheus\n\nCOPY config/prometheus.yml /opt/prometheus/prometheus.yml\n\nRUN chown prometheus:prometheus /opt/prometheus/prometheus.yml && \\\n    chmod 755 /opt/prometheus/prometheus.yml\n\nEXPOSE 9090\nVOLUME  [ \"/opt/prometheus\" ]\nWORKDIR ${PROMETHEUS_HOME}\n\nUSER prometheus\n\nENTRYPOINT [ \"./prometheus\" ]\nCMD        [ \"--config.file=prometheus.yml\" ]\n```\n\n运行镜像测试:\n``` docker run -p 9090:9090 prometheus-2.47.0 ```\n\n\n### 2.2 使用 docker-compose 快速构建\n\n``` vim Prometheus.yaml ```\n\n``` yaml\nversion: \"3\"\nservices:\n    prometheus:\n        image: prometheus-2.47.0:latest\n        user: \"1000:1000\"\n        ports:\n            - \"9090:9090\"\n        container_name: prometheus\n        restart: always\n        volumes:\n            - /usr/local/prometheus-2.47/prometheus.yml:/opt/prometheus/prometheus.yml\nnetworks:\n    default:\n        driver: bridge\n```\n\n\n运行: \n\n``` docker-compose -f prometheus.yaml up -d ```\n\n\n\n## 三、 常见问题\n\n### 3.1 Prometheus查询不到数据\n\n报错详情: **Error on ingesting samples that are too old or are too far into the future**\n报错详情: **err=\"out of bounds\"**\n``` yaml\ncaller=scrape.go:1741 level=warn component=\"scrape manager\" scrape_pool=prometheus target=http://192.168.128.203:9090/metrics msg=\"Error on ingesting samples that are too old or are too far into the future\" num_dropped=666\n\ncaller=scrape.go:1405 level=warn component=\"scrape manager\" scrape_pool=prometheus target=http://192.168.128.203:9090/metrics msg=\"Append failed\" err=\"out of bounds\"\n```\n> [引用](https://forum.gitlab.com/t/prometheus-out-of-bounds-error-after-reboot/75229)\n\n**问题解决**: 构建镜像或者其他原因造成的容器内时间和容器外时间不一致,且Prometheus已获取了错误时间内的相关数据.\n             清空容器内 ```/opt/prometheus/data``` 的数据 并重启容器.\n\n**清空容器内错误数据:**\n``` docker exec -it prometheus /bin/bash```\n``` cd /opt/prometheus/data ```\n``` rm -rf 0* wal/0* wal/checkpoint.0* ```\n\n**重启容器:**\n``` docker-compose -f prometheus.yaml down ```\n``` docker-compose -f prometheus.yaml up -d ```\n\n<img src=\"/images/053.Prometheus_Installation.md.01.png\" width=100% height=100% />","source":"_posts/053.Prometheus_Installation.md","raw":"---\ntitle: 自动化监控运维(一)Prometheus 构建\ndate: 2023-9-26 15:29:47\ncategories: \n- [Monitor]\ntags: \n- Prometheus\n---\n\n## 零、 说明\n\n- 两种部署方式\n  - 二进制包部署+systemd管理\n  - docker 部署\n\n\n## 一、 二进制方式部署\n\n### 1.1 下载\n\n[下载连接](https://prometheus.io/download/) \n\n\n### 1.2 解压\n\n``` tar -xzvf prometheus-2.47.0.linux-amd64.tar.gz ```\n``` cp -r prometheus-2.47.0.linux-amd64 /usr/local/prometheus ``` \n\n### 1.3 运行测试\n\n``` cd /usr/local/prometheus ```\n``` ./prometheus --config.file=./prometheus.yml ```\n\n默认数据目录: ``` ./data  ```\n \n### 1.4 访问测试\n\n``` curl http://192.168.128.203:9090/metrics ```\n\n有数据返回一般就没什么问题了.\n\n### 1.5 使用 systemd 管理\n\n``` yaml\n# /usr/local/prometheus-2.47/prometheus.service\n[Unit]\nDescription=Prometheus Server\nDocumentation=https://prometheus.io/docs/introduction/overview/\nAfter=network-online.target\n\n[Service]\nType=simple\nUser=root\nRestart=on-failure\nExecReload=/bin/kill -HUP $MAINPID\nExecStart=/usr/local/prometheus-2.47/prometheus \\\n  --config.file=/usr/local/prometheus-2.47/prometheus.yml \\\n  --storage.tsdb.path /usr/local/prometheus-2.47/data \\\n  --storage.tsdb.retention=15d\n\n[Install]\nWantedBy=multi-user.target\n\n```\n\n``` systemctl daemon-reload ```\n``` systemctl enable prometheus --now ```\n\n\n## 二、 使用 docker 构建\n\n### 2.1 基于centos7.9镜像构建\n\n``` docker build -network=host -t prometheus-2.47.0 .```\n- ``` -network=host ```可以有效避免yum install的报错\n- ``` -t prometheus-2.47.0 ``` 指定构建后的镜像名称\n\nDockerfile: ``` vim Dockerfile```\n``` yaml\nFROM centos:centos7\n\n# Define Prometheus home and its version\nARG PROMETHEUS_HOME=/opt/prometheus\nARG PROMETHEUS_VERSION=2.47.0\n\n# Define TAR & folder names, as well as download URL for easier use\nARG PROMETHEUS_TAR_MAYOR=prometheus-${PROMETHEUS_VERSION}.linux-amd64\nARG PROMETHEUS_TAR_FULLNAME=${PROMETHEUS_TAR_MAYOR}.tar.gz\nARG PROMETHEUS_URL=https://github.com/prometheus/prometheus/releases/download/v${PROMETHEUS_VERSION}/${PROMETHEUS_TAR_FULLNAME}\n\n# Install wget; download Prometheus\nRUN yum install -y wget && \\\n    wget ${PROMETHEUS_URL}\n\n# Untar the file and rename it to \"prometheus\"\nRUN tar xvfz ${PROMETHEUS_TAR_FULLNAME} -C /opt && \\\n    mv /opt/${PROMETHEUS_TAR_MAYOR} /opt/prometheus && \\\n    rm -rf /opt/prometheus/prometheus.yml\n\nRUN groupadd -r prometheus && \\\n    useradd -g prometheus -s /bin/bash -c \"Prometheus user\" prometheus && \\\n    chown -R prometheus:prometheus /opt/prometheus\n\nCOPY config/prometheus.yml /opt/prometheus/prometheus.yml\n\nRUN chown prometheus:prometheus /opt/prometheus/prometheus.yml && \\\n    chmod 755 /opt/prometheus/prometheus.yml\n\nEXPOSE 9090\nVOLUME  [ \"/opt/prometheus\" ]\nWORKDIR ${PROMETHEUS_HOME}\n\nUSER prometheus\n\nENTRYPOINT [ \"./prometheus\" ]\nCMD        [ \"--config.file=prometheus.yml\" ]\n```\n\n运行镜像测试:\n``` docker run -p 9090:9090 prometheus-2.47.0 ```\n\n\n### 2.2 使用 docker-compose 快速构建\n\n``` vim Prometheus.yaml ```\n\n``` yaml\nversion: \"3\"\nservices:\n    prometheus:\n        image: prometheus-2.47.0:latest\n        user: \"1000:1000\"\n        ports:\n            - \"9090:9090\"\n        container_name: prometheus\n        restart: always\n        volumes:\n            - /usr/local/prometheus-2.47/prometheus.yml:/opt/prometheus/prometheus.yml\nnetworks:\n    default:\n        driver: bridge\n```\n\n\n运行: \n\n``` docker-compose -f prometheus.yaml up -d ```\n\n\n\n## 三、 常见问题\n\n### 3.1 Prometheus查询不到数据\n\n报错详情: **Error on ingesting samples that are too old or are too far into the future**\n报错详情: **err=\"out of bounds\"**\n``` yaml\ncaller=scrape.go:1741 level=warn component=\"scrape manager\" scrape_pool=prometheus target=http://192.168.128.203:9090/metrics msg=\"Error on ingesting samples that are too old or are too far into the future\" num_dropped=666\n\ncaller=scrape.go:1405 level=warn component=\"scrape manager\" scrape_pool=prometheus target=http://192.168.128.203:9090/metrics msg=\"Append failed\" err=\"out of bounds\"\n```\n> [引用](https://forum.gitlab.com/t/prometheus-out-of-bounds-error-after-reboot/75229)\n\n**问题解决**: 构建镜像或者其他原因造成的容器内时间和容器外时间不一致,且Prometheus已获取了错误时间内的相关数据.\n             清空容器内 ```/opt/prometheus/data``` 的数据 并重启容器.\n\n**清空容器内错误数据:**\n``` docker exec -it prometheus /bin/bash```\n``` cd /opt/prometheus/data ```\n``` rm -rf 0* wal/0* wal/checkpoint.0* ```\n\n**重启容器:**\n``` docker-compose -f prometheus.yaml down ```\n``` docker-compose -f prometheus.yaml up -d ```\n\n<img src=\"/images/053.Prometheus_Installation.md.01.png\" width=100% height=100% />","slug":"053.Prometheus_Installation","published":1,"updated":"2023-12-05T08:52:30.879Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzec004tijnr70f4a415","content":"<h2 id=\"零、-说明\"><a href=\"#零、-说明\" class=\"headerlink\" title=\"零、 说明\"></a>零、 说明</h2><ul>\n<li>两种部署方式<ul>\n<li>二进制包部署+systemd管理</li>\n<li>docker 部署</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"一、-二进制方式部署\"><a href=\"#一、-二进制方式部署\" class=\"headerlink\" title=\"一、 二进制方式部署\"></a>一、 二进制方式部署</h2><h3 id=\"1-1-下载\"><a href=\"#1-1-下载\" class=\"headerlink\" title=\"1.1 下载\"></a>1.1 下载</h3><p><a href=\"https://prometheus.io/download/\">下载连接</a> </p>\n<h3 id=\"1-2-解压\"><a href=\"#1-2-解压\" class=\"headerlink\" title=\"1.2 解压\"></a>1.2 解压</h3><p><code>tar -xzvf prometheus-2.47.0.linux-amd64.tar.gz</code><br><code>cp -r prometheus-2.47.0.linux-amd64 /usr/local/prometheus</code> </p>\n<h3 id=\"1-3-运行测试\"><a href=\"#1-3-运行测试\" class=\"headerlink\" title=\"1.3 运行测试\"></a>1.3 运行测试</h3><p><code>cd /usr/local/prometheus</code><br><code>./prometheus --config.file=./prometheus.yml</code></p>\n<p>默认数据目录: <code>./data </code></p>\n<h3 id=\"1-4-访问测试\"><a href=\"#1-4-访问测试\" class=\"headerlink\" title=\"1.4 访问测试\"></a>1.4 访问测试</h3><p><code>curl http://192.168.128.203:9090/metrics</code></p>\n<p>有数据返回一般就没什么问题了.</p>\n<h3 id=\"1-5-使用-systemd-管理\"><a href=\"#1-5-使用-systemd-管理\" class=\"headerlink\" title=\"1.5 使用 systemd 管理\"></a>1.5 使用 systemd 管理</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /usr/local/prometheus-2.47/prometheus.service</span></span><br><span class=\"line\">[<span class=\"string\">Unit</span>]</span><br><span class=\"line\"><span class=\"string\">Description=Prometheus</span> <span class=\"string\">Server</span></span><br><span class=\"line\"><span class=\"string\">Documentation=https://prometheus.io/docs/introduction/overview/</span></span><br><span class=\"line\"><span class=\"string\">After=network-online.target</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"string\">Service</span>]</span><br><span class=\"line\"><span class=\"string\">Type=simple</span></span><br><span class=\"line\"><span class=\"string\">User=root</span></span><br><span class=\"line\"><span class=\"string\">Restart=on-failure</span></span><br><span class=\"line\"><span class=\"string\">ExecReload=/bin/kill</span> <span class=\"string\">-HUP</span> <span class=\"string\">$MAINPID</span></span><br><span class=\"line\"><span class=\"string\">ExecStart=/usr/local/prometheus-2.47/prometheus</span> <span class=\"string\">\\</span></span><br><span class=\"line\">  <span class=\"string\">--config.file=/usr/local/prometheus-2.47/prometheus.yml</span> <span class=\"string\">\\</span></span><br><span class=\"line\">  <span class=\"string\">--storage.tsdb.path</span> <span class=\"string\">/usr/local/prometheus-2.47/data</span> <span class=\"string\">\\</span></span><br><span class=\"line\">  <span class=\"string\">--storage.tsdb.retention=15d</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"string\">Install</span>]</span><br><span class=\"line\"><span class=\"string\">WantedBy=multi-user.target</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>systemctl daemon-reload</code><br><code>systemctl enable prometheus --now</code></p>\n<h2 id=\"二、-使用-docker-构建\"><a href=\"#二、-使用-docker-构建\" class=\"headerlink\" title=\"二、 使用 docker 构建\"></a>二、 使用 docker 构建</h2><h3 id=\"2-1-基于centos7-9镜像构建\"><a href=\"#2-1-基于centos7-9镜像构建\" class=\"headerlink\" title=\"2.1 基于centos7.9镜像构建\"></a>2.1 基于centos7.9镜像构建</h3><p><code> docker build -network=host -t prometheus-2.47.0 .</code></p>\n<ul>\n<li><code>-network=host</code>可以有效避免yum install的报错</li>\n<li><code>-t prometheus-2.47.0</code> 指定构建后的镜像名称</li>\n</ul>\n<p>Dockerfile: <code> vim Dockerfile</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">FROM</span> <span class=\"string\">centos:centos7</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Define Prometheus home and its version</span></span><br><span class=\"line\"><span class=\"string\">ARG</span> <span class=\"string\">PROMETHEUS_HOME=/opt/prometheus</span></span><br><span class=\"line\"><span class=\"string\">ARG</span> <span class=\"string\">PROMETHEUS_VERSION=2.47.0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Define TAR &amp; folder names, as well as download URL for easier use</span></span><br><span class=\"line\"><span class=\"string\">ARG</span> <span class=\"string\">PROMETHEUS_TAR_MAYOR=prometheus-$&#123;PROMETHEUS_VERSION&#125;.linux-amd64</span></span><br><span class=\"line\"><span class=\"string\">ARG</span> <span class=\"string\">PROMETHEUS_TAR_FULLNAME=$&#123;PROMETHEUS_TAR_MAYOR&#125;.tar.gz</span></span><br><span class=\"line\"><span class=\"string\">ARG</span> <span class=\"string\">PROMETHEUS_URL=https://github.com/prometheus/prometheus/releases/download/v$&#123;PROMETHEUS_VERSION&#125;/$&#123;PROMETHEUS_TAR_FULLNAME&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Install wget; download Prometheus</span></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">yum</span> <span class=\"string\">install</span> <span class=\"string\">-y</span> <span class=\"string\">wget</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">wget</span> <span class=\"string\">$&#123;PROMETHEUS_URL&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Untar the file and rename it to &quot;prometheus&quot;</span></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">tar</span> <span class=\"string\">xvfz</span> <span class=\"string\">$&#123;PROMETHEUS_TAR_FULLNAME&#125;</span> <span class=\"string\">-C</span> <span class=\"string\">/opt</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">mv</span> <span class=\"string\">/opt/$&#123;PROMETHEUS_TAR_MAYOR&#125;</span> <span class=\"string\">/opt/prometheus</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">rm</span> <span class=\"string\">-rf</span> <span class=\"string\">/opt/prometheus/prometheus.yml</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">groupadd</span> <span class=\"string\">-r</span> <span class=\"string\">prometheus</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">useradd</span> <span class=\"string\">-g</span> <span class=\"string\">prometheus</span> <span class=\"string\">-s</span> <span class=\"string\">/bin/bash</span> <span class=\"string\">-c</span> <span class=\"string\">&quot;Prometheus user&quot;</span> <span class=\"string\">prometheus</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">chown</span> <span class=\"string\">-R</span> <span class=\"string\">prometheus:prometheus</span> <span class=\"string\">/opt/prometheus</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">COPY</span> <span class=\"string\">config/prometheus.yml</span> <span class=\"string\">/opt/prometheus/prometheus.yml</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">chown</span> <span class=\"string\">prometheus:prometheus</span> <span class=\"string\">/opt/prometheus/prometheus.yml</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">chmod</span> <span class=\"number\">755</span> <span class=\"string\">/opt/prometheus/prometheus.yml</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">EXPOSE</span> <span class=\"number\">9090</span></span><br><span class=\"line\"><span class=\"string\">VOLUME</span>  [ <span class=\"string\">&quot;/opt/prometheus&quot;</span> ]</span><br><span class=\"line\"><span class=\"string\">WORKDIR</span> <span class=\"string\">$&#123;PROMETHEUS_HOME&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">USER</span> <span class=\"string\">prometheus</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">ENTRYPOINT</span> [ <span class=\"string\">&quot;./prometheus&quot;</span> ]</span><br><span class=\"line\"><span class=\"string\">CMD</span>        [ <span class=\"string\">&quot;--config.file=prometheus.yml&quot;</span> ]</span><br></pre></td></tr></table></figure>\n\n<p>运行镜像测试:<br><code>docker run -p 9090:9090 prometheus-2.47.0</code></p>\n<h3 id=\"2-2-使用-docker-compose-快速构建\"><a href=\"#2-2-使用-docker-compose-快速构建\" class=\"headerlink\" title=\"2.2 使用 docker-compose 快速构建\"></a>2.2 使用 docker-compose 快速构建</h3><p><code>vim Prometheus.yaml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">    <span class=\"attr\">prometheus:</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">prometheus-2.47.0:latest</span></span><br><span class=\"line\">        <span class=\"attr\">user:</span> <span class=\"string\">&quot;1000:1000&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;9090:9090&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">container_name:</span> <span class=\"string\">prometheus</span></span><br><span class=\"line\">        <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">        <span class=\"attr\">volumes:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/prometheus-2.47/prometheus.yml:/opt/prometheus/prometheus.yml</span></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">    <span class=\"attr\">default:</span></span><br><span class=\"line\">        <span class=\"attr\">driver:</span> <span class=\"string\">bridge</span></span><br></pre></td></tr></table></figure>\n\n\n<p>运行: </p>\n<p><code>docker-compose -f prometheus.yaml up -d</code></p>\n<h2 id=\"三、-常见问题\"><a href=\"#三、-常见问题\" class=\"headerlink\" title=\"三、 常见问题\"></a>三、 常见问题</h2><h3 id=\"3-1-Prometheus查询不到数据\"><a href=\"#3-1-Prometheus查询不到数据\" class=\"headerlink\" title=\"3.1 Prometheus查询不到数据\"></a>3.1 Prometheus查询不到数据</h3><p>报错详情: <strong>Error on ingesting samples that are too old or are too far into the future</strong><br>报错详情: <strong>err&#x3D;”out of bounds”</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">caller=scrape.go:1741</span> <span class=\"string\">level=warn</span> <span class=\"string\">component=&quot;scrape</span> <span class=\"string\">manager&quot;</span> <span class=\"string\">scrape_pool=prometheus</span> <span class=\"string\">target=http://192.168.128.203:9090/metrics</span> <span class=\"string\">msg=&quot;Error</span> <span class=\"string\">on</span> <span class=\"string\">ingesting</span> <span class=\"string\">samples</span> <span class=\"string\">that</span> <span class=\"string\">are</span> <span class=\"string\">too</span> <span class=\"string\">old</span> <span class=\"string\">or</span> <span class=\"string\">are</span> <span class=\"string\">too</span> <span class=\"string\">far</span> <span class=\"string\">into</span> <span class=\"string\">the</span> <span class=\"string\">future&quot;</span> <span class=\"string\">num_dropped=666</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">caller=scrape.go:1405</span> <span class=\"string\">level=warn</span> <span class=\"string\">component=&quot;scrape</span> <span class=\"string\">manager&quot;</span> <span class=\"string\">scrape_pool=prometheus</span> <span class=\"string\">target=http://192.168.128.203:9090/metrics</span> <span class=\"string\">msg=&quot;Append</span> <span class=\"string\">failed&quot;</span> <span class=\"string\">err=&quot;out</span> <span class=\"string\">of</span> <span class=\"string\">bounds&quot;</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><a href=\"https://forum.gitlab.com/t/prometheus-out-of-bounds-error-after-reboot/75229\">引用</a></p>\n</blockquote>\n<p><strong>问题解决</strong>: 构建镜像或者其他原因造成的容器内时间和容器外时间不一致,且Prometheus已获取了错误时间内的相关数据.<br>             清空容器内 <code>/opt/prometheus/data</code> 的数据 并重启容器.</p>\n<p><strong>清空容器内错误数据:</strong><br><code> docker exec -it prometheus /bin/bash</code><br><code>cd /opt/prometheus/data</code><br><code>rm -rf 0* wal/0* wal/checkpoint.0*</code></p>\n<p><strong>重启容器:</strong><br><code>docker-compose -f prometheus.yaml down</code><br><code>docker-compose -f prometheus.yaml up -d</code></p>\n<img src=\"/images/053.Prometheus_Installation.md.01.png\" width=100% height=100% />","site":{"data":{}},"excerpt":"","more":"<h2 id=\"零、-说明\"><a href=\"#零、-说明\" class=\"headerlink\" title=\"零、 说明\"></a>零、 说明</h2><ul>\n<li>两种部署方式<ul>\n<li>二进制包部署+systemd管理</li>\n<li>docker 部署</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"一、-二进制方式部署\"><a href=\"#一、-二进制方式部署\" class=\"headerlink\" title=\"一、 二进制方式部署\"></a>一、 二进制方式部署</h2><h3 id=\"1-1-下载\"><a href=\"#1-1-下载\" class=\"headerlink\" title=\"1.1 下载\"></a>1.1 下载</h3><p><a href=\"https://prometheus.io/download/\">下载连接</a> </p>\n<h3 id=\"1-2-解压\"><a href=\"#1-2-解压\" class=\"headerlink\" title=\"1.2 解压\"></a>1.2 解压</h3><p><code>tar -xzvf prometheus-2.47.0.linux-amd64.tar.gz</code><br><code>cp -r prometheus-2.47.0.linux-amd64 /usr/local/prometheus</code> </p>\n<h3 id=\"1-3-运行测试\"><a href=\"#1-3-运行测试\" class=\"headerlink\" title=\"1.3 运行测试\"></a>1.3 运行测试</h3><p><code>cd /usr/local/prometheus</code><br><code>./prometheus --config.file=./prometheus.yml</code></p>\n<p>默认数据目录: <code>./data </code></p>\n<h3 id=\"1-4-访问测试\"><a href=\"#1-4-访问测试\" class=\"headerlink\" title=\"1.4 访问测试\"></a>1.4 访问测试</h3><p><code>curl http://192.168.128.203:9090/metrics</code></p>\n<p>有数据返回一般就没什么问题了.</p>\n<h3 id=\"1-5-使用-systemd-管理\"><a href=\"#1-5-使用-systemd-管理\" class=\"headerlink\" title=\"1.5 使用 systemd 管理\"></a>1.5 使用 systemd 管理</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /usr/local/prometheus-2.47/prometheus.service</span></span><br><span class=\"line\">[<span class=\"string\">Unit</span>]</span><br><span class=\"line\"><span class=\"string\">Description=Prometheus</span> <span class=\"string\">Server</span></span><br><span class=\"line\"><span class=\"string\">Documentation=https://prometheus.io/docs/introduction/overview/</span></span><br><span class=\"line\"><span class=\"string\">After=network-online.target</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"string\">Service</span>]</span><br><span class=\"line\"><span class=\"string\">Type=simple</span></span><br><span class=\"line\"><span class=\"string\">User=root</span></span><br><span class=\"line\"><span class=\"string\">Restart=on-failure</span></span><br><span class=\"line\"><span class=\"string\">ExecReload=/bin/kill</span> <span class=\"string\">-HUP</span> <span class=\"string\">$MAINPID</span></span><br><span class=\"line\"><span class=\"string\">ExecStart=/usr/local/prometheus-2.47/prometheus</span> <span class=\"string\">\\</span></span><br><span class=\"line\">  <span class=\"string\">--config.file=/usr/local/prometheus-2.47/prometheus.yml</span> <span class=\"string\">\\</span></span><br><span class=\"line\">  <span class=\"string\">--storage.tsdb.path</span> <span class=\"string\">/usr/local/prometheus-2.47/data</span> <span class=\"string\">\\</span></span><br><span class=\"line\">  <span class=\"string\">--storage.tsdb.retention=15d</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"string\">Install</span>]</span><br><span class=\"line\"><span class=\"string\">WantedBy=multi-user.target</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>systemctl daemon-reload</code><br><code>systemctl enable prometheus --now</code></p>\n<h2 id=\"二、-使用-docker-构建\"><a href=\"#二、-使用-docker-构建\" class=\"headerlink\" title=\"二、 使用 docker 构建\"></a>二、 使用 docker 构建</h2><h3 id=\"2-1-基于centos7-9镜像构建\"><a href=\"#2-1-基于centos7-9镜像构建\" class=\"headerlink\" title=\"2.1 基于centos7.9镜像构建\"></a>2.1 基于centos7.9镜像构建</h3><p><code> docker build -network=host -t prometheus-2.47.0 .</code></p>\n<ul>\n<li><code>-network=host</code>可以有效避免yum install的报错</li>\n<li><code>-t prometheus-2.47.0</code> 指定构建后的镜像名称</li>\n</ul>\n<p>Dockerfile: <code> vim Dockerfile</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">FROM</span> <span class=\"string\">centos:centos7</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Define Prometheus home and its version</span></span><br><span class=\"line\"><span class=\"string\">ARG</span> <span class=\"string\">PROMETHEUS_HOME=/opt/prometheus</span></span><br><span class=\"line\"><span class=\"string\">ARG</span> <span class=\"string\">PROMETHEUS_VERSION=2.47.0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Define TAR &amp; folder names, as well as download URL for easier use</span></span><br><span class=\"line\"><span class=\"string\">ARG</span> <span class=\"string\">PROMETHEUS_TAR_MAYOR=prometheus-$&#123;PROMETHEUS_VERSION&#125;.linux-amd64</span></span><br><span class=\"line\"><span class=\"string\">ARG</span> <span class=\"string\">PROMETHEUS_TAR_FULLNAME=$&#123;PROMETHEUS_TAR_MAYOR&#125;.tar.gz</span></span><br><span class=\"line\"><span class=\"string\">ARG</span> <span class=\"string\">PROMETHEUS_URL=https://github.com/prometheus/prometheus/releases/download/v$&#123;PROMETHEUS_VERSION&#125;/$&#123;PROMETHEUS_TAR_FULLNAME&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Install wget; download Prometheus</span></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">yum</span> <span class=\"string\">install</span> <span class=\"string\">-y</span> <span class=\"string\">wget</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">wget</span> <span class=\"string\">$&#123;PROMETHEUS_URL&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Untar the file and rename it to &quot;prometheus&quot;</span></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">tar</span> <span class=\"string\">xvfz</span> <span class=\"string\">$&#123;PROMETHEUS_TAR_FULLNAME&#125;</span> <span class=\"string\">-C</span> <span class=\"string\">/opt</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">mv</span> <span class=\"string\">/opt/$&#123;PROMETHEUS_TAR_MAYOR&#125;</span> <span class=\"string\">/opt/prometheus</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">rm</span> <span class=\"string\">-rf</span> <span class=\"string\">/opt/prometheus/prometheus.yml</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">groupadd</span> <span class=\"string\">-r</span> <span class=\"string\">prometheus</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">useradd</span> <span class=\"string\">-g</span> <span class=\"string\">prometheus</span> <span class=\"string\">-s</span> <span class=\"string\">/bin/bash</span> <span class=\"string\">-c</span> <span class=\"string\">&quot;Prometheus user&quot;</span> <span class=\"string\">prometheus</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">chown</span> <span class=\"string\">-R</span> <span class=\"string\">prometheus:prometheus</span> <span class=\"string\">/opt/prometheus</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">COPY</span> <span class=\"string\">config/prometheus.yml</span> <span class=\"string\">/opt/prometheus/prometheus.yml</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">RUN</span> <span class=\"string\">chown</span> <span class=\"string\">prometheus:prometheus</span> <span class=\"string\">/opt/prometheus/prometheus.yml</span> <span class=\"string\">&amp;&amp;</span> <span class=\"string\">\\</span></span><br><span class=\"line\">    <span class=\"string\">chmod</span> <span class=\"number\">755</span> <span class=\"string\">/opt/prometheus/prometheus.yml</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">EXPOSE</span> <span class=\"number\">9090</span></span><br><span class=\"line\"><span class=\"string\">VOLUME</span>  [ <span class=\"string\">&quot;/opt/prometheus&quot;</span> ]</span><br><span class=\"line\"><span class=\"string\">WORKDIR</span> <span class=\"string\">$&#123;PROMETHEUS_HOME&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">USER</span> <span class=\"string\">prometheus</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">ENTRYPOINT</span> [ <span class=\"string\">&quot;./prometheus&quot;</span> ]</span><br><span class=\"line\"><span class=\"string\">CMD</span>        [ <span class=\"string\">&quot;--config.file=prometheus.yml&quot;</span> ]</span><br></pre></td></tr></table></figure>\n\n<p>运行镜像测试:<br><code>docker run -p 9090:9090 prometheus-2.47.0</code></p>\n<h3 id=\"2-2-使用-docker-compose-快速构建\"><a href=\"#2-2-使用-docker-compose-快速构建\" class=\"headerlink\" title=\"2.2 使用 docker-compose 快速构建\"></a>2.2 使用 docker-compose 快速构建</h3><p><code>vim Prometheus.yaml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">    <span class=\"attr\">prometheus:</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">prometheus-2.47.0:latest</span></span><br><span class=\"line\">        <span class=\"attr\">user:</span> <span class=\"string\">&quot;1000:1000&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;9090:9090&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">container_name:</span> <span class=\"string\">prometheus</span></span><br><span class=\"line\">        <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">        <span class=\"attr\">volumes:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/prometheus-2.47/prometheus.yml:/opt/prometheus/prometheus.yml</span></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">    <span class=\"attr\">default:</span></span><br><span class=\"line\">        <span class=\"attr\">driver:</span> <span class=\"string\">bridge</span></span><br></pre></td></tr></table></figure>\n\n\n<p>运行: </p>\n<p><code>docker-compose -f prometheus.yaml up -d</code></p>\n<h2 id=\"三、-常见问题\"><a href=\"#三、-常见问题\" class=\"headerlink\" title=\"三、 常见问题\"></a>三、 常见问题</h2><h3 id=\"3-1-Prometheus查询不到数据\"><a href=\"#3-1-Prometheus查询不到数据\" class=\"headerlink\" title=\"3.1 Prometheus查询不到数据\"></a>3.1 Prometheus查询不到数据</h3><p>报错详情: <strong>Error on ingesting samples that are too old or are too far into the future</strong><br>报错详情: <strong>err&#x3D;”out of bounds”</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">caller=scrape.go:1741</span> <span class=\"string\">level=warn</span> <span class=\"string\">component=&quot;scrape</span> <span class=\"string\">manager&quot;</span> <span class=\"string\">scrape_pool=prometheus</span> <span class=\"string\">target=http://192.168.128.203:9090/metrics</span> <span class=\"string\">msg=&quot;Error</span> <span class=\"string\">on</span> <span class=\"string\">ingesting</span> <span class=\"string\">samples</span> <span class=\"string\">that</span> <span class=\"string\">are</span> <span class=\"string\">too</span> <span class=\"string\">old</span> <span class=\"string\">or</span> <span class=\"string\">are</span> <span class=\"string\">too</span> <span class=\"string\">far</span> <span class=\"string\">into</span> <span class=\"string\">the</span> <span class=\"string\">future&quot;</span> <span class=\"string\">num_dropped=666</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">caller=scrape.go:1405</span> <span class=\"string\">level=warn</span> <span class=\"string\">component=&quot;scrape</span> <span class=\"string\">manager&quot;</span> <span class=\"string\">scrape_pool=prometheus</span> <span class=\"string\">target=http://192.168.128.203:9090/metrics</span> <span class=\"string\">msg=&quot;Append</span> <span class=\"string\">failed&quot;</span> <span class=\"string\">err=&quot;out</span> <span class=\"string\">of</span> <span class=\"string\">bounds&quot;</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><a href=\"https://forum.gitlab.com/t/prometheus-out-of-bounds-error-after-reboot/75229\">引用</a></p>\n</blockquote>\n<p><strong>问题解决</strong>: 构建镜像或者其他原因造成的容器内时间和容器外时间不一致,且Prometheus已获取了错误时间内的相关数据.<br>             清空容器内 <code>/opt/prometheus/data</code> 的数据 并重启容器.</p>\n<p><strong>清空容器内错误数据:</strong><br><code> docker exec -it prometheus /bin/bash</code><br><code>cd /opt/prometheus/data</code><br><code>rm -rf 0* wal/0* wal/checkpoint.0*</code></p>\n<p><strong>重启容器:</strong><br><code>docker-compose -f prometheus.yaml down</code><br><code>docker-compose -f prometheus.yaml up -d</code></p>\n<img src=\"/images/053.Prometheus_Installation.md.01.png\" width=100% height=100% />"},{"title":"基于源码构建 MySQL","date":"2023-09-25T08:55:00.000Z","_content":"\n## 零、 环境\n\n- OS: Kylin Server V10 \n- Arch: aarch64\n- MySQL release: mysql-5.7.40-Linux-aarch64\n- HW: 4c16g\n\n\n## 一、 安装前准备\n\n### 1.1 安装依赖\n\n``` yum install gcc gcc-c++ cmake ```\n\n### 1.2 下载安装包\n\n下载带有boost的安装， 省去单独安装boost的步骤\n\n[下载链接](https://dev.mysql.com/downloads/mysql/)\n\n<img src=\"/images/052.MySQL_Installation_Uasing_Source.md.01.png\" width=100% height=100% />\n\n\n\n## 编译安装\n\n### 2.1 解压\n\n``` tar -xzvf mysql-boost-5.7.43.tar.gz ```\n\n### 2.2 编译安装\n\n``` cd mysql-5.7.43 ```\n\n``` mkdir bld  && cd bld ```\n\n```yaml\ncmake .. \\\n-DCMAKE_INSTALL_PREFIX=/usr/local/mysql \\\n-DDEFAULT_CHARSET=utf8 \\\n-DDEFAULT_COLLATION=utf8_general_ci \\\n-DENABLED_LOCAL_INFILE=ON \\\n-DWITH_INNOBASE_STORAGE_ENGINE=1 \\\n-DWITH_FEDERATED_STORAGE_ENGINE=1 \\\n-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \\\n-DWITHOUT_EXAMPLE_STORAGE_ENGINE=1 \\\n-DWITH_PARTITION_STORAGE_ENGINE=1 \\\n-DWITH_PERFSCHEMA_STORAGE_ENGINE=1 \\\n-DCOMPILATION_COMMENT='Mysqlma' \\\n-DWITH_READLINE=ON \\\n-DWITH_BOOST=/root/mysql-5.7.43/boost/boost_1_59_0 \\\n-DSYSCONFDIR=/data/mysql \\\n-DMYSQL_UNIX_ADDR=/data/mysql/mysql.sock\n```\n\n\n``` make && make install ```\n\n\n## 三、 部署\n\n[参考另外一篇文章](https://mdzz.wang/2023/09/25/051.MySQL_Install_Using_Generic_Binaries/)\n\n## 四、 相关问题\n\n### 4.1 RPC 相关问题\n\n问题描述: rpc相关头文件找不到\n``` yaml\n--   Package 'libtirpc', required by 'virtual:world', not found\nCMake Error at cmake/rpc.cmake:76 (MESSAGE):\n  Could not find rpc/rpc.h in /usr/include or /usr/include/tirpc\nCall Stack (most recent call first):\n  rapid/plugin/group_replication/configure.cmake:60 (MYSQL_CHECK_RPC)\n  rapid/plugin/group_replication/CMakeLists.txt:25 (INCLUDE)\n```\n\n<img src=\"/images/052.MySQL_Installation_Uasing_Source.md.02.png\" width=100% height=100% />\n\n解决: \n```yum install libtirpc libtirpc-devel ```\n\n但是在 Kylin V10 aarch64 下找不到 libtirpc-devel\n\n只好从其他操作系统里 /usr/bin/rpc 拷贝一份\n\n","source":"_posts/052.MySQL_Installation_Uasing_Source.md","raw":"---\ntitle: 基于源码构建 MySQL\ndate: 2023-9-25 16:55:00\ncategories: \n- [Database]\ntags: \n- MySQL\n---\n\n## 零、 环境\n\n- OS: Kylin Server V10 \n- Arch: aarch64\n- MySQL release: mysql-5.7.40-Linux-aarch64\n- HW: 4c16g\n\n\n## 一、 安装前准备\n\n### 1.1 安装依赖\n\n``` yum install gcc gcc-c++ cmake ```\n\n### 1.2 下载安装包\n\n下载带有boost的安装， 省去单独安装boost的步骤\n\n[下载链接](https://dev.mysql.com/downloads/mysql/)\n\n<img src=\"/images/052.MySQL_Installation_Uasing_Source.md.01.png\" width=100% height=100% />\n\n\n\n## 编译安装\n\n### 2.1 解压\n\n``` tar -xzvf mysql-boost-5.7.43.tar.gz ```\n\n### 2.2 编译安装\n\n``` cd mysql-5.7.43 ```\n\n``` mkdir bld  && cd bld ```\n\n```yaml\ncmake .. \\\n-DCMAKE_INSTALL_PREFIX=/usr/local/mysql \\\n-DDEFAULT_CHARSET=utf8 \\\n-DDEFAULT_COLLATION=utf8_general_ci \\\n-DENABLED_LOCAL_INFILE=ON \\\n-DWITH_INNOBASE_STORAGE_ENGINE=1 \\\n-DWITH_FEDERATED_STORAGE_ENGINE=1 \\\n-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \\\n-DWITHOUT_EXAMPLE_STORAGE_ENGINE=1 \\\n-DWITH_PARTITION_STORAGE_ENGINE=1 \\\n-DWITH_PERFSCHEMA_STORAGE_ENGINE=1 \\\n-DCOMPILATION_COMMENT='Mysqlma' \\\n-DWITH_READLINE=ON \\\n-DWITH_BOOST=/root/mysql-5.7.43/boost/boost_1_59_0 \\\n-DSYSCONFDIR=/data/mysql \\\n-DMYSQL_UNIX_ADDR=/data/mysql/mysql.sock\n```\n\n\n``` make && make install ```\n\n\n## 三、 部署\n\n[参考另外一篇文章](https://mdzz.wang/2023/09/25/051.MySQL_Install_Using_Generic_Binaries/)\n\n## 四、 相关问题\n\n### 4.1 RPC 相关问题\n\n问题描述: rpc相关头文件找不到\n``` yaml\n--   Package 'libtirpc', required by 'virtual:world', not found\nCMake Error at cmake/rpc.cmake:76 (MESSAGE):\n  Could not find rpc/rpc.h in /usr/include or /usr/include/tirpc\nCall Stack (most recent call first):\n  rapid/plugin/group_replication/configure.cmake:60 (MYSQL_CHECK_RPC)\n  rapid/plugin/group_replication/CMakeLists.txt:25 (INCLUDE)\n```\n\n<img src=\"/images/052.MySQL_Installation_Uasing_Source.md.02.png\" width=100% height=100% />\n\n解决: \n```yum install libtirpc libtirpc-devel ```\n\n但是在 Kylin V10 aarch64 下找不到 libtirpc-devel\n\n只好从其他操作系统里 /usr/bin/rpc 拷贝一份\n\n","slug":"052.MySQL_Installation_Uasing_Source","published":1,"updated":"2023-12-05T08:52:30.879Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzee004xijnrdwkh07jr","content":"<h2 id=\"零、-环境\"><a href=\"#零、-环境\" class=\"headerlink\" title=\"零、 环境\"></a>零、 环境</h2><ul>\n<li>OS: Kylin Server V10 </li>\n<li>Arch: aarch64</li>\n<li>MySQL release: mysql-5.7.40-Linux-aarch64</li>\n<li>HW: 4c16g</li>\n</ul>\n<h2 id=\"一、-安装前准备\"><a href=\"#一、-安装前准备\" class=\"headerlink\" title=\"一、 安装前准备\"></a>一、 安装前准备</h2><h3 id=\"1-1-安装依赖\"><a href=\"#1-1-安装依赖\" class=\"headerlink\" title=\"1.1 安装依赖\"></a>1.1 安装依赖</h3><p><code>yum install gcc gcc-c++ cmake</code></p>\n<h3 id=\"1-2-下载安装包\"><a href=\"#1-2-下载安装包\" class=\"headerlink\" title=\"1.2 下载安装包\"></a>1.2 下载安装包</h3><p>下载带有boost的安装， 省去单独安装boost的步骤</p>\n<p><a href=\"https://dev.mysql.com/downloads/mysql/\">下载链接</a></p>\n<img src=\"/images/052.MySQL_Installation_Uasing_Source.md.01.png\" width=100% height=100% />\n\n\n\n<h2 id=\"编译安装\"><a href=\"#编译安装\" class=\"headerlink\" title=\"编译安装\"></a>编译安装</h2><h3 id=\"2-1-解压\"><a href=\"#2-1-解压\" class=\"headerlink\" title=\"2.1 解压\"></a>2.1 解压</h3><p><code>tar -xzvf mysql-boost-5.7.43.tar.gz</code></p>\n<h3 id=\"2-2-编译安装\"><a href=\"#2-2-编译安装\" class=\"headerlink\" title=\"2.2 编译安装\"></a>2.2 编译安装</h3><p><code>cd mysql-5.7.43</code></p>\n<p><code>mkdir bld  &amp;&amp; cd bld</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">cmake</span> <span class=\"string\">..</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DCMAKE_INSTALL_PREFIX=/usr/local/mysql</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DDEFAULT_CHARSET=utf8</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DDEFAULT_COLLATION=utf8_general_ci</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DENABLED_LOCAL_INFILE=ON</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DWITH_INNOBASE_STORAGE_ENGINE=1</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DWITH_FEDERATED_STORAGE_ENGINE=1</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DWITH_BLACKHOLE_STORAGE_ENGINE=1</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DWITHOUT_EXAMPLE_STORAGE_ENGINE=1</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DWITH_PARTITION_STORAGE_ENGINE=1</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DWITH_PERFSCHEMA_STORAGE_ENGINE=1</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DCOMPILATION_COMMENT=&#x27;Mysqlma&#x27;</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DWITH_READLINE=ON</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DWITH_BOOST=/root/mysql-5.7.43/boost/boost_1_59_0</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DSYSCONFDIR=/data/mysql</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DMYSQL_UNIX_ADDR=/data/mysql/mysql.sock</span></span><br></pre></td></tr></table></figure>\n\n\n<p><code>make &amp;&amp; make install</code></p>\n<h2 id=\"三、-部署\"><a href=\"#三、-部署\" class=\"headerlink\" title=\"三、 部署\"></a>三、 部署</h2><p><a href=\"https://mdzz.wang/2023/09/25/051.MySQL_Install_Using_Generic_Binaries/\">参考另外一篇文章</a></p>\n<h2 id=\"四、-相关问题\"><a href=\"#四、-相关问题\" class=\"headerlink\" title=\"四、 相关问题\"></a>四、 相关问题</h2><h3 id=\"4-1-RPC-相关问题\"><a href=\"#4-1-RPC-相关问题\" class=\"headerlink\" title=\"4.1 RPC 相关问题\"></a>4.1 RPC 相关问题</h3><p>问题描述: rpc相关头文件找不到</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">--</span>   <span class=\"string\">Package</span> <span class=\"string\">&#x27;libtirpc&#x27;</span><span class=\"string\">,</span> <span class=\"string\">required</span> <span class=\"string\">by</span> <span class=\"string\">&#x27;virtual:world&#x27;</span><span class=\"string\">,</span> <span class=\"string\">not</span> <span class=\"string\">found</span></span><br><span class=\"line\"><span class=\"string\">CMake</span> <span class=\"string\">Error</span> <span class=\"string\">at</span> <span class=\"string\">cmake/rpc.cmake:76</span> <span class=\"string\">(MESSAGE):</span></span><br><span class=\"line\">  <span class=\"string\">Could</span> <span class=\"string\">not</span> <span class=\"string\">find</span> <span class=\"string\">rpc/rpc.h</span> <span class=\"string\">in</span> <span class=\"string\">/usr/include</span> <span class=\"string\">or</span> <span class=\"string\">/usr/include/tirpc</span></span><br><span class=\"line\"><span class=\"string\">Call</span> <span class=\"string\">Stack</span> <span class=\"string\">(most</span> <span class=\"string\">recent</span> <span class=\"string\">call</span> <span class=\"string\">first):</span></span><br><span class=\"line\">  <span class=\"string\">rapid/plugin/group_replication/configure.cmake:60</span> <span class=\"string\">(MYSQL_CHECK_RPC)</span></span><br><span class=\"line\">  <span class=\"string\">rapid/plugin/group_replication/CMakeLists.txt:25</span> <span class=\"string\">(INCLUDE)</span></span><br></pre></td></tr></table></figure>\n\n<img src=\"/images/052.MySQL_Installation_Uasing_Source.md.02.png\" width=100% height=100% />\n\n<p>解决:<br><code>yum install libtirpc libtirpc-devel </code></p>\n<p>但是在 Kylin V10 aarch64 下找不到 libtirpc-devel</p>\n<p>只好从其他操作系统里 &#x2F;usr&#x2F;bin&#x2F;rpc 拷贝一份</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"零、-环境\"><a href=\"#零、-环境\" class=\"headerlink\" title=\"零、 环境\"></a>零、 环境</h2><ul>\n<li>OS: Kylin Server V10 </li>\n<li>Arch: aarch64</li>\n<li>MySQL release: mysql-5.7.40-Linux-aarch64</li>\n<li>HW: 4c16g</li>\n</ul>\n<h2 id=\"一、-安装前准备\"><a href=\"#一、-安装前准备\" class=\"headerlink\" title=\"一、 安装前准备\"></a>一、 安装前准备</h2><h3 id=\"1-1-安装依赖\"><a href=\"#1-1-安装依赖\" class=\"headerlink\" title=\"1.1 安装依赖\"></a>1.1 安装依赖</h3><p><code>yum install gcc gcc-c++ cmake</code></p>\n<h3 id=\"1-2-下载安装包\"><a href=\"#1-2-下载安装包\" class=\"headerlink\" title=\"1.2 下载安装包\"></a>1.2 下载安装包</h3><p>下载带有boost的安装， 省去单独安装boost的步骤</p>\n<p><a href=\"https://dev.mysql.com/downloads/mysql/\">下载链接</a></p>\n<img src=\"/images/052.MySQL_Installation_Uasing_Source.md.01.png\" width=100% height=100% />\n\n\n\n<h2 id=\"编译安装\"><a href=\"#编译安装\" class=\"headerlink\" title=\"编译安装\"></a>编译安装</h2><h3 id=\"2-1-解压\"><a href=\"#2-1-解压\" class=\"headerlink\" title=\"2.1 解压\"></a>2.1 解压</h3><p><code>tar -xzvf mysql-boost-5.7.43.tar.gz</code></p>\n<h3 id=\"2-2-编译安装\"><a href=\"#2-2-编译安装\" class=\"headerlink\" title=\"2.2 编译安装\"></a>2.2 编译安装</h3><p><code>cd mysql-5.7.43</code></p>\n<p><code>mkdir bld  &amp;&amp; cd bld</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">cmake</span> <span class=\"string\">..</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DCMAKE_INSTALL_PREFIX=/usr/local/mysql</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DDEFAULT_CHARSET=utf8</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DDEFAULT_COLLATION=utf8_general_ci</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DENABLED_LOCAL_INFILE=ON</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DWITH_INNOBASE_STORAGE_ENGINE=1</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DWITH_FEDERATED_STORAGE_ENGINE=1</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DWITH_BLACKHOLE_STORAGE_ENGINE=1</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DWITHOUT_EXAMPLE_STORAGE_ENGINE=1</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DWITH_PARTITION_STORAGE_ENGINE=1</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DWITH_PERFSCHEMA_STORAGE_ENGINE=1</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DCOMPILATION_COMMENT=&#x27;Mysqlma&#x27;</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DWITH_READLINE=ON</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DWITH_BOOST=/root/mysql-5.7.43/boost/boost_1_59_0</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DSYSCONFDIR=/data/mysql</span> <span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">-DMYSQL_UNIX_ADDR=/data/mysql/mysql.sock</span></span><br></pre></td></tr></table></figure>\n\n\n<p><code>make &amp;&amp; make install</code></p>\n<h2 id=\"三、-部署\"><a href=\"#三、-部署\" class=\"headerlink\" title=\"三、 部署\"></a>三、 部署</h2><p><a href=\"https://mdzz.wang/2023/09/25/051.MySQL_Install_Using_Generic_Binaries/\">参考另外一篇文章</a></p>\n<h2 id=\"四、-相关问题\"><a href=\"#四、-相关问题\" class=\"headerlink\" title=\"四、 相关问题\"></a>四、 相关问题</h2><h3 id=\"4-1-RPC-相关问题\"><a href=\"#4-1-RPC-相关问题\" class=\"headerlink\" title=\"4.1 RPC 相关问题\"></a>4.1 RPC 相关问题</h3><p>问题描述: rpc相关头文件找不到</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">--</span>   <span class=\"string\">Package</span> <span class=\"string\">&#x27;libtirpc&#x27;</span><span class=\"string\">,</span> <span class=\"string\">required</span> <span class=\"string\">by</span> <span class=\"string\">&#x27;virtual:world&#x27;</span><span class=\"string\">,</span> <span class=\"string\">not</span> <span class=\"string\">found</span></span><br><span class=\"line\"><span class=\"string\">CMake</span> <span class=\"string\">Error</span> <span class=\"string\">at</span> <span class=\"string\">cmake/rpc.cmake:76</span> <span class=\"string\">(MESSAGE):</span></span><br><span class=\"line\">  <span class=\"string\">Could</span> <span class=\"string\">not</span> <span class=\"string\">find</span> <span class=\"string\">rpc/rpc.h</span> <span class=\"string\">in</span> <span class=\"string\">/usr/include</span> <span class=\"string\">or</span> <span class=\"string\">/usr/include/tirpc</span></span><br><span class=\"line\"><span class=\"string\">Call</span> <span class=\"string\">Stack</span> <span class=\"string\">(most</span> <span class=\"string\">recent</span> <span class=\"string\">call</span> <span class=\"string\">first):</span></span><br><span class=\"line\">  <span class=\"string\">rapid/plugin/group_replication/configure.cmake:60</span> <span class=\"string\">(MYSQL_CHECK_RPC)</span></span><br><span class=\"line\">  <span class=\"string\">rapid/plugin/group_replication/CMakeLists.txt:25</span> <span class=\"string\">(INCLUDE)</span></span><br></pre></td></tr></table></figure>\n\n<img src=\"/images/052.MySQL_Installation_Uasing_Source.md.02.png\" width=100% height=100% />\n\n<p>解决:<br><code>yum install libtirpc libtirpc-devel </code></p>\n<p>但是在 Kylin V10 aarch64 下找不到 libtirpc-devel</p>\n<p>只好从其他操作系统里 &#x2F;usr&#x2F;bin&#x2F;rpc 拷贝一份</p>\n"},{"title":"自动化监控运维(二)   Grafana 构建","date":"2023-09-28T08:45:47.000Z","_content":"\n## 零、 说明\n\n- 三种部署方式\n    - rpm 包部署 (简单, 不写)\n    - 二进制部署\n    - docker 构建\n\n\n\n## 一、 二进制安装\n\n### 1.1 下载\n\n[下载连接](https://dl.grafana.com/enterprise/release/grafana-enterprise-10.1.2.linux-amd64.tar.gz)\n\n### 1.2 解压并复制到指定目录\n``` tar -zxvf grafana-enterprise-10.1.2.linux-amd64.tar.gz```\n``` cp -rf grafana-10.1.2/ /usr/local/grafana ```\n\n### 1.3 创建用户/组\n```groupadd grafana```\n```useradd -g grafana grafana```\n\n### 1.4 创建相关目录\n```mkdir -p /etc/grafana```\n```mkdir -p /etc/grafana/provisioning```\n```mkdir -p /var/log/grafana```\n```mkdir -p /var/lib/grafana```\n```mkdir -p /var/lib/grafana/plugins```\n\n### 1.5 修改目录权限\n```chown -R grafana:grafana /usr/local/grafana/```\n```chown -R grafana:grafana /etc/grafana/```\n```chown -R grafana:grafana /var/lib/grafana/```\n```chown -R grafana:grafana /var/log/grafana/```\n\n### 1.6 复制 grafana 配置文件\n``` cp /usr/local/grafana/conf/sample.ini /etc/grafana/grafana.ini ```\n\n### 1.7 环境配置文件\n```vim /etc/sysconfig/grafana-server```\n\n``` yaml\nGRAFANA_USER=grafana\nGRAFANA_GROUP=grafana\nGRAFANA_HOME=/usr/local/grafana\nLOG_DIR=/var/log/grafana\nDATA_DIR=/var/lib/grafana\nMAX_OPEN_FILES=10000\nCONF_DIR=/etc/grafana\nCONF_FILE=/etc/grafana/grafana.ini\nRESTART_ON_UPGRADE=true\nPLUGINS_DIR=/var/lib/grafana/plugins\nPROVISIONING_CFG_DIR=/etc/grafana/provisioning\n# Only used on systemd systems\nPID_FILE_DIR=/var/run/grafana\n```\n\n### 1.8 systemd 管理脚本\n```vim /usr/lib/systemd/system/grafana-server.service```\n\n``` yaml\n# /usr/lib/systemd/system/grafana-server.service\n[Unit]\nDescription=Grafana instance\nDocumentation=http://docs.grafana.org\nWants=network-online.target\nAfter=network-online.target\nAfter=postgresql.service mariadb.service mysqld.service influxdb.service\n\n[Service]\nEnvironmentFile=/etc/sysconfig/grafana-server\nUser=grafana\nGroup=grafana\nType=notify\nRestart=on-failure\nWorkingDirectory=/usr/local/grafana\nRuntimeDirectory=grafana\nRuntimeDirectoryMode=0750\nExecStart=/usr/local/grafana/bin/grafana server                                     \\\n                            --config=${CONF_FILE}                                   \\\n                            --pidfile=${PID_FILE_DIR}/grafana-server.pid            \\\n                            --packaging=rpm                                         \\\n                            cfg:default.paths.logs=${LOG_DIR}                       \\\n                            cfg:default.paths.data=${DATA_DIR}                      \\\n                            cfg:default.paths.plugins=${PLUGINS_DIR}                \\\n                            cfg:default.paths.provisioning=${PROVISIONING_CFG_DIR}\n\nLimitNOFILE=10000\nTimeoutStopSec=20\nCapabilityBoundingSet=\nDeviceAllow=\nLockPersonality=true\nMemoryDenyWriteExecute=false\nNoNewPrivileges=true\nPrivateDevices=true\nPrivateTmp=true\nProtectClock=true\nProtectControlGroups=true\nProtectHome=true\nProtectHostname=true\nProtectKernelLogs=true\nProtectKernelModules=true\nProtectKernelTunables=true\nProtectProc=invisible\nProtectSystem=full\nRemoveIPC=true\nRestrictAddressFamilies=AF_INET AF_INET6 AF_UNIX\nRestrictNamespaces=true\nRestrictRealtime=true\nRestrictSUIDSGID=true\nSystemCallArchitectures=native\nUMask=0027\n\n[Install]\nWantedBy=multi-user.target\n```\n\n### 1.9 启动\n\n```systemctl daemon-reload```\n```systemctl enable grafana-server --now```\n\n\n### 1.10 注意\n\n**如果启动报错, 注意配置文件还有相关目录的权限**\n\n\n## 二、 docker 构建\n\n### 2.1 拉取镜像\n\n``` docker pull grafana/grafana-enterprise ```\n\n### 2.2 docker-compose \n\n```vim grafana.yaml ```\n\n``` yaml\nversion: \"3\"\nservices:\n  grafana:\n    image: grafana/grafana-enterprise\n    container_name: grafana\n    restart: unless-stopped\n    user: \"0\"\n    ports:\n      - \"3000:3000\"\n    volumes:\n      - /var/lib/grafana:/var/lib/grafana\n```\n\n### 2.3 启动 \n\n``` docker-compose -f grafana.yaml up -d ```","source":"_posts/054.Grafana_Installation.md","raw":"---\ntitle: 自动化监控运维(二)   Grafana 构建\ndate: 2023-9-28 16:45:47\ncategories: \n- [Monitor]\ntags: \n- Grafana\n---\n\n## 零、 说明\n\n- 三种部署方式\n    - rpm 包部署 (简单, 不写)\n    - 二进制部署\n    - docker 构建\n\n\n\n## 一、 二进制安装\n\n### 1.1 下载\n\n[下载连接](https://dl.grafana.com/enterprise/release/grafana-enterprise-10.1.2.linux-amd64.tar.gz)\n\n### 1.2 解压并复制到指定目录\n``` tar -zxvf grafana-enterprise-10.1.2.linux-amd64.tar.gz```\n``` cp -rf grafana-10.1.2/ /usr/local/grafana ```\n\n### 1.3 创建用户/组\n```groupadd grafana```\n```useradd -g grafana grafana```\n\n### 1.4 创建相关目录\n```mkdir -p /etc/grafana```\n```mkdir -p /etc/grafana/provisioning```\n```mkdir -p /var/log/grafana```\n```mkdir -p /var/lib/grafana```\n```mkdir -p /var/lib/grafana/plugins```\n\n### 1.5 修改目录权限\n```chown -R grafana:grafana /usr/local/grafana/```\n```chown -R grafana:grafana /etc/grafana/```\n```chown -R grafana:grafana /var/lib/grafana/```\n```chown -R grafana:grafana /var/log/grafana/```\n\n### 1.6 复制 grafana 配置文件\n``` cp /usr/local/grafana/conf/sample.ini /etc/grafana/grafana.ini ```\n\n### 1.7 环境配置文件\n```vim /etc/sysconfig/grafana-server```\n\n``` yaml\nGRAFANA_USER=grafana\nGRAFANA_GROUP=grafana\nGRAFANA_HOME=/usr/local/grafana\nLOG_DIR=/var/log/grafana\nDATA_DIR=/var/lib/grafana\nMAX_OPEN_FILES=10000\nCONF_DIR=/etc/grafana\nCONF_FILE=/etc/grafana/grafana.ini\nRESTART_ON_UPGRADE=true\nPLUGINS_DIR=/var/lib/grafana/plugins\nPROVISIONING_CFG_DIR=/etc/grafana/provisioning\n# Only used on systemd systems\nPID_FILE_DIR=/var/run/grafana\n```\n\n### 1.8 systemd 管理脚本\n```vim /usr/lib/systemd/system/grafana-server.service```\n\n``` yaml\n# /usr/lib/systemd/system/grafana-server.service\n[Unit]\nDescription=Grafana instance\nDocumentation=http://docs.grafana.org\nWants=network-online.target\nAfter=network-online.target\nAfter=postgresql.service mariadb.service mysqld.service influxdb.service\n\n[Service]\nEnvironmentFile=/etc/sysconfig/grafana-server\nUser=grafana\nGroup=grafana\nType=notify\nRestart=on-failure\nWorkingDirectory=/usr/local/grafana\nRuntimeDirectory=grafana\nRuntimeDirectoryMode=0750\nExecStart=/usr/local/grafana/bin/grafana server                                     \\\n                            --config=${CONF_FILE}                                   \\\n                            --pidfile=${PID_FILE_DIR}/grafana-server.pid            \\\n                            --packaging=rpm                                         \\\n                            cfg:default.paths.logs=${LOG_DIR}                       \\\n                            cfg:default.paths.data=${DATA_DIR}                      \\\n                            cfg:default.paths.plugins=${PLUGINS_DIR}                \\\n                            cfg:default.paths.provisioning=${PROVISIONING_CFG_DIR}\n\nLimitNOFILE=10000\nTimeoutStopSec=20\nCapabilityBoundingSet=\nDeviceAllow=\nLockPersonality=true\nMemoryDenyWriteExecute=false\nNoNewPrivileges=true\nPrivateDevices=true\nPrivateTmp=true\nProtectClock=true\nProtectControlGroups=true\nProtectHome=true\nProtectHostname=true\nProtectKernelLogs=true\nProtectKernelModules=true\nProtectKernelTunables=true\nProtectProc=invisible\nProtectSystem=full\nRemoveIPC=true\nRestrictAddressFamilies=AF_INET AF_INET6 AF_UNIX\nRestrictNamespaces=true\nRestrictRealtime=true\nRestrictSUIDSGID=true\nSystemCallArchitectures=native\nUMask=0027\n\n[Install]\nWantedBy=multi-user.target\n```\n\n### 1.9 启动\n\n```systemctl daemon-reload```\n```systemctl enable grafana-server --now```\n\n\n### 1.10 注意\n\n**如果启动报错, 注意配置文件还有相关目录的权限**\n\n\n## 二、 docker 构建\n\n### 2.1 拉取镜像\n\n``` docker pull grafana/grafana-enterprise ```\n\n### 2.2 docker-compose \n\n```vim grafana.yaml ```\n\n``` yaml\nversion: \"3\"\nservices:\n  grafana:\n    image: grafana/grafana-enterprise\n    container_name: grafana\n    restart: unless-stopped\n    user: \"0\"\n    ports:\n      - \"3000:3000\"\n    volumes:\n      - /var/lib/grafana:/var/lib/grafana\n```\n\n### 2.3 启动 \n\n``` docker-compose -f grafana.yaml up -d ```","slug":"054.Grafana_Installation","published":1,"updated":"2023-12-05T08:52:30.880Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzef0050ijnr5dkshhqo","content":"<h2 id=\"零、-说明\"><a href=\"#零、-说明\" class=\"headerlink\" title=\"零、 说明\"></a>零、 说明</h2><ul>\n<li>三种部署方式<ul>\n<li>rpm 包部署 (简单, 不写)</li>\n<li>二进制部署</li>\n<li>docker 构建</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"一、-二进制安装\"><a href=\"#一、-二进制安装\" class=\"headerlink\" title=\"一、 二进制安装\"></a>一、 二进制安装</h2><h3 id=\"1-1-下载\"><a href=\"#1-1-下载\" class=\"headerlink\" title=\"1.1 下载\"></a>1.1 下载</h3><p><a href=\"https://dl.grafana.com/enterprise/release/grafana-enterprise-10.1.2.linux-amd64.tar.gz\">下载连接</a></p>\n<h3 id=\"1-2-解压并复制到指定目录\"><a href=\"#1-2-解压并复制到指定目录\" class=\"headerlink\" title=\"1.2 解压并复制到指定目录\"></a>1.2 解压并复制到指定目录</h3><p><code> tar -zxvf grafana-enterprise-10.1.2.linux-amd64.tar.gz</code><br><code>cp -rf grafana-10.1.2/ /usr/local/grafana</code></p>\n<h3 id=\"1-3-创建用户-组\"><a href=\"#1-3-创建用户-组\" class=\"headerlink\" title=\"1.3 创建用户&#x2F;组\"></a>1.3 创建用户&#x2F;组</h3><p><code>groupadd grafana</code><br><code>useradd -g grafana grafana</code></p>\n<h3 id=\"1-4-创建相关目录\"><a href=\"#1-4-创建相关目录\" class=\"headerlink\" title=\"1.4 创建相关目录\"></a>1.4 创建相关目录</h3><p><code>mkdir -p /etc/grafana</code><br><code>mkdir -p /etc/grafana/provisioning</code><br><code>mkdir -p /var/log/grafana</code><br><code>mkdir -p /var/lib/grafana</code><br><code>mkdir -p /var/lib/grafana/plugins</code></p>\n<h3 id=\"1-5-修改目录权限\"><a href=\"#1-5-修改目录权限\" class=\"headerlink\" title=\"1.5 修改目录权限\"></a>1.5 修改目录权限</h3><p><code>chown -R grafana:grafana /usr/local/grafana/</code><br><code>chown -R grafana:grafana /etc/grafana/</code><br><code>chown -R grafana:grafana /var/lib/grafana/</code><br><code>chown -R grafana:grafana /var/log/grafana/</code></p>\n<h3 id=\"1-6-复制-grafana-配置文件\"><a href=\"#1-6-复制-grafana-配置文件\" class=\"headerlink\" title=\"1.6 复制 grafana 配置文件\"></a>1.6 复制 grafana 配置文件</h3><p><code>cp /usr/local/grafana/conf/sample.ini /etc/grafana/grafana.ini</code></p>\n<h3 id=\"1-7-环境配置文件\"><a href=\"#1-7-环境配置文件\" class=\"headerlink\" title=\"1.7 环境配置文件\"></a>1.7 环境配置文件</h3><p><code>vim /etc/sysconfig/grafana-server</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">GRAFANA_USER=grafana</span></span><br><span class=\"line\"><span class=\"string\">GRAFANA_GROUP=grafana</span></span><br><span class=\"line\"><span class=\"string\">GRAFANA_HOME=/usr/local/grafana</span></span><br><span class=\"line\"><span class=\"string\">LOG_DIR=/var/log/grafana</span></span><br><span class=\"line\"><span class=\"string\">DATA_DIR=/var/lib/grafana</span></span><br><span class=\"line\"><span class=\"string\">MAX_OPEN_FILES=10000</span></span><br><span class=\"line\"><span class=\"string\">CONF_DIR=/etc/grafana</span></span><br><span class=\"line\"><span class=\"string\">CONF_FILE=/etc/grafana/grafana.ini</span></span><br><span class=\"line\"><span class=\"string\">RESTART_ON_UPGRADE=true</span></span><br><span class=\"line\"><span class=\"string\">PLUGINS_DIR=/var/lib/grafana/plugins</span></span><br><span class=\"line\"><span class=\"string\">PROVISIONING_CFG_DIR=/etc/grafana/provisioning</span></span><br><span class=\"line\"><span class=\"comment\"># Only used on systemd systems</span></span><br><span class=\"line\"><span class=\"string\">PID_FILE_DIR=/var/run/grafana</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-8-systemd-管理脚本\"><a href=\"#1-8-systemd-管理脚本\" class=\"headerlink\" title=\"1.8 systemd 管理脚本\"></a>1.8 systemd 管理脚本</h3><p><code>vim /usr/lib/systemd/system/grafana-server.service</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /usr/lib/systemd/system/grafana-server.service</span></span><br><span class=\"line\">[<span class=\"string\">Unit</span>]</span><br><span class=\"line\"><span class=\"string\">Description=Grafana</span> <span class=\"string\">instance</span></span><br><span class=\"line\"><span class=\"string\">Documentation=http://docs.grafana.org</span></span><br><span class=\"line\"><span class=\"string\">Wants=network-online.target</span></span><br><span class=\"line\"><span class=\"string\">After=network-online.target</span></span><br><span class=\"line\"><span class=\"string\">After=postgresql.service</span> <span class=\"string\">mariadb.service</span> <span class=\"string\">mysqld.service</span> <span class=\"string\">influxdb.service</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"string\">Service</span>]</span><br><span class=\"line\"><span class=\"string\">EnvironmentFile=/etc/sysconfig/grafana-server</span></span><br><span class=\"line\"><span class=\"string\">User=grafana</span></span><br><span class=\"line\"><span class=\"string\">Group=grafana</span></span><br><span class=\"line\"><span class=\"string\">Type=notify</span></span><br><span class=\"line\"><span class=\"string\">Restart=on-failure</span></span><br><span class=\"line\"><span class=\"string\">WorkingDirectory=/usr/local/grafana</span></span><br><span class=\"line\"><span class=\"string\">RuntimeDirectory=grafana</span></span><br><span class=\"line\"><span class=\"string\">RuntimeDirectoryMode=0750</span></span><br><span class=\"line\"><span class=\"string\">ExecStart=/usr/local/grafana/bin/grafana</span> <span class=\"string\">server</span>                                     <span class=\"string\">\\</span></span><br><span class=\"line\">                            <span class=\"string\">--config=$&#123;CONF_FILE&#125;</span>                                   <span class=\"string\">\\</span></span><br><span class=\"line\">                            <span class=\"string\">--pidfile=$&#123;PID_FILE_DIR&#125;/grafana-server.pid</span>            <span class=\"string\">\\</span></span><br><span class=\"line\">                            <span class=\"string\">--packaging=rpm</span>                                         <span class=\"string\">\\</span></span><br><span class=\"line\">                            <span class=\"string\">cfg:default.paths.logs=$&#123;LOG_DIR&#125;</span>                       <span class=\"string\">\\</span></span><br><span class=\"line\">                            <span class=\"string\">cfg:default.paths.data=$&#123;DATA_DIR&#125;</span>                      <span class=\"string\">\\</span></span><br><span class=\"line\">                            <span class=\"string\">cfg:default.paths.plugins=$&#123;PLUGINS_DIR&#125;</span>                <span class=\"string\">\\</span></span><br><span class=\"line\">                            <span class=\"string\">cfg:default.paths.provisioning=$&#123;PROVISIONING_CFG_DIR&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">LimitNOFILE=10000</span></span><br><span class=\"line\"><span class=\"string\">TimeoutStopSec=20</span></span><br><span class=\"line\"><span class=\"string\">CapabilityBoundingSet=</span></span><br><span class=\"line\"><span class=\"string\">DeviceAllow=</span></span><br><span class=\"line\"><span class=\"string\">LockPersonality=true</span></span><br><span class=\"line\"><span class=\"string\">MemoryDenyWriteExecute=false</span></span><br><span class=\"line\"><span class=\"string\">NoNewPrivileges=true</span></span><br><span class=\"line\"><span class=\"string\">PrivateDevices=true</span></span><br><span class=\"line\"><span class=\"string\">PrivateTmp=true</span></span><br><span class=\"line\"><span class=\"string\">ProtectClock=true</span></span><br><span class=\"line\"><span class=\"string\">ProtectControlGroups=true</span></span><br><span class=\"line\"><span class=\"string\">ProtectHome=true</span></span><br><span class=\"line\"><span class=\"string\">ProtectHostname=true</span></span><br><span class=\"line\"><span class=\"string\">ProtectKernelLogs=true</span></span><br><span class=\"line\"><span class=\"string\">ProtectKernelModules=true</span></span><br><span class=\"line\"><span class=\"string\">ProtectKernelTunables=true</span></span><br><span class=\"line\"><span class=\"string\">ProtectProc=invisible</span></span><br><span class=\"line\"><span class=\"string\">ProtectSystem=full</span></span><br><span class=\"line\"><span class=\"string\">RemoveIPC=true</span></span><br><span class=\"line\"><span class=\"string\">RestrictAddressFamilies=AF_INET</span> <span class=\"string\">AF_INET6</span> <span class=\"string\">AF_UNIX</span></span><br><span class=\"line\"><span class=\"string\">RestrictNamespaces=true</span></span><br><span class=\"line\"><span class=\"string\">RestrictRealtime=true</span></span><br><span class=\"line\"><span class=\"string\">RestrictSUIDSGID=true</span></span><br><span class=\"line\"><span class=\"string\">SystemCallArchitectures=native</span></span><br><span class=\"line\"><span class=\"string\">UMask=0027</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"string\">Install</span>]</span><br><span class=\"line\"><span class=\"string\">WantedBy=multi-user.target</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-9-启动\"><a href=\"#1-9-启动\" class=\"headerlink\" title=\"1.9 启动\"></a>1.9 启动</h3><p><code>systemctl daemon-reload</code><br><code>systemctl enable grafana-server --now</code></p>\n<h3 id=\"1-10-注意\"><a href=\"#1-10-注意\" class=\"headerlink\" title=\"1.10 注意\"></a>1.10 注意</h3><p><strong>如果启动报错, 注意配置文件还有相关目录的权限</strong></p>\n<h2 id=\"二、-docker-构建\"><a href=\"#二、-docker-构建\" class=\"headerlink\" title=\"二、 docker 构建\"></a>二、 docker 构建</h2><h3 id=\"2-1-拉取镜像\"><a href=\"#2-1-拉取镜像\" class=\"headerlink\" title=\"2.1 拉取镜像\"></a>2.1 拉取镜像</h3><p><code>docker pull grafana/grafana-enterprise</code></p>\n<h3 id=\"2-2-docker-compose\"><a href=\"#2-2-docker-compose\" class=\"headerlink\" title=\"2.2 docker-compose\"></a>2.2 docker-compose</h3><p><code>vim grafana.yaml </code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">grafana:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">grafana/grafana-enterprise</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">grafana</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">unless-stopped</span></span><br><span class=\"line\">    <span class=\"attr\">user:</span> <span class=\"string\">&quot;0&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;3000:3000&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/var/lib/grafana:/var/lib/grafana</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-3-启动\"><a href=\"#2-3-启动\" class=\"headerlink\" title=\"2.3 启动\"></a>2.3 启动</h3><p><code>docker-compose -f grafana.yaml up -d</code></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"零、-说明\"><a href=\"#零、-说明\" class=\"headerlink\" title=\"零、 说明\"></a>零、 说明</h2><ul>\n<li>三种部署方式<ul>\n<li>rpm 包部署 (简单, 不写)</li>\n<li>二进制部署</li>\n<li>docker 构建</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"一、-二进制安装\"><a href=\"#一、-二进制安装\" class=\"headerlink\" title=\"一、 二进制安装\"></a>一、 二进制安装</h2><h3 id=\"1-1-下载\"><a href=\"#1-1-下载\" class=\"headerlink\" title=\"1.1 下载\"></a>1.1 下载</h3><p><a href=\"https://dl.grafana.com/enterprise/release/grafana-enterprise-10.1.2.linux-amd64.tar.gz\">下载连接</a></p>\n<h3 id=\"1-2-解压并复制到指定目录\"><a href=\"#1-2-解压并复制到指定目录\" class=\"headerlink\" title=\"1.2 解压并复制到指定目录\"></a>1.2 解压并复制到指定目录</h3><p><code> tar -zxvf grafana-enterprise-10.1.2.linux-amd64.tar.gz</code><br><code>cp -rf grafana-10.1.2/ /usr/local/grafana</code></p>\n<h3 id=\"1-3-创建用户-组\"><a href=\"#1-3-创建用户-组\" class=\"headerlink\" title=\"1.3 创建用户&#x2F;组\"></a>1.3 创建用户&#x2F;组</h3><p><code>groupadd grafana</code><br><code>useradd -g grafana grafana</code></p>\n<h3 id=\"1-4-创建相关目录\"><a href=\"#1-4-创建相关目录\" class=\"headerlink\" title=\"1.4 创建相关目录\"></a>1.4 创建相关目录</h3><p><code>mkdir -p /etc/grafana</code><br><code>mkdir -p /etc/grafana/provisioning</code><br><code>mkdir -p /var/log/grafana</code><br><code>mkdir -p /var/lib/grafana</code><br><code>mkdir -p /var/lib/grafana/plugins</code></p>\n<h3 id=\"1-5-修改目录权限\"><a href=\"#1-5-修改目录权限\" class=\"headerlink\" title=\"1.5 修改目录权限\"></a>1.5 修改目录权限</h3><p><code>chown -R grafana:grafana /usr/local/grafana/</code><br><code>chown -R grafana:grafana /etc/grafana/</code><br><code>chown -R grafana:grafana /var/lib/grafana/</code><br><code>chown -R grafana:grafana /var/log/grafana/</code></p>\n<h3 id=\"1-6-复制-grafana-配置文件\"><a href=\"#1-6-复制-grafana-配置文件\" class=\"headerlink\" title=\"1.6 复制 grafana 配置文件\"></a>1.6 复制 grafana 配置文件</h3><p><code>cp /usr/local/grafana/conf/sample.ini /etc/grafana/grafana.ini</code></p>\n<h3 id=\"1-7-环境配置文件\"><a href=\"#1-7-环境配置文件\" class=\"headerlink\" title=\"1.7 环境配置文件\"></a>1.7 环境配置文件</h3><p><code>vim /etc/sysconfig/grafana-server</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">GRAFANA_USER=grafana</span></span><br><span class=\"line\"><span class=\"string\">GRAFANA_GROUP=grafana</span></span><br><span class=\"line\"><span class=\"string\">GRAFANA_HOME=/usr/local/grafana</span></span><br><span class=\"line\"><span class=\"string\">LOG_DIR=/var/log/grafana</span></span><br><span class=\"line\"><span class=\"string\">DATA_DIR=/var/lib/grafana</span></span><br><span class=\"line\"><span class=\"string\">MAX_OPEN_FILES=10000</span></span><br><span class=\"line\"><span class=\"string\">CONF_DIR=/etc/grafana</span></span><br><span class=\"line\"><span class=\"string\">CONF_FILE=/etc/grafana/grafana.ini</span></span><br><span class=\"line\"><span class=\"string\">RESTART_ON_UPGRADE=true</span></span><br><span class=\"line\"><span class=\"string\">PLUGINS_DIR=/var/lib/grafana/plugins</span></span><br><span class=\"line\"><span class=\"string\">PROVISIONING_CFG_DIR=/etc/grafana/provisioning</span></span><br><span class=\"line\"><span class=\"comment\"># Only used on systemd systems</span></span><br><span class=\"line\"><span class=\"string\">PID_FILE_DIR=/var/run/grafana</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-8-systemd-管理脚本\"><a href=\"#1-8-systemd-管理脚本\" class=\"headerlink\" title=\"1.8 systemd 管理脚本\"></a>1.8 systemd 管理脚本</h3><p><code>vim /usr/lib/systemd/system/grafana-server.service</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /usr/lib/systemd/system/grafana-server.service</span></span><br><span class=\"line\">[<span class=\"string\">Unit</span>]</span><br><span class=\"line\"><span class=\"string\">Description=Grafana</span> <span class=\"string\">instance</span></span><br><span class=\"line\"><span class=\"string\">Documentation=http://docs.grafana.org</span></span><br><span class=\"line\"><span class=\"string\">Wants=network-online.target</span></span><br><span class=\"line\"><span class=\"string\">After=network-online.target</span></span><br><span class=\"line\"><span class=\"string\">After=postgresql.service</span> <span class=\"string\">mariadb.service</span> <span class=\"string\">mysqld.service</span> <span class=\"string\">influxdb.service</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"string\">Service</span>]</span><br><span class=\"line\"><span class=\"string\">EnvironmentFile=/etc/sysconfig/grafana-server</span></span><br><span class=\"line\"><span class=\"string\">User=grafana</span></span><br><span class=\"line\"><span class=\"string\">Group=grafana</span></span><br><span class=\"line\"><span class=\"string\">Type=notify</span></span><br><span class=\"line\"><span class=\"string\">Restart=on-failure</span></span><br><span class=\"line\"><span class=\"string\">WorkingDirectory=/usr/local/grafana</span></span><br><span class=\"line\"><span class=\"string\">RuntimeDirectory=grafana</span></span><br><span class=\"line\"><span class=\"string\">RuntimeDirectoryMode=0750</span></span><br><span class=\"line\"><span class=\"string\">ExecStart=/usr/local/grafana/bin/grafana</span> <span class=\"string\">server</span>                                     <span class=\"string\">\\</span></span><br><span class=\"line\">                            <span class=\"string\">--config=$&#123;CONF_FILE&#125;</span>                                   <span class=\"string\">\\</span></span><br><span class=\"line\">                            <span class=\"string\">--pidfile=$&#123;PID_FILE_DIR&#125;/grafana-server.pid</span>            <span class=\"string\">\\</span></span><br><span class=\"line\">                            <span class=\"string\">--packaging=rpm</span>                                         <span class=\"string\">\\</span></span><br><span class=\"line\">                            <span class=\"string\">cfg:default.paths.logs=$&#123;LOG_DIR&#125;</span>                       <span class=\"string\">\\</span></span><br><span class=\"line\">                            <span class=\"string\">cfg:default.paths.data=$&#123;DATA_DIR&#125;</span>                      <span class=\"string\">\\</span></span><br><span class=\"line\">                            <span class=\"string\">cfg:default.paths.plugins=$&#123;PLUGINS_DIR&#125;</span>                <span class=\"string\">\\</span></span><br><span class=\"line\">                            <span class=\"string\">cfg:default.paths.provisioning=$&#123;PROVISIONING_CFG_DIR&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">LimitNOFILE=10000</span></span><br><span class=\"line\"><span class=\"string\">TimeoutStopSec=20</span></span><br><span class=\"line\"><span class=\"string\">CapabilityBoundingSet=</span></span><br><span class=\"line\"><span class=\"string\">DeviceAllow=</span></span><br><span class=\"line\"><span class=\"string\">LockPersonality=true</span></span><br><span class=\"line\"><span class=\"string\">MemoryDenyWriteExecute=false</span></span><br><span class=\"line\"><span class=\"string\">NoNewPrivileges=true</span></span><br><span class=\"line\"><span class=\"string\">PrivateDevices=true</span></span><br><span class=\"line\"><span class=\"string\">PrivateTmp=true</span></span><br><span class=\"line\"><span class=\"string\">ProtectClock=true</span></span><br><span class=\"line\"><span class=\"string\">ProtectControlGroups=true</span></span><br><span class=\"line\"><span class=\"string\">ProtectHome=true</span></span><br><span class=\"line\"><span class=\"string\">ProtectHostname=true</span></span><br><span class=\"line\"><span class=\"string\">ProtectKernelLogs=true</span></span><br><span class=\"line\"><span class=\"string\">ProtectKernelModules=true</span></span><br><span class=\"line\"><span class=\"string\">ProtectKernelTunables=true</span></span><br><span class=\"line\"><span class=\"string\">ProtectProc=invisible</span></span><br><span class=\"line\"><span class=\"string\">ProtectSystem=full</span></span><br><span class=\"line\"><span class=\"string\">RemoveIPC=true</span></span><br><span class=\"line\"><span class=\"string\">RestrictAddressFamilies=AF_INET</span> <span class=\"string\">AF_INET6</span> <span class=\"string\">AF_UNIX</span></span><br><span class=\"line\"><span class=\"string\">RestrictNamespaces=true</span></span><br><span class=\"line\"><span class=\"string\">RestrictRealtime=true</span></span><br><span class=\"line\"><span class=\"string\">RestrictSUIDSGID=true</span></span><br><span class=\"line\"><span class=\"string\">SystemCallArchitectures=native</span></span><br><span class=\"line\"><span class=\"string\">UMask=0027</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"string\">Install</span>]</span><br><span class=\"line\"><span class=\"string\">WantedBy=multi-user.target</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-9-启动\"><a href=\"#1-9-启动\" class=\"headerlink\" title=\"1.9 启动\"></a>1.9 启动</h3><p><code>systemctl daemon-reload</code><br><code>systemctl enable grafana-server --now</code></p>\n<h3 id=\"1-10-注意\"><a href=\"#1-10-注意\" class=\"headerlink\" title=\"1.10 注意\"></a>1.10 注意</h3><p><strong>如果启动报错, 注意配置文件还有相关目录的权限</strong></p>\n<h2 id=\"二、-docker-构建\"><a href=\"#二、-docker-构建\" class=\"headerlink\" title=\"二、 docker 构建\"></a>二、 docker 构建</h2><h3 id=\"2-1-拉取镜像\"><a href=\"#2-1-拉取镜像\" class=\"headerlink\" title=\"2.1 拉取镜像\"></a>2.1 拉取镜像</h3><p><code>docker pull grafana/grafana-enterprise</code></p>\n<h3 id=\"2-2-docker-compose\"><a href=\"#2-2-docker-compose\" class=\"headerlink\" title=\"2.2 docker-compose\"></a>2.2 docker-compose</h3><p><code>vim grafana.yaml </code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">grafana:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">grafana/grafana-enterprise</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">grafana</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">unless-stopped</span></span><br><span class=\"line\">    <span class=\"attr\">user:</span> <span class=\"string\">&quot;0&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;3000:3000&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/var/lib/grafana:/var/lib/grafana</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-3-启动\"><a href=\"#2-3-启动\" class=\"headerlink\" title=\"2.3 启动\"></a>2.3 启动</h3><p><code>docker-compose -f grafana.yaml up -d</code></p>\n"},{"title":"Gitlab 部署以及升级","date":"2023-10-11T03:20:47.000Z","_content":"\n## 零、 ENV\n\n- OS: CentOS 7.9\n- HW: 4c4g\n- platform: KVM\n- version: GitLab Community Edition 12.10.6\n- ip: 192.168.128.100\n\n## 一、 官方源安装\n\n### 1.1 安装 CE 版本yum源\n\n``` curl -s https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash ```\n\n### 1.2 安装\n\n``` yum install gitlab-ce-12.10.6 ```\n\n## 二、 启动\n\n### 2.1 编辑gitlab配置文件 \n\n``` vim /etc/gitlab/gitlab.rb ```\n\n- line29: http://192.168.128.100\n\n### 2.2 配置生效\n\n``` gitlab-ctl reconfigure ```\n\n### 2.3 启动 gitlab\n\n``` gitlab start ```\n\n\n## 三、 GitLab升级\n\n> 由于GitLab有严格的版本控制, 无法随意升级.\n\n> 官方给出的升级办法. \n\n<img src=\"/images/055.Gitlab_Installation.md.01.png\" width=100% height=100% />\n\n\n\n### 3.1 升级路线查询\n\nhttps://gitlab-com.gitlab.io/support/toolbox/upgrade-path/\n\n<img src=\"/images/055.Gitlab_Installation.md.02.png\" width=100% height=100% />\n\n### 升级\n\n1. 可以直接 ```yum install + 包名称-版本号 ```\n2. 也可以直接下载 rpm 包然后通过 ``` rpm -uvh + xxx.rpm ```\n\n看到如下标志表示安装/升级成功.\n\n<img src=\"/images/055.Gitlab_Installation.md.03.png\" width=100% height=100% />\n\n","source":"_posts/055.Gitlab_Installation.md","raw":"---\ntitle: Gitlab 部署以及升级\ndate: 2023-10-11 11:20:47\ncategories: \n- [CI/CD]\ntags: \n- gitlab\n---\n\n## 零、 ENV\n\n- OS: CentOS 7.9\n- HW: 4c4g\n- platform: KVM\n- version: GitLab Community Edition 12.10.6\n- ip: 192.168.128.100\n\n## 一、 官方源安装\n\n### 1.1 安装 CE 版本yum源\n\n``` curl -s https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash ```\n\n### 1.2 安装\n\n``` yum install gitlab-ce-12.10.6 ```\n\n## 二、 启动\n\n### 2.1 编辑gitlab配置文件 \n\n``` vim /etc/gitlab/gitlab.rb ```\n\n- line29: http://192.168.128.100\n\n### 2.2 配置生效\n\n``` gitlab-ctl reconfigure ```\n\n### 2.3 启动 gitlab\n\n``` gitlab start ```\n\n\n## 三、 GitLab升级\n\n> 由于GitLab有严格的版本控制, 无法随意升级.\n\n> 官方给出的升级办法. \n\n<img src=\"/images/055.Gitlab_Installation.md.01.png\" width=100% height=100% />\n\n\n\n### 3.1 升级路线查询\n\nhttps://gitlab-com.gitlab.io/support/toolbox/upgrade-path/\n\n<img src=\"/images/055.Gitlab_Installation.md.02.png\" width=100% height=100% />\n\n### 升级\n\n1. 可以直接 ```yum install + 包名称-版本号 ```\n2. 也可以直接下载 rpm 包然后通过 ``` rpm -uvh + xxx.rpm ```\n\n看到如下标志表示安装/升级成功.\n\n<img src=\"/images/055.Gitlab_Installation.md.03.png\" width=100% height=100% />\n\n","slug":"055.Gitlab_Installation","published":1,"updated":"2023-12-05T08:52:30.880Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzeh0054ijnr3anrb7ys","content":"<h2 id=\"零、-ENV\"><a href=\"#零、-ENV\" class=\"headerlink\" title=\"零、 ENV\"></a>零、 ENV</h2><ul>\n<li>OS: CentOS 7.9</li>\n<li>HW: 4c4g</li>\n<li>platform: KVM</li>\n<li>version: GitLab Community Edition 12.10.6</li>\n<li>ip: 192.168.128.100</li>\n</ul>\n<h2 id=\"一、-官方源安装\"><a href=\"#一、-官方源安装\" class=\"headerlink\" title=\"一、 官方源安装\"></a>一、 官方源安装</h2><h3 id=\"1-1-安装-CE-版本yum源\"><a href=\"#1-1-安装-CE-版本yum源\" class=\"headerlink\" title=\"1.1 安装 CE 版本yum源\"></a>1.1 安装 CE 版本yum源</h3><p><code>curl -s https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash</code></p>\n<h3 id=\"1-2-安装\"><a href=\"#1-2-安装\" class=\"headerlink\" title=\"1.2 安装\"></a>1.2 安装</h3><p><code>yum install gitlab-ce-12.10.6</code></p>\n<h2 id=\"二、-启动\"><a href=\"#二、-启动\" class=\"headerlink\" title=\"二、 启动\"></a>二、 启动</h2><h3 id=\"2-1-编辑gitlab配置文件\"><a href=\"#2-1-编辑gitlab配置文件\" class=\"headerlink\" title=\"2.1 编辑gitlab配置文件\"></a>2.1 编辑gitlab配置文件</h3><p><code>vim /etc/gitlab/gitlab.rb</code></p>\n<ul>\n<li>line29: <a href=\"http://192.168.128.100/\">http://192.168.128.100</a></li>\n</ul>\n<h3 id=\"2-2-配置生效\"><a href=\"#2-2-配置生效\" class=\"headerlink\" title=\"2.2 配置生效\"></a>2.2 配置生效</h3><p><code>gitlab-ctl reconfigure</code></p>\n<h3 id=\"2-3-启动-gitlab\"><a href=\"#2-3-启动-gitlab\" class=\"headerlink\" title=\"2.3 启动 gitlab\"></a>2.3 启动 gitlab</h3><p><code>gitlab start</code></p>\n<h2 id=\"三、-GitLab升级\"><a href=\"#三、-GitLab升级\" class=\"headerlink\" title=\"三、 GitLab升级\"></a>三、 GitLab升级</h2><blockquote>\n<p>由于GitLab有严格的版本控制, 无法随意升级.</p>\n</blockquote>\n<blockquote>\n<p>官方给出的升级办法. </p>\n</blockquote>\n<img src=\"/images/055.Gitlab_Installation.md.01.png\" width=100% height=100% />\n\n\n\n<h3 id=\"3-1-升级路线查询\"><a href=\"#3-1-升级路线查询\" class=\"headerlink\" title=\"3.1 升级路线查询\"></a>3.1 升级路线查询</h3><p><a href=\"https://gitlab-com.gitlab.io/support/toolbox/upgrade-path/\">https://gitlab-com.gitlab.io/support/toolbox/upgrade-path/</a></p>\n<img src=\"/images/055.Gitlab_Installation.md.02.png\" width=100% height=100% />\n\n<h3 id=\"升级\"><a href=\"#升级\" class=\"headerlink\" title=\"升级\"></a>升级</h3><ol>\n<li>可以直接 <code>yum install + 包名称-版本号 </code></li>\n<li>也可以直接下载 rpm 包然后通过 <code>rpm -uvh + xxx.rpm</code></li>\n</ol>\n<p>看到如下标志表示安装&#x2F;升级成功.</p>\n<img src=\"/images/055.Gitlab_Installation.md.03.png\" width=100% height=100% />\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"零、-ENV\"><a href=\"#零、-ENV\" class=\"headerlink\" title=\"零、 ENV\"></a>零、 ENV</h2><ul>\n<li>OS: CentOS 7.9</li>\n<li>HW: 4c4g</li>\n<li>platform: KVM</li>\n<li>version: GitLab Community Edition 12.10.6</li>\n<li>ip: 192.168.128.100</li>\n</ul>\n<h2 id=\"一、-官方源安装\"><a href=\"#一、-官方源安装\" class=\"headerlink\" title=\"一、 官方源安装\"></a>一、 官方源安装</h2><h3 id=\"1-1-安装-CE-版本yum源\"><a href=\"#1-1-安装-CE-版本yum源\" class=\"headerlink\" title=\"1.1 安装 CE 版本yum源\"></a>1.1 安装 CE 版本yum源</h3><p><code>curl -s https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash</code></p>\n<h3 id=\"1-2-安装\"><a href=\"#1-2-安装\" class=\"headerlink\" title=\"1.2 安装\"></a>1.2 安装</h3><p><code>yum install gitlab-ce-12.10.6</code></p>\n<h2 id=\"二、-启动\"><a href=\"#二、-启动\" class=\"headerlink\" title=\"二、 启动\"></a>二、 启动</h2><h3 id=\"2-1-编辑gitlab配置文件\"><a href=\"#2-1-编辑gitlab配置文件\" class=\"headerlink\" title=\"2.1 编辑gitlab配置文件\"></a>2.1 编辑gitlab配置文件</h3><p><code>vim /etc/gitlab/gitlab.rb</code></p>\n<ul>\n<li>line29: <a href=\"http://192.168.128.100/\">http://192.168.128.100</a></li>\n</ul>\n<h3 id=\"2-2-配置生效\"><a href=\"#2-2-配置生效\" class=\"headerlink\" title=\"2.2 配置生效\"></a>2.2 配置生效</h3><p><code>gitlab-ctl reconfigure</code></p>\n<h3 id=\"2-3-启动-gitlab\"><a href=\"#2-3-启动-gitlab\" class=\"headerlink\" title=\"2.3 启动 gitlab\"></a>2.3 启动 gitlab</h3><p><code>gitlab start</code></p>\n<h2 id=\"三、-GitLab升级\"><a href=\"#三、-GitLab升级\" class=\"headerlink\" title=\"三、 GitLab升级\"></a>三、 GitLab升级</h2><blockquote>\n<p>由于GitLab有严格的版本控制, 无法随意升级.</p>\n</blockquote>\n<blockquote>\n<p>官方给出的升级办法. </p>\n</blockquote>\n<img src=\"/images/055.Gitlab_Installation.md.01.png\" width=100% height=100% />\n\n\n\n<h3 id=\"3-1-升级路线查询\"><a href=\"#3-1-升级路线查询\" class=\"headerlink\" title=\"3.1 升级路线查询\"></a>3.1 升级路线查询</h3><p><a href=\"https://gitlab-com.gitlab.io/support/toolbox/upgrade-path/\">https://gitlab-com.gitlab.io/support/toolbox/upgrade-path/</a></p>\n<img src=\"/images/055.Gitlab_Installation.md.02.png\" width=100% height=100% />\n\n<h3 id=\"升级\"><a href=\"#升级\" class=\"headerlink\" title=\"升级\"></a>升级</h3><ol>\n<li>可以直接 <code>yum install + 包名称-版本号 </code></li>\n<li>也可以直接下载 rpm 包然后通过 <code>rpm -uvh + xxx.rpm</code></li>\n</ol>\n<p>看到如下标志表示安装&#x2F;升级成功.</p>\n<img src=\"/images/055.Gitlab_Installation.md.03.png\" width=100% height=100% />\n\n"},{"title":"Harbor 部署","date":"2023-10-12T08:20:47.000Z","_content":"\n\n## 一、 离线安装\n\n### 1.1 下载安装包\n[Github Release](https://github.com/goharbor/harbor/releases)\n\n### 1.2 解压\n\n```tar -xzvf harbor-offline-installer-v2.7.3.tgz -C /usr/local```\n\n### 1.3 加载镜像\n\n```docker load -i /usr/local/harbor/harbor.v2.7.3.tar.gz```\n\n### 1.4 创建相关数据日志目录\n\n``` mkdir /data/harbor /var/log/harbor -p```\n\n### 1.5 创建配置文件\n\n```cp /usr/local/harbor/harbor.yml.tmpl /usr/local/harbor/harbor.yml```\n\n```vim /usr/local/harbor/harbor.yml```\n<img src=\"/images/056.Harbor_Installation.md.01.png\" width=100% height=100% />\n\n修改相应的主机,端口号, 密码等.\n\n### 1.6 安装\n\n```./prepare```\n```./install```\n<img src=\"/images/056.Harbor_Installation.md.02.png\" width=100% height=100% />\n\n## 二、 注意事项\n\nharbor自带registry, 安装之前请卸载原来官方的registry(如果你有的话)","source":"_posts/056.Harbor_Installation.md","raw":"---\ntitle: Harbor 部署\ndate: 2023-10-12 16:20:47\ncategories: \n- [Docker]\ntags: \n- harbor\n---\n\n\n## 一、 离线安装\n\n### 1.1 下载安装包\n[Github Release](https://github.com/goharbor/harbor/releases)\n\n### 1.2 解压\n\n```tar -xzvf harbor-offline-installer-v2.7.3.tgz -C /usr/local```\n\n### 1.3 加载镜像\n\n```docker load -i /usr/local/harbor/harbor.v2.7.3.tar.gz```\n\n### 1.4 创建相关数据日志目录\n\n``` mkdir /data/harbor /var/log/harbor -p```\n\n### 1.5 创建配置文件\n\n```cp /usr/local/harbor/harbor.yml.tmpl /usr/local/harbor/harbor.yml```\n\n```vim /usr/local/harbor/harbor.yml```\n<img src=\"/images/056.Harbor_Installation.md.01.png\" width=100% height=100% />\n\n修改相应的主机,端口号, 密码等.\n\n### 1.6 安装\n\n```./prepare```\n```./install```\n<img src=\"/images/056.Harbor_Installation.md.02.png\" width=100% height=100% />\n\n## 二、 注意事项\n\nharbor自带registry, 安装之前请卸载原来官方的registry(如果你有的话)","slug":"056.Harbor_Installation","published":1,"updated":"2023-12-05T08:52:30.880Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzei0057ijnrahnn2k72","content":"<h2 id=\"一、-离线安装\"><a href=\"#一、-离线安装\" class=\"headerlink\" title=\"一、 离线安装\"></a>一、 离线安装</h2><h3 id=\"1-1-下载安装包\"><a href=\"#1-1-下载安装包\" class=\"headerlink\" title=\"1.1 下载安装包\"></a>1.1 下载安装包</h3><p><a href=\"https://github.com/goharbor/harbor/releases\">Github Release</a></p>\n<h3 id=\"1-2-解压\"><a href=\"#1-2-解压\" class=\"headerlink\" title=\"1.2 解压\"></a>1.2 解压</h3><p><code>tar -xzvf harbor-offline-installer-v2.7.3.tgz -C /usr/local</code></p>\n<h3 id=\"1-3-加载镜像\"><a href=\"#1-3-加载镜像\" class=\"headerlink\" title=\"1.3 加载镜像\"></a>1.3 加载镜像</h3><p><code>docker load -i /usr/local/harbor/harbor.v2.7.3.tar.gz</code></p>\n<h3 id=\"1-4-创建相关数据日志目录\"><a href=\"#1-4-创建相关数据日志目录\" class=\"headerlink\" title=\"1.4 创建相关数据日志目录\"></a>1.4 创建相关数据日志目录</h3><p><code> mkdir /data/harbor /var/log/harbor -p</code></p>\n<h3 id=\"1-5-创建配置文件\"><a href=\"#1-5-创建配置文件\" class=\"headerlink\" title=\"1.5 创建配置文件\"></a>1.5 创建配置文件</h3><p><code>cp /usr/local/harbor/harbor.yml.tmpl /usr/local/harbor/harbor.yml</code></p>\n<p><code>vim /usr/local/harbor/harbor.yml</code><br><img src=\"/images/056.Harbor_Installation.md.01.png\" width=100% height=100% /></p>\n<p>修改相应的主机,端口号, 密码等.</p>\n<h3 id=\"1-6-安装\"><a href=\"#1-6-安装\" class=\"headerlink\" title=\"1.6 安装\"></a>1.6 安装</h3><p><code>./prepare</code><br><code>./install</code><br><img src=\"/images/056.Harbor_Installation.md.02.png\" width=100% height=100% /></p>\n<h2 id=\"二、-注意事项\"><a href=\"#二、-注意事项\" class=\"headerlink\" title=\"二、 注意事项\"></a>二、 注意事项</h2><p>harbor自带registry, 安装之前请卸载原来官方的registry(如果你有的话)</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、-离线安装\"><a href=\"#一、-离线安装\" class=\"headerlink\" title=\"一、 离线安装\"></a>一、 离线安装</h2><h3 id=\"1-1-下载安装包\"><a href=\"#1-1-下载安装包\" class=\"headerlink\" title=\"1.1 下载安装包\"></a>1.1 下载安装包</h3><p><a href=\"https://github.com/goharbor/harbor/releases\">Github Release</a></p>\n<h3 id=\"1-2-解压\"><a href=\"#1-2-解压\" class=\"headerlink\" title=\"1.2 解压\"></a>1.2 解压</h3><p><code>tar -xzvf harbor-offline-installer-v2.7.3.tgz -C /usr/local</code></p>\n<h3 id=\"1-3-加载镜像\"><a href=\"#1-3-加载镜像\" class=\"headerlink\" title=\"1.3 加载镜像\"></a>1.3 加载镜像</h3><p><code>docker load -i /usr/local/harbor/harbor.v2.7.3.tar.gz</code></p>\n<h3 id=\"1-4-创建相关数据日志目录\"><a href=\"#1-4-创建相关数据日志目录\" class=\"headerlink\" title=\"1.4 创建相关数据日志目录\"></a>1.4 创建相关数据日志目录</h3><p><code> mkdir /data/harbor /var/log/harbor -p</code></p>\n<h3 id=\"1-5-创建配置文件\"><a href=\"#1-5-创建配置文件\" class=\"headerlink\" title=\"1.5 创建配置文件\"></a>1.5 创建配置文件</h3><p><code>cp /usr/local/harbor/harbor.yml.tmpl /usr/local/harbor/harbor.yml</code></p>\n<p><code>vim /usr/local/harbor/harbor.yml</code><br><img src=\"/images/056.Harbor_Installation.md.01.png\" width=100% height=100% /></p>\n<p>修改相应的主机,端口号, 密码等.</p>\n<h3 id=\"1-6-安装\"><a href=\"#1-6-安装\" class=\"headerlink\" title=\"1.6 安装\"></a>1.6 安装</h3><p><code>./prepare</code><br><code>./install</code><br><img src=\"/images/056.Harbor_Installation.md.02.png\" width=100% height=100% /></p>\n<h2 id=\"二、-注意事项\"><a href=\"#二、-注意事项\" class=\"headerlink\" title=\"二、 注意事项\"></a>二、 注意事项</h2><p>harbor自带registry, 安装之前请卸载原来官方的registry(如果你有的话)</p>\n"},{"title":"三级等保--Linux账户相关安全策略","date":"2023-11-02T07:45:20.000Z","_content":"\n\n## 一、 说明\n\n> 仅在 CentOS7 下测试, 理论上适用RHEL系列\n\n## 二、 密码相关\n\n\n\nLinux对应的密码策略模块有：```pam_passwdqc``` 和 ```pam_pwquality``` \n密码有效期: ```pam_passwdqc``` 模块对应的是 ```/etc/login.defs``` \n密码复杂度: ```pam_pwquality``` 模块对应的是 ```/etc/security/pwquality.conf```\n\n\n### 2.1 密码复杂度\n**注意: 默认只针对普通用户,对root用户无效**\n可以使用```enforce_for_root```强制对root用户生效\n\n配置文件: \n编辑```/etc/pam.d/system-auth-ac```\n- line16:``` password    requisite     pam_pwquality.so try_first_pass local_users_only enforce_for_root minlen=15 dcredit=-1 ucredit=-1 lcredit=-1 ocredit=-1 maxrepeat=5 retry=3 difok=3 ```\n- line17:```password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok remember=24```\n\n<img src=\"/images/057.Linux_Security_Policy.md.01.png\" width=100% height=100% />\n\n参数说明: \n- ```retry=3```:          定义登录 / 修改密码失败时，可以重试的次数\n- ```minlen=8```:         密码最小长度为 8 个字符\n- ```lcredit=-1```:       密码应包含的小写字母的至少一个\n- ```ucredit=-1```:       密码应包含的大写字母至少一个\n- ```dcredit=-1```:       将密码包含的数字至少为一个\n- ```ocredit=-1```:       设置其他符号的最小数量，例如 @，＃、! $％等，至少要有一个\n- ```enforce_for_root```: 确保即使是 root 用户设置密码，也应强制执行复杂性策略\n\n禁止使用最近使用过的密码: ```remember=3``` 注意其模块为 ``` pam_unix.so ```\n``` password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok remember=3```\n\n相关错误日志: ``` /var/log/secure ```\n<img src=\"/images/057.Linux_Security_Policy.md.02.png\" width=100% height=100% />\n\n### 2.2 密码有效期\n\n配置文件: ``` /etc/login.defs ```\n\n一般设置如下: \n```PASS_MAX_DAYS 90```\n```PASS_MIN_LEN 12```\n```PASS_MIN_DAYS 7```\n```PASS_WARN_AGE 30```\n```UMASK 077```\n\n\n|  参数   | 值  |  含义 |\n|  ----  | ----  | ---- | \n|```MAIL_DIR```        | ```/var/spool/mail```| \t创建用户时，系统会在目录 /var/spool/mail 中创建一个用户邮箱，比如 lamp 用户的邮箱是 /var/spool/mail/lamp|\n|```PASS_MAX_DAYS```   | ```99999```|\t            密码有效期，99999 是自 1970 年 1 月 1 日起密码有效的天数，相当于 273 年，可理解为密码始终有效|\n|```PASS_MIN_DAYS```   | ```0```|\t                表示自上次修改密码以来，最少隔多少天后用户才能再次修改密码，默认值是 0|\n|```PASS_MIN_LEN```    |```5```|\t                指定密码的最小长度，默认不小于 5 位，但是现在用户登录时验证已经被 PAM 模块取代，所以这个选项并不生效|\n|```PASS_WARN_AGE```   |```7```|\t                指定在密码到期前多少天，系统就开始通过用户密码即将到期，默认为 7 天|\n|```UID_MIN```         |```500```| \t            指定最小 UID 为 500，也就是说，添加用户时，默认 UID 从 500 开始。注意，如果手工指定了一个用户的 UID 是 550，那么下一个创建的用户的 UID 就会从551 开始，哪怕 500~549 之间的 UID 没有使用|\n|```UID_MAX```         |```60000```|\t            指定用户最大的 UID 为 60000|\n|```GID_MIN```         |```500```|\t            指定最小 GID 为 500，也就是在添加组时，组的 GID 从 500 开始|\n|```GID_MAX```         |```60000```|\t            用户 GID 最大为 60000|\n|```CREATE_HOME```     |```yes```|\t            指定在创建用户时，是否同时创建用户主目录，yes 表示创建，no 则不创建，默认是 yes|\n|```UMASK```           |```077```|\t            用户主目录的权限默认设置为 077|\n|```USERGROUPS_ENAB``` |```yes```|\t            指定删除用户的时候是否同时删除用户组，准备地说，这里指的是删除用户的初始组，此项的默认值为 yes|\n|```ENCRYPT_METHOD```  |```SHA512```|\t            指定用户密码采用的加密规则，默认采用 SHA512，这是新的密码加密模式，原先的 Linux 只能用 DES 或 MD5 加密|\n\n","source":"_posts/057.Linux_Security_Policy.md","raw":"---\ntitle: 三级等保--Linux账户相关安全策略\ndate: 2023-11-02 15:45:20\ncategories: \n- [Linux]\ntags: \n- security\n---\n\n\n## 一、 说明\n\n> 仅在 CentOS7 下测试, 理论上适用RHEL系列\n\n## 二、 密码相关\n\n\n\nLinux对应的密码策略模块有：```pam_passwdqc``` 和 ```pam_pwquality``` \n密码有效期: ```pam_passwdqc``` 模块对应的是 ```/etc/login.defs``` \n密码复杂度: ```pam_pwquality``` 模块对应的是 ```/etc/security/pwquality.conf```\n\n\n### 2.1 密码复杂度\n**注意: 默认只针对普通用户,对root用户无效**\n可以使用```enforce_for_root```强制对root用户生效\n\n配置文件: \n编辑```/etc/pam.d/system-auth-ac```\n- line16:``` password    requisite     pam_pwquality.so try_first_pass local_users_only enforce_for_root minlen=15 dcredit=-1 ucredit=-1 lcredit=-1 ocredit=-1 maxrepeat=5 retry=3 difok=3 ```\n- line17:```password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok remember=24```\n\n<img src=\"/images/057.Linux_Security_Policy.md.01.png\" width=100% height=100% />\n\n参数说明: \n- ```retry=3```:          定义登录 / 修改密码失败时，可以重试的次数\n- ```minlen=8```:         密码最小长度为 8 个字符\n- ```lcredit=-1```:       密码应包含的小写字母的至少一个\n- ```ucredit=-1```:       密码应包含的大写字母至少一个\n- ```dcredit=-1```:       将密码包含的数字至少为一个\n- ```ocredit=-1```:       设置其他符号的最小数量，例如 @，＃、! $％等，至少要有一个\n- ```enforce_for_root```: 确保即使是 root 用户设置密码，也应强制执行复杂性策略\n\n禁止使用最近使用过的密码: ```remember=3``` 注意其模块为 ``` pam_unix.so ```\n``` password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok remember=3```\n\n相关错误日志: ``` /var/log/secure ```\n<img src=\"/images/057.Linux_Security_Policy.md.02.png\" width=100% height=100% />\n\n### 2.2 密码有效期\n\n配置文件: ``` /etc/login.defs ```\n\n一般设置如下: \n```PASS_MAX_DAYS 90```\n```PASS_MIN_LEN 12```\n```PASS_MIN_DAYS 7```\n```PASS_WARN_AGE 30```\n```UMASK 077```\n\n\n|  参数   | 值  |  含义 |\n|  ----  | ----  | ---- | \n|```MAIL_DIR```        | ```/var/spool/mail```| \t创建用户时，系统会在目录 /var/spool/mail 中创建一个用户邮箱，比如 lamp 用户的邮箱是 /var/spool/mail/lamp|\n|```PASS_MAX_DAYS```   | ```99999```|\t            密码有效期，99999 是自 1970 年 1 月 1 日起密码有效的天数，相当于 273 年，可理解为密码始终有效|\n|```PASS_MIN_DAYS```   | ```0```|\t                表示自上次修改密码以来，最少隔多少天后用户才能再次修改密码，默认值是 0|\n|```PASS_MIN_LEN```    |```5```|\t                指定密码的最小长度，默认不小于 5 位，但是现在用户登录时验证已经被 PAM 模块取代，所以这个选项并不生效|\n|```PASS_WARN_AGE```   |```7```|\t                指定在密码到期前多少天，系统就开始通过用户密码即将到期，默认为 7 天|\n|```UID_MIN```         |```500```| \t            指定最小 UID 为 500，也就是说，添加用户时，默认 UID 从 500 开始。注意，如果手工指定了一个用户的 UID 是 550，那么下一个创建的用户的 UID 就会从551 开始，哪怕 500~549 之间的 UID 没有使用|\n|```UID_MAX```         |```60000```|\t            指定用户最大的 UID 为 60000|\n|```GID_MIN```         |```500```|\t            指定最小 GID 为 500，也就是在添加组时，组的 GID 从 500 开始|\n|```GID_MAX```         |```60000```|\t            用户 GID 最大为 60000|\n|```CREATE_HOME```     |```yes```|\t            指定在创建用户时，是否同时创建用户主目录，yes 表示创建，no 则不创建，默认是 yes|\n|```UMASK```           |```077```|\t            用户主目录的权限默认设置为 077|\n|```USERGROUPS_ENAB``` |```yes```|\t            指定删除用户的时候是否同时删除用户组，准备地说，这里指的是删除用户的初始组，此项的默认值为 yes|\n|```ENCRYPT_METHOD```  |```SHA512```|\t            指定用户密码采用的加密规则，默认采用 SHA512，这是新的密码加密模式，原先的 Linux 只能用 DES 或 MD5 加密|\n\n","slug":"057.Linux_Security_Policy","published":1,"updated":"2023-12-05T08:52:30.880Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzep005bijnr2v5sf4q4","content":"<h2 id=\"一、-说明\"><a href=\"#一、-说明\" class=\"headerlink\" title=\"一、 说明\"></a>一、 说明</h2><blockquote>\n<p>仅在 CentOS7 下测试, 理论上适用RHEL系列</p>\n</blockquote>\n<h2 id=\"二、-密码相关\"><a href=\"#二、-密码相关\" class=\"headerlink\" title=\"二、 密码相关\"></a>二、 密码相关</h2><p>Linux对应的密码策略模块有：<code>pam_passwdqc</code> 和 <code>pam_pwquality</code><br>密码有效期: <code>pam_passwdqc</code> 模块对应的是 <code>/etc/login.defs</code><br>密码复杂度: <code>pam_pwquality</code> 模块对应的是 <code>/etc/security/pwquality.conf</code></p>\n<h3 id=\"2-1-密码复杂度\"><a href=\"#2-1-密码复杂度\" class=\"headerlink\" title=\"2.1 密码复杂度\"></a>2.1 密码复杂度</h3><p><strong>注意: 默认只针对普通用户,对root用户无效</strong><br>可以使用<code>enforce_for_root</code>强制对root用户生效</p>\n<p>配置文件:<br>编辑<code>/etc/pam.d/system-auth-ac</code></p>\n<ul>\n<li>line16:<code>password    requisite     pam_pwquality.so try_first_pass local_users_only enforce_for_root minlen=15 dcredit=-1 ucredit=-1 lcredit=-1 ocredit=-1 maxrepeat=5 retry=3 difok=3</code></li>\n<li>line17:<code>password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok remember=24</code></li>\n</ul>\n<img src=\"/images/057.Linux_Security_Policy.md.01.png\" width=100% height=100% />\n\n<p>参数说明: </p>\n<ul>\n<li><code>retry=3</code>:          定义登录 &#x2F; 修改密码失败时，可以重试的次数</li>\n<li><code>minlen=8</code>:         密码最小长度为 8 个字符</li>\n<li><code>lcredit=-1</code>:       密码应包含的小写字母的至少一个</li>\n<li><code>ucredit=-1</code>:       密码应包含的大写字母至少一个</li>\n<li><code>dcredit=-1</code>:       将密码包含的数字至少为一个</li>\n<li><code>ocredit=-1</code>:       设置其他符号的最小数量，例如 @，＃、! $％等，至少要有一个</li>\n<li><code>enforce_for_root</code>: 确保即使是 root 用户设置密码，也应强制执行复杂性策略</li>\n</ul>\n<p>禁止使用最近使用过的密码: <code>remember=3</code> 注意其模块为 <code>pam_unix.so</code><br><code> password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok remember=3</code></p>\n<p>相关错误日志: <code>/var/log/secure</code><br><img src=\"/images/057.Linux_Security_Policy.md.02.png\" width=100% height=100% /></p>\n<h3 id=\"2-2-密码有效期\"><a href=\"#2-2-密码有效期\" class=\"headerlink\" title=\"2.2 密码有效期\"></a>2.2 密码有效期</h3><p>配置文件: <code>/etc/login.defs</code></p>\n<p>一般设置如下:<br><code>PASS_MAX_DAYS 90</code><br><code>PASS_MIN_LEN 12</code><br><code>PASS_MIN_DAYS 7</code><br><code>PASS_WARN_AGE 30</code><br><code>UMASK 077</code></p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>值</th>\n<th>含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>MAIL_DIR</code></td>\n<td><code>/var/spool/mail</code></td>\n<td>创建用户时，系统会在目录 &#x2F;var&#x2F;spool&#x2F;mail 中创建一个用户邮箱，比如 lamp 用户的邮箱是 &#x2F;var&#x2F;spool&#x2F;mail&#x2F;lamp</td>\n</tr>\n<tr>\n<td><code>PASS_MAX_DAYS</code></td>\n<td><code>99999</code></td>\n<td>密码有效期，99999 是自 1970 年 1 月 1 日起密码有效的天数，相当于 273 年，可理解为密码始终有效</td>\n</tr>\n<tr>\n<td><code>PASS_MIN_DAYS</code></td>\n<td><code>0</code></td>\n<td>表示自上次修改密码以来，最少隔多少天后用户才能再次修改密码，默认值是 0</td>\n</tr>\n<tr>\n<td><code>PASS_MIN_LEN</code></td>\n<td><code>5</code></td>\n<td>指定密码的最小长度，默认不小于 5 位，但是现在用户登录时验证已经被 PAM 模块取代，所以这个选项并不生效</td>\n</tr>\n<tr>\n<td><code>PASS_WARN_AGE</code></td>\n<td><code>7</code></td>\n<td>指定在密码到期前多少天，系统就开始通过用户密码即将到期，默认为 7 天</td>\n</tr>\n<tr>\n<td><code>UID_MIN</code></td>\n<td><code>500</code></td>\n<td>指定最小 UID 为 500，也就是说，添加用户时，默认 UID 从 500 开始。注意，如果手工指定了一个用户的 UID 是 550，那么下一个创建的用户的 UID 就会从551 开始，哪怕 500~549 之间的 UID 没有使用</td>\n</tr>\n<tr>\n<td><code>UID_MAX</code></td>\n<td><code>60000</code></td>\n<td>指定用户最大的 UID 为 60000</td>\n</tr>\n<tr>\n<td><code>GID_MIN</code></td>\n<td><code>500</code></td>\n<td>指定最小 GID 为 500，也就是在添加组时，组的 GID 从 500 开始</td>\n</tr>\n<tr>\n<td><code>GID_MAX</code></td>\n<td><code>60000</code></td>\n<td>用户 GID 最大为 60000</td>\n</tr>\n<tr>\n<td><code>CREATE_HOME</code></td>\n<td><code>yes</code></td>\n<td>指定在创建用户时，是否同时创建用户主目录，yes 表示创建，no 则不创建，默认是 yes</td>\n</tr>\n<tr>\n<td><code>UMASK</code></td>\n<td><code>077</code></td>\n<td>用户主目录的权限默认设置为 077</td>\n</tr>\n<tr>\n<td><code>USERGROUPS_ENAB</code></td>\n<td><code>yes</code></td>\n<td>指定删除用户的时候是否同时删除用户组，准备地说，这里指的是删除用户的初始组，此项的默认值为 yes</td>\n</tr>\n<tr>\n<td><code>ENCRYPT_METHOD</code></td>\n<td><code>SHA512</code></td>\n<td>指定用户密码采用的加密规则，默认采用 SHA512，这是新的密码加密模式，原先的 Linux 只能用 DES 或 MD5 加密</td>\n</tr>\n</tbody></table>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、-说明\"><a href=\"#一、-说明\" class=\"headerlink\" title=\"一、 说明\"></a>一、 说明</h2><blockquote>\n<p>仅在 CentOS7 下测试, 理论上适用RHEL系列</p>\n</blockquote>\n<h2 id=\"二、-密码相关\"><a href=\"#二、-密码相关\" class=\"headerlink\" title=\"二、 密码相关\"></a>二、 密码相关</h2><p>Linux对应的密码策略模块有：<code>pam_passwdqc</code> 和 <code>pam_pwquality</code><br>密码有效期: <code>pam_passwdqc</code> 模块对应的是 <code>/etc/login.defs</code><br>密码复杂度: <code>pam_pwquality</code> 模块对应的是 <code>/etc/security/pwquality.conf</code></p>\n<h3 id=\"2-1-密码复杂度\"><a href=\"#2-1-密码复杂度\" class=\"headerlink\" title=\"2.1 密码复杂度\"></a>2.1 密码复杂度</h3><p><strong>注意: 默认只针对普通用户,对root用户无效</strong><br>可以使用<code>enforce_for_root</code>强制对root用户生效</p>\n<p>配置文件:<br>编辑<code>/etc/pam.d/system-auth-ac</code></p>\n<ul>\n<li>line16:<code>password    requisite     pam_pwquality.so try_first_pass local_users_only enforce_for_root minlen=15 dcredit=-1 ucredit=-1 lcredit=-1 ocredit=-1 maxrepeat=5 retry=3 difok=3</code></li>\n<li>line17:<code>password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok remember=24</code></li>\n</ul>\n<img src=\"/images/057.Linux_Security_Policy.md.01.png\" width=100% height=100% />\n\n<p>参数说明: </p>\n<ul>\n<li><code>retry=3</code>:          定义登录 &#x2F; 修改密码失败时，可以重试的次数</li>\n<li><code>minlen=8</code>:         密码最小长度为 8 个字符</li>\n<li><code>lcredit=-1</code>:       密码应包含的小写字母的至少一个</li>\n<li><code>ucredit=-1</code>:       密码应包含的大写字母至少一个</li>\n<li><code>dcredit=-1</code>:       将密码包含的数字至少为一个</li>\n<li><code>ocredit=-1</code>:       设置其他符号的最小数量，例如 @，＃、! $％等，至少要有一个</li>\n<li><code>enforce_for_root</code>: 确保即使是 root 用户设置密码，也应强制执行复杂性策略</li>\n</ul>\n<p>禁止使用最近使用过的密码: <code>remember=3</code> 注意其模块为 <code>pam_unix.so</code><br><code> password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok remember=3</code></p>\n<p>相关错误日志: <code>/var/log/secure</code><br><img src=\"/images/057.Linux_Security_Policy.md.02.png\" width=100% height=100% /></p>\n<h3 id=\"2-2-密码有效期\"><a href=\"#2-2-密码有效期\" class=\"headerlink\" title=\"2.2 密码有效期\"></a>2.2 密码有效期</h3><p>配置文件: <code>/etc/login.defs</code></p>\n<p>一般设置如下:<br><code>PASS_MAX_DAYS 90</code><br><code>PASS_MIN_LEN 12</code><br><code>PASS_MIN_DAYS 7</code><br><code>PASS_WARN_AGE 30</code><br><code>UMASK 077</code></p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>值</th>\n<th>含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>MAIL_DIR</code></td>\n<td><code>/var/spool/mail</code></td>\n<td>创建用户时，系统会在目录 &#x2F;var&#x2F;spool&#x2F;mail 中创建一个用户邮箱，比如 lamp 用户的邮箱是 &#x2F;var&#x2F;spool&#x2F;mail&#x2F;lamp</td>\n</tr>\n<tr>\n<td><code>PASS_MAX_DAYS</code></td>\n<td><code>99999</code></td>\n<td>密码有效期，99999 是自 1970 年 1 月 1 日起密码有效的天数，相当于 273 年，可理解为密码始终有效</td>\n</tr>\n<tr>\n<td><code>PASS_MIN_DAYS</code></td>\n<td><code>0</code></td>\n<td>表示自上次修改密码以来，最少隔多少天后用户才能再次修改密码，默认值是 0</td>\n</tr>\n<tr>\n<td><code>PASS_MIN_LEN</code></td>\n<td><code>5</code></td>\n<td>指定密码的最小长度，默认不小于 5 位，但是现在用户登录时验证已经被 PAM 模块取代，所以这个选项并不生效</td>\n</tr>\n<tr>\n<td><code>PASS_WARN_AGE</code></td>\n<td><code>7</code></td>\n<td>指定在密码到期前多少天，系统就开始通过用户密码即将到期，默认为 7 天</td>\n</tr>\n<tr>\n<td><code>UID_MIN</code></td>\n<td><code>500</code></td>\n<td>指定最小 UID 为 500，也就是说，添加用户时，默认 UID 从 500 开始。注意，如果手工指定了一个用户的 UID 是 550，那么下一个创建的用户的 UID 就会从551 开始，哪怕 500~549 之间的 UID 没有使用</td>\n</tr>\n<tr>\n<td><code>UID_MAX</code></td>\n<td><code>60000</code></td>\n<td>指定用户最大的 UID 为 60000</td>\n</tr>\n<tr>\n<td><code>GID_MIN</code></td>\n<td><code>500</code></td>\n<td>指定最小 GID 为 500，也就是在添加组时，组的 GID 从 500 开始</td>\n</tr>\n<tr>\n<td><code>GID_MAX</code></td>\n<td><code>60000</code></td>\n<td>用户 GID 最大为 60000</td>\n</tr>\n<tr>\n<td><code>CREATE_HOME</code></td>\n<td><code>yes</code></td>\n<td>指定在创建用户时，是否同时创建用户主目录，yes 表示创建，no 则不创建，默认是 yes</td>\n</tr>\n<tr>\n<td><code>UMASK</code></td>\n<td><code>077</code></td>\n<td>用户主目录的权限默认设置为 077</td>\n</tr>\n<tr>\n<td><code>USERGROUPS_ENAB</code></td>\n<td><code>yes</code></td>\n<td>指定删除用户的时候是否同时删除用户组，准备地说，这里指的是删除用户的初始组，此项的默认值为 yes</td>\n</tr>\n<tr>\n<td><code>ENCRYPT_METHOD</code></td>\n<td><code>SHA512</code></td>\n<td>指定用户密码采用的加密规则，默认采用 SHA512，这是新的密码加密模式，原先的 Linux 只能用 DES 或 MD5 加密</td>\n</tr>\n</tbody></table>\n"},{"title":"三级等保--MySQL账户相关安全策略","date":"2023-11-06T07:45:20.000Z","_content":"\n\n## 一、 密码复杂度审计\n\n### 1.1 查看当前密码策略\n\n``` MySQL> SHOW VARIABLES LIKE 'validate_password%'; ```\n\n### 1.2 插件安装\n\n``` MySQL> install plugin validate_password soname 'validate_password.so'; ```\n\n\n### 1.3 my.cnf 参数配置\n\n``` vim /etc/my.cnf ```\n\n``` shell\n[mysqld]\nplugin-load-add=validate_password.so\nvalidate-password=ON\nvalidate_password_policy = 1\nvalidate_password_length = 8\nvalidate_password_mixed_case_count = 1\nvalidate_password_number_count = 2\nvalidate_password_special_char_count = 1\n```\n\n\n## 二、 登录失败处理\n\n### 2.1 数据库并查看是否开启登录失败和超时功能参数\n\n``` MySQL> show variables like '%connection_control%'; ```\n\n\n### 2.2 安装插件\n\n``` MySQL> install plugin CONNECTION_CONTROL soname 'connection_control.so'; ```\n``` MySQL> install plugin CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS soname 'connection_control.so'; ```\n\n\n###  2.3 修改配置文件my.cnf\n\n``` vim /etc/my.cnf ```\n\n``` shell\n[mysqld]\nplugin-load-add=connection_control.so\nconnection-control-failed-connections-threshold=5 \nconnection-control-min-connection-delay=300000\n```\n\n\n\n\n## 三、 配置模板\n\n### 3.1 某生产环境使用的配置文件\n\n``` shell\n[mysqld]\nskip_ssl\nskip-name-resolve\ndefault_password_lifetime=0\nuser = mysql\nbasedir = /usr/local/mysql\ndatadir = /data/mysql/data\nport = 3306\nserver_id = 1\nsocket = /usr/local/mysql/mysql.sock\npid-file = /usr/local/mysql/mysql.pid\nlog-error = /data/mysql/data/mysql.err\nlog-bin = /data/mysql/data/binlog/mysql-bin\nsql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES\nlower_case_table_names=1\ncharacter-set-server = utf8mb4\nlog_bin_trust_function_creators=1\nexplicit_defaults_for_timestamp=true\ndefault_time_zone = \"+8:00\"\nlog_timestamps = SYSTEM\nexplicit_defaults_for_timestamp = 1\n\ntable_open_cache = 500\ntable_definition_cache = 1000\ntable_open_cache_instances = 64\nthread_stack = 512K\nthread_cache_size = 700\nmax_allowed_packet = 256M\njoin_buffer_size = 4M\nkey_buffer_size = 32M\nread_buffer_size = 8M\nread_rnd_buffer_size = 8M\nsort_buffer_size = 2M\nmax_connections = 3000\nmax_connect_errors = 2000\n\ninnodb_log_buffer_size = 32M\ninnodb_log_file_size = 2G\ninnodb_log_files_in_group = 2\ninnodb_buffer_pool_size = 48G #重要参数，建议为内存的80%\ninnodb_buffer_pool_instances = 8\ninnodb_io_capacity=1200\ninnodb_page_cleaners=8\n\nlog_bin_trust_function_creators=1\nbinlog_cache_size = 1M\nexpire_logs_days = 7\nbinlog_format = row\n\n####mysql master\ngtid-mode = ON\nenforce-gtid-consistency = ON\n\nslow_query_log = 1\nslow_query_log_file = /data/mysql/data/slow_query.log\nlong_query_time= 60\nlog_queries_not_using_indexes = 1\n\n[mysqldump]\nquick\nmax_allowed_packet = 256M\n\n[client]\nport = 3306\nsocket = /usr/local/mysql/mysql.sock\n#default-character-set = utf8mb4\n```\n","source":"_posts/058.MySQL_Security_Policy.md","raw":"---\ntitle: 三级等保--MySQL账户相关安全策略\ndate: 2023-11-06 15:45:20\ncategories: \n- [Linux]\ntags: \n- mysql\n---\n\n\n## 一、 密码复杂度审计\n\n### 1.1 查看当前密码策略\n\n``` MySQL> SHOW VARIABLES LIKE 'validate_password%'; ```\n\n### 1.2 插件安装\n\n``` MySQL> install plugin validate_password soname 'validate_password.so'; ```\n\n\n### 1.3 my.cnf 参数配置\n\n``` vim /etc/my.cnf ```\n\n``` shell\n[mysqld]\nplugin-load-add=validate_password.so\nvalidate-password=ON\nvalidate_password_policy = 1\nvalidate_password_length = 8\nvalidate_password_mixed_case_count = 1\nvalidate_password_number_count = 2\nvalidate_password_special_char_count = 1\n```\n\n\n## 二、 登录失败处理\n\n### 2.1 数据库并查看是否开启登录失败和超时功能参数\n\n``` MySQL> show variables like '%connection_control%'; ```\n\n\n### 2.2 安装插件\n\n``` MySQL> install plugin CONNECTION_CONTROL soname 'connection_control.so'; ```\n``` MySQL> install plugin CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS soname 'connection_control.so'; ```\n\n\n###  2.3 修改配置文件my.cnf\n\n``` vim /etc/my.cnf ```\n\n``` shell\n[mysqld]\nplugin-load-add=connection_control.so\nconnection-control-failed-connections-threshold=5 \nconnection-control-min-connection-delay=300000\n```\n\n\n\n\n## 三、 配置模板\n\n### 3.1 某生产环境使用的配置文件\n\n``` shell\n[mysqld]\nskip_ssl\nskip-name-resolve\ndefault_password_lifetime=0\nuser = mysql\nbasedir = /usr/local/mysql\ndatadir = /data/mysql/data\nport = 3306\nserver_id = 1\nsocket = /usr/local/mysql/mysql.sock\npid-file = /usr/local/mysql/mysql.pid\nlog-error = /data/mysql/data/mysql.err\nlog-bin = /data/mysql/data/binlog/mysql-bin\nsql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES\nlower_case_table_names=1\ncharacter-set-server = utf8mb4\nlog_bin_trust_function_creators=1\nexplicit_defaults_for_timestamp=true\ndefault_time_zone = \"+8:00\"\nlog_timestamps = SYSTEM\nexplicit_defaults_for_timestamp = 1\n\ntable_open_cache = 500\ntable_definition_cache = 1000\ntable_open_cache_instances = 64\nthread_stack = 512K\nthread_cache_size = 700\nmax_allowed_packet = 256M\njoin_buffer_size = 4M\nkey_buffer_size = 32M\nread_buffer_size = 8M\nread_rnd_buffer_size = 8M\nsort_buffer_size = 2M\nmax_connections = 3000\nmax_connect_errors = 2000\n\ninnodb_log_buffer_size = 32M\ninnodb_log_file_size = 2G\ninnodb_log_files_in_group = 2\ninnodb_buffer_pool_size = 48G #重要参数，建议为内存的80%\ninnodb_buffer_pool_instances = 8\ninnodb_io_capacity=1200\ninnodb_page_cleaners=8\n\nlog_bin_trust_function_creators=1\nbinlog_cache_size = 1M\nexpire_logs_days = 7\nbinlog_format = row\n\n####mysql master\ngtid-mode = ON\nenforce-gtid-consistency = ON\n\nslow_query_log = 1\nslow_query_log_file = /data/mysql/data/slow_query.log\nlong_query_time= 60\nlog_queries_not_using_indexes = 1\n\n[mysqldump]\nquick\nmax_allowed_packet = 256M\n\n[client]\nport = 3306\nsocket = /usr/local/mysql/mysql.sock\n#default-character-set = utf8mb4\n```\n","slug":"058.MySQL_Security_Policy","published":1,"updated":"2023-12-05T08:52:30.881Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzeq005eijnr4l955y4b","content":"<h2 id=\"一、-密码复杂度审计\"><a href=\"#一、-密码复杂度审计\" class=\"headerlink\" title=\"一、 密码复杂度审计\"></a>一、 密码复杂度审计</h2><h3 id=\"1-1-查看当前密码策略\"><a href=\"#1-1-查看当前密码策略\" class=\"headerlink\" title=\"1.1 查看当前密码策略\"></a>1.1 查看当前密码策略</h3><p><code>MySQL&gt; SHOW VARIABLES LIKE &#39;validate_password%&#39;;</code></p>\n<h3 id=\"1-2-插件安装\"><a href=\"#1-2-插件安装\" class=\"headerlink\" title=\"1.2 插件安装\"></a>1.2 插件安装</h3><p><code>MySQL&gt; install plugin validate_password soname &#39;validate_password.so&#39;;</code></p>\n<h3 id=\"1-3-my-cnf-参数配置\"><a href=\"#1-3-my-cnf-参数配置\" class=\"headerlink\" title=\"1.3 my.cnf 参数配置\"></a>1.3 my.cnf 参数配置</h3><p><code>vim /etc/my.cnf</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">plugin-load-add=validate_password.so</span><br><span class=\"line\">validate-password=ON</span><br><span class=\"line\">validate_password_policy = 1</span><br><span class=\"line\">validate_password_length = 8</span><br><span class=\"line\">validate_password_mixed_case_count = 1</span><br><span class=\"line\">validate_password_number_count = 2</span><br><span class=\"line\">validate_password_special_char_count = 1</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"二、-登录失败处理\"><a href=\"#二、-登录失败处理\" class=\"headerlink\" title=\"二、 登录失败处理\"></a>二、 登录失败处理</h2><h3 id=\"2-1-数据库并查看是否开启登录失败和超时功能参数\"><a href=\"#2-1-数据库并查看是否开启登录失败和超时功能参数\" class=\"headerlink\" title=\"2.1 数据库并查看是否开启登录失败和超时功能参数\"></a>2.1 数据库并查看是否开启登录失败和超时功能参数</h3><p><code>MySQL&gt; show variables like &#39;%connection_control%&#39;;</code></p>\n<h3 id=\"2-2-安装插件\"><a href=\"#2-2-安装插件\" class=\"headerlink\" title=\"2.2 安装插件\"></a>2.2 安装插件</h3><p><code>MySQL&gt; install plugin CONNECTION_CONTROL soname &#39;connection_control.so&#39;;</code><br><code>MySQL&gt; install plugin CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS soname &#39;connection_control.so&#39;;</code></p>\n<h3 id=\"2-3-修改配置文件my-cnf\"><a href=\"#2-3-修改配置文件my-cnf\" class=\"headerlink\" title=\"2.3 修改配置文件my.cnf\"></a>2.3 修改配置文件my.cnf</h3><p><code>vim /etc/my.cnf</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">plugin-load-add=connection_control.so</span><br><span class=\"line\">connection-control-failed-connections-threshold=5 </span><br><span class=\"line\">connection-control-min-connection-delay=300000</span><br></pre></td></tr></table></figure>\n\n\n\n\n<h2 id=\"三、-配置模板\"><a href=\"#三、-配置模板\" class=\"headerlink\" title=\"三、 配置模板\"></a>三、 配置模板</h2><h3 id=\"3-1-某生产环境使用的配置文件\"><a href=\"#3-1-某生产环境使用的配置文件\" class=\"headerlink\" title=\"3.1 某生产环境使用的配置文件\"></a>3.1 某生产环境使用的配置文件</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">skip_ssl</span><br><span class=\"line\">skip-name-resolve</span><br><span class=\"line\">default_password_lifetime=0</span><br><span class=\"line\">user = mysql</span><br><span class=\"line\">basedir = /usr/local/mysql</span><br><span class=\"line\">datadir = /data/mysql/data</span><br><span class=\"line\">port = 3306</span><br><span class=\"line\">server_id = 1</span><br><span class=\"line\">socket = /usr/local/mysql/mysql.sock</span><br><span class=\"line\">pid-file = /usr/local/mysql/mysql.pid</span><br><span class=\"line\">log-error = /data/mysql/data/mysql.err</span><br><span class=\"line\">log-bin = /data/mysql/data/binlog/mysql-bin</span><br><span class=\"line\">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class=\"line\">lower_case_table_names=1</span><br><span class=\"line\">character-set-server = utf8mb4</span><br><span class=\"line\">log_bin_trust_function_creators=1</span><br><span class=\"line\">explicit_defaults_for_timestamp=true</span><br><span class=\"line\">default_time_zone = &quot;+8:00&quot;</span><br><span class=\"line\">log_timestamps = SYSTEM</span><br><span class=\"line\">explicit_defaults_for_timestamp = 1</span><br><span class=\"line\"></span><br><span class=\"line\">table_open_cache = 500</span><br><span class=\"line\">table_definition_cache = 1000</span><br><span class=\"line\">table_open_cache_instances = 64</span><br><span class=\"line\">thread_stack = 512K</span><br><span class=\"line\">thread_cache_size = 700</span><br><span class=\"line\">max_allowed_packet = 256M</span><br><span class=\"line\">join_buffer_size = 4M</span><br><span class=\"line\">key_buffer_size = 32M</span><br><span class=\"line\">read_buffer_size = 8M</span><br><span class=\"line\">read_rnd_buffer_size = 8M</span><br><span class=\"line\">sort_buffer_size = 2M</span><br><span class=\"line\">max_connections = 3000</span><br><span class=\"line\">max_connect_errors = 2000</span><br><span class=\"line\"></span><br><span class=\"line\">innodb_log_buffer_size = 32M</span><br><span class=\"line\">innodb_log_file_size = 2G</span><br><span class=\"line\">innodb_log_files_in_group = 2</span><br><span class=\"line\">innodb_buffer_pool_size = 48G #重要参数，建议为内存的80%</span><br><span class=\"line\">innodb_buffer_pool_instances = 8</span><br><span class=\"line\">innodb_io_capacity=1200</span><br><span class=\"line\">innodb_page_cleaners=8</span><br><span class=\"line\"></span><br><span class=\"line\">log_bin_trust_function_creators=1</span><br><span class=\"line\">binlog_cache_size = 1M</span><br><span class=\"line\">expire_logs_days = 7</span><br><span class=\"line\">binlog_format = row</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\">###mysql master</span></span></span><br><span class=\"line\">gtid-mode = ON</span><br><span class=\"line\">enforce-gtid-consistency = ON</span><br><span class=\"line\"></span><br><span class=\"line\">slow_query_log = 1</span><br><span class=\"line\">slow_query_log_file = /data/mysql/data/slow_query.log</span><br><span class=\"line\">long_query_time= 60</span><br><span class=\"line\">log_queries_not_using_indexes = 1</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqldump]</span><br><span class=\"line\">quick</span><br><span class=\"line\">max_allowed_packet = 256M</span><br><span class=\"line\"></span><br><span class=\"line\">[client]</span><br><span class=\"line\">port = 3306</span><br><span class=\"line\">socket = /usr/local/mysql/mysql.sock</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">default-character-set = utf8mb4</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、-密码复杂度审计\"><a href=\"#一、-密码复杂度审计\" class=\"headerlink\" title=\"一、 密码复杂度审计\"></a>一、 密码复杂度审计</h2><h3 id=\"1-1-查看当前密码策略\"><a href=\"#1-1-查看当前密码策略\" class=\"headerlink\" title=\"1.1 查看当前密码策略\"></a>1.1 查看当前密码策略</h3><p><code>MySQL&gt; SHOW VARIABLES LIKE &#39;validate_password%&#39;;</code></p>\n<h3 id=\"1-2-插件安装\"><a href=\"#1-2-插件安装\" class=\"headerlink\" title=\"1.2 插件安装\"></a>1.2 插件安装</h3><p><code>MySQL&gt; install plugin validate_password soname &#39;validate_password.so&#39;;</code></p>\n<h3 id=\"1-3-my-cnf-参数配置\"><a href=\"#1-3-my-cnf-参数配置\" class=\"headerlink\" title=\"1.3 my.cnf 参数配置\"></a>1.3 my.cnf 参数配置</h3><p><code>vim /etc/my.cnf</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">plugin-load-add=validate_password.so</span><br><span class=\"line\">validate-password=ON</span><br><span class=\"line\">validate_password_policy = 1</span><br><span class=\"line\">validate_password_length = 8</span><br><span class=\"line\">validate_password_mixed_case_count = 1</span><br><span class=\"line\">validate_password_number_count = 2</span><br><span class=\"line\">validate_password_special_char_count = 1</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"二、-登录失败处理\"><a href=\"#二、-登录失败处理\" class=\"headerlink\" title=\"二、 登录失败处理\"></a>二、 登录失败处理</h2><h3 id=\"2-1-数据库并查看是否开启登录失败和超时功能参数\"><a href=\"#2-1-数据库并查看是否开启登录失败和超时功能参数\" class=\"headerlink\" title=\"2.1 数据库并查看是否开启登录失败和超时功能参数\"></a>2.1 数据库并查看是否开启登录失败和超时功能参数</h3><p><code>MySQL&gt; show variables like &#39;%connection_control%&#39;;</code></p>\n<h3 id=\"2-2-安装插件\"><a href=\"#2-2-安装插件\" class=\"headerlink\" title=\"2.2 安装插件\"></a>2.2 安装插件</h3><p><code>MySQL&gt; install plugin CONNECTION_CONTROL soname &#39;connection_control.so&#39;;</code><br><code>MySQL&gt; install plugin CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS soname &#39;connection_control.so&#39;;</code></p>\n<h3 id=\"2-3-修改配置文件my-cnf\"><a href=\"#2-3-修改配置文件my-cnf\" class=\"headerlink\" title=\"2.3 修改配置文件my.cnf\"></a>2.3 修改配置文件my.cnf</h3><p><code>vim /etc/my.cnf</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">plugin-load-add=connection_control.so</span><br><span class=\"line\">connection-control-failed-connections-threshold=5 </span><br><span class=\"line\">connection-control-min-connection-delay=300000</span><br></pre></td></tr></table></figure>\n\n\n\n\n<h2 id=\"三、-配置模板\"><a href=\"#三、-配置模板\" class=\"headerlink\" title=\"三、 配置模板\"></a>三、 配置模板</h2><h3 id=\"3-1-某生产环境使用的配置文件\"><a href=\"#3-1-某生产环境使用的配置文件\" class=\"headerlink\" title=\"3.1 某生产环境使用的配置文件\"></a>3.1 某生产环境使用的配置文件</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">skip_ssl</span><br><span class=\"line\">skip-name-resolve</span><br><span class=\"line\">default_password_lifetime=0</span><br><span class=\"line\">user = mysql</span><br><span class=\"line\">basedir = /usr/local/mysql</span><br><span class=\"line\">datadir = /data/mysql/data</span><br><span class=\"line\">port = 3306</span><br><span class=\"line\">server_id = 1</span><br><span class=\"line\">socket = /usr/local/mysql/mysql.sock</span><br><span class=\"line\">pid-file = /usr/local/mysql/mysql.pid</span><br><span class=\"line\">log-error = /data/mysql/data/mysql.err</span><br><span class=\"line\">log-bin = /data/mysql/data/binlog/mysql-bin</span><br><span class=\"line\">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class=\"line\">lower_case_table_names=1</span><br><span class=\"line\">character-set-server = utf8mb4</span><br><span class=\"line\">log_bin_trust_function_creators=1</span><br><span class=\"line\">explicit_defaults_for_timestamp=true</span><br><span class=\"line\">default_time_zone = &quot;+8:00&quot;</span><br><span class=\"line\">log_timestamps = SYSTEM</span><br><span class=\"line\">explicit_defaults_for_timestamp = 1</span><br><span class=\"line\"></span><br><span class=\"line\">table_open_cache = 500</span><br><span class=\"line\">table_definition_cache = 1000</span><br><span class=\"line\">table_open_cache_instances = 64</span><br><span class=\"line\">thread_stack = 512K</span><br><span class=\"line\">thread_cache_size = 700</span><br><span class=\"line\">max_allowed_packet = 256M</span><br><span class=\"line\">join_buffer_size = 4M</span><br><span class=\"line\">key_buffer_size = 32M</span><br><span class=\"line\">read_buffer_size = 8M</span><br><span class=\"line\">read_rnd_buffer_size = 8M</span><br><span class=\"line\">sort_buffer_size = 2M</span><br><span class=\"line\">max_connections = 3000</span><br><span class=\"line\">max_connect_errors = 2000</span><br><span class=\"line\"></span><br><span class=\"line\">innodb_log_buffer_size = 32M</span><br><span class=\"line\">innodb_log_file_size = 2G</span><br><span class=\"line\">innodb_log_files_in_group = 2</span><br><span class=\"line\">innodb_buffer_pool_size = 48G #重要参数，建议为内存的80%</span><br><span class=\"line\">innodb_buffer_pool_instances = 8</span><br><span class=\"line\">innodb_io_capacity=1200</span><br><span class=\"line\">innodb_page_cleaners=8</span><br><span class=\"line\"></span><br><span class=\"line\">log_bin_trust_function_creators=1</span><br><span class=\"line\">binlog_cache_size = 1M</span><br><span class=\"line\">expire_logs_days = 7</span><br><span class=\"line\">binlog_format = row</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\">###mysql master</span></span></span><br><span class=\"line\">gtid-mode = ON</span><br><span class=\"line\">enforce-gtid-consistency = ON</span><br><span class=\"line\"></span><br><span class=\"line\">slow_query_log = 1</span><br><span class=\"line\">slow_query_log_file = /data/mysql/data/slow_query.log</span><br><span class=\"line\">long_query_time= 60</span><br><span class=\"line\">log_queries_not_using_indexes = 1</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqldump]</span><br><span class=\"line\">quick</span><br><span class=\"line\">max_allowed_packet = 256M</span><br><span class=\"line\"></span><br><span class=\"line\">[client]</span><br><span class=\"line\">port = 3306</span><br><span class=\"line\">socket = /usr/local/mysql/mysql.sock</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">default-character-set = utf8mb4</span></span><br></pre></td></tr></table></figure>\n"},{"title":"SecureCRT 语法高亮","date":"2023-11-23T08:15:03.000Z","_content":"\n\n> 合适的语法高亮可以帮助快速找到想要的信息\n\n> 下面正则适用secureCRT, 理论上xshell也是适用\n\n> 解决了 secureCRT 在某些场景下的开启语法高亮后卡顿的问题\n\n\n## 一、 secureCRT shell 高亮\n\n### ipv4\n\n``` \n([0-9]{1,3})\\.([0-9]{1,3})\\.([0-9]{1,3})\\.([0-9]{1,3})\n```\n\n### stop end disable close \n\n```\n(\\bstop(ped)?\\b)|(\\bend\\b)|(\\bfinish(ed)?\\b)|(\\bdisable(d)?\\b)|(\\bdelete(d)?\\b)|(\\bclose(d)?\\b)\n```\n\n### error fail flase down dead failure\n\n```\n(\\berror(s)?\\b)|(\\bfail(ed)?\\b)|(\\bfalse\\b)|(\\bdown\\b)|(\\bdead\\b)|(\\bfailure\\b)\n```\n\n### active success true ok up enable\n\n```\n(\\bactive(d)?\\b)|(\\bsuccess(ful(ly)?)?\\b)|(\\btrue\\b)|(\\bok\\b)|(\\bup\\b)|(\\benable(d)\\b)\n```\n\n### username@hostname\n\n```\n[a-z0-9-]*@[a-z0-9-]*\n```\n\n注意: xshell中关于电子邮件的高亮规则如何在secureCRT, 会消耗大量资源, 导致执行htop或者查看大量日志的时候终端卡顿.\n\n\n效果图:\n\n<img src=\"/images/060.highlight.md.01.png\" width=100% height=100% />\n\n\n\n**SecureCRT开启高亮**\n\n``` Options-->Configure-->Default Session-->keyword Highlighting ``` \n\n**Xshell开启高亮**\n\n``` 工具-->突出显示集```","source":"_posts/060.highlight.md","raw":"---\ntitle: SecureCRT 语法高亮\ndate: 2023-11-23 16:15:03\ncategories: \n- [Linux]\ntags: \n- SecureCRT\n- xshell\n---\n\n\n> 合适的语法高亮可以帮助快速找到想要的信息\n\n> 下面正则适用secureCRT, 理论上xshell也是适用\n\n> 解决了 secureCRT 在某些场景下的开启语法高亮后卡顿的问题\n\n\n## 一、 secureCRT shell 高亮\n\n### ipv4\n\n``` \n([0-9]{1,3})\\.([0-9]{1,3})\\.([0-9]{1,3})\\.([0-9]{1,3})\n```\n\n### stop end disable close \n\n```\n(\\bstop(ped)?\\b)|(\\bend\\b)|(\\bfinish(ed)?\\b)|(\\bdisable(d)?\\b)|(\\bdelete(d)?\\b)|(\\bclose(d)?\\b)\n```\n\n### error fail flase down dead failure\n\n```\n(\\berror(s)?\\b)|(\\bfail(ed)?\\b)|(\\bfalse\\b)|(\\bdown\\b)|(\\bdead\\b)|(\\bfailure\\b)\n```\n\n### active success true ok up enable\n\n```\n(\\bactive(d)?\\b)|(\\bsuccess(ful(ly)?)?\\b)|(\\btrue\\b)|(\\bok\\b)|(\\bup\\b)|(\\benable(d)\\b)\n```\n\n### username@hostname\n\n```\n[a-z0-9-]*@[a-z0-9-]*\n```\n\n注意: xshell中关于电子邮件的高亮规则如何在secureCRT, 会消耗大量资源, 导致执行htop或者查看大量日志的时候终端卡顿.\n\n\n效果图:\n\n<img src=\"/images/060.highlight.md.01.png\" width=100% height=100% />\n\n\n\n**SecureCRT开启高亮**\n\n``` Options-->Configure-->Default Session-->keyword Highlighting ``` \n\n**Xshell开启高亮**\n\n``` 工具-->突出显示集```","slug":"060.highlight","published":1,"updated":"2023-12-05T08:52:30.882Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzes005iijnrc20k3030","content":"<blockquote>\n<p>合适的语法高亮可以帮助快速找到想要的信息</p>\n</blockquote>\n<blockquote>\n<p>下面正则适用secureCRT, 理论上xshell也是适用</p>\n</blockquote>\n<blockquote>\n<p>解决了 secureCRT 在某些场景下的开启语法高亮后卡顿的问题</p>\n</blockquote>\n<h2 id=\"一、-secureCRT-shell-高亮\"><a href=\"#一、-secureCRT-shell-高亮\" class=\"headerlink\" title=\"一、 secureCRT shell 高亮\"></a>一、 secureCRT shell 高亮</h2><h3 id=\"ipv4\"><a href=\"#ipv4\" class=\"headerlink\" title=\"ipv4\"></a>ipv4</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">([0-9]&#123;1,3&#125;)\\.([0-9]&#123;1,3&#125;)\\.([0-9]&#123;1,3&#125;)\\.([0-9]&#123;1,3&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"stop-end-disable-close\"><a href=\"#stop-end-disable-close\" class=\"headerlink\" title=\"stop end disable close\"></a>stop end disable close</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">(\\bstop(ped)?\\b)|(\\bend\\b)|(\\bfinish(ed)?\\b)|(\\bdisable(d)?\\b)|(\\bdelete(d)?\\b)|(\\bclose(d)?\\b)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"error-fail-flase-down-dead-failure\"><a href=\"#error-fail-flase-down-dead-failure\" class=\"headerlink\" title=\"error fail flase down dead failure\"></a>error fail flase down dead failure</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">(\\berror(s)?\\b)|(\\bfail(ed)?\\b)|(\\bfalse\\b)|(\\bdown\\b)|(\\bdead\\b)|(\\bfailure\\b)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"active-success-true-ok-up-enable\"><a href=\"#active-success-true-ok-up-enable\" class=\"headerlink\" title=\"active success true ok up enable\"></a>active success true ok up enable</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">(\\bactive(d)?\\b)|(\\bsuccess(ful(ly)?)?\\b)|(\\btrue\\b)|(\\bok\\b)|(\\bup\\b)|(\\benable(d)\\b)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"username-hostname\"><a href=\"#username-hostname\" class=\"headerlink\" title=\"username@hostname\"></a>username@hostname</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[a-z0-9-]*@[a-z0-9-]*</span><br></pre></td></tr></table></figure>\n\n<p>注意: xshell中关于电子邮件的高亮规则如何在secureCRT, 会消耗大量资源, 导致执行htop或者查看大量日志的时候终端卡顿.</p>\n<p>效果图:</p>\n<img src=\"/images/060.highlight.md.01.png\" width=100% height=100% />\n\n\n\n<p><strong>SecureCRT开启高亮</strong></p>\n<p><code>Options--&gt;Configure--&gt;Default Session--&gt;keyword Highlighting</code> </p>\n<p><strong>Xshell开启高亮</strong></p>\n<p><code> 工具--&gt;突出显示集</code></p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>合适的语法高亮可以帮助快速找到想要的信息</p>\n</blockquote>\n<blockquote>\n<p>下面正则适用secureCRT, 理论上xshell也是适用</p>\n</blockquote>\n<blockquote>\n<p>解决了 secureCRT 在某些场景下的开启语法高亮后卡顿的问题</p>\n</blockquote>\n<h2 id=\"一、-secureCRT-shell-高亮\"><a href=\"#一、-secureCRT-shell-高亮\" class=\"headerlink\" title=\"一、 secureCRT shell 高亮\"></a>一、 secureCRT shell 高亮</h2><h3 id=\"ipv4\"><a href=\"#ipv4\" class=\"headerlink\" title=\"ipv4\"></a>ipv4</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">([0-9]&#123;1,3&#125;)\\.([0-9]&#123;1,3&#125;)\\.([0-9]&#123;1,3&#125;)\\.([0-9]&#123;1,3&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"stop-end-disable-close\"><a href=\"#stop-end-disable-close\" class=\"headerlink\" title=\"stop end disable close\"></a>stop end disable close</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">(\\bstop(ped)?\\b)|(\\bend\\b)|(\\bfinish(ed)?\\b)|(\\bdisable(d)?\\b)|(\\bdelete(d)?\\b)|(\\bclose(d)?\\b)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"error-fail-flase-down-dead-failure\"><a href=\"#error-fail-flase-down-dead-failure\" class=\"headerlink\" title=\"error fail flase down dead failure\"></a>error fail flase down dead failure</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">(\\berror(s)?\\b)|(\\bfail(ed)?\\b)|(\\bfalse\\b)|(\\bdown\\b)|(\\bdead\\b)|(\\bfailure\\b)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"active-success-true-ok-up-enable\"><a href=\"#active-success-true-ok-up-enable\" class=\"headerlink\" title=\"active success true ok up enable\"></a>active success true ok up enable</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">(\\bactive(d)?\\b)|(\\bsuccess(ful(ly)?)?\\b)|(\\btrue\\b)|(\\bok\\b)|(\\bup\\b)|(\\benable(d)\\b)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"username-hostname\"><a href=\"#username-hostname\" class=\"headerlink\" title=\"username@hostname\"></a>username@hostname</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[a-z0-9-]*@[a-z0-9-]*</span><br></pre></td></tr></table></figure>\n\n<p>注意: xshell中关于电子邮件的高亮规则如何在secureCRT, 会消耗大量资源, 导致执行htop或者查看大量日志的时候终端卡顿.</p>\n<p>效果图:</p>\n<img src=\"/images/060.highlight.md.01.png\" width=100% height=100% />\n\n\n\n<p><strong>SecureCRT开启高亮</strong></p>\n<p><code>Options--&gt;Configure--&gt;Default Session--&gt;keyword Highlighting</code> </p>\n<p><strong>Xshell开启高亮</strong></p>\n<p><code> 工具--&gt;突出显示集</code></p>\n"},{"title":"samba 部署以及端口修改","date":"2023-11-23T06:15:03.000Z","_content":"\n\n## 一、 samba 部署\n\n### 1.1 samba 安装\n\n``` yum install samba*```\n\n###  1.2 samba 启动\n\n``` systemctl enable smb --now ```\n``` systemctl status smb ```\n<img src=\"/images/059.samba.md.01.png\" width=100% height=100% />\n\n### 1.3 测试 smb\n\n添加配置\n``` shell\n[share]\n    path = /samba/share\n    browsable = Yes\n    writable = Yes\n    guest ok = Yes\n    read only = N\n```\n\n创建用户\n``` useradd smb ```\n``` smbpasswd smb ```\n\nWindows资源管理器输入 ```\\\\192.168.1.201``` , 在跳出的窗口输入刚才的用户名和密码即可.\n\n## 二、 修改 samba 默认端口\n\n>>  由于安全原因, 不允许常见服务运行在常见的端口上\n \n### 2.1 修改配置文件\n\n在 [globle] 选项下面添加从参数 ```smb port = 9445```\n重启 smb 生效\n\n```vim /etc/samba/smb.conf```\n<img src=\"/images/059.samba.md.02.png\" width=100% height=100% />\n\n<img src=\"/images/059.samba.md.03.png\" width=100% height=100% />\n\n\n## 三、 修改端口后客户端去连接smb\n\n### 3.1 Linux下smb客户端安装\n\n``` sudo apt install smbclient ```\n\n### 3.2 连接 9445端口的 smb\n\n```sudo smbclient -L 192.168.1.201 -p 9445 -U smb ```\n```  sudo smbclient //192.168.1.201/smb -p 9445 -U smb ```\n\n<img src=\"/images/059.samba.md.04.png\" width=100% height=100% />\n\n### 3.3 Windows下连接 smb\n\n> smb的Windows客户端没有指定端口的选项, 可以通过修改注册表, 但是不一定成功。\n> 使用端口映射, 将```192.168.1.201:9445``` 映射到本地 ```127.0.0.1:445```\n> 资源管理器访问 ```\\\\127.0.0.1```\n\n#### 3.3.1 关闭Windows下的smb服务端\n\n[服务]-->[server]-->[关闭]-->[重启Windows]\n\n#### 3.3.2 添加端口映射\n\n管理员权限cmd执行:\n``` netsh interface portproxy add v4tov4 listenport=445 listenaddress=127.0.0.1 connectport=9445 connectaddress= 192.168.1.201 ```\n\n查看映射规则:\n\n``` netsh interface portproxy show all ```\n\n<img src=\"/images/059.samba.md.05.png\" width=100% height=100% />\n<img src=\"/images/059.samba.md.06.png\" width=100% height=100% />","source":"_posts/059.samba.md","raw":"---\ntitle: samba 部署以及端口修改\ndate: 2023-11-23 14:15:03\ncategories: \n- [Linux]\ntags: \n- samba\n---\n\n\n## 一、 samba 部署\n\n### 1.1 samba 安装\n\n``` yum install samba*```\n\n###  1.2 samba 启动\n\n``` systemctl enable smb --now ```\n``` systemctl status smb ```\n<img src=\"/images/059.samba.md.01.png\" width=100% height=100% />\n\n### 1.3 测试 smb\n\n添加配置\n``` shell\n[share]\n    path = /samba/share\n    browsable = Yes\n    writable = Yes\n    guest ok = Yes\n    read only = N\n```\n\n创建用户\n``` useradd smb ```\n``` smbpasswd smb ```\n\nWindows资源管理器输入 ```\\\\192.168.1.201``` , 在跳出的窗口输入刚才的用户名和密码即可.\n\n## 二、 修改 samba 默认端口\n\n>>  由于安全原因, 不允许常见服务运行在常见的端口上\n \n### 2.1 修改配置文件\n\n在 [globle] 选项下面添加从参数 ```smb port = 9445```\n重启 smb 生效\n\n```vim /etc/samba/smb.conf```\n<img src=\"/images/059.samba.md.02.png\" width=100% height=100% />\n\n<img src=\"/images/059.samba.md.03.png\" width=100% height=100% />\n\n\n## 三、 修改端口后客户端去连接smb\n\n### 3.1 Linux下smb客户端安装\n\n``` sudo apt install smbclient ```\n\n### 3.2 连接 9445端口的 smb\n\n```sudo smbclient -L 192.168.1.201 -p 9445 -U smb ```\n```  sudo smbclient //192.168.1.201/smb -p 9445 -U smb ```\n\n<img src=\"/images/059.samba.md.04.png\" width=100% height=100% />\n\n### 3.3 Windows下连接 smb\n\n> smb的Windows客户端没有指定端口的选项, 可以通过修改注册表, 但是不一定成功。\n> 使用端口映射, 将```192.168.1.201:9445``` 映射到本地 ```127.0.0.1:445```\n> 资源管理器访问 ```\\\\127.0.0.1```\n\n#### 3.3.1 关闭Windows下的smb服务端\n\n[服务]-->[server]-->[关闭]-->[重启Windows]\n\n#### 3.3.2 添加端口映射\n\n管理员权限cmd执行:\n``` netsh interface portproxy add v4tov4 listenport=445 listenaddress=127.0.0.1 connectport=9445 connectaddress= 192.168.1.201 ```\n\n查看映射规则:\n\n``` netsh interface portproxy show all ```\n\n<img src=\"/images/059.samba.md.05.png\" width=100% height=100% />\n<img src=\"/images/059.samba.md.06.png\" width=100% height=100% />","slug":"059.samba","published":1,"updated":"2023-12-05T08:52:30.882Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzeu005lijnrbwoybu0h","content":"<h2 id=\"一、-samba-部署\"><a href=\"#一、-samba-部署\" class=\"headerlink\" title=\"一、 samba 部署\"></a>一、 samba 部署</h2><h3 id=\"1-1-samba-安装\"><a href=\"#1-1-samba-安装\" class=\"headerlink\" title=\"1.1 samba 安装\"></a>1.1 samba 安装</h3><p><code> yum install samba*</code></p>\n<h3 id=\"1-2-samba-启动\"><a href=\"#1-2-samba-启动\" class=\"headerlink\" title=\"1.2 samba 启动\"></a>1.2 samba 启动</h3><p><code>systemctl enable smb --now</code><br><code>systemctl status smb</code><br><img src=\"/images/059.samba.md.01.png\" width=100% height=100% /></p>\n<h3 id=\"1-3-测试-smb\"><a href=\"#1-3-测试-smb\" class=\"headerlink\" title=\"1.3 测试 smb\"></a>1.3 测试 smb</h3><p>添加配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[share]</span><br><span class=\"line\">    path = /samba/share</span><br><span class=\"line\">    browsable = Yes</span><br><span class=\"line\">    writable = Yes</span><br><span class=\"line\">    guest ok = Yes</span><br><span class=\"line\">    read only = N</span><br></pre></td></tr></table></figure>\n\n<p>创建用户<br><code>useradd smb</code><br><code>smbpasswd smb</code></p>\n<p>Windows资源管理器输入 <code>\\\\192.168.1.201</code> , 在跳出的窗口输入刚才的用户名和密码即可.</p>\n<h2 id=\"二、-修改-samba-默认端口\"><a href=\"#二、-修改-samba-默认端口\" class=\"headerlink\" title=\"二、 修改 samba 默认端口\"></a>二、 修改 samba 默认端口</h2><blockquote>\n<blockquote>\n<p> 由于安全原因, 不允许常见服务运行在常见的端口上</p>\n</blockquote>\n</blockquote>\n<h3 id=\"2-1-修改配置文件\"><a href=\"#2-1-修改配置文件\" class=\"headerlink\" title=\"2.1 修改配置文件\"></a>2.1 修改配置文件</h3><p>在 [globle] 选项下面添加从参数 <code>smb port = 9445</code><br>重启 smb 生效</p>\n<p><code>vim /etc/samba/smb.conf</code><br><img src=\"/images/059.samba.md.02.png\" width=100% height=100% /></p>\n<img src=\"/images/059.samba.md.03.png\" width=100% height=100% />\n\n\n<h2 id=\"三、-修改端口后客户端去连接smb\"><a href=\"#三、-修改端口后客户端去连接smb\" class=\"headerlink\" title=\"三、 修改端口后客户端去连接smb\"></a>三、 修改端口后客户端去连接smb</h2><h3 id=\"3-1-Linux下smb客户端安装\"><a href=\"#3-1-Linux下smb客户端安装\" class=\"headerlink\" title=\"3.1 Linux下smb客户端安装\"></a>3.1 Linux下smb客户端安装</h3><p><code>sudo apt install smbclient</code></p>\n<h3 id=\"3-2-连接-9445端口的-smb\"><a href=\"#3-2-连接-9445端口的-smb\" class=\"headerlink\" title=\"3.2 连接 9445端口的 smb\"></a>3.2 连接 9445端口的 smb</h3><p><code>sudo smbclient -L 192.168.1.201 -p 9445 -U smb </code><br><code> sudo smbclient //192.168.1.201/smb -p 9445 -U smb</code></p>\n<img src=\"/images/059.samba.md.04.png\" width=100% height=100% />\n\n<h3 id=\"3-3-Windows下连接-smb\"><a href=\"#3-3-Windows下连接-smb\" class=\"headerlink\" title=\"3.3 Windows下连接 smb\"></a>3.3 Windows下连接 smb</h3><blockquote>\n<p>smb的Windows客户端没有指定端口的选项, 可以通过修改注册表, 但是不一定成功。<br>使用端口映射, 将<code>192.168.1.201:9445</code> 映射到本地 <code>127.0.0.1:445</code><br>资源管理器访问 <code>\\\\127.0.0.1</code></p>\n</blockquote>\n<h4 id=\"3-3-1-关闭Windows下的smb服务端\"><a href=\"#3-3-1-关闭Windows下的smb服务端\" class=\"headerlink\" title=\"3.3.1 关闭Windows下的smb服务端\"></a>3.3.1 关闭Windows下的smb服务端</h4><p>[服务]–&gt;[server]–&gt;[关闭]–&gt;[重启Windows]</p>\n<h4 id=\"3-3-2-添加端口映射\"><a href=\"#3-3-2-添加端口映射\" class=\"headerlink\" title=\"3.3.2 添加端口映射\"></a>3.3.2 添加端口映射</h4><p>管理员权限cmd执行:<br><code>netsh interface portproxy add v4tov4 listenport=445 listenaddress=127.0.0.1 connectport=9445 connectaddress= 192.168.1.201</code></p>\n<p>查看映射规则:</p>\n<p><code>netsh interface portproxy show all</code></p>\n<img src=\"/images/059.samba.md.05.png\" width=100% height=100% />\n<img src=\"/images/059.samba.md.06.png\" width=100% height=100% />","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、-samba-部署\"><a href=\"#一、-samba-部署\" class=\"headerlink\" title=\"一、 samba 部署\"></a>一、 samba 部署</h2><h3 id=\"1-1-samba-安装\"><a href=\"#1-1-samba-安装\" class=\"headerlink\" title=\"1.1 samba 安装\"></a>1.1 samba 安装</h3><p><code> yum install samba*</code></p>\n<h3 id=\"1-2-samba-启动\"><a href=\"#1-2-samba-启动\" class=\"headerlink\" title=\"1.2 samba 启动\"></a>1.2 samba 启动</h3><p><code>systemctl enable smb --now</code><br><code>systemctl status smb</code><br><img src=\"/images/059.samba.md.01.png\" width=100% height=100% /></p>\n<h3 id=\"1-3-测试-smb\"><a href=\"#1-3-测试-smb\" class=\"headerlink\" title=\"1.3 测试 smb\"></a>1.3 测试 smb</h3><p>添加配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[share]</span><br><span class=\"line\">    path = /samba/share</span><br><span class=\"line\">    browsable = Yes</span><br><span class=\"line\">    writable = Yes</span><br><span class=\"line\">    guest ok = Yes</span><br><span class=\"line\">    read only = N</span><br></pre></td></tr></table></figure>\n\n<p>创建用户<br><code>useradd smb</code><br><code>smbpasswd smb</code></p>\n<p>Windows资源管理器输入 <code>\\\\192.168.1.201</code> , 在跳出的窗口输入刚才的用户名和密码即可.</p>\n<h2 id=\"二、-修改-samba-默认端口\"><a href=\"#二、-修改-samba-默认端口\" class=\"headerlink\" title=\"二、 修改 samba 默认端口\"></a>二、 修改 samba 默认端口</h2><blockquote>\n<blockquote>\n<p> 由于安全原因, 不允许常见服务运行在常见的端口上</p>\n</blockquote>\n</blockquote>\n<h3 id=\"2-1-修改配置文件\"><a href=\"#2-1-修改配置文件\" class=\"headerlink\" title=\"2.1 修改配置文件\"></a>2.1 修改配置文件</h3><p>在 [globle] 选项下面添加从参数 <code>smb port = 9445</code><br>重启 smb 生效</p>\n<p><code>vim /etc/samba/smb.conf</code><br><img src=\"/images/059.samba.md.02.png\" width=100% height=100% /></p>\n<img src=\"/images/059.samba.md.03.png\" width=100% height=100% />\n\n\n<h2 id=\"三、-修改端口后客户端去连接smb\"><a href=\"#三、-修改端口后客户端去连接smb\" class=\"headerlink\" title=\"三、 修改端口后客户端去连接smb\"></a>三、 修改端口后客户端去连接smb</h2><h3 id=\"3-1-Linux下smb客户端安装\"><a href=\"#3-1-Linux下smb客户端安装\" class=\"headerlink\" title=\"3.1 Linux下smb客户端安装\"></a>3.1 Linux下smb客户端安装</h3><p><code>sudo apt install smbclient</code></p>\n<h3 id=\"3-2-连接-9445端口的-smb\"><a href=\"#3-2-连接-9445端口的-smb\" class=\"headerlink\" title=\"3.2 连接 9445端口的 smb\"></a>3.2 连接 9445端口的 smb</h3><p><code>sudo smbclient -L 192.168.1.201 -p 9445 -U smb </code><br><code> sudo smbclient //192.168.1.201/smb -p 9445 -U smb</code></p>\n<img src=\"/images/059.samba.md.04.png\" width=100% height=100% />\n\n<h3 id=\"3-3-Windows下连接-smb\"><a href=\"#3-3-Windows下连接-smb\" class=\"headerlink\" title=\"3.3 Windows下连接 smb\"></a>3.3 Windows下连接 smb</h3><blockquote>\n<p>smb的Windows客户端没有指定端口的选项, 可以通过修改注册表, 但是不一定成功。<br>使用端口映射, 将<code>192.168.1.201:9445</code> 映射到本地 <code>127.0.0.1:445</code><br>资源管理器访问 <code>\\\\127.0.0.1</code></p>\n</blockquote>\n<h4 id=\"3-3-1-关闭Windows下的smb服务端\"><a href=\"#3-3-1-关闭Windows下的smb服务端\" class=\"headerlink\" title=\"3.3.1 关闭Windows下的smb服务端\"></a>3.3.1 关闭Windows下的smb服务端</h4><p>[服务]–&gt;[server]–&gt;[关闭]–&gt;[重启Windows]</p>\n<h4 id=\"3-3-2-添加端口映射\"><a href=\"#3-3-2-添加端口映射\" class=\"headerlink\" title=\"3.3.2 添加端口映射\"></a>3.3.2 添加端口映射</h4><p>管理员权限cmd执行:<br><code>netsh interface portproxy add v4tov4 listenport=445 listenaddress=127.0.0.1 connectport=9445 connectaddress= 192.168.1.201</code></p>\n<p>查看映射规则:</p>\n<p><code>netsh interface portproxy show all</code></p>\n<img src=\"/images/059.samba.md.05.png\" width=100% height=100% />\n<img src=\"/images/059.samba.md.06.png\" width=100% height=100% />"},{"title":"hexo 部署","date":"2023-11-30T06:54:40.000Z","_content":"\nENV:\n\nHW: kvm\nArch: x86_64\nOS: CentOS7.9\n\n\n## 一、 安装 nodejs\n\n### 1.1 yum 安装\n``` yum install nodejs ```\n\n### 1.2 二进制安装\nhttps://nodejs.org/download/release/v16.20.2/\n\n本文采用二进制安装, 因为yum安装的node和openssl版本有冲突\n下载文件后, 解压至 /usr/local; 然后通过软连接到系统变量\n\n``` tar -xzvf node-v12.22.12-linux-x64.tar.gz ```\n``` mv node-v12.22.12-linux-x64 /usr/local/ ```\n``` ln -s /usr/local/node-v12.22.12-linux-x64/ /usr/local/nodejs ```\n``` ln -s /usr/local/nodejs/bin/node /usr/bin/node ```\n``` ln -s /usr/local/nodejs/bin/npm /usr/bin/npm ```\n\n## 二、 安装 hexo\n\n### 2.1 创建目录\n\n**后面所有的命令都在这个目录下执行**\n``` mkdir /mdzz ```\n``` npm install hexo ```\n\n### 2.2 创建软连接\n\n``` ln -s /mdzz/node_modules/hexo/bin/hexo /usr/bin/hexo ```\n\n### 2.3 建站\n\n``` hexo init blog ```\n``` cd  blog ```\n``` npm install ```\n\n### 2.4 临时启动\n\n``` hexo s ```\n\n\n\n\n\n\n","source":"_posts/061.hexo.md","raw":"---\ntitle: hexo 部署\ndate: 2023-11-30 14:54:40\ncategories: \n- [Linux]\ntags: \n- hexo\n---\n\nENV:\n\nHW: kvm\nArch: x86_64\nOS: CentOS7.9\n\n\n## 一、 安装 nodejs\n\n### 1.1 yum 安装\n``` yum install nodejs ```\n\n### 1.2 二进制安装\nhttps://nodejs.org/download/release/v16.20.2/\n\n本文采用二进制安装, 因为yum安装的node和openssl版本有冲突\n下载文件后, 解压至 /usr/local; 然后通过软连接到系统变量\n\n``` tar -xzvf node-v12.22.12-linux-x64.tar.gz ```\n``` mv node-v12.22.12-linux-x64 /usr/local/ ```\n``` ln -s /usr/local/node-v12.22.12-linux-x64/ /usr/local/nodejs ```\n``` ln -s /usr/local/nodejs/bin/node /usr/bin/node ```\n``` ln -s /usr/local/nodejs/bin/npm /usr/bin/npm ```\n\n## 二、 安装 hexo\n\n### 2.1 创建目录\n\n**后面所有的命令都在这个目录下执行**\n``` mkdir /mdzz ```\n``` npm install hexo ```\n\n### 2.2 创建软连接\n\n``` ln -s /mdzz/node_modules/hexo/bin/hexo /usr/bin/hexo ```\n\n### 2.3 建站\n\n``` hexo init blog ```\n``` cd  blog ```\n``` npm install ```\n\n### 2.4 临时启动\n\n``` hexo s ```\n\n\n\n\n\n\n","slug":"061.hexo","published":1,"updated":"2023-12-05T08:52:30.882Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzev005nijnr3lnzd3so","content":"<p>ENV:</p>\n<p>HW: kvm<br>Arch: x86_64<br>OS: CentOS7.9</p>\n<h2 id=\"一、-安装-nodejs\"><a href=\"#一、-安装-nodejs\" class=\"headerlink\" title=\"一、 安装 nodejs\"></a>一、 安装 nodejs</h2><h3 id=\"1-1-yum-安装\"><a href=\"#1-1-yum-安装\" class=\"headerlink\" title=\"1.1 yum 安装\"></a>1.1 yum 安装</h3><p><code>yum install nodejs</code></p>\n<h3 id=\"1-2-二进制安装\"><a href=\"#1-2-二进制安装\" class=\"headerlink\" title=\"1.2 二进制安装\"></a>1.2 二进制安装</h3><p><a href=\"https://nodejs.org/download/release/v16.20.2/\">https://nodejs.org/download/release/v16.20.2/</a></p>\n<p>本文采用二进制安装, 因为yum安装的node和openssl版本有冲突<br>下载文件后, 解压至 &#x2F;usr&#x2F;local; 然后通过软连接到系统变量</p>\n<p><code>tar -xzvf node-v12.22.12-linux-x64.tar.gz</code><br><code>mv node-v12.22.12-linux-x64 /usr/local/</code><br><code>ln -s /usr/local/node-v12.22.12-linux-x64/ /usr/local/nodejs</code><br><code>ln -s /usr/local/nodejs/bin/node /usr/bin/node</code><br><code>ln -s /usr/local/nodejs/bin/npm /usr/bin/npm</code></p>\n<h2 id=\"二、-安装-hexo\"><a href=\"#二、-安装-hexo\" class=\"headerlink\" title=\"二、 安装 hexo\"></a>二、 安装 hexo</h2><h3 id=\"2-1-创建目录\"><a href=\"#2-1-创建目录\" class=\"headerlink\" title=\"2.1 创建目录\"></a>2.1 创建目录</h3><p><strong>后面所有的命令都在这个目录下执行</strong><br><code>mkdir /mdzz</code><br><code>npm install hexo</code></p>\n<h3 id=\"2-2-创建软连接\"><a href=\"#2-2-创建软连接\" class=\"headerlink\" title=\"2.2 创建软连接\"></a>2.2 创建软连接</h3><p><code>ln -s /mdzz/node_modules/hexo/bin/hexo /usr/bin/hexo</code></p>\n<h3 id=\"2-3-建站\"><a href=\"#2-3-建站\" class=\"headerlink\" title=\"2.3 建站\"></a>2.3 建站</h3><p><code>hexo init blog</code><br><code>cd  blog</code><br><code>npm install</code></p>\n<h3 id=\"2-4-临时启动\"><a href=\"#2-4-临时启动\" class=\"headerlink\" title=\"2.4 临时启动\"></a>2.4 临时启动</h3><p><code>hexo s</code></p>\n","site":{"data":{}},"excerpt":"","more":"<p>ENV:</p>\n<p>HW: kvm<br>Arch: x86_64<br>OS: CentOS7.9</p>\n<h2 id=\"一、-安装-nodejs\"><a href=\"#一、-安装-nodejs\" class=\"headerlink\" title=\"一、 安装 nodejs\"></a>一、 安装 nodejs</h2><h3 id=\"1-1-yum-安装\"><a href=\"#1-1-yum-安装\" class=\"headerlink\" title=\"1.1 yum 安装\"></a>1.1 yum 安装</h3><p><code>yum install nodejs</code></p>\n<h3 id=\"1-2-二进制安装\"><a href=\"#1-2-二进制安装\" class=\"headerlink\" title=\"1.2 二进制安装\"></a>1.2 二进制安装</h3><p><a href=\"https://nodejs.org/download/release/v16.20.2/\">https://nodejs.org/download/release/v16.20.2/</a></p>\n<p>本文采用二进制安装, 因为yum安装的node和openssl版本有冲突<br>下载文件后, 解压至 &#x2F;usr&#x2F;local; 然后通过软连接到系统变量</p>\n<p><code>tar -xzvf node-v12.22.12-linux-x64.tar.gz</code><br><code>mv node-v12.22.12-linux-x64 /usr/local/</code><br><code>ln -s /usr/local/node-v12.22.12-linux-x64/ /usr/local/nodejs</code><br><code>ln -s /usr/local/nodejs/bin/node /usr/bin/node</code><br><code>ln -s /usr/local/nodejs/bin/npm /usr/bin/npm</code></p>\n<h2 id=\"二、-安装-hexo\"><a href=\"#二、-安装-hexo\" class=\"headerlink\" title=\"二、 安装 hexo\"></a>二、 安装 hexo</h2><h3 id=\"2-1-创建目录\"><a href=\"#2-1-创建目录\" class=\"headerlink\" title=\"2.1 创建目录\"></a>2.1 创建目录</h3><p><strong>后面所有的命令都在这个目录下执行</strong><br><code>mkdir /mdzz</code><br><code>npm install hexo</code></p>\n<h3 id=\"2-2-创建软连接\"><a href=\"#2-2-创建软连接\" class=\"headerlink\" title=\"2.2 创建软连接\"></a>2.2 创建软连接</h3><p><code>ln -s /mdzz/node_modules/hexo/bin/hexo /usr/bin/hexo</code></p>\n<h3 id=\"2-3-建站\"><a href=\"#2-3-建站\" class=\"headerlink\" title=\"2.3 建站\"></a>2.3 建站</h3><p><code>hexo init blog</code><br><code>cd  blog</code><br><code>npm install</code></p>\n<h3 id=\"2-4-临时启动\"><a href=\"#2-4-临时启动\" class=\"headerlink\" title=\"2.4 临时启动\"></a>2.4 临时启动</h3><p><code>hexo s</code></p>\n"},{"title":"Tips on Linux","date":"2022-05-18T07:48:13.000Z","_content":"\n\n### 复制一份备份文件\n``` cp /etc/sysconfig/iptables{,.back} ```\n\n### 重命名\n``` mv /etc/sysconfig/iptables{,.back} ```\n\n### 追加内容到文件尾\n``` echo \"123\"  >> /path/file ```\n\n### 树形查看目录大小\n``` du -h --max-depth=1 ```\n\n### 指定源搜索软件\n``` yum repo-pkgs REPO list```\n``` yum repo-pkgs epel list | grep nginx```\n\tANOTHER WAY TO\n``` yum --disablerepo \"*\" --enablerepo REPO list ```\n``` yum --disablerepo \"*\" --enablerepo REPO list | grep nginx ```\n\n### MySQL 5.7.37 \n``` password ``` ---> ``` authentication_string```\n\n### 挂载磁盘设备\n``` fdisk /dev/vdb1```\n``` {n, p, size, type, w} ```\n```mkfs.ext4 /dev/vdb1 ```\n```mount /dev/vdb1 /data```\n\n### 使用代理\n```curl -–socks5 127.0.0.1:10808 https://www.google.com```\n```wget -e http_proxy=127.0.0.1:10808 http://www/google.com```\n```wget -e https_proxy=127.0.0.1:10808 https://www/google.com```\n\n测试是否使用代理\n```curl cip.cc```\n\n### 设置临时代理\n\n``` bash\n export  http_proxy=\"http://username:password@proxyServer:port/\"\n export  https_proxy=\"http://username:password@proxyServer:port/\"\n export ftp_proxy=\"http://username:password@proxyServer:port/\"\n export no_proxy=\"127.0.0.1,192.168.124.0/16,*.example.com\"\n```\n\n取消代理\n\n``` bash\n unset  http_proxy\n unset https_proxy\n unset  ftp_proxy\n unset  no_proxy\n```\n\n9) 永久代理\n\n``` bash\ncat   >>  /etc/profile   << EOF\nexport  http_proxy=\"http://username:password@proxyServer:port/\"\nexport  https_proxy=\"http://username:password@proxyServer:port/\"\nexport ftp_proxy=\"http://username:password@proxyServer:port/\"\nexport no_proxy=\"127.0.0.1,192.168.124.0/16,*.example.com\"\nEOF\n```\n ```source  /etc/profile```\n\n\n### 清空正在使用的文件\n\n``` /usr/bin/cp /dev/null /path2yourFILE```\n**cp使用绝对路径, 避免出现cp提示是否覆盖文件**\n**对正在使用的文件,如果直接rm -rf 文件是没了, 但是占用的空间还在.**\n\n\n### 图形化配置网络ip\n\n``` nmtui ```\n>> nmtui 是 NetworkManager 工具的一部分，它为你提供了一个漂亮的用户界面来配置网络。这是 NetworkManager-tui 包的一部分，当你完成最小服务器的安装时它应该默认安装。\n\n\n### 删除某个目录下除了某个文件之外\n\n删除某目录下除了 xx.txt 的所有文件\n\n``` rm -rf /pathtoyourdir/(!xx.txt)  ```\n\n### 不重启系统识别新添加的硬盘\n\n``` for i in 0 1 2; do echo \"- - -\" > /sys/class/scsi_host/host$i/scan; done ```\n","source":"_posts/999.Tips-linux.md","raw":"---\ntitle: Tips on Linux\ndate: 2022-5-18 15:48:13\ncategories: \n- [Linux]\ntags: \n- Tips\n---\n\n\n### 复制一份备份文件\n``` cp /etc/sysconfig/iptables{,.back} ```\n\n### 重命名\n``` mv /etc/sysconfig/iptables{,.back} ```\n\n### 追加内容到文件尾\n``` echo \"123\"  >> /path/file ```\n\n### 树形查看目录大小\n``` du -h --max-depth=1 ```\n\n### 指定源搜索软件\n``` yum repo-pkgs REPO list```\n``` yum repo-pkgs epel list | grep nginx```\n\tANOTHER WAY TO\n``` yum --disablerepo \"*\" --enablerepo REPO list ```\n``` yum --disablerepo \"*\" --enablerepo REPO list | grep nginx ```\n\n### MySQL 5.7.37 \n``` password ``` ---> ``` authentication_string```\n\n### 挂载磁盘设备\n``` fdisk /dev/vdb1```\n``` {n, p, size, type, w} ```\n```mkfs.ext4 /dev/vdb1 ```\n```mount /dev/vdb1 /data```\n\n### 使用代理\n```curl -–socks5 127.0.0.1:10808 https://www.google.com```\n```wget -e http_proxy=127.0.0.1:10808 http://www/google.com```\n```wget -e https_proxy=127.0.0.1:10808 https://www/google.com```\n\n测试是否使用代理\n```curl cip.cc```\n\n### 设置临时代理\n\n``` bash\n export  http_proxy=\"http://username:password@proxyServer:port/\"\n export  https_proxy=\"http://username:password@proxyServer:port/\"\n export ftp_proxy=\"http://username:password@proxyServer:port/\"\n export no_proxy=\"127.0.0.1,192.168.124.0/16,*.example.com\"\n```\n\n取消代理\n\n``` bash\n unset  http_proxy\n unset https_proxy\n unset  ftp_proxy\n unset  no_proxy\n```\n\n9) 永久代理\n\n``` bash\ncat   >>  /etc/profile   << EOF\nexport  http_proxy=\"http://username:password@proxyServer:port/\"\nexport  https_proxy=\"http://username:password@proxyServer:port/\"\nexport ftp_proxy=\"http://username:password@proxyServer:port/\"\nexport no_proxy=\"127.0.0.1,192.168.124.0/16,*.example.com\"\nEOF\n```\n ```source  /etc/profile```\n\n\n### 清空正在使用的文件\n\n``` /usr/bin/cp /dev/null /path2yourFILE```\n**cp使用绝对路径, 避免出现cp提示是否覆盖文件**\n**对正在使用的文件,如果直接rm -rf 文件是没了, 但是占用的空间还在.**\n\n\n### 图形化配置网络ip\n\n``` nmtui ```\n>> nmtui 是 NetworkManager 工具的一部分，它为你提供了一个漂亮的用户界面来配置网络。这是 NetworkManager-tui 包的一部分，当你完成最小服务器的安装时它应该默认安装。\n\n\n### 删除某个目录下除了某个文件之外\n\n删除某目录下除了 xx.txt 的所有文件\n\n``` rm -rf /pathtoyourdir/(!xx.txt)  ```\n\n### 不重启系统识别新添加的硬盘\n\n``` for i in 0 1 2; do echo \"- - -\" > /sys/class/scsi_host/host$i/scan; done ```\n","slug":"999.Tips-linux","published":1,"updated":"2023-12-05T08:52:30.882Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clq4xtzey005rijnrav8yhkcm","content":"<h3 id=\"复制一份备份文件\"><a href=\"#复制一份备份文件\" class=\"headerlink\" title=\"复制一份备份文件\"></a>复制一份备份文件</h3><p><code>cp /etc/sysconfig/iptables&#123;,.back&#125;</code></p>\n<h3 id=\"重命名\"><a href=\"#重命名\" class=\"headerlink\" title=\"重命名\"></a>重命名</h3><p><code>mv /etc/sysconfig/iptables&#123;,.back&#125;</code></p>\n<h3 id=\"追加内容到文件尾\"><a href=\"#追加内容到文件尾\" class=\"headerlink\" title=\"追加内容到文件尾\"></a>追加内容到文件尾</h3><p><code>echo &quot;123&quot;  &gt;&gt; /path/file</code></p>\n<h3 id=\"树形查看目录大小\"><a href=\"#树形查看目录大小\" class=\"headerlink\" title=\"树形查看目录大小\"></a>树形查看目录大小</h3><p><code>du -h --max-depth=1</code></p>\n<h3 id=\"指定源搜索软件\"><a href=\"#指定源搜索软件\" class=\"headerlink\" title=\"指定源搜索软件\"></a>指定源搜索软件</h3><p><code> yum repo-pkgs REPO list</code><br><code> yum repo-pkgs epel list | grep nginx</code><br>    ANOTHER WAY TO<br><code>yum --disablerepo &quot;*&quot; --enablerepo REPO list</code><br><code>yum --disablerepo &quot;*&quot; --enablerepo REPO list | grep nginx</code></p>\n<h3 id=\"MySQL-5-7-37\"><a href=\"#MySQL-5-7-37\" class=\"headerlink\" title=\"MySQL 5.7.37\"></a>MySQL 5.7.37</h3><p><code>password</code> —&gt; <code> authentication_string</code></p>\n<h3 id=\"挂载磁盘设备\"><a href=\"#挂载磁盘设备\" class=\"headerlink\" title=\"挂载磁盘设备\"></a>挂载磁盘设备</h3><p><code> fdisk /dev/vdb1</code><br><code>&#123;n, p, size, type, w&#125;</code><br><code>mkfs.ext4 /dev/vdb1 </code><br><code>mount /dev/vdb1 /data</code></p>\n<h3 id=\"使用代理\"><a href=\"#使用代理\" class=\"headerlink\" title=\"使用代理\"></a>使用代理</h3><p><code>curl -–socks5 127.0.0.1:10808 https://www.google.com</code><br><code>wget -e http_proxy=127.0.0.1:10808 http://www/google.com</code><br><code>wget -e https_proxy=127.0.0.1:10808 https://www/google.com</code></p>\n<p>测试是否使用代理<br><code>curl cip.cc</code></p>\n<h3 id=\"设置临时代理\"><a href=\"#设置临时代理\" class=\"headerlink\" title=\"设置临时代理\"></a>设置临时代理</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span>  http_proxy=<span class=\"string\">&quot;http://username:password@proxyServer:port/&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span>  https_proxy=<span class=\"string\">&quot;http://username:password@proxyServer:port/&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> ftp_proxy=<span class=\"string\">&quot;http://username:password@proxyServer:port/&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> no_proxy=<span class=\"string\">&quot;127.0.0.1,192.168.124.0/16,*.example.com&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>取消代理</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">unset</span>  http_proxy</span><br><span class=\"line\"><span class=\"built_in\">unset</span> https_proxy</span><br><span class=\"line\"><span class=\"built_in\">unset</span>  ftp_proxy</span><br><span class=\"line\"><span class=\"built_in\">unset</span>  no_proxy</span><br></pre></td></tr></table></figure>\n\n<ol start=\"9\">\n<li>永久代理</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cat</span>   &gt;&gt;  /etc/profile   &lt;&lt; <span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">export  http_proxy=&quot;http://username:password@proxyServer:port/&quot;</span></span><br><span class=\"line\"><span class=\"string\">export  https_proxy=&quot;http://username:password@proxyServer:port/&quot;</span></span><br><span class=\"line\"><span class=\"string\">export ftp_proxy=&quot;http://username:password@proxyServer:port/&quot;</span></span><br><span class=\"line\"><span class=\"string\">export no_proxy=&quot;127.0.0.1,192.168.124.0/16,*.example.com&quot;</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br></pre></td></tr></table></figure>\n<p> <code>source  /etc/profile</code></p>\n<h3 id=\"清空正在使用的文件\"><a href=\"#清空正在使用的文件\" class=\"headerlink\" title=\"清空正在使用的文件\"></a>清空正在使用的文件</h3><p><code> /usr/bin/cp /dev/null /path2yourFILE</code><br><strong>cp使用绝对路径, 避免出现cp提示是否覆盖文件</strong><br><strong>对正在使用的文件,如果直接rm -rf 文件是没了, 但是占用的空间还在.</strong></p>\n<h3 id=\"图形化配置网络ip\"><a href=\"#图形化配置网络ip\" class=\"headerlink\" title=\"图形化配置网络ip\"></a>图形化配置网络ip</h3><p><code>nmtui</code></p>\n<blockquote>\n<blockquote>\n<p>nmtui 是 NetworkManager 工具的一部分，它为你提供了一个漂亮的用户界面来配置网络。这是 NetworkManager-tui 包的一部分，当你完成最小服务器的安装时它应该默认安装。</p>\n</blockquote>\n</blockquote>\n<h3 id=\"删除某个目录下除了某个文件之外\"><a href=\"#删除某个目录下除了某个文件之外\" class=\"headerlink\" title=\"删除某个目录下除了某个文件之外\"></a>删除某个目录下除了某个文件之外</h3><p>删除某目录下除了 xx.txt 的所有文件</p>\n<p><code>rm -rf /pathtoyourdir/(!xx.txt) </code></p>\n<h3 id=\"不重启系统识别新添加的硬盘\"><a href=\"#不重启系统识别新添加的硬盘\" class=\"headerlink\" title=\"不重启系统识别新添加的硬盘\"></a>不重启系统识别新添加的硬盘</h3><p><code>for i in 0 1 2; do echo &quot;- - -&quot; &gt; /sys/class/scsi_host/host$i/scan; done</code></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"复制一份备份文件\"><a href=\"#复制一份备份文件\" class=\"headerlink\" title=\"复制一份备份文件\"></a>复制一份备份文件</h3><p><code>cp /etc/sysconfig/iptables&#123;,.back&#125;</code></p>\n<h3 id=\"重命名\"><a href=\"#重命名\" class=\"headerlink\" title=\"重命名\"></a>重命名</h3><p><code>mv /etc/sysconfig/iptables&#123;,.back&#125;</code></p>\n<h3 id=\"追加内容到文件尾\"><a href=\"#追加内容到文件尾\" class=\"headerlink\" title=\"追加内容到文件尾\"></a>追加内容到文件尾</h3><p><code>echo &quot;123&quot;  &gt;&gt; /path/file</code></p>\n<h3 id=\"树形查看目录大小\"><a href=\"#树形查看目录大小\" class=\"headerlink\" title=\"树形查看目录大小\"></a>树形查看目录大小</h3><p><code>du -h --max-depth=1</code></p>\n<h3 id=\"指定源搜索软件\"><a href=\"#指定源搜索软件\" class=\"headerlink\" title=\"指定源搜索软件\"></a>指定源搜索软件</h3><p><code> yum repo-pkgs REPO list</code><br><code> yum repo-pkgs epel list | grep nginx</code><br>    ANOTHER WAY TO<br><code>yum --disablerepo &quot;*&quot; --enablerepo REPO list</code><br><code>yum --disablerepo &quot;*&quot; --enablerepo REPO list | grep nginx</code></p>\n<h3 id=\"MySQL-5-7-37\"><a href=\"#MySQL-5-7-37\" class=\"headerlink\" title=\"MySQL 5.7.37\"></a>MySQL 5.7.37</h3><p><code>password</code> —&gt; <code> authentication_string</code></p>\n<h3 id=\"挂载磁盘设备\"><a href=\"#挂载磁盘设备\" class=\"headerlink\" title=\"挂载磁盘设备\"></a>挂载磁盘设备</h3><p><code> fdisk /dev/vdb1</code><br><code>&#123;n, p, size, type, w&#125;</code><br><code>mkfs.ext4 /dev/vdb1 </code><br><code>mount /dev/vdb1 /data</code></p>\n<h3 id=\"使用代理\"><a href=\"#使用代理\" class=\"headerlink\" title=\"使用代理\"></a>使用代理</h3><p><code>curl -–socks5 127.0.0.1:10808 https://www.google.com</code><br><code>wget -e http_proxy=127.0.0.1:10808 http://www/google.com</code><br><code>wget -e https_proxy=127.0.0.1:10808 https://www/google.com</code></p>\n<p>测试是否使用代理<br><code>curl cip.cc</code></p>\n<h3 id=\"设置临时代理\"><a href=\"#设置临时代理\" class=\"headerlink\" title=\"设置临时代理\"></a>设置临时代理</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span>  http_proxy=<span class=\"string\">&quot;http://username:password@proxyServer:port/&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span>  https_proxy=<span class=\"string\">&quot;http://username:password@proxyServer:port/&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> ftp_proxy=<span class=\"string\">&quot;http://username:password@proxyServer:port/&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> no_proxy=<span class=\"string\">&quot;127.0.0.1,192.168.124.0/16,*.example.com&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>取消代理</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">unset</span>  http_proxy</span><br><span class=\"line\"><span class=\"built_in\">unset</span> https_proxy</span><br><span class=\"line\"><span class=\"built_in\">unset</span>  ftp_proxy</span><br><span class=\"line\"><span class=\"built_in\">unset</span>  no_proxy</span><br></pre></td></tr></table></figure>\n\n<ol start=\"9\">\n<li>永久代理</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cat</span>   &gt;&gt;  /etc/profile   &lt;&lt; <span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">export  http_proxy=&quot;http://username:password@proxyServer:port/&quot;</span></span><br><span class=\"line\"><span class=\"string\">export  https_proxy=&quot;http://username:password@proxyServer:port/&quot;</span></span><br><span class=\"line\"><span class=\"string\">export ftp_proxy=&quot;http://username:password@proxyServer:port/&quot;</span></span><br><span class=\"line\"><span class=\"string\">export no_proxy=&quot;127.0.0.1,192.168.124.0/16,*.example.com&quot;</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br></pre></td></tr></table></figure>\n<p> <code>source  /etc/profile</code></p>\n<h3 id=\"清空正在使用的文件\"><a href=\"#清空正在使用的文件\" class=\"headerlink\" title=\"清空正在使用的文件\"></a>清空正在使用的文件</h3><p><code> /usr/bin/cp /dev/null /path2yourFILE</code><br><strong>cp使用绝对路径, 避免出现cp提示是否覆盖文件</strong><br><strong>对正在使用的文件,如果直接rm -rf 文件是没了, 但是占用的空间还在.</strong></p>\n<h3 id=\"图形化配置网络ip\"><a href=\"#图形化配置网络ip\" class=\"headerlink\" title=\"图形化配置网络ip\"></a>图形化配置网络ip</h3><p><code>nmtui</code></p>\n<blockquote>\n<blockquote>\n<p>nmtui 是 NetworkManager 工具的一部分，它为你提供了一个漂亮的用户界面来配置网络。这是 NetworkManager-tui 包的一部分，当你完成最小服务器的安装时它应该默认安装。</p>\n</blockquote>\n</blockquote>\n<h3 id=\"删除某个目录下除了某个文件之外\"><a href=\"#删除某个目录下除了某个文件之外\" class=\"headerlink\" title=\"删除某个目录下除了某个文件之外\"></a>删除某个目录下除了某个文件之外</h3><p>删除某目录下除了 xx.txt 的所有文件</p>\n<p><code>rm -rf /pathtoyourdir/(!xx.txt) </code></p>\n<h3 id=\"不重启系统识别新添加的硬盘\"><a href=\"#不重启系统识别新添加的硬盘\" class=\"headerlink\" title=\"不重启系统识别新添加的硬盘\"></a>不重启系统识别新添加的硬盘</h3><p><code>for i in 0 1 2; do echo &quot;- - -&quot; &gt; /sys/class/scsi_host/host$i/scan; done</code></p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"clq4xtz850001ijnrdkte5o5e","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtz9l000kijnrh4r573m6"},{"post_id":"clq4xtz8g0003ijnrfhwehspi","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtz9u000rijnr0l4xbig5"},{"post_id":"clq4xtz8r0007ijnralwtblgi","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtza80013ijnr8o5m624i"},{"post_id":"clq4xtz8r0007ijnralwtblgi","category_id":"clq4xtz9k000jijnr8kk3dc6a","_id":"clq4xtzac0017ijnr7xsq87kr"},{"post_id":"clq4xtz9s000qijnr1vwy13tj","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzae001bijnr216w4kl5"},{"post_id":"clq4xtz9x000vijnr0o6h2qqc","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzai001gijnrd5hw9bvj"},{"post_id":"clq4xtz9x000vijnr0o6h2qqc","category_id":"clq4xtz9k000jijnr8kk3dc6a","_id":"clq4xtzam001kijnr244c9pb5"},{"post_id":"clq4xtz90000bijnrd6vz57hk","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzaq001oijnr4tmtbj25"},{"post_id":"clq4xtz90000bijnrd6vz57hk","category_id":"clq4xtz9k000jijnr8kk3dc6a","_id":"clq4xtzaw001sijnrbj646j3c"},{"post_id":"clq4xtzad001aijnr55gggunz","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzaz001vijnrdpet1l4u"},{"post_id":"clq4xtzaa0016ijnraj6z6lkm","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzb3001zijnr6m297leo"},{"post_id":"clq4xtzaa0016ijnraj6z6lkm","category_id":"clq4xtz9k000jijnr8kk3dc6a","_id":"clq4xtzb70023ijnrc95y1ocv"},{"post_id":"clq4xtz9b000gijnr0faaeytq","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzbd0027ijnr88ph9hwp"},{"post_id":"clq4xtz9b000gijnr0faaeytq","category_id":"clq4xtzac0018ijnrax4t9pqd","_id":"clq4xtzbh002aijnrewks7w1m"},{"post_id":"clq4xtzag001fijnr5nsodrnb","category_id":"clq4xtzac0018ijnrax4t9pqd","_id":"clq4xtzbs002eijnraj0e9a4s"},{"post_id":"clq4xtz9j000iijnrc5ci8lkk","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzbw002gijnrhpypc6fn"},{"post_id":"clq4xtz9j000iijnrc5ci8lkk","category_id":"clq4xtz9k000jijnr8kk3dc6a","_id":"clq4xtzc2002jijnr9ubs3ct5"},{"post_id":"clq4xtz9j000iijnrc5ci8lkk","category_id":"clq4xtzai001hijnr18yjhsoh","_id":"clq4xtzc6002mijnrduokb1q3"},{"post_id":"clq4xtz9p000nijnrd60g4lbl","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzcb002pijnr5kgh99ms"},{"post_id":"clq4xtz9p000nijnrd60g4lbl","category_id":"clq4xtz9k000jijnr8kk3dc6a","_id":"clq4xtzci002tijnrhx4n1jpg"},{"post_id":"clq4xtz9p000nijnrd60g4lbl","category_id":"clq4xtzai001hijnr18yjhsoh","_id":"clq4xtzcj002xijnr8h8xbeu0"},{"post_id":"clq4xtzay001uijnr1znzafla","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzcm0031ijnrhyf6aa0q"},{"post_id":"clq4xtzay001uijnr1znzafla","category_id":"clq4xtz9k000jijnr8kk3dc6a","_id":"clq4xtzcn0034ijnrbrf6270s"},{"post_id":"clq4xtza1000yijnr6b5j2ayi","category_id":"clq4xtzb0001xijnr358632ai","_id":"clq4xtzcp0037ijnre57e4em0"},{"post_id":"clq4xtzb1001yijnr37teekms","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzcs0039ijnr92nfdlmj"},{"post_id":"clq4xtzb1001yijnr37teekms","category_id":"clq4xtz9k000jijnr8kk3dc6a","_id":"clq4xtzcu003eijnrhy78h8ej"},{"post_id":"clq4xtzb80025ijnr3emtdf1x","category_id":"clq4xtzb0001xijnr358632ai","_id":"clq4xtzcv003hijnr7ht72vut"},{"post_id":"clq4xtzb50022ijnrgw7ycqin","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzcy003mijnrcyi5ei0n"},{"post_id":"clq4xtzb50022ijnrgw7ycqin","category_id":"clq4xtz9k000jijnr8kk3dc6a","_id":"clq4xtzcz003oijnredvo3a21"},{"post_id":"clq4xtz8w0009ijnratonc1nh","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzd1003sijnrasyfflkg"},{"post_id":"clq4xtz8w0009ijnratonc1nh","category_id":"clq4xtz9k000jijnr8kk3dc6a","_id":"clq4xtzd3003uijnrdjoy3qkb"},{"post_id":"clq4xtz8w0009ijnratonc1nh","category_id":"clq4xtzai001hijnr18yjhsoh","_id":"clq4xtzd6003yijnrh2zx26o0"},{"post_id":"clq4xtzbf0028ijnre2fi51oa","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzda0040ijnrcfqkcvxk"},{"post_id":"clq4xtzbi002cijnr9eala391","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzde0043ijnrhgic45md"},{"post_id":"clq4xtzbt002fijnr2fxgfu9i","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzdh0047ijnreruy9n53"},{"post_id":"clq4xtza60012ijnr6nna8dct","category_id":"clq4xtzbq002dijnreg00gfm3","_id":"clq4xtzdk004aijnr1twt85cf"},{"post_id":"clq4xtzby002iijnrevgtgcw2","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzdr004eijnragdqhlbe"},{"post_id":"clq4xtzc3002lijnr7m040u5a","category_id":"clq4xtzbq002dijnreg00gfm3","_id":"clq4xtzdt004gijnrdrx9hqdo"},{"post_id":"clq4xtzal001jijnr98tjdgpm","category_id":"clq4xtzc2002kijnr9bpx77or","_id":"clq4xtzdw004jijnrgtiq4qju"},{"post_id":"clq4xtzc8002oijnr18x16lku","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzdz004mijnrcdqc4nxv"},{"post_id":"clq4xtzce002sijnrexcse04s","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzeb004qijnr98lo0i8z"},{"post_id":"clq4xtzao001nijnr9m9q0rjn","category_id":"clq4xtzb0001xijnr358632ai","_id":"clq4xtzec004sijnr1xho18mm"},{"post_id":"clq4xtzat001rijnr8x78ekol","category_id":"clq4xtzb0001xijnr358632ai","_id":"clq4xtzed004vijnr84u48hjw"},{"post_id":"clq4xtzco0036ijnr9e8c5rim","category_id":"clq4xtzco0035ijnrg81c4suo","_id":"clq4xtzee004yijnrded43kyi"},{"post_id":"clq4xtzci002wijnrcth3crpa","category_id":"clq4xtzco0035ijnrg81c4suo","_id":"clq4xtzeg0052ijnr9p4u8c3w"},{"post_id":"clq4xtzcq0038ijnraklvati5","category_id":"clq4xtzco0035ijnrg81c4suo","_id":"clq4xtzei0056ijnr45jx0iod"},{"post_id":"clq4xtzct003cijnrbaye3b8s","category_id":"clq4xtzco0035ijnrg81c4suo","_id":"clq4xtzek0059ijnrbsjug5e3"},{"post_id":"clq4xtzck0030ijnr6vuj9035","category_id":"clq4xtzco0035ijnrg81c4suo","_id":"clq4xtzeq005cijnr3xet99fh"},{"post_id":"clq4xtzck0030ijnr6vuj9035","category_id":"clq4xtz9k000jijnr8kk3dc6a","_id":"clq4xtzer005gijnr00sx4b6d"},{"post_id":"clq4xtzcm0032ijnrflhg7bed","category_id":"clq4xtzco0035ijnrg81c4suo","_id":"clq4xtzeu005jijnralwm981h"},{"post_id":"clq4xtzd0003rijnr4jbh2f5v","category_id":"clq4xtzcz003qijnrhmticrvg","_id":"clq4xtzev005mijnr5k42dqrp"},{"post_id":"clq4xtzcu003fijnra76h0gpn","category_id":"clq4xtzcz003qijnrhmticrvg","_id":"clq4xtzey005pijnr3k7yfrtm"},{"post_id":"clq4xtzd1003tijnr3obo8dj2","category_id":"clq4xtzcz003qijnrhmticrvg","_id":"clq4xtzez005sijnrfv6uaxoy"},{"post_id":"clq4xtzd4003wijnr1w1u4h7p","category_id":"clq4xtzcz003qijnrhmticrvg","_id":"clq4xtzf0005tijnr2pnbbtnl"},{"post_id":"clq4xtzd6003zijnr03freepu","category_id":"clq4xtzco0035ijnrg81c4suo","_id":"clq4xtzf0005vijnrb4nlg0vo"},{"post_id":"clq4xtzcx003kijnrep2j0h3a","category_id":"clq4xtzd4003xijnreom21t2t","_id":"clq4xtzf1005wijnr9fus1arg"},{"post_id":"clq4xtzdd0041ijnr3hwg18nh","category_id":"clq4xtzco0035ijnrg81c4suo","_id":"clq4xtzf2005yijnr5cmg33bt"},{"post_id":"clq4xtzcy003nijnr9vme5057","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzf20060ijnrbn2g2gst"},{"post_id":"clq4xtzcy003nijnr9vme5057","category_id":"clq4xtzde0044ijnre1kg4fwl","_id":"clq4xtzf20063ijnrc3ak9br4"},{"post_id":"clq4xtzdg0046ijnr90kd8whh","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzf30064ijnrf70kgims"},{"post_id":"clq4xtzdg0046ijnr90kd8whh","category_id":"clq4xtzco0035ijnrg81c4suo","_id":"clq4xtzf30066ijnr4epu02d2"},{"post_id":"clq4xtzdi0049ijnr8lugeppq","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzf40068ijnrb8gma368"},{"post_id":"clq4xtzdi0049ijnr8lugeppq","category_id":"clq4xtzco0035ijnrg81c4suo","_id":"clq4xtzf4006bijnr57gj8b96"},{"post_id":"clq4xtzdn004dijnr05yrhn0m","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzf4006cijnrc2twcybw"},{"post_id":"clq4xtzdn004dijnr05yrhn0m","category_id":"clq4xtzbq002dijnreg00gfm3","_id":"clq4xtzf5006dijnr8vos54up"},{"post_id":"clq4xtzdv004iijnrewh7aqvb","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzf5006gijnrege082v0"},{"post_id":"clq4xtzdr004fijnrbwx57cr0","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzf5006iijnr8xy07jr5"},{"post_id":"clq4xtzdr004fijnrbwx57cr0","category_id":"clq4xtzbq002dijnreg00gfm3","_id":"clq4xtzf7006kijnrddfzb7cn"},{"post_id":"clq4xtzdy004lijnr94ohczsz","category_id":"clq4xtzbq002dijnreg00gfm3","_id":"clq4xtzf7006mijnrb9vmflto"},{"post_id":"clq4xtzeb004rijnrdfm13ky4","category_id":"clq4xtzb0001xijnr358632ai","_id":"clq4xtzf8006oijnr48mw7o60"},{"post_id":"clq4xtzea004pijnrb46ldvvo","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzf8006pijnrd66g6473"},{"post_id":"clq4xtzea004pijnrb46ldvvo","category_id":"clq4xtzbq002dijnreg00gfm3","_id":"clq4xtzf9006rijnr7zllf39r"},{"post_id":"clq4xtzee004xijnrdwkh07jr","category_id":"clq4xtzb0001xijnr358632ai","_id":"clq4xtzf9006sijnr9wemaviu"},{"post_id":"clq4xtzec004tijnr70f4a415","category_id":"clq4xtzeg0051ijnr7azu2404","_id":"clq4xtzf9006uijnrfjjxhuiv"},{"post_id":"clq4xtzei0057ijnrahnn2k72","category_id":"clq4xtzbq002dijnreg00gfm3","_id":"clq4xtzf9006wijnr7kje2fvp"},{"post_id":"clq4xtzep005bijnr2v5sf4q4","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzfa006yijnr17u08j8y"},{"post_id":"clq4xtzef0050ijnr5dkshhqo","category_id":"clq4xtzeg0051ijnr7azu2404","_id":"clq4xtzfa0071ijnr3o4p3ly6"},{"post_id":"clq4xtzeq005eijnr4l955y4b","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzfa0072ijnr3d8b6trz"},{"post_id":"clq4xtzes005iijnrc20k3030","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzfb0074ijnr3vj42ugf"},{"post_id":"clq4xtzeh0054ijnr3anrb7ys","category_id":"clq4xtzer005fijnr60d1gl7h","_id":"clq4xtzfb0075ijnr1omf81rr"},{"post_id":"clq4xtzeu005lijnrbwoybu0h","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzfd0077ijnrgixo1z7f"},{"post_id":"clq4xtzev005nijnr3lnzd3so","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzfd0079ijnrc9i7bjqe"},{"post_id":"clq4xtzey005rijnrav8yhkcm","category_id":"clq4xtz8k0004ijnrex12eyz8","_id":"clq4xtzfe007cijnr7x54faa0"}],"PostTag":[{"post_id":"clq4xtz850001ijnrdkte5o5e","tag_id":"clq4xtz8p0005ijnr0y4h4rgj","_id":"clq4xtz98000eijnr0z6y8002"},{"post_id":"clq4xtz8g0003ijnrfhwehspi","tag_id":"clq4xtz94000dijnrg6my3rda","_id":"clq4xtz9q000oijnrb8ib2klw"},{"post_id":"clq4xtz8r0007ijnralwtblgi","tag_id":"clq4xtz9m000lijnrfivs44xj","_id":"clq4xtza0000wijnrby8b4jns"},{"post_id":"clq4xtz8w0009ijnratonc1nh","tag_id":"clq4xtz9v000tijnrgee3bn9b","_id":"clq4xtza90014ijnr1ozic4qk"},{"post_id":"clq4xtz90000bijnrd6vz57hk","tag_id":"clq4xtza50010ijnr6pz0ccxe","_id":"clq4xtzaf001dijnrewdnbxfl"},{"post_id":"clq4xtz9b000gijnr0faaeytq","tag_id":"clq4xtzae001cijnr998608md","_id":"clq4xtzb0001wijnr7jru0hak"},{"post_id":"clq4xtz9b000gijnr0faaeytq","tag_id":"clq4xtzan001lijnr0cs7f3lx","_id":"clq4xtzb30020ijnracayapj4"},{"post_id":"clq4xtz9j000iijnrc5ci8lkk","tag_id":"clq4xtzaw001tijnr1tf9garz","_id":"clq4xtzb80024ijnreahe2q8i"},{"post_id":"clq4xtz9p000nijnrd60g4lbl","tag_id":"clq4xtzb40021ijnr2y472qfg","_id":"clq4xtzbi002bijnr2g1gdw3g"},{"post_id":"clq4xtz9s000qijnr1vwy13tj","tag_id":"clq4xtzbg0029ijnr3okc1qlp","_id":"clq4xtzcb002qijnr4wm453tc"},{"post_id":"clq4xtz9s000qijnr1vwy13tj","tag_id":"clq4xtzbw002hijnrgeij5cx2","_id":"clq4xtzci002uijnr281uf4s6"},{"post_id":"clq4xtz9x000vijnr0o6h2qqc","tag_id":"clq4xtzc6002nijnrbg7fcqkx","_id":"clq4xtzck002zijnr2ha8bqe5"},{"post_id":"clq4xtza1000yijnr6b5j2ayi","tag_id":"clq4xtzci002vijnrhrstatod","_id":"clq4xtzcu003dijnr14nbfodf"},{"post_id":"clq4xtza1000yijnr6b5j2ayi","tag_id":"clq4xtzcn0033ijnralykdupi","_id":"clq4xtzcv003gijnra4ja8ibw"},{"post_id":"clq4xtza60012ijnr6nna8dct","tag_id":"clq4xtzcn0033ijnralykdupi","_id":"clq4xtzcy003lijnr2bvog40g"},{"post_id":"clq4xtzaa0016ijnraj6z6lkm","tag_id":"clq4xtzcv003iijnr5bme5bim","_id":"clq4xtzdg0045ijnr2dggact6"},{"post_id":"clq4xtzaa0016ijnraj6z6lkm","tag_id":"clq4xtzcz003pijnr9sc1g3lr","_id":"clq4xtzdi0048ijnrgf07hhop"},{"post_id":"clq4xtzaa0016ijnraj6z6lkm","tag_id":"clq4xtzd3003vijnrdp02arsm","_id":"clq4xtzdn004cijnr7nwj445s"},{"post_id":"clq4xtzad001aijnr55gggunz","tag_id":"clq4xtzde0042ijnr17gg7hv0","_id":"clq4xtzdw004kijnr3yfqam4c"},{"post_id":"clq4xtzad001aijnr55gggunz","tag_id":"clq4xtzdl004bijnrhphoe744","_id":"clq4xtze0004nijnr6kst9hbs"},{"post_id":"clq4xtzag001fijnr5nsodrnb","tag_id":"clq4xtzdu004hijnra21sc895","_id":"clq4xtzed004wijnr8mil9j8d"},{"post_id":"clq4xtzag001fijnr5nsodrnb","tag_id":"clq4xtze9004oijnrdu1agi4v","_id":"clq4xtzef004zijnr63dzd4g6"},{"post_id":"clq4xtzal001jijnr98tjdgpm","tag_id":"clq4xtzed004uijnrd1gt5pak","_id":"clq4xtzei0055ijnrcd1xh2gj"},{"post_id":"clq4xtzao001nijnr9m9q0rjn","tag_id":"clq4xtzeg0053ijnrflubgbe2","_id":"clq4xtzeq005dijnr0swe528l"},{"post_id":"clq4xtzat001rijnr8x78ekol","tag_id":"clq4xtzep005aijnr7od305gd","_id":"clq4xtzeu005kijnr93682x5i"},{"post_id":"clq4xtzay001uijnr1znzafla","tag_id":"clq4xtzes005hijnr85xc1fhg","_id":"clq4xtzey005qijnrgw2ge9wm"},{"post_id":"clq4xtzb1001yijnr37teekms","tag_id":"clq4xtzev005oijnreyhb4hf3","_id":"clq4xtzf2005zijnrgfo6ele4"},{"post_id":"clq4xtzb1001yijnr37teekms","tag_id":"clq4xtzf0005uijnrh8xx63ak","_id":"clq4xtzf20061ijnra28weqap"},{"post_id":"clq4xtzb50022ijnrgw7ycqin","tag_id":"clq4xtzf1005xijnrb6kzfsba","_id":"clq4xtzf40067ijnr0a975w5h"},{"post_id":"clq4xtzb50022ijnrgw7ycqin","tag_id":"clq4xtzf20062ijnrhsrhczer","_id":"clq4xtzf40069ijnr32tue3or"},{"post_id":"clq4xtzb80025ijnr3emtdf1x","tag_id":"clq4xtzep005aijnr7od305gd","_id":"clq4xtzf5006fijnrheyk3kf9"},{"post_id":"clq4xtzb80025ijnr3emtdf1x","tag_id":"clq4xtzf4006aijnrbh7v1iz2","_id":"clq4xtzf5006hijnr7jq4axk0"},{"post_id":"clq4xtzbf0028ijnre2fi51oa","tag_id":"clq4xtzf5006eijnrfwrphkym","_id":"clq4xtzf7006lijnr44d4935f"},{"post_id":"clq4xtzbi002cijnr9eala391","tag_id":"clq4xtzf5006jijnrcsxi5k9x","_id":"clq4xtzf9006vijnrg5wh3p34"},{"post_id":"clq4xtzbi002cijnr9eala391","tag_id":"clq4xtzf0005uijnrh8xx63ak","_id":"clq4xtzfa006xijnr90sc7ssu"},{"post_id":"clq4xtzbi002cijnr9eala391","tag_id":"clq4xtzf8006qijnrajyjdhif","_id":"clq4xtzfa0070ijnrd5fk6pqg"},{"post_id":"clq4xtzbt002fijnr2fxgfu9i","tag_id":"clq4xtzf9006tijnr099vb9a1","_id":"clq4xtzfd0078ijnr9cm2ffxb"},{"post_id":"clq4xtzbt002fijnr2fxgfu9i","tag_id":"clq4xtzfa006zijnr0eevabe2","_id":"clq4xtzfd007aijnrc098bhp4"},{"post_id":"clq4xtzbt002fijnr2fxgfu9i","tag_id":"clq4xtzfa0073ijnr5wlh3gry","_id":"clq4xtzfe007dijnr7756ampd"},{"post_id":"clq4xtzby002iijnrevgtgcw2","tag_id":"clq4xtzfb0076ijnrbqwx78tk","_id":"clq4xtzff007fijnr5zbva8dl"},{"post_id":"clq4xtzby002iijnrevgtgcw2","tag_id":"clq4xtzfe007bijnr8wzu4gd3","_id":"clq4xtzff007gijnrf2qu5zk6"},{"post_id":"clq4xtzc3002lijnr7m040u5a","tag_id":"clq4xtzcn0033ijnralykdupi","_id":"clq4xtzfh007jijnr1lk9g373"},{"post_id":"clq4xtzc3002lijnr7m040u5a","tag_id":"clq4xtzfg007hijnr4epvccq5","_id":"clq4xtzfh007kijnr69cdc7wp"},{"post_id":"clq4xtzc8002oijnr18x16lku","tag_id":"clq4xtzfg007iijnr35khduh2","_id":"clq4xtzfi007nijnrbvsj1bz1"},{"post_id":"clq4xtzc8002oijnr18x16lku","tag_id":"clq4xtzfh007lijnrhnu3bot6","_id":"clq4xtzfj007oijnr9iei3ouu"},{"post_id":"clq4xtzce002sijnrexcse04s","tag_id":"clq4xtzfi007mijnrao8fb60g","_id":"clq4xtzfk007qijnr6zgwh627"},{"post_id":"clq4xtzci002wijnrcth3crpa","tag_id":"clq4xtzfj007pijnrb57s8ahr","_id":"clq4xtzfk007sijnr3suzfstk"},{"post_id":"clq4xtzck0030ijnr6vuj9035","tag_id":"clq4xtzfk007rijnrdvbw4yio","_id":"clq4xtzfl007vijnr8zk4g3yj"},{"post_id":"clq4xtzck0030ijnr6vuj9035","tag_id":"clq4xtzbg0029ijnr3okc1qlp","_id":"clq4xtzfl007wijnr2hp7e62u"},{"post_id":"clq4xtzck0030ijnr6vuj9035","tag_id":"clq4xtzfk007tijnrbodg2thk","_id":"clq4xtzfl007yijnr80c80tki"},{"post_id":"clq4xtzcm0032ijnrflhg7bed","tag_id":"clq4xtzfk007uijnrapgt6p71","_id":"clq4xtzfm0081ijnr0pe6b5k8"},{"post_id":"clq4xtzcm0032ijnrflhg7bed","tag_id":"clq4xtzfk007tijnrbodg2thk","_id":"clq4xtzfm0082ijnr25991b74"},{"post_id":"clq4xtzcm0032ijnrflhg7bed","tag_id":"clq4xtzfl007zijnrceoacs4a","_id":"clq4xtzfm0084ijnr2c73a7uc"},{"post_id":"clq4xtzco0036ijnr9e8c5rim","tag_id":"clq4xtzfl0080ijnred7w2zrv","_id":"clq4xtzfn0087ijnrfujbhe7a"},{"post_id":"clq4xtzco0036ijnr9e8c5rim","tag_id":"clq4xtzfm0083ijnreuex3kc1","_id":"clq4xtzfn0088ijnrfvw28dsq"},{"post_id":"clq4xtzco0036ijnr9e8c5rim","tag_id":"clq4xtzfn0085ijnr7d8bcasb","_id":"clq4xtzfo008aijnrdznebzt6"},{"post_id":"clq4xtzcq0038ijnraklvati5","tag_id":"clq4xtzfn0086ijnrdubxblap","_id":"clq4xtzfo008bijnr1qukh26q"},{"post_id":"clq4xtzct003cijnrbaye3b8s","tag_id":"clq4xtzfo0089ijnrh7lafws4","_id":"clq4xtzfo008dijnre6go4vtv"},{"post_id":"clq4xtzcu003fijnra76h0gpn","tag_id":"clq4xtzfo008cijnrfij81egj","_id":"clq4xtzfp008fijnr0c6u60w4"},{"post_id":"clq4xtzcx003kijnrep2j0h3a","tag_id":"clq4xtzfp008eijnrdicu0ehk","_id":"clq4xtzfs008iijnrfrpf02lf"},{"post_id":"clq4xtzcx003kijnrep2j0h3a","tag_id":"clq4xtzfp008gijnr7ld60rha","_id":"clq4xtzfs008jijnr467rgmlk"},{"post_id":"clq4xtzcy003nijnr9vme5057","tag_id":"clq4xtzfs008hijnr1o2zd0o9","_id":"clq4xtzfu008mijnr9fzd6wzb"},{"post_id":"clq4xtzcy003nijnr9vme5057","tag_id":"clq4xtzft008kijnrc4jefx9y","_id":"clq4xtzfu008nijnrhdgo72s1"},{"post_id":"clq4xtzd0003rijnr4jbh2f5v","tag_id":"clq4xtzfo008cijnrfij81egj","_id":"clq4xtzfw008qijnr43pnfgsl"},{"post_id":"clq4xtzd0003rijnr4jbh2f5v","tag_id":"clq4xtzfu008oijnr3bik9qt8","_id":"clq4xtzfw008rijnr2hfs8xt8"},{"post_id":"clq4xtzd1003tijnr3obo8dj2","tag_id":"clq4xtzfo008cijnrfij81egj","_id":"clq4xtzfx008tijnrbwi1cw2n"},{"post_id":"clq4xtzd4003wijnr1w1u4h7p","tag_id":"clq4xtzfo008cijnrfij81egj","_id":"clq4xtzfz008wijnrgos74v4m"},{"post_id":"clq4xtzd4003wijnr1w1u4h7p","tag_id":"clq4xtzfx008uijnrc00m92my","_id":"clq4xtzfz008xijnrhg684ho8"},{"post_id":"clq4xtzd6003zijnr03freepu","tag_id":"clq4xtzfy008vijnrfb5x75bs","_id":"clq4xtzfz008zijnrg95cbdnp"},{"post_id":"clq4xtzdd0041ijnr3hwg18nh","tag_id":"clq4xtzfz008yijnr8luq66ib","_id":"clq4xtzg10093ijnr7o5l4mfx"},{"post_id":"clq4xtzdd0041ijnr3hwg18nh","tag_id":"clq4xtzfz0090ijnr72ndbai6","_id":"clq4xtzg20094ijnr9ff83u6o"},{"post_id":"clq4xtzdd0041ijnr3hwg18nh","tag_id":"clq4xtzg00091ijnr3k3b2gvn","_id":"clq4xtzg30096ijnrdk6sf8es"},{"post_id":"clq4xtzdg0046ijnr90kd8whh","tag_id":"clq4xtzg10092ijnrg5t1a96f","_id":"clq4xtzg40098ijnr9l4e6t6p"},{"post_id":"clq4xtzdg0046ijnr90kd8whh","tag_id":"clq4xtzg20095ijnrdzo93mlc","_id":"clq4xtzg40099ijnr0b6gbykp"},{"post_id":"clq4xtzdi0049ijnr8lugeppq","tag_id":"clq4xtzg30097ijnr1zgjgods","_id":"clq4xtzg5009dijnr0iwtajo5"},{"post_id":"clq4xtzdi0049ijnr8lugeppq","tag_id":"clq4xtzg4009aijnr6qqsa7ca","_id":"clq4xtzg6009eijnr5b8scmvg"},{"post_id":"clq4xtzdi0049ijnr8lugeppq","tag_id":"clq4xtzg5009bijnr42wkbwmz","_id":"clq4xtzg6009gijnr74qs9bvk"},{"post_id":"clq4xtzdn004dijnr05yrhn0m","tag_id":"clq4xtzcn0033ijnralykdupi","_id":"clq4xtzg6009hijnrh5p642ks"},{"post_id":"clq4xtzdn004dijnr05yrhn0m","tag_id":"clq4xtzg5009cijnr8wkr6f52","_id":"clq4xtzg7009jijnrdvng0yfc"},{"post_id":"clq4xtzdr004fijnrbwx57cr0","tag_id":"clq4xtzcn0033ijnralykdupi","_id":"clq4xtzg8009lijnrc7k74rh9"},{"post_id":"clq4xtzdr004fijnrbwx57cr0","tag_id":"clq4xtzg6009fijnr6f1c768f","_id":"clq4xtzg9009mijnreg4tfo8o"},{"post_id":"clq4xtzdr004fijnrbwx57cr0","tag_id":"clq4xtzfg007hijnr4epvccq5","_id":"clq4xtzg9009oijnr8kjtcnl2"},{"post_id":"clq4xtzdv004iijnrewh7aqvb","tag_id":"clq4xtzg8009kijnra7cfg53a","_id":"clq4xtzg9009qijnrd4dh2ik8"},{"post_id":"clq4xtzdv004iijnrewh7aqvb","tag_id":"clq4xtzg9009nijnrcplb3gdm","_id":"clq4xtzga009rijnr9qf55hib"},{"post_id":"clq4xtzdy004lijnr94ohczsz","tag_id":"clq4xtzcn0033ijnralykdupi","_id":"clq4xtzga009tijnrbdrhdbob"},{"post_id":"clq4xtzdy004lijnr94ohczsz","tag_id":"clq4xtzg9009pijnrcmlc3ikv","_id":"clq4xtzga009uijnr6olr4pud"},{"post_id":"clq4xtzea004pijnrb46ldvvo","tag_id":"clq4xtzcn0033ijnralykdupi","_id":"clq4xtzgb009wijnr86815w7s"},{"post_id":"clq4xtzea004pijnrb46ldvvo","tag_id":"clq4xtzga009sijnrcqt8dntm","_id":"clq4xtzgb009xijnrhydfh0nr"},{"post_id":"clq4xtzeb004rijnrdfm13ky4","tag_id":"clq4xtzep005aijnr7od305gd","_id":"clq4xtzgc009zijnr3qiigzkz"},{"post_id":"clq4xtzec004tijnr70f4a415","tag_id":"clq4xtzgb009yijnrdt3r7r41","_id":"clq4xtzgd00a1ijnr4sfq5v1x"},{"post_id":"clq4xtzee004xijnrdwkh07jr","tag_id":"clq4xtzep005aijnr7od305gd","_id":"clq4xtzgd00a3ijnres1sbdod"},{"post_id":"clq4xtzef0050ijnr5dkshhqo","tag_id":"clq4xtzgd00a2ijnr2cr01gow","_id":"clq4xtzge00a5ijnr1kvh5e39"},{"post_id":"clq4xtzeh0054ijnr3anrb7ys","tag_id":"clq4xtzgd00a4ijnrdind23uo","_id":"clq4xtzge00a7ijnrdsfo93zq"},{"post_id":"clq4xtzei0057ijnrahnn2k72","tag_id":"clq4xtzge00a6ijnr3ujdfvjk","_id":"clq4xtzge00a9ijnrawzk7vqg"},{"post_id":"clq4xtzep005bijnr2v5sf4q4","tag_id":"clq4xtzge00a8ijnrgmi2dbkp","_id":"clq4xtzgf00abijnr6w04ff22"},{"post_id":"clq4xtzeq005eijnr4l955y4b","tag_id":"clq4xtzge00aaijnr9mneap93","_id":"clq4xtzgf00adijnr0cpu3ope"},{"post_id":"clq4xtzes005iijnrc20k3030","tag_id":"clq4xtzgf00acijnr0bxd7e3c","_id":"clq4xtzgg00agijnrhhdshvqn"},{"post_id":"clq4xtzes005iijnrc20k3030","tag_id":"clq4xtzgf00aeijnrd1xuf2ud","_id":"clq4xtzgg00ahijnr7zoe63il"},{"post_id":"clq4xtzeu005lijnrbwoybu0h","tag_id":"clq4xtzgf00afijnrbbhlhhs4","_id":"clq4xtzgg00ajijnr81qp5fys"},{"post_id":"clq4xtzev005nijnr3lnzd3so","tag_id":"clq4xtzgg00aiijnrac0f8rbc","_id":"clq4xtzgh00alijnrhxk37com"},{"post_id":"clq4xtzey005rijnrav8yhkcm","tag_id":"clq4xtzgg00akijnr4tzn27vc","_id":"clq4xtzgh00amijnrbtsve9vc"}],"Tag":[{"name":"frp 内网穿透","_id":"clq4xtz8p0005ijnr0y4h4rgj"},{"name":"Linux 进程","_id":"clq4xtz94000dijnrg6my3rda"},{"name":"Clamav","_id":"clq4xtz9m000lijnrfivs44xj"},{"name":"LVM","_id":"clq4xtz9v000tijnrgee3bn9b"},{"name":"elasticsearch","_id":"clq4xtza50010ijnr6pz0ccxe"},{"name":"iptables","_id":"clq4xtzae001cijnr998608md"},{"name":"firewalls","_id":"clq4xtzan001lijnr0cs7f3lx"},{"name":"monitor","_id":"clq4xtzaw001tijnr1tf9garz"},{"name":"password","_id":"clq4xtzb40021ijnr2y472qfg"},{"name":"openssl","_id":"clq4xtzbg0029ijnr3okc1qlp"},{"name":"openssh","_id":"clq4xtzbw002hijnrgeij5cx2"},{"name":"gcc","_id":"clq4xtzc6002nijnrbg7fcqkx"},{"name":"apache-doris","_id":"clq4xtzci002vijnrhrstatod"},{"name":"docker","_id":"clq4xtzcn0033ijnralykdupi"},{"name":"nginx","_id":"clq4xtzcv003iijnr5bme5bim"},{"name":"keepalived","_id":"clq4xtzcz003pijnr9sc1g3lr"},{"name":"HA","_id":"clq4xtzd3003vijnrdp02arsm"},{"name":"shell","_id":"clq4xtzde0042ijnr17gg7hv0"},{"name":"重定向","_id":"clq4xtzdl004bijnrhphoe744"},{"name":"路由","_id":"clq4xtzdu004hijnra21sc895"},{"name":"windows","_id":"clq4xtze9004oijnrdu1agi4v"},{"name":"ownership","_id":"clq4xtzed004uijnrd1gt5pak"},{"name":"Oracle","_id":"clq4xtzeg0053ijnrflubgbe2"},{"name":"MySQL","_id":"clq4xtzep005aijnr7od305gd"},{"name":"sudo","_id":"clq4xtzes005hijnr85xc1fhg"},{"name":"mkfs.ext4","_id":"clq4xtzev005oijnreyhb4hf3"},{"name":"mount","_id":"clq4xtzf0005uijnrh8xx63ak"},{"name":"repo","_id":"clq4xtzf1005xijnrb6kzfsba"},{"name":"yum","_id":"clq4xtzf20062ijnrhsrhczer"},{"name":"backup","_id":"clq4xtzf4006aijnrbh7v1iz2"},{"name":"access","_id":"clq4xtzf5006eijnrfwrphkym"},{"name":"fstab","_id":"clq4xtzf5006jijnrcsxi5k9x"},{"name":"umount","_id":"clq4xtzf8006qijnrajyjdhif"},{"name":"ssh","_id":"clq4xtzf9006tijnr099vb9a1"},{"name":"远程登录","_id":"clq4xtzfa006zijnr0eevabe2"},{"name":"ssh协议","_id":"clq4xtzfa0073ijnr5wlh3gry"},{"name":"xserver","_id":"clq4xtzfb0076ijnrbqwx78tk"},{"name":"桌面","_id":"clq4xtzfe007bijnr8wzu4gd3"},{"name":"容器","_id":"clq4xtzfg007hijnr4epvccq5"},{"name":"telnet","_id":"clq4xtzfg007iijnr35khduh2"},{"name":"xinetd","_id":"clq4xtzfh007lijnrhnu3bot6"},{"name":"php","_id":"clq4xtzfi007mijnrao8fb60g"},{"name":"nextcloud","_id":"clq4xtzfj007pijnrb57s8ahr"},{"name":"CA","_id":"clq4xtzfk007rijnrdvbw4yio"},{"name":"https","_id":"clq4xtzfk007tijnrbodg2thk"},{"name":"ca","_id":"clq4xtzfk007uijnrapgt6p71"},{"name":"acme.sh","_id":"clq4xtzfl007zijnrceoacs4a"},{"name":"tcpdump","_id":"clq4xtzfl0080ijnred7w2zrv"},{"name":"wireshark","_id":"clq4xtzfm0083ijnreuex3kc1"},{"name":"抓包","_id":"clq4xtzfn0085ijnr7d8bcasb"},{"name":"redis","_id":"clq4xtzfn0086ijnrdubxblap"},{"name":"SSH","_id":"clq4xtzfo0089ijnrh7lafws4"},{"name":"OpenWrt","_id":"clq4xtzfo008cijnrfij81egj"},{"name":"kvm","_id":"clq4xtzfp008eijnrdicu0ehk"},{"name":"qemu","_id":"clq4xtzfp008gijnr7ld60rha"},{"name":"Ubuntu","_id":"clq4xtzfs008hijnr1o2zd0o9"},{"name":"network","_id":"clq4xtzft008kijnrc4jefx9y"},{"name":"passwall","_id":"clq4xtzfu008oijnr3bik9qt8"},{"name":"frpc","_id":"clq4xtzfx008uijnrc00m92my"},{"name":"DevOps","_id":"clq4xtzfy008vijnrfb5x75bs"},{"name":"挖矿","_id":"clq4xtzfz008yijnr8luq66ib"},{"name":"xmrig","_id":"clq4xtzfz0090ijnr72ndbai6"},{"name":"Cryptocurrency-Mining-Malware","_id":"clq4xtzg00091ijnr3k3b2gvn"},{"name":"pid","_id":"clq4xtzg10092ijnrg5t1a96f"},{"name":"progress","_id":"clq4xtzg20095ijnrdzo93mlc"},{"name":"v2ray","_id":"clq4xtzg30097ijnr1zgjgods"},{"name":"xray","_id":"clq4xtzg4009aijnr6qqsa7ca"},{"name":"v2rayA","_id":"clq4xtzg5009bijnr42wkbwmz"},{"name":"systemd","_id":"clq4xtzg5009cijnr8wkr6f52"},{"name":"Dockerfile","_id":"clq4xtzg6009fijnr6f1c768f"},{"name":"centos","_id":"clq4xtzg8009kijnra7cfg53a"},{"name":"downgrade","_id":"clq4xtzg9009nijnrcplb3gdm"},{"name":"registry","_id":"clq4xtzg9009pijnrcmlc3ikv"},{"name":"docker-compose","_id":"clq4xtzga009sijnrcqt8dntm"},{"name":"Prometheus","_id":"clq4xtzgb009yijnrdt3r7r41"},{"name":"Grafana","_id":"clq4xtzgd00a2ijnr2cr01gow"},{"name":"gitlab","_id":"clq4xtzgd00a4ijnrdind23uo"},{"name":"harbor","_id":"clq4xtzge00a6ijnr3ujdfvjk"},{"name":"security","_id":"clq4xtzge00a8ijnrgmi2dbkp"},{"name":"mysql","_id":"clq4xtzge00aaijnr9mneap93"},{"name":"SecureCRT","_id":"clq4xtzgf00acijnr0bxd7e3c"},{"name":"xshell","_id":"clq4xtzgf00aeijnrd1xuf2ud"},{"name":"samba","_id":"clq4xtzgf00afijnrbbhlhhs4"},{"name":"hexo","_id":"clq4xtzgg00aiijnrac0f8rbc"},{"name":"Tips","_id":"clq4xtzgg00akijnr4tzn27vc"}]}}